/*******************************************************************************
 * Copyright 2017 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
if (window.Element && !Element.prototype.closest) {
    // eslint valid-jsdoc: "off"
    Element.prototype.closest =
        function(s) {
            "use strict";
            var matches = (this.document || this.ownerDocument).querySelectorAll(s);
            var el      = this;
            var i;
            do {
                i = matches.length;
                while (--i >= 0 && matches.item(i) !== el) {
                    // continue
                }
            } while ((i < 0) && (el = el.parentElement));
            return el;
        };
}

if (window.Element && !Element.prototype.matches) {
    Element.prototype.matches =
        Element.prototype.matchesSelector ||
        Element.prototype.mozMatchesSelector ||
        Element.prototype.msMatchesSelector ||
        Element.prototype.oMatchesSelector ||
        Element.prototype.webkitMatchesSelector ||
        function(s) {
            "use strict";
            var matches = (this.document || this.ownerDocument).querySelectorAll(s);
            var i       = matches.length;
            while (--i >= 0 && matches.item(i) !== this) {
                // continue
            }
            return i > -1;
        };
}

if (!Object.assign) {
    Object.assign = function(target, varArgs) { // .length of function is 2
        "use strict";
        if (target === null) {
            throw new TypeError("Cannot convert undefined or null to object");
        }

        var to = Object(target);

        for (var index = 1; index < arguments.length; index++) {
            var nextSource = arguments[index];

            if (nextSource !== null) {
                for (var nextKey in nextSource) {
                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                        to[nextKey] = nextSource[nextKey];
                    }
                }
            }
        }
        return to;
    };
}

(function(arr) {
    "use strict";
    arr.forEach(function(item) {
        if (item.hasOwnProperty("remove")) {
            return;
        }
        Object.defineProperty(item, "remove", {
            configurable: true,
            enumerable: true,
            writable: true,
            value: function remove() {
                this.parentNode.removeChild(this);
            }
        });
    });
})([Element.prototype, CharacterData.prototype, DocumentType.prototype]);

/*******************************************************************************
 * Copyright 2016 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {
    "use strict";

    var NS = "cmp";
    var IS = "image";

    var EMPTY_PIXEL = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
    var LAZY_THRESHOLD = 0;
    var SRC_URI_TEMPLATE_WIDTH_VAR = "{.width}";

    var selectors = {
        self: "[data-" + NS + '-is="' + IS + '"]',
        image: '[data-cmp-hook-image="image"]',
        map: '[data-cmp-hook-image="map"]',
        area: '[data-cmp-hook-image="area"]'
    };

    var lazyLoader = {
        "cssClass": "cmp-image__image--is-loading",
        "style": {
            "height": 0,
            "padding-bottom": "" // will be replaced with % ratio
        }
    };

    var properties = {
        /**
         * An array of alternative image widths (in pixels).
         * Used to replace a {.width} variable in the src property with an optimal width if a URI template is provided.
         *
         * @memberof Image
         * @type {Number[]}
         * @default []
         */
        "widths": {
            "default": [],
            "transform": function(value) {
                var widths = [];
                value.split(",").forEach(function(item) {
                    item = parseFloat(item);
                    if (!isNaN(item)) {
                        widths.push(item);
                    }
                });
                return widths;
            }
        },
        /**
         * Indicates whether the image should be rendered lazily.
         *
         * @memberof Image
         * @type {Boolean}
         * @default false
         */
        "lazy": {
            "default": false,
            "transform": function(value) {
                return !(value === null || typeof value === "undefined");
            }
        },
        /**
         * The image source.
         *
         * Can be a simple image source, or a URI template representation that
         * can be variable expanded - useful for building an image configuration with an alternative width.
         * e.g. '/path/image.coreimg{.width}.jpeg/1506620954214.jpeg'
         *
         * @memberof Image
         * @type {String}
         */
        "src": {
        }
    };

    var devicePixelRatio = window.devicePixelRatio || 1;

    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    function Image(config) {
        var that = this;

        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            setupProperties(config.options);
            cacheElements(config.element);

            if (!that._elements.noscript) {
                return;
            }

            that._elements.container = that._elements.link ? that._elements.link : that._elements.self;

            unwrapNoScript();

            if (that._properties.lazy) {
                addLazyLoader();
            }

            if (that._elements.map) {
                that._elements.image.addEventListener("load", onLoad);
            }

            window.addEventListener("scroll", that.update);
            window.addEventListener("resize", onWindowResize);
            window.addEventListener("update", that.update);
            that._elements.image.addEventListener("cmp-image-redraw", that.update);
            that.update();
        }

        function loadImage() {
            var hasWidths = that._properties.widths && that._properties.widths.length > 0;
            var replacement = hasWidths ? "." + getOptimalWidth() : "";
            var url = that._properties.src.replace(SRC_URI_TEMPLATE_WIDTH_VAR, replacement);

            if (that._elements.image.getAttribute("src") !== url) {
                that._elements.image.setAttribute("src", url);
                if (!hasWidths) {
                    window.removeEventListener("scroll", that.update);
                }
            }

            if (that._lazyLoaderShowing) {
                that._elements.image.addEventListener("load", removeLazyLoader);
            }
        }

        function getOptimalWidth() {
            var container = that._elements.self;
            var containerWidth = container.clientWidth;
            while (containerWidth === 0 && container.parentNode) {
                container = container.parentNode;
                containerWidth = container.clientWidth;
            }
            var optimalWidth = containerWidth * devicePixelRatio;
            var len = that._properties.widths.length;
            var key = 0;

            while ((key < len - 1) && (that._properties.widths[key] < optimalWidth)) {
                key++;
            }

            return that._properties.widths[key].toString();
        }

        function addLazyLoader() {
            var width = that._elements.image.getAttribute("width");
            var height = that._elements.image.getAttribute("height");

            if (width && height) {
                var ratio = (height / width) * 100;
                var styles = lazyLoader.style;

                styles["padding-bottom"] = ratio + "%";

                for (var s in styles) {
                    if (styles.hasOwnProperty(s)) {
                        that._elements.image.style[s] = styles[s];
                    }
                }
            }
            that._elements.image.setAttribute("src", EMPTY_PIXEL);
            that._elements.image.classList.add(lazyLoader.cssClass);
            that._lazyLoaderShowing = true;
        }

        function unwrapNoScript() {
            var markup = decodeNoscript(that._elements.noscript.textContent.trim());
            var parser = new DOMParser();

            // temporary document avoids requesting the image before removing its src
            var temporaryDocument = parser.parseFromString(markup, "text/html");
            var imageElement = temporaryDocument.querySelector(selectors.image);
            imageElement.removeAttribute("src");
            that._elements.container.insertBefore(imageElement, that._elements.noscript);

            var mapElement = temporaryDocument.querySelector(selectors.map);
            if (mapElement) {
                that._elements.container.insertBefore(mapElement, that._elements.noscript);
            }

            that._elements.noscript.parentNode.removeChild(that._elements.noscript);
            if (that._elements.container.matches(selectors.image)) {
                that._elements.image = that._elements.container;
            } else {
                that._elements.image = that._elements.container.querySelector(selectors.image);
            }

            that._elements.map = that._elements.container.querySelector(selectors.map);
            that._elements.areas = that._elements.container.querySelectorAll(selectors.area);
        }

        function removeLazyLoader() {
            that._elements.image.classList.remove(lazyLoader.cssClass);
            for (var property in lazyLoader.style) {
                if (lazyLoader.style.hasOwnProperty(property)) {
                    that._elements.image.style[property] = "";
                }
            }
            that._elements.image.removeEventListener("load", removeLazyLoader);
            that._lazyLoaderShowing = false;
        }

        function isLazyVisible() {
            if (that._elements.container.offsetParent === null) {
                return false;
            }

            var wt = window.pageYOffset;
            var wb = wt + document.documentElement.clientHeight;
            var et = that._elements.container.getBoundingClientRect().top + wt;
            var eb = et + that._elements.container.clientHeight;

            return eb >= wt - LAZY_THRESHOLD && et <= wb + LAZY_THRESHOLD;
        }

        function resizeAreas() {
            if (that._elements.areas && that._elements.areas.length > 0) {
                for (var i = 0; i < that._elements.areas.length; i++) {
                    var width = that._elements.image.width;
                    var height = that._elements.image.height;

                    if (width && height) {
                        var relcoords = that._elements.areas[i].dataset.cmpRelcoords;
                        if (relcoords) {
                            var relativeCoordinates = relcoords.split(",");
                            var coordinates = new Array(relativeCoordinates.length);

                            for (var j = 0; j < coordinates.length; j++) {
                                if (j % 2 === 0) {
                                    coordinates[j] = parseInt(relativeCoordinates[j] * width);
                                } else {
                                    coordinates[j] = parseInt(relativeCoordinates[j] * height);
                                }
                            }

                            that._elements.areas[i].coords = coordinates;
                        }
                    }
                }
            }
        }

        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                var capitalized = IS;
                capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                var key = hook.dataset[NS + "Hook" + capitalized];
                that._elements[key] = hook;
            }
        }

        function setupProperties(options) {
            that._properties = {};

            for (var key in properties) {
                if (properties.hasOwnProperty(key)) {
                    var property = properties[key];
                    if (options && options[key] != null) {
                        if (property && typeof property.transform === "function") {
                            that._properties[key] = property.transform(options[key]);
                        } else {
                            that._properties[key] = options[key];
                        }
                    } else {
                        that._properties[key] = properties[key]["default"];
                    }
                }
            }
        }

        function onWindowResize() {
            that.update();
            resizeAreas();
        }

        function onLoad() {
            resizeAreas();
        }

        that.update = function() {
            if (that._properties.lazy) {
                if (isLazyVisible()) {
                    loadImage();
                }
            } else {
                loadImage();
            }
        };

        if (config && config.element) {
            init(config);
        }
    }

    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Image({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body             = document.querySelector("body");
        var observer         = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Image({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady);
    }

    /*
        on drag & drop of the component into a parsys, noscript's content will be escaped multiple times by the editor which creates
        the DOM for editing; the HTML parser cannot be used here due to the multiple escaping
     */
    function decodeNoscript(text) {
        text = text.replace(/&(amp;)*lt;/g, "<");
        text = text.replace(/&(amp;)*gt;/g, ">");
        return text;
    }

})();

/*******************************************************************************
 * Copyright 2017 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {
    "use strict";

    var NS = "cmp";
    var IS = "search";

    var DELAY = 300; // time before fetching new results when the user is typing a search string
    var LOADING_DISPLAY_DELAY = 300; // minimum time during which the loading indicator is displayed
    var PARAM_RESULTS_OFFSET = "resultsOffset";

    var keyCodes = {
        TAB: 9,
        ENTER: 13,
        ESCAPE: 27,
        ARROW_UP: 38,
        ARROW_DOWN: 40
    };

    var selectors = {
        self: "[data-" + NS + '-is="' + IS + '"]',
        item: {
            self: "[data-" + NS + "-hook-" + IS + '="item"]',
            title: "[data-" + NS + "-hook-" + IS + '="itemTitle"]',
            focused: "." + NS + "-search__item--is-focused"
        }
    };

    var properties = {
        /**
         * The minimum required length of the search term before results are fetched.
         *
         * @memberof Search
         * @type {Number}
         * @default 3
         */
        minLength: {
            "default": 3,
            transform: function(value) {
                value = parseFloat(value);
                return isNaN(value) ? null : value;
            }
        },
        /**
         * The maximal number of results fetched by a search request.
         *
         * @memberof Search
         * @type {Number}
         * @default 10
         */
        resultsSize: {
            "default": 10,
            transform: function(value) {
                value = parseFloat(value);
                return isNaN(value) ? null : value;
            }
        }
    };

    var idCount = 0;

    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    function toggleShow(element, show) {
        if (element) {
            if (show !== false) {
                element.style.display = "block";
                element.setAttribute("aria-hidden", false);
            } else {
                element.style.display = "none";
                element.setAttribute("aria-hidden", true);
            }
        }
    }

    function serialize(form) {
        var query = [];
        if (form && form.elements) {
            for (var i = 0; i < form.elements.length; i++) {
                var node = form.elements[i];
                if (!node.disabled && node.name) {
                    var param = [node.name, encodeURIComponent(node.value)];
                    query.push(param.join("="));
                }
            }
        }
        return query.join("&");
    }

    function mark(node, regex) {
        if (!node || !regex) {
            return;
        }

        // text nodes
        if (node.nodeType === 3) {
            var nodeValue = node.nodeValue;
            var match = regex.exec(nodeValue);

            if (nodeValue && match) {
                var element = document.createElement("mark");
                element.className = NS + "-search__item-mark";
                element.appendChild(document.createTextNode(match[0]));

                var after = node.splitText(match.index);
                after.nodeValue = after.nodeValue.substring(match[0].length);
                node.parentNode.insertBefore(element, after);
            }
        } else if (node.hasChildNodes()) {
            for (var i = 0; i < node.childNodes.length; i++) {
                // recurse
                mark(node.childNodes[i], regex);
            }
        }
    }

    function Search(config) {
        if (config.element) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");
        }

        this._cacheElements(config.element);
        this._setupProperties(config.options);

        this._action = this._elements.form.getAttribute("action");
        this._resultsOffset = 0;
        this._hasMoreResults = true;

        this._elements.input.addEventListener("input", this._onInput.bind(this));
        this._elements.input.addEventListener("focus", this._onInput.bind(this));
        this._elements.input.addEventListener("keydown", this._onKeydown.bind(this));
        this._elements.clear.addEventListener("click", this._onClearClick.bind(this));
        document.addEventListener("click", this._onDocumentClick.bind(this));
        this._elements.results.addEventListener("scroll", this._onScroll.bind(this));

        this._makeAccessible();
    }

    Search.prototype._displayResults = function() {
        if (this._elements.input.value.length === 0) {
            toggleShow(this._elements.clear, false);
            this._cancelResults();
        } else if (this._elements.input.value.length < this._properties.minLength) {
            toggleShow(this._elements.clear, true);
        } else {
            this._updateResults();
            toggleShow(this._elements.clear, true);
        }
    };

    Search.prototype._onScroll = function(event) {
        // fetch new results when the results to be scrolled down are less than the visible results
        if (this._elements.results.scrollTop + 2 * this._elements.results.clientHeight >= this._elements.results.scrollHeight) {
            this._resultsOffset += this._properties.resultsSize;
            this._displayResults();
        }
    };

    Search.prototype._onInput = function(event) {
        var self = this;
        self._cancelResults();
        // start searching when the search term reaches the minimum length
        this._timeout = setTimeout(function() {
            self._displayResults();
        }, DELAY);
    };

    Search.prototype._onKeydown = function(event) {
        var self = this;

        switch (event.keyCode) {
            case keyCodes.TAB:
                if (self._resultsOpen()) {
                    event.preventDefault();
                }
                break;
            case keyCodes.ENTER:
                event.preventDefault();
                if (self._resultsOpen()) {
                    var focused = self._elements.results.querySelector(selectors.item.focused);
                    if (focused) {
                        focused.click();
                    }
                }
                break;
            case keyCodes.ESCAPE:
                self._cancelResults();
                break;
            case keyCodes.ARROW_UP:
                if (self._resultsOpen()) {
                    event.preventDefault();
                    self._stepResultFocus(true);
                }
                break;
            case keyCodes.ARROW_DOWN:
                if (self._resultsOpen()) {
                    event.preventDefault();
                    self._stepResultFocus();
                } else {
                    // test the input and if necessary fetch and display the results
                    self._onInput();
                }
                break;
            default:
                return;
        }
    };

    Search.prototype._onClearClick = function(event) {
        event.preventDefault();
        this._elements.input.value = "";
        toggleShow(this._elements.clear, false);
        toggleShow(this._elements.results, false);
    };

    Search.prototype._onDocumentClick = function(event) {
        var inputContainsTarget =  this._elements.input.contains(event.target);
        var resultsContainTarget = this._elements.results.contains(event.target);

        if (!(inputContainsTarget || resultsContainTarget)) {
            toggleShow(this._elements.results, false);
        }
    };

    Search.prototype._resultsOpen = function() {
        return this._elements.results.style.display !== "none";
    };

    Search.prototype._makeAccessible = function() {
        var id = NS + "-search-results-" + idCount;
        this._elements.input.setAttribute("aria-owns", id);
        this._elements.results.id = id;
        idCount++;
    };

    Search.prototype._generateItems = function(data, results) {
        var self = this;

        data.forEach(function(item) {
            var el = document.createElement("span");
            el.innerHTML = self._elements.itemTemplate.innerHTML;
            el.querySelectorAll(selectors.item.title)[0].appendChild(document.createTextNode(item.title));
            el.querySelectorAll(selectors.item.self)[0].setAttribute("href", item.url);
            results.innerHTML += el.innerHTML;
        });
    };

    Search.prototype._markResults = function() {
        var nodeList = this._elements.results.querySelectorAll(selectors.item.self);
        var escapedTerm = this._elements.input.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
        var regex = new RegExp("(" + escapedTerm + ")", "gi");

        for (var i = this._resultsOffset - 1; i < nodeList.length; ++i) {
            var result = nodeList[i];
            mark(result, regex);
        }
    };

    Search.prototype._stepResultFocus = function(reverse) {
        var results = this._elements.results.querySelectorAll(selectors.item.self);
        var focused = this._elements.results.querySelector(selectors.item.focused);
        var newFocused;
        var index = Array.prototype.indexOf.call(results, focused);
        var focusedCssClass = NS + "-search__item--is-focused";

        if (results.length > 0) {

            if (!reverse) {
                // highlight the next result
                if (index < 0) {
                    results[0].classList.add(focusedCssClass);
                } else if (index + 1 < results.length) {
                    results[index].classList.remove(focusedCssClass);
                    results[index + 1].classList.add(focusedCssClass);
                }

                // if the last visible result is partially hidden, scroll up until it's completely visible
                newFocused = this._elements.results.querySelector(selectors.item.focused);
                if (newFocused) {
                    var bottomHiddenHeight = newFocused.offsetTop + newFocused.offsetHeight - this._elements.results.scrollTop - this._elements.results.clientHeight;
                    if (bottomHiddenHeight > 0) {
                        this._elements.results.scrollTop += bottomHiddenHeight;
                    } else {
                        this._onScroll();
                    }
                }

            } else {
                // highlight the previous result
                if (index >= 1) {
                    results[index].classList.remove(focusedCssClass);
                    results[index - 1].classList.add(focusedCssClass);
                }

                // if the first visible result is partially hidden, scroll down until it's completely visible
                newFocused = this._elements.results.querySelector(selectors.item.focused);
                if (newFocused) {
                    var topHiddenHeight = this._elements.results.scrollTop - newFocused.offsetTop;
                    if (topHiddenHeight > 0) {
                        this._elements.results.scrollTop -= topHiddenHeight;
                    }
                }
            }
        }
    };

    Search.prototype._updateResults = function() {
        var self = this;
        if (self._hasMoreResults) {
            var request = new XMLHttpRequest();
            var url = self._action + "?" + serialize(self._elements.form) + "&" + PARAM_RESULTS_OFFSET + "=" + self._resultsOffset;

            request.open("GET", url, true);
            request.onload = function() {
                // when the results are loaded: hide the loading indicator and display the search icon after a minimum period
                setTimeout(function() {
                    toggleShow(self._elements.loadingIndicator, false);
                    toggleShow(self._elements.icon, true);
                }, LOADING_DISPLAY_DELAY);
                if (request.status >= 200 && request.status < 400) {
                    // success status
                    var data = JSON.parse(request.responseText);
                    if (data.length > 0) {
                        self._generateItems(data, self._elements.results);
                        self._markResults();
                        toggleShow(self._elements.results, true);
                    } else {
                        self._hasMoreResults = false;
                    }
                    // the total number of results is not a multiple of the fetched results:
                    // -> we reached the end of the query
                    if (self._elements.results.querySelectorAll(selectors.item.self).length % self._properties.resultsSize > 0) {
                        self._hasMoreResults = false;
                    }
                } else {
                    // error status
                }
            };
            // when the results are loading: display the loading indicator and hide the search icon
            toggleShow(self._elements.loadingIndicator, true);
            toggleShow(self._elements.icon, false);
            request.send();
        }
    };

    Search.prototype._cancelResults = function() {
        clearTimeout(this._timeout);
        this._elements.results.scrollTop = 0;
        this._resultsOffset = 0;
        this._hasMoreResults = true;
        this._elements.results.innerHTML = "";
    };

    Search.prototype._cacheElements = function(wrapper) {
        this._elements = {};
        this._elements.self = wrapper;
        var hooks = this._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

        for (var i = 0; i < hooks.length; i++) {
            var hook = hooks[i];
            var capitalized = IS;
            capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
            var key = hook.dataset[NS + "Hook" + capitalized];
            this._elements[key] = hook;
        }
    };

    Search.prototype._setupProperties = function(options) {
        this._properties = {};

        for (var key in properties) {
            if (properties.hasOwnProperty(key)) {
                var property = properties[key];
                if (options && options[key] != null) {
                    if (property && typeof property.transform === "function") {
                        this._properties[key] = property.transform(options[key]);
                    } else {
                        this._properties[key] = options[key];
                    }
                } else {
                    this._properties[key] = properties[key]["default"];
                }
            }
        }
    };

    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Search({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Search({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady);
    }

})();

/*******************************************************************************
 * Copyright 2016 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {
    "use strict";

    var NS = "cmp";
    var IS = "formText";
    var IS_DASH = "form-text";

    var selectors = {
        self: "[data-" + NS + '-is="' + IS + '"]'
    };

    var properties = {
        /**
         * A validation message to display if there is a type mismatch between the user input and expected input.
         *
         * @type {String}
         */
        constraintMessage: {
        },
        /**
         * A validation message to display if no input is supplied, but input is expected for the field.
         *
         * @type {String}
         */
        requiredMessage: {
        }
    };

    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    function FormText(config) {
        if (config.element) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");
        }

        this._cacheElements(config.element);
        this._setupProperties(config.options);

        this._elements.input.addEventListener("invalid", this._onInvalid.bind(this));
        this._elements.input.addEventListener("input", this._onInput.bind(this));
    }

    FormText.prototype._onInvalid = function(event) {
        event.target.setCustomValidity("");
        if (event.target.validity.typeMismatch) {
            if (this._properties.constraintMessage) {
                event.target.setCustomValidity(this._properties.constraintMessage);
            }
        } else if (event.target.validity.valueMissing) {
            if (this._properties.requiredMessage) {
                event.target.setCustomValidity(this._properties.requiredMessage);
            }
        }
    };

    FormText.prototype._onInput = function(event) {
        event.target.setCustomValidity("");
    };

    FormText.prototype._cacheElements = function(wrapper) {
        this._elements = {};
        this._elements.self = wrapper;
        var hooks = this._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS_DASH + "]");
        for (var i = 0; i < hooks.length; i++) {
            var hook = hooks[i];
            var capitalized = IS;
            capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
            var key = hook.dataset[NS + "Hook" + capitalized];
            this._elements[key] = hook;
        }
    };

    FormText.prototype._setupProperties = function(options) {
        this._properties = {};

        for (var key in properties) {
            if (properties.hasOwnProperty(key)) {
                var property = properties[key];
                if (options && options[key] != null) {
                    if (property && typeof property.transform === "function") {
                        this._properties[key] = property.transform(options[key]);
                    } else {
                        this._properties[key] = options[key];
                    }
                } else {
                    this._properties[key] = properties[key]["default"];
                }
            }
        }
    };

    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new FormText({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new FormText({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady);
    }

})();

/*!

 handlebars v1.3.0

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/
/* exported Handlebars */
var Handlebars = (function() {
// handlebars/safe-string.js
var __module4__ = (function() {
  "use strict";
  var __exports__;
  // Build out our basic SafeString type
  function SafeString(string) {
    this.string = string;
  }

  SafeString.prototype.toString = function() {
    return "" + this.string;
  };

  __exports__ = SafeString;
  return __exports__;
})();

// handlebars/utils.js
var __module3__ = (function(__dependency1__) {
  "use strict";
  var __exports__ = {};
  /*jshint -W004 */
  var SafeString = __dependency1__;

  var escape = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#x27;",
    "`": "&#x60;"
  };

  var badChars = /[&<>"'`]/g;
  var possible = /[&<>"'`]/;

  function escapeChar(chr) {
    return escape[chr] || "&amp;";
  }

  function extend(obj, value) {
    for(var key in value) {
      if(Object.prototype.hasOwnProperty.call(value, key)) {
        obj[key] = value[key];
      }
    }
  }

  __exports__.extend = extend;var toString = Object.prototype.toString;
  __exports__.toString = toString;
  // Sourced from lodash
  // https://github.com/bestiejs/lodash/blob/master/LICENSE.txt
  var isFunction = function(value) {
    return typeof value === 'function';
  };
  // fallback for older versions of Chrome and Safari
  if (isFunction(/x/)) {
    isFunction = function(value) {
      return typeof value === 'function' && toString.call(value) === '[object Function]';
    };
  }
  var isFunction;
  __exports__.isFunction = isFunction;
  var isArray = Array.isArray || function(value) {
    return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;
  };
  __exports__.isArray = isArray;

  function escapeExpression(string) {
    // don't escape SafeStrings, since they're already safe
    if (string instanceof SafeString) {
      return string.toString();
    } else if (!string && string !== 0) {
      return "";
    }

    // Force a string conversion as this will be done by the append regardless and
    // the regex test will do this transparently behind the scenes, causing issues if
    // an object's to string has escaped characters in it.
    string = "" + string;

    if(!possible.test(string)) { return string; }
    return string.replace(badChars, escapeChar);
  }

  __exports__.escapeExpression = escapeExpression;function isEmpty(value) {
    if (!value && value !== 0) {
      return true;
    } else if (isArray(value) && value.length === 0) {
      return true;
    } else {
      return false;
    }
  }

  __exports__.isEmpty = isEmpty;
  return __exports__;
})(__module4__);

// handlebars/exception.js
var __module5__ = (function() {
  "use strict";
  var __exports__;

  var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];

  function Exception(message, node) {
    var line;
    if (node && node.firstLine) {
      line = node.firstLine;

      message += ' - ' + line + ':' + node.firstColumn;
    }

    var tmp = Error.prototype.constructor.call(this, message);

    // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.
    for (var idx = 0; idx < errorProps.length; idx++) {
      this[errorProps[idx]] = tmp[errorProps[idx]];
    }

    if (line) {
      this.lineNumber = line;
      this.column = node.firstColumn;
    }
  }

  Exception.prototype = new Error();

  __exports__ = Exception;
  return __exports__;
})();

// handlebars/base.js
var __module2__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__ = {};
  var Utils = __dependency1__;
  var Exception = __dependency2__;

  var VERSION = "1.3.0";
  __exports__.VERSION = VERSION;var COMPILER_REVISION = 4;
  __exports__.COMPILER_REVISION = COMPILER_REVISION;
  var REVISION_CHANGES = {
    1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it
    2: '== 1.0.0-rc.3',
    3: '== 1.0.0-rc.4',
    4: '>= 1.0.0'
  };
  __exports__.REVISION_CHANGES = REVISION_CHANGES;
  var isArray = Utils.isArray,
      isFunction = Utils.isFunction,
      toString = Utils.toString,
      objectType = '[object Object]';

  function HandlebarsEnvironment(helpers, partials) {
    this.helpers = helpers || {};
    this.partials = partials || {};

    registerDefaultHelpers(this);
  }

  __exports__.HandlebarsEnvironment = HandlebarsEnvironment;HandlebarsEnvironment.prototype = {
    constructor: HandlebarsEnvironment,

    logger: logger,
    log: log,

    registerHelper: function(name, fn, inverse) {
      if (toString.call(name) === objectType) {
        if (inverse || fn) { throw new Exception('Arg not supported with multiple helpers'); }
        Utils.extend(this.helpers, name);
      } else {
        if (inverse) { fn.not = inverse; }
        this.helpers[name] = fn;
      }
    },

    registerPartial: function(name, str) {
      if (toString.call(name) === objectType) {
        Utils.extend(this.partials,  name);
      } else {
        this.partials[name] = str;
      }
    }
  };

  function registerDefaultHelpers(instance) {
    instance.registerHelper('helperMissing', function(arg) {
      if(arguments.length === 2) {
        return undefined;
      } else {
        throw new Exception("Missing helper: '" + arg + "'");
      }
    });

    instance.registerHelper('blockHelperMissing', function(context, options) {
      var inverse = options.inverse || function() {}, fn = options.fn;

      if (isFunction(context)) { context = context.call(this); }

      if(context === true) {
        return fn(this);
      } else if(context === false || context == null) {
        return inverse(this);
      } else if (isArray(context)) {
        if(context.length > 0) {
          return instance.helpers.each(context, options);
        } else {
          return inverse(this);
        }
      } else {
        return fn(context);
      }
    });

    instance.registerHelper('each', function(context, options) {
      var fn = options.fn, inverse = options.inverse;
      var i = 0, ret = "", data;

      if (isFunction(context)) { context = context.call(this); }

      if (options.data) {
        data = createFrame(options.data);
      }

      if(context && typeof context === 'object') {
        if (isArray(context)) {
          for(var j = context.length; i<j; i++) {
            if (data) {
              data.index = i;
              data.first = (i === 0);
              data.last  = (i === (context.length-1));
            }
            ret = ret + fn(context[i], { data: data });
          }
        } else {
          for(var key in context) {
            if(context.hasOwnProperty(key)) {
              if(data) { 
                data.key = key; 
                data.index = i;
                data.first = (i === 0);
              }
              ret = ret + fn(context[key], {data: data});
              i++;
            }
          }
        }
      }

      if(i === 0){
        ret = inverse(this);
      }

      return ret;
    });

    instance.registerHelper('if', function(conditional, options) {
      if (isFunction(conditional)) { conditional = conditional.call(this); }

      // Default behavior is to render the positive path if the value is truthy and not empty.
      // The `includeZero` option may be set to treat the condtional as purely not empty based on the
      // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.
      if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {
        return options.inverse(this);
      } else {
        return options.fn(this);
      }
    });

    instance.registerHelper('unless', function(conditional, options) {
      return instance.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn, hash: options.hash});
    });

    instance.registerHelper('with', function(context, options) {
      if (isFunction(context)) { context = context.call(this); }

      if (!Utils.isEmpty(context)) return options.fn(context);
    });

    instance.registerHelper('log', function(context, options) {
      var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;
      instance.log(level, context);
    });
  }

  var logger = {
    methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },

    // State enum
    DEBUG: 0,
    INFO: 1,
    WARN: 2,
    ERROR: 3,
    level: 3,

    // can be overridden in the host environment
    log: function(level, obj) {
      if (logger.level <= level) {
        var method = logger.methodMap[level];
        if (typeof console !== 'undefined' && console[method]) {
          console[method].call(console, obj);
        }
      }
    }
  };
  __exports__.logger = logger;
  function log(level, obj) { logger.log(level, obj); }

  __exports__.log = log;var createFrame = function(object) {
    var obj = {};
    Utils.extend(obj, object);
    return obj;
  };
  __exports__.createFrame = createFrame;
  return __exports__;
})(__module3__, __module5__);

// handlebars/runtime.js
var __module6__ = (function(__dependency1__, __dependency2__, __dependency3__) {
  "use strict";
  var __exports__ = {};
  var Utils = __dependency1__;
  var Exception = __dependency2__;
  var COMPILER_REVISION = __dependency3__.COMPILER_REVISION;
  var REVISION_CHANGES = __dependency3__.REVISION_CHANGES;

  function checkRevision(compilerInfo) {
    var compilerRevision = compilerInfo && compilerInfo[0] || 1,
        currentRevision = COMPILER_REVISION;

    if (compilerRevision !== currentRevision) {
      if (compilerRevision < currentRevision) {
        var runtimeVersions = REVISION_CHANGES[currentRevision],
            compilerVersions = REVISION_CHANGES[compilerRevision];
        throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. "+
              "Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").");
      } else {
        // Use the embedded version info since the runtime doesn't know about this revision yet
        throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. "+
              "Please update your runtime to a newer version ("+compilerInfo[1]+").");
      }
    }
  }

  __exports__.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial

  function template(templateSpec, env) {
    if (!env) {
      throw new Exception("No environment passed to template");
    }

    // Note: Using env.VM references rather than local var references throughout this section to allow
    // for external users to override these as psuedo-supported APIs.
    var invokePartialWrapper = function(partial, name, context, helpers, partials, data) {
      var result = env.VM.invokePartial.apply(this, arguments);
      if (result != null) { return result; }

      if (env.compile) {
        var options = { helpers: helpers, partials: partials, data: data };
        partials[name] = env.compile(partial, { data: data !== undefined }, env);
        return partials[name](context, options);
      } else {
        throw new Exception("The partial " + name + " could not be compiled when running in runtime-only mode");
      }
    };

    // Just add water
    var container = {
      escapeExpression: Utils.escapeExpression,
      invokePartial: invokePartialWrapper,
      programs: [],
      program: function(i, fn, data) {
        var programWrapper = this.programs[i];
        if(data) {
          programWrapper = program(i, fn, data);
        } else if (!programWrapper) {
          programWrapper = this.programs[i] = program(i, fn);
        }
        return programWrapper;
      },
      merge: function(param, common) {
        var ret = param || common;

        if (param && common && (param !== common)) {
          ret = {};
          Utils.extend(ret, common);
          Utils.extend(ret, param);
        }
        return ret;
      },
      programWithDepth: env.VM.programWithDepth,
      noop: env.VM.noop,
      compilerInfo: null
    };

    return function(context, options) {
      options = options || {};
      var namespace = options.partial ? options : env,
          helpers,
          partials;

      if (!options.partial) {
        helpers = options.helpers;
        partials = options.partials;
      }
      var result = templateSpec.call(
            container,
            namespace, context,
            helpers,
            partials,
            options.data);

      if (!options.partial) {
        env.VM.checkRevision(container.compilerInfo);
      }

      return result;
    };
  }

  __exports__.template = template;function programWithDepth(i, fn, data /*, $depth */) {
    var args = Array.prototype.slice.call(arguments, 3);

    var prog = function(context, options) {
      options = options || {};

      return fn.apply(this, [context, options.data || data].concat(args));
    };
    prog.program = i;
    prog.depth = args.length;
    return prog;
  }

  __exports__.programWithDepth = programWithDepth;function program(i, fn, data) {
    var prog = function(context, options) {
      options = options || {};

      return fn(context, options.data || data);
    };
    prog.program = i;
    prog.depth = 0;
    return prog;
  }

  __exports__.program = program;function invokePartial(partial, name, context, helpers, partials, data) {
    var options = { partial: true, helpers: helpers, partials: partials, data: data };

    if(partial === undefined) {
      throw new Exception("The partial " + name + " could not be found");
    } else if(partial instanceof Function) {
      return partial(context, options);
    }
  }

  __exports__.invokePartial = invokePartial;function noop() { return ""; }

  __exports__.noop = noop;
  return __exports__;
})(__module3__, __module5__, __module2__);

// handlebars.runtime.js
var __module1__ = (function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
  "use strict";
  var __exports__;
  /*globals Handlebars: true */
  var base = __dependency1__;

  // Each of these augment the Handlebars object. No need to setup here.
  // (This is done to easily share code between commonjs and browse envs)
  var SafeString = __dependency2__;
  var Exception = __dependency3__;
  var Utils = __dependency4__;
  var runtime = __dependency5__;

  // For compatibility and usage outside of module systems, make the Handlebars object a namespace
  var create = function() {
    var hb = new base.HandlebarsEnvironment();

    Utils.extend(hb, base);
    hb.SafeString = SafeString;
    hb.Exception = Exception;
    hb.Utils = Utils;

    hb.VM = runtime;
    hb.template = function(spec) {
      return runtime.template(spec, hb);
    };

    return hb;
  };

  var Handlebars = create();
  Handlebars.create = create;

  __exports__ = Handlebars;
  return __exports__;
})(__module2__, __module4__, __module5__, __module3__, __module6__);

// handlebars/compiler/ast.js
var __module7__ = (function(__dependency1__) {
  "use strict";
  var __exports__;
  var Exception = __dependency1__;

  function LocationInfo(locInfo){
    locInfo = locInfo || {};
    this.firstLine   = locInfo.first_line;
    this.firstColumn = locInfo.first_column;
    this.lastColumn  = locInfo.last_column;
    this.lastLine    = locInfo.last_line;
  }

  var AST = {
    ProgramNode: function(statements, inverseStrip, inverse, locInfo) {
      var inverseLocationInfo, firstInverseNode;
      if (arguments.length === 3) {
        locInfo = inverse;
        inverse = null;
      } else if (arguments.length === 2) {
        locInfo = inverseStrip;
        inverseStrip = null;
      }

      LocationInfo.call(this, locInfo);
      this.type = "program";
      this.statements = statements;
      this.strip = {};

      if(inverse) {
        firstInverseNode = inverse[0];
        if (firstInverseNode) {
          inverseLocationInfo = {
            first_line: firstInverseNode.firstLine,
            last_line: firstInverseNode.lastLine,
            last_column: firstInverseNode.lastColumn,
            first_column: firstInverseNode.firstColumn
          };
          this.inverse = new AST.ProgramNode(inverse, inverseStrip, inverseLocationInfo);
        } else {
          this.inverse = new AST.ProgramNode(inverse, inverseStrip);
        }
        this.strip.right = inverseStrip.left;
      } else if (inverseStrip) {
        this.strip.left = inverseStrip.right;
      }
    },

    MustacheNode: function(rawParams, hash, open, strip, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "mustache";
      this.strip = strip;

      // Open may be a string parsed from the parser or a passed boolean flag
      if (open != null && open.charAt) {
        // Must use charAt to support IE pre-10
        var escapeFlag = open.charAt(3) || open.charAt(2);
        this.escaped = escapeFlag !== '{' && escapeFlag !== '&';
      } else {
        this.escaped = !!open;
      }

      if (rawParams instanceof AST.SexprNode) {
        this.sexpr = rawParams;
      } else {
        // Support old AST API
        this.sexpr = new AST.SexprNode(rawParams, hash);
      }

      this.sexpr.isRoot = true;

      // Support old AST API that stored this info in MustacheNode
      this.id = this.sexpr.id;
      this.params = this.sexpr.params;
      this.hash = this.sexpr.hash;
      this.eligibleHelper = this.sexpr.eligibleHelper;
      this.isHelper = this.sexpr.isHelper;
    },

    SexprNode: function(rawParams, hash, locInfo) {
      LocationInfo.call(this, locInfo);

      this.type = "sexpr";
      this.hash = hash;

      var id = this.id = rawParams[0];
      var params = this.params = rawParams.slice(1);

      // a mustache is an eligible helper if:
      // * its id is simple (a single part, not `this` or `..`)
      var eligibleHelper = this.eligibleHelper = id.isSimple;

      // a mustache is definitely a helper if:
      // * it is an eligible helper, and
      // * it has at least one parameter or hash segment
      this.isHelper = eligibleHelper && (params.length || hash);

      // if a mustache is an eligible helper but not a definite
      // helper, it is ambiguous, and will be resolved in a later
      // pass or at runtime.
    },

    PartialNode: function(partialName, context, strip, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type         = "partial";
      this.partialName  = partialName;
      this.context      = context;
      this.strip = strip;
    },

    BlockNode: function(mustache, program, inverse, close, locInfo) {
      LocationInfo.call(this, locInfo);

      if(mustache.sexpr.id.original !== close.path.original) {
        throw new Exception(mustache.sexpr.id.original + " doesn't match " + close.path.original, this);
      }

      this.type = 'block';
      this.mustache = mustache;
      this.program  = program;
      this.inverse  = inverse;

      this.strip = {
        left: mustache.strip.left,
        right: close.strip.right
      };

      (program || inverse).strip.left = mustache.strip.right;
      (inverse || program).strip.right = close.strip.left;

      if (inverse && !program) {
        this.isInverse = true;
      }
    },

    ContentNode: function(string, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "content";
      this.string = string;
    },

    HashNode: function(pairs, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "hash";
      this.pairs = pairs;
    },

    IdNode: function(parts, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "ID";

      var original = "",
          dig = [],
          depth = 0;

      for(var i=0,l=parts.length; i<l; i++) {
        var part = parts[i].part;
        original += (parts[i].separator || '') + part;

        if (part === ".." || part === "." || part === "this") {
          if (dig.length > 0) {
            throw new Exception("Invalid path: " + original, this);
          } else if (part === "..") {
            depth++;
          } else {
            this.isScoped = true;
          }
        } else {
          dig.push(part);
        }
      }

      this.original = original;
      this.parts    = dig;
      this.string   = dig.join('.');
      this.depth    = depth;

      // an ID is simple if it only has one part, and that part is not
      // `..` or `this`.
      this.isSimple = parts.length === 1 && !this.isScoped && depth === 0;

      this.stringModeValue = this.string;
    },

    PartialNameNode: function(name, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "PARTIAL_NAME";
      this.name = name.original;
    },

    DataNode: function(id, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "DATA";
      this.id = id;
    },

    StringNode: function(string, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "STRING";
      this.original =
        this.string =
        this.stringModeValue = string;
    },

    IntegerNode: function(integer, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "INTEGER";
      this.original =
        this.integer = integer;
      this.stringModeValue = Number(integer);
    },

    BooleanNode: function(bool, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "BOOLEAN";
      this.bool = bool;
      this.stringModeValue = bool === "true";
    },

    CommentNode: function(comment, locInfo) {
      LocationInfo.call(this, locInfo);
      this.type = "comment";
      this.comment = comment;
    }
  };

  // Must be exported as an object rather than the root of the module as the jison lexer
  // most modify the object to operate properly.
  __exports__ = AST;
  return __exports__;
})(__module5__);

// handlebars/compiler/parser.js
var __module9__ = (function() {
  "use strict";
  var __exports__;
  /* jshint ignore:start */
  /* Jison generated parser */
  var handlebars = (function(){
  var parser = {trace: function trace() { },
  yy: {},
  symbols_: {"error":2,"root":3,"statements":4,"EOF":5,"program":6,"simpleInverse":7,"statement":8,"openInverse":9,"closeBlock":10,"openBlock":11,"mustache":12,"partial":13,"CONTENT":14,"COMMENT":15,"OPEN_BLOCK":16,"sexpr":17,"CLOSE":18,"OPEN_INVERSE":19,"OPEN_ENDBLOCK":20,"path":21,"OPEN":22,"OPEN_UNESCAPED":23,"CLOSE_UNESCAPED":24,"OPEN_PARTIAL":25,"partialName":26,"partial_option0":27,"sexpr_repetition0":28,"sexpr_option0":29,"dataName":30,"param":31,"STRING":32,"INTEGER":33,"BOOLEAN":34,"OPEN_SEXPR":35,"CLOSE_SEXPR":36,"hash":37,"hash_repetition_plus0":38,"hashSegment":39,"ID":40,"EQUALS":41,"DATA":42,"pathSegments":43,"SEP":44,"$accept":0,"$end":1},
  terminals_: {2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",35:"OPEN_SEXPR",36:"CLOSE_SEXPR",40:"ID",41:"EQUALS",42:"DATA",44:"SEP"},
  productions_: [0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[31,3],[37,1],[39,3],[26,1],[26,1],[26,1],[30,2],[21,1],[43,3],[43,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[38,1],[38,2]],
  performAction: function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {

  var $0 = $$.length - 1;
  switch (yystate) {
  case 1: return new yy.ProgramNode($$[$0-1], this._$); 
  break;
  case 2: return new yy.ProgramNode([], this._$); 
  break;
  case 3:this.$ = new yy.ProgramNode([], $$[$0-1], $$[$0], this._$);
  break;
  case 4:this.$ = new yy.ProgramNode($$[$0-2], $$[$0-1], $$[$0], this._$);
  break;
  case 5:this.$ = new yy.ProgramNode($$[$0-1], $$[$0], [], this._$);
  break;
  case 6:this.$ = new yy.ProgramNode($$[$0], this._$);
  break;
  case 7:this.$ = new yy.ProgramNode([], this._$);
  break;
  case 8:this.$ = new yy.ProgramNode([], this._$);
  break;
  case 9:this.$ = [$$[$0]];
  break;
  case 10: $$[$0-1].push($$[$0]); this.$ = $$[$0-1]; 
  break;
  case 11:this.$ = new yy.BlockNode($$[$0-2], $$[$0-1].inverse, $$[$0-1], $$[$0], this._$);
  break;
  case 12:this.$ = new yy.BlockNode($$[$0-2], $$[$0-1], $$[$0-1].inverse, $$[$0], this._$);
  break;
  case 13:this.$ = $$[$0];
  break;
  case 14:this.$ = $$[$0];
  break;
  case 15:this.$ = new yy.ContentNode($$[$0], this._$);
  break;
  case 16:this.$ = new yy.CommentNode($$[$0], this._$);
  break;
  case 17:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 18:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 19:this.$ = {path: $$[$0-1], strip: stripFlags($$[$0-2], $$[$0])};
  break;
  case 20:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 21:this.$ = new yy.MustacheNode($$[$0-1], null, $$[$0-2], stripFlags($$[$0-2], $$[$0]), this._$);
  break;
  case 22:this.$ = new yy.PartialNode($$[$0-2], $$[$0-1], stripFlags($$[$0-3], $$[$0]), this._$);
  break;
  case 23:this.$ = stripFlags($$[$0-1], $$[$0]);
  break;
  case 24:this.$ = new yy.SexprNode([$$[$0-2]].concat($$[$0-1]), $$[$0], this._$);
  break;
  case 25:this.$ = new yy.SexprNode([$$[$0]], null, this._$);
  break;
  case 26:this.$ = $$[$0];
  break;
  case 27:this.$ = new yy.StringNode($$[$0], this._$);
  break;
  case 28:this.$ = new yy.IntegerNode($$[$0], this._$);
  break;
  case 29:this.$ = new yy.BooleanNode($$[$0], this._$);
  break;
  case 30:this.$ = $$[$0];
  break;
  case 31:$$[$0-1].isHelper = true; this.$ = $$[$0-1];
  break;
  case 32:this.$ = new yy.HashNode($$[$0], this._$);
  break;
  case 33:this.$ = [$$[$0-2], $$[$0]];
  break;
  case 34:this.$ = new yy.PartialNameNode($$[$0], this._$);
  break;
  case 35:this.$ = new yy.PartialNameNode(new yy.StringNode($$[$0], this._$), this._$);
  break;
  case 36:this.$ = new yy.PartialNameNode(new yy.IntegerNode($$[$0], this._$));
  break;
  case 37:this.$ = new yy.DataNode($$[$0], this._$);
  break;
  case 38:this.$ = new yy.IdNode($$[$0], this._$);
  break;
  case 39: $$[$0-2].push({part: $$[$0], separator: $$[$0-1]}); this.$ = $$[$0-2]; 
  break;
  case 40:this.$ = [{part: $$[$0]}];
  break;
  case 43:this.$ = [];
  break;
  case 44:$$[$0-1].push($$[$0]);
  break;
  case 47:this.$ = [$$[$0]];
  break;
  case 48:$$[$0-1].push($$[$0]);
  break;
  }
  },
  table: [{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:29,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:30,21:24,30:25,40:[1,28],42:[1,27],43:26},{17:31,21:24,30:25,40:[1,28],42:[1,27],43:26},{21:33,26:32,32:[1,34],33:[1,35],40:[1,28],43:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,40:[1,28],42:[1,27],43:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,43],24:[2,43],28:43,32:[2,43],33:[2,43],34:[2,43],35:[2,43],36:[2,43],40:[2,43],42:[2,43]},{18:[2,25],24:[2,25],36:[2,25]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],35:[2,38],36:[2,38],40:[2,38],42:[2,38],44:[1,44]},{21:45,40:[1,28],43:26},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],42:[2,40],44:[2,40]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,41],21:50,27:49,40:[1,28],43:26},{18:[2,34],40:[2,34]},{18:[2,35],40:[2,35]},{18:[2,36],40:[2,36]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,40:[1,28],43:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,45],21:56,24:[2,45],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:[1,61],36:[2,45],37:55,38:62,39:63,40:[1,64],42:[1,27],43:26},{40:[1,65]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],35:[2,37],36:[2,37],40:[2,37],42:[2,37]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,66]},{18:[2,42]},{18:[1,67]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24],36:[2,24]},{18:[2,44],24:[2,44],32:[2,44],33:[2,44],34:[2,44],35:[2,44],36:[2,44],40:[2,44],42:[2,44]},{18:[2,46],24:[2,46],36:[2,46]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],35:[2,26],36:[2,26],40:[2,26],42:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],35:[2,27],36:[2,27],40:[2,27],42:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],35:[2,28],36:[2,28],40:[2,28],42:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],35:[2,29],36:[2,29],40:[2,29],42:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],35:[2,30],36:[2,30],40:[2,30],42:[2,30]},{17:68,21:24,30:25,40:[1,28],42:[1,27],43:26},{18:[2,32],24:[2,32],36:[2,32],39:69,40:[1,70]},{18:[2,47],24:[2,47],36:[2,47],40:[2,47]},{18:[2,40],24:[2,40],32:[2,40],33:[2,40],34:[2,40],35:[2,40],36:[2,40],40:[2,40],41:[1,71],42:[2,40],44:[2,40]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],35:[2,39],36:[2,39],40:[2,39],42:[2,39],44:[2,39]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{36:[1,72]},{18:[2,48],24:[2,48],36:[2,48],40:[2,48]},{41:[1,71]},{21:56,30:60,31:73,32:[1,57],33:[1,58],34:[1,59],35:[1,61],40:[1,28],42:[1,27],43:26},{18:[2,31],24:[2,31],32:[2,31],33:[2,31],34:[2,31],35:[2,31],36:[2,31],40:[2,31],42:[2,31]},{18:[2,33],24:[2,33],36:[2,33],40:[2,33]}],
  defaultActions: {3:[2,2],16:[2,1],50:[2,42]},
  parseError: function parseError(str, hash) {
      throw new Error(str);
  },
  parse: function parse(input) {
      var self = this, stack = [0], vstack = [null], lstack = [], table = this.table, yytext = "", yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;
      this.lexer.setInput(input);
      this.lexer.yy = this.yy;
      this.yy.lexer = this.lexer;
      this.yy.parser = this;
      if (typeof this.lexer.yylloc == "undefined")
          this.lexer.yylloc = {};
      var yyloc = this.lexer.yylloc;
      lstack.push(yyloc);
      var ranges = this.lexer.options && this.lexer.options.ranges;
      if (typeof this.yy.parseError === "function")
          this.parseError = this.yy.parseError;
      function popStack(n) {
          stack.length = stack.length - 2 * n;
          vstack.length = vstack.length - n;
          lstack.length = lstack.length - n;
      }
      function lex() {
          var token;
          token = self.lexer.lex() || 1;
          if (typeof token !== "number") {
              token = self.symbols_[token] || token;
          }
          return token;
      }
      var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;
      while (true) {
          state = stack[stack.length - 1];
          if (this.defaultActions[state]) {
              action = this.defaultActions[state];
          } else {
              if (symbol === null || typeof symbol == "undefined") {
                  symbol = lex();
              }
              action = table[state] && table[state][symbol];
          }
          if (typeof action === "undefined" || !action.length || !action[0]) {
              var errStr = "";
              if (!recovering) {
                  expected = [];
                  for (p in table[state])
                      if (this.terminals_[p] && p > 2) {
                          expected.push("'" + this.terminals_[p] + "'");
                      }
                  if (this.lexer.showPosition) {
                      errStr = "Parse error on line " + (yylineno + 1) + ":\n" + this.lexer.showPosition() + "\nExpecting " + expected.join(", ") + ", got '" + (this.terminals_[symbol] || symbol) + "'";
                  } else {
                      errStr = "Parse error on line " + (yylineno + 1) + ": Unexpected " + (symbol == 1?"end of input":"'" + (this.terminals_[symbol] || symbol) + "'");
                  }
                  this.parseError(errStr, {text: this.lexer.match, token: this.terminals_[symbol] || symbol, line: this.lexer.yylineno, loc: yyloc, expected: expected});
              }
          }
          if (action[0] instanceof Array && action.length > 1) {
              throw new Error("Parse Error: multiple actions possible at state: " + state + ", token: " + symbol);
          }
          switch (action[0]) {
          case 1:
              stack.push(symbol);
              vstack.push(this.lexer.yytext);
              lstack.push(this.lexer.yylloc);
              stack.push(action[1]);
              symbol = null;
              if (!preErrorSymbol) {
                  yyleng = this.lexer.yyleng;
                  yytext = this.lexer.yytext;
                  yylineno = this.lexer.yylineno;
                  yyloc = this.lexer.yylloc;
                  if (recovering > 0)
                      recovering--;
              } else {
                  symbol = preErrorSymbol;
                  preErrorSymbol = null;
              }
              break;
          case 2:
              len = this.productions_[action[1]][1];
              yyval.$ = vstack[vstack.length - len];
              yyval._$ = {first_line: lstack[lstack.length - (len || 1)].first_line, last_line: lstack[lstack.length - 1].last_line, first_column: lstack[lstack.length - (len || 1)].first_column, last_column: lstack[lstack.length - 1].last_column};
              if (ranges) {
                  yyval._$.range = [lstack[lstack.length - (len || 1)].range[0], lstack[lstack.length - 1].range[1]];
              }
              r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);
              if (typeof r !== "undefined") {
                  return r;
              }
              if (len) {
                  stack = stack.slice(0, -1 * len * 2);
                  vstack = vstack.slice(0, -1 * len);
                  lstack = lstack.slice(0, -1 * len);
              }
              stack.push(this.productions_[action[1]][0]);
              vstack.push(yyval.$);
              lstack.push(yyval._$);
              newState = table[stack[stack.length - 2]][stack[stack.length - 1]];
              stack.push(newState);
              break;
          case 3:
              return true;
          }
      }
      return true;
  }
  };


  function stripFlags(open, close) {
    return {
      left: open.charAt(2) === '~',
      right: close.charAt(0) === '~' || close.charAt(1) === '~'
    };
  }

  /* Jison generated lexer */
  var lexer = (function(){
  var lexer = ({EOF:1,
  parseError:function parseError(str, hash) {
          if (this.yy.parser) {
              this.yy.parser.parseError(str, hash);
          } else {
              throw new Error(str);
          }
      },
  setInput:function (input) {
          this._input = input;
          this._more = this._less = this.done = false;
          this.yylineno = this.yyleng = 0;
          this.yytext = this.matched = this.match = '';
          this.conditionStack = ['INITIAL'];
          this.yylloc = {first_line:1,first_column:0,last_line:1,last_column:0};
          if (this.options.ranges) this.yylloc.range = [0,0];
          this.offset = 0;
          return this;
      },
  input:function () {
          var ch = this._input[0];
          this.yytext += ch;
          this.yyleng++;
          this.offset++;
          this.match += ch;
          this.matched += ch;
          var lines = ch.match(/(?:\r\n?|\n).*/g);
          if (lines) {
              this.yylineno++;
              this.yylloc.last_line++;
          } else {
              this.yylloc.last_column++;
          }
          if (this.options.ranges) this.yylloc.range[1]++;

          this._input = this._input.slice(1);
          return ch;
      },
  unput:function (ch) {
          var len = ch.length;
          var lines = ch.split(/(?:\r\n?|\n)/g);

          this._input = ch + this._input;
          this.yytext = this.yytext.substr(0, this.yytext.length-len-1);
          //this.yyleng -= len;
          this.offset -= len;
          var oldLines = this.match.split(/(?:\r\n?|\n)/g);
          this.match = this.match.substr(0, this.match.length-1);
          this.matched = this.matched.substr(0, this.matched.length-1);

          if (lines.length-1) this.yylineno -= lines.length-1;
          var r = this.yylloc.range;

          this.yylloc = {first_line: this.yylloc.first_line,
            last_line: this.yylineno+1,
            first_column: this.yylloc.first_column,
            last_column: lines ?
                (lines.length === oldLines.length ? this.yylloc.first_column : 0) + oldLines[oldLines.length - lines.length].length - lines[0].length:
                this.yylloc.first_column - len
            };

          if (this.options.ranges) {
              this.yylloc.range = [r[0], r[0] + this.yyleng - len];
          }
          return this;
      },
  more:function () {
          this._more = true;
          return this;
      },
  less:function (n) {
          this.unput(this.match.slice(n));
      },
  pastInput:function () {
          var past = this.matched.substr(0, this.matched.length - this.match.length);
          return (past.length > 20 ? '...':'') + past.substr(-20).replace(/\n/g, "");
      },
  upcomingInput:function () {
          var next = this.match;
          if (next.length < 20) {
              next += this._input.substr(0, 20-next.length);
          }
          return (next.substr(0,20)+(next.length > 20 ? '...':'')).replace(/\n/g, "");
      },
  showPosition:function () {
          var pre = this.pastInput();
          var c = new Array(pre.length + 1).join("-");
          return pre + this.upcomingInput() + "\n" + c+"^";
      },
  next:function () {
          if (this.done) {
              return this.EOF;
          }
          if (!this._input) this.done = true;

          var token,
              match,
              tempMatch,
              index,
              col,
              lines;
          if (!this._more) {
              this.yytext = '';
              this.match = '';
          }
          var rules = this._currentRules();
          for (var i=0;i < rules.length; i++) {
              tempMatch = this._input.match(this.rules[rules[i]]);
              if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                  match = tempMatch;
                  index = i;
                  if (!this.options.flex) break;
              }
          }
          if (match) {
              lines = match[0].match(/(?:\r\n?|\n).*/g);
              if (lines) this.yylineno += lines.length;
              this.yylloc = {first_line: this.yylloc.last_line,
                             last_line: this.yylineno+1,
                             first_column: this.yylloc.last_column,
                             last_column: lines ? lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length : this.yylloc.last_column + match[0].length};
              this.yytext += match[0];
              this.match += match[0];
              this.matches = match;
              this.yyleng = this.yytext.length;
              if (this.options.ranges) {
                  this.yylloc.range = [this.offset, this.offset += this.yyleng];
              }
              this._more = false;
              this._input = this._input.slice(match[0].length);
              this.matched += match[0];
              token = this.performAction.call(this, this.yy, this, rules[index],this.conditionStack[this.conditionStack.length-1]);
              if (this.done && this._input) this.done = false;
              if (token) return token;
              else return;
          }
          if (this._input === "") {
              return this.EOF;
          } else {
              return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(),
                      {text: "", token: null, line: this.yylineno});
          }
      },
  lex:function lex() {
          var r = this.next();
          if (typeof r !== 'undefined') {
              return r;
          } else {
              return this.lex();
          }
      },
  begin:function begin(condition) {
          this.conditionStack.push(condition);
      },
  popState:function popState() {
          return this.conditionStack.pop();
      },
  _currentRules:function _currentRules() {
          return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;
      },
  topState:function () {
          return this.conditionStack[this.conditionStack.length-2];
      },
  pushState:function begin(condition) {
          this.begin(condition);
      }});
  lexer.options = {};
  lexer.performAction = function anonymous(yy,yy_,$avoiding_name_collisions,YY_START) {


  function strip(start, end) {
    return yy_.yytext = yy_.yytext.substr(start, yy_.yyleng-end);
  }


  var YYSTATE=YY_START
  switch($avoiding_name_collisions) {
  case 0:
                                     if(yy_.yytext.slice(-2) === "\\\\") {
                                       strip(0,1);
                                       this.begin("mu");
                                     } else if(yy_.yytext.slice(-1) === "\\") {
                                       strip(0,1);
                                       this.begin("emu");
                                     } else {
                                       this.begin("mu");
                                     }
                                     if(yy_.yytext) return 14;
                                   
  break;
  case 1:return 14;
  break;
  case 2:
                                     this.popState();
                                     return 14;
                                   
  break;
  case 3:strip(0,4); this.popState(); return 15;
  break;
  case 4:return 35;
  break;
  case 5:return 36;
  break;
  case 6:return 25;
  break;
  case 7:return 16;
  break;
  case 8:return 20;
  break;
  case 9:return 19;
  break;
  case 10:return 19;
  break;
  case 11:return 23;
  break;
  case 12:return 22;
  break;
  case 13:this.popState(); this.begin('com');
  break;
  case 14:strip(3,5); this.popState(); return 15;
  break;
  case 15:return 22;
  break;
  case 16:return 41;
  break;
  case 17:return 40;
  break;
  case 18:return 40;
  break;
  case 19:return 44;
  break;
  case 20:// ignore whitespace
  break;
  case 21:this.popState(); return 24;
  break;
  case 22:this.popState(); return 18;
  break;
  case 23:yy_.yytext = strip(1,2).replace(/\\"/g,'"'); return 32;
  break;
  case 24:yy_.yytext = strip(1,2).replace(/\\'/g,"'"); return 32;
  break;
  case 25:return 42;
  break;
  case 26:return 34;
  break;
  case 27:return 34;
  break;
  case 28:return 33;
  break;
  case 29:return 40;
  break;
  case 30:yy_.yytext = strip(1,2); return 40;
  break;
  case 31:return 'INVALID';
  break;
  case 32:return 5;
  break;
  }
  };
  lexer.rules = [/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/];
  lexer.conditions = {"mu":{"rules":[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],"inclusive":false},"emu":{"rules":[2],"inclusive":false},"com":{"rules":[3],"inclusive":false},"INITIAL":{"rules":[0,1,32],"inclusive":true}};
  return lexer;})()
  parser.lexer = lexer;
  function Parser () { this.yy = {}; }Parser.prototype = parser;parser.Parser = Parser;
  return new Parser;
  })();__exports__ = handlebars;
  /* jshint ignore:end */
  return __exports__;
})();

// handlebars/compiler/base.js
var __module8__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__ = {};
  var parser = __dependency1__;
  var AST = __dependency2__;

  __exports__.parser = parser;

  function parse(input) {
    // Just return if an already-compile AST was passed in.
    if(input.constructor === AST.ProgramNode) { return input; }

    parser.yy = AST;
    return parser.parse(input);
  }

  __exports__.parse = parse;
  return __exports__;
})(__module9__, __module7__);

// handlebars/compiler/compiler.js
var __module10__ = (function(__dependency1__) {
  "use strict";
  var __exports__ = {};
  var Exception = __dependency1__;

  function Compiler() {}

  __exports__.Compiler = Compiler;// the foundHelper register will disambiguate helper lookup from finding a
  // function in a context. This is necessary for mustache compatibility, which
  // requires that context functions in blocks are evaluated by blockHelperMissing,
  // and then proceed as if the resulting value was provided to blockHelperMissing.

  Compiler.prototype = {
    compiler: Compiler,

    disassemble: function() {
      var opcodes = this.opcodes, opcode, out = [], params, param;

      for (var i=0, l=opcodes.length; i<l; i++) {
        opcode = opcodes[i];

        if (opcode.opcode === 'DECLARE') {
          out.push("DECLARE " + opcode.name + "=" + opcode.value);
        } else {
          params = [];
          for (var j=0; j<opcode.args.length; j++) {
            param = opcode.args[j];
            if (typeof param === "string") {
              param = "\"" + param.replace("\n", "\\n") + "\"";
            }
            params.push(param);
          }
          out.push(opcode.opcode + " " + params.join(" "));
        }
      }

      return out.join("\n");
    },

    equals: function(other) {
      var len = this.opcodes.length;
      if (other.opcodes.length !== len) {
        return false;
      }

      for (var i = 0; i < len; i++) {
        var opcode = this.opcodes[i],
            otherOpcode = other.opcodes[i];
        if (opcode.opcode !== otherOpcode.opcode || opcode.args.length !== otherOpcode.args.length) {
          return false;
        }
        for (var j = 0; j < opcode.args.length; j++) {
          if (opcode.args[j] !== otherOpcode.args[j]) {
            return false;
          }
        }
      }

      len = this.children.length;
      if (other.children.length !== len) {
        return false;
      }
      for (i = 0; i < len; i++) {
        if (!this.children[i].equals(other.children[i])) {
          return false;
        }
      }

      return true;
    },

    guid: 0,

    compile: function(program, options) {
      this.opcodes = [];
      this.children = [];
      this.depths = {list: []};
      this.options = options;

      // These changes will propagate to the other compiler components
      var knownHelpers = this.options.knownHelpers;
      this.options.knownHelpers = {
        'helperMissing': true,
        'blockHelperMissing': true,
        'each': true,
        'if': true,
        'unless': true,
        'with': true,
        'log': true
      };
      if (knownHelpers) {
        for (var name in knownHelpers) {
          this.options.knownHelpers[name] = knownHelpers[name];
        }
      }

      return this.accept(program);
    },

    accept: function(node) {
      var strip = node.strip || {},
          ret;
      if (strip.left) {
        this.opcode('strip');
      }

      ret = this[node.type](node);

      if (strip.right) {
        this.opcode('strip');
      }

      return ret;
    },

    program: function(program) {
      var statements = program.statements;

      for(var i=0, l=statements.length; i<l; i++) {
        this.accept(statements[i]);
      }
      this.isSimple = l === 1;

      this.depths.list = this.depths.list.sort(function(a, b) {
        return a - b;
      });

      return this;
    },

    compileProgram: function(program) {
      var result = new this.compiler().compile(program, this.options);
      var guid = this.guid++, depth;

      this.usePartial = this.usePartial || result.usePartial;

      this.children[guid] = result;

      for(var i=0, l=result.depths.list.length; i<l; i++) {
        depth = result.depths.list[i];

        if(depth < 2) { continue; }
        else { this.addDepth(depth - 1); }
      }

      return guid;
    },

    block: function(block) {
      var mustache = block.mustache,
          program = block.program,
          inverse = block.inverse;

      if (program) {
        program = this.compileProgram(program);
      }

      if (inverse) {
        inverse = this.compileProgram(inverse);
      }

      var sexpr = mustache.sexpr;
      var type = this.classifySexpr(sexpr);

      if (type === "helper") {
        this.helperSexpr(sexpr, program, inverse);
      } else if (type === "simple") {
        this.simpleSexpr(sexpr);

        // now that the simple mustache is resolved, we need to
        // evaluate it by executing `blockHelperMissing`
        this.opcode('pushProgram', program);
        this.opcode('pushProgram', inverse);
        this.opcode('emptyHash');
        this.opcode('blockValue');
      } else {
        this.ambiguousSexpr(sexpr, program, inverse);

        // now that the simple mustache is resolved, we need to
        // evaluate it by executing `blockHelperMissing`
        this.opcode('pushProgram', program);
        this.opcode('pushProgram', inverse);
        this.opcode('emptyHash');
        this.opcode('ambiguousBlockValue');
      }

      this.opcode('append');
    },

    hash: function(hash) {
      var pairs = hash.pairs, pair, val;

      this.opcode('pushHash');

      for(var i=0, l=pairs.length; i<l; i++) {
        pair = pairs[i];
        val  = pair[1];

        if (this.options.stringParams) {
          if(val.depth) {
            this.addDepth(val.depth);
          }
          this.opcode('getContext', val.depth || 0);
          this.opcode('pushStringParam', val.stringModeValue, val.type);

          if (val.type === 'sexpr') {
            // Subexpressions get evaluated and passed in
            // in string params mode.
            this.sexpr(val);
          }
        } else {
          this.accept(val);
        }

        this.opcode('assignToHash', pair[0]);
      }
      this.opcode('popHash');
    },

    partial: function(partial) {
      var partialName = partial.partialName;
      this.usePartial = true;

      if(partial.context) {
        this.ID(partial.context);
      } else {
        this.opcode('push', 'depth0');
      }

      this.opcode('invokePartial', partialName.name);
      this.opcode('append');
    },

    content: function(content) {
      this.opcode('appendContent', content.string);
    },

    mustache: function(mustache) {
      this.sexpr(mustache.sexpr);

      if(mustache.escaped && !this.options.noEscape) {
        this.opcode('appendEscaped');
      } else {
        this.opcode('append');
      }
    },

    ambiguousSexpr: function(sexpr, program, inverse) {
      var id = sexpr.id,
          name = id.parts[0],
          isBlock = program != null || inverse != null;

      this.opcode('getContext', id.depth);

      this.opcode('pushProgram', program);
      this.opcode('pushProgram', inverse);

      this.opcode('invokeAmbiguous', name, isBlock);
    },

    simpleSexpr: function(sexpr) {
      var id = sexpr.id;

      if (id.type === 'DATA') {
        this.DATA(id);
      } else if (id.parts.length) {
        this.ID(id);
      } else {
        // Simplified ID for `this`
        this.addDepth(id.depth);
        this.opcode('getContext', id.depth);
        this.opcode('pushContext');
      }

      this.opcode('resolvePossibleLambda');
    },

    helperSexpr: function(sexpr, program, inverse) {
      var params = this.setupFullMustacheParams(sexpr, program, inverse),
          name = sexpr.id.parts[0];

      if (this.options.knownHelpers[name]) {
        this.opcode('invokeKnownHelper', params.length, name);
      } else if (this.options.knownHelpersOnly) {
        throw new Exception("You specified knownHelpersOnly, but used the unknown helper " + name, sexpr);
      } else {
        this.opcode('invokeHelper', params.length, name, sexpr.isRoot);
      }
    },

    sexpr: function(sexpr) {
      var type = this.classifySexpr(sexpr);

      if (type === "simple") {
        this.simpleSexpr(sexpr);
      } else if (type === "helper") {
        this.helperSexpr(sexpr);
      } else {
        this.ambiguousSexpr(sexpr);
      }
    },

    ID: function(id) {
      this.addDepth(id.depth);
      this.opcode('getContext', id.depth);

      var name = id.parts[0];
      if (!name) {
        this.opcode('pushContext');
      } else {
        this.opcode('lookupOnContext', id.parts[0]);
      }

      for(var i=1, l=id.parts.length; i<l; i++) {
        this.opcode('lookup', id.parts[i]);
      }
    },

    DATA: function(data) {
      this.options.data = true;
      if (data.id.isScoped || data.id.depth) {
        throw new Exception('Scoped data references are not supported: ' + data.original, data);
      }

      this.opcode('lookupData');
      var parts = data.id.parts;
      for(var i=0, l=parts.length; i<l; i++) {
        this.opcode('lookup', parts[i]);
      }
    },

    STRING: function(string) {
      this.opcode('pushString', string.string);
    },

    INTEGER: function(integer) {
      this.opcode('pushLiteral', integer.integer);
    },

    BOOLEAN: function(bool) {
      this.opcode('pushLiteral', bool.bool);
    },

    comment: function() {},

    // HELPERS
    opcode: function(name) {
      this.opcodes.push({ opcode: name, args: [].slice.call(arguments, 1) });
    },

    declare: function(name, value) {
      this.opcodes.push({ opcode: 'DECLARE', name: name, value: value });
    },

    addDepth: function(depth) {
      if(depth === 0) { return; }

      if(!this.depths[depth]) {
        this.depths[depth] = true;
        this.depths.list.push(depth);
      }
    },

    classifySexpr: function(sexpr) {
      var isHelper   = sexpr.isHelper;
      var isEligible = sexpr.eligibleHelper;
      var options    = this.options;

      // if ambiguous, we can possibly resolve the ambiguity now
      if (isEligible && !isHelper) {
        var name = sexpr.id.parts[0];

        if (options.knownHelpers[name]) {
          isHelper = true;
        } else if (options.knownHelpersOnly) {
          isEligible = false;
        }
      }

      if (isHelper) { return "helper"; }
      else if (isEligible) { return "ambiguous"; }
      else { return "simple"; }
    },

    pushParams: function(params) {
      var i = params.length, param;

      while(i--) {
        param = params[i];

        if(this.options.stringParams) {
          if(param.depth) {
            this.addDepth(param.depth);
          }

          this.opcode('getContext', param.depth || 0);
          this.opcode('pushStringParam', param.stringModeValue, param.type);

          if (param.type === 'sexpr') {
            // Subexpressions get evaluated and passed in
            // in string params mode.
            this.sexpr(param);
          }
        } else {
          this[param.type](param);
        }
      }
    },

    setupFullMustacheParams: function(sexpr, program, inverse) {
      var params = sexpr.params;
      this.pushParams(params);

      this.opcode('pushProgram', program);
      this.opcode('pushProgram', inverse);

      if (sexpr.hash) {
        this.hash(sexpr.hash);
      } else {
        this.opcode('emptyHash');
      }

      return params;
    }
  };

  function precompile(input, options, env) {
    if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
      throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed " + input);
    }

    options = options || {};
    if (!('data' in options)) {
      options.data = true;
    }

    var ast = env.parse(input);
    var environment = new env.Compiler().compile(ast, options);
    return new env.JavaScriptCompiler().compile(environment, options);
  }

  __exports__.precompile = precompile;function compile(input, options, env) {
    if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
      throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed " + input);
    }

    options = options || {};

    if (!('data' in options)) {
      options.data = true;
    }

    var compiled;

    function compileInput() {
      var ast = env.parse(input);
      var environment = new env.Compiler().compile(ast, options);
      var templateSpec = new env.JavaScriptCompiler().compile(environment, options, undefined, true);
      return env.template(templateSpec);
    }

    // Template is only compiled on first use and cached after that point.
    return function(context, options) {
      if (!compiled) {
        compiled = compileInput();
      }
      return compiled.call(this, context, options);
    };
  }

  __exports__.compile = compile;
  return __exports__;
})(__module5__);

// handlebars/compiler/javascript-compiler.js
var __module11__ = (function(__dependency1__, __dependency2__) {
  "use strict";
  var __exports__;
  var COMPILER_REVISION = __dependency1__.COMPILER_REVISION;
  var REVISION_CHANGES = __dependency1__.REVISION_CHANGES;
  var log = __dependency1__.log;
  var Exception = __dependency2__;

  function Literal(value) {
    this.value = value;
  }

  function JavaScriptCompiler() {}

  JavaScriptCompiler.prototype = {
    // PUBLIC API: You can override these methods in a subclass to provide
    // alternative compiled forms for name lookup and buffering semantics
    nameLookup: function(parent, name /* , type*/) {
      var wrap,
          ret;
      if (parent.indexOf('depth') === 0) {
        wrap = true;
      }

      if (/^[0-9]+$/.test(name)) {
        ret = parent + "[" + name + "]";
      } else if (JavaScriptCompiler.isValidJavaScriptVariableName(name)) {
        ret = parent + "." + name;
      }
      else {
        ret = parent + "['" + name + "']";
      }

      if (wrap) {
        return '(' + parent + ' && ' + ret + ')';
      } else {
        return ret;
      }
    },

    compilerInfo: function() {
      var revision = COMPILER_REVISION,
          versions = REVISION_CHANGES[revision];
      return "this.compilerInfo = ["+revision+",'"+versions+"'];\n";
    },

    appendToBuffer: function(string) {
      if (this.environment.isSimple) {
        return "return " + string + ";";
      } else {
        return {
          appendToBuffer: true,
          content: string,
          toString: function() { return "buffer += " + string + ";"; }
        };
      }
    },

    initializeBuffer: function() {
      return this.quotedString("");
    },

    namespace: "Handlebars",
    // END PUBLIC API

    compile: function(environment, options, context, asObject) {
      this.environment = environment;
      this.options = options || {};

      log('debug', this.environment.disassemble() + "\n\n");

      this.name = this.environment.name;
      this.isChild = !!context;
      this.context = context || {
        programs: [],
        environments: [],
        aliases: { }
      };

      this.preamble();

      this.stackSlot = 0;
      this.stackVars = [];
      this.registers = { list: [] };
      this.hashes = [];
      this.compileStack = [];
      this.inlineStack = [];

      this.compileChildren(environment, options);

      var opcodes = environment.opcodes, opcode;

      this.i = 0;

      for(var l=opcodes.length; this.i<l; this.i++) {
        opcode = opcodes[this.i];

        if(opcode.opcode === 'DECLARE') {
          this[opcode.name] = opcode.value;
        } else {
          this[opcode.opcode].apply(this, opcode.args);
        }

        // Reset the stripNext flag if it was not set by this operation.
        if (opcode.opcode !== this.stripNext) {
          this.stripNext = false;
        }
      }

      // Flush any trailing content that might be pending.
      this.pushSource('');

      if (this.stackSlot || this.inlineStack.length || this.compileStack.length) {
        throw new Exception('Compile completed with content left on stack');
      }

      return this.createFunctionContext(asObject);
    },

    preamble: function() {
      var out = [];

      if (!this.isChild) {
        var namespace = this.namespace;

        var copies = "helpers = this.merge(helpers, " + namespace + ".helpers);";
        if (this.environment.usePartial) { copies = copies + " partials = this.merge(partials, " + namespace + ".partials);"; }
        if (this.options.data) { copies = copies + " data = data || {};"; }
        out.push(copies);
      } else {
        out.push('');
      }

      if (!this.environment.isSimple) {
        out.push(", buffer = " + this.initializeBuffer());
      } else {
        out.push("");
      }

      // track the last context pushed into place to allow skipping the
      // getContext opcode when it would be a noop
      this.lastContext = 0;
      this.source = out;
    },

    createFunctionContext: function(asObject) {
      var locals = this.stackVars.concat(this.registers.list);

      if(locals.length > 0) {
        this.source[1] = this.source[1] + ", " + locals.join(", ");
      }

      // Generate minimizer alias mappings
      if (!this.isChild) {
        for (var alias in this.context.aliases) {
          if (this.context.aliases.hasOwnProperty(alias)) {
            this.source[1] = this.source[1] + ', ' + alias + '=' + this.context.aliases[alias];
          }
        }
      }

      if (this.source[1]) {
        this.source[1] = "var " + this.source[1].substring(2) + ";";
      }

      // Merge children
      if (!this.isChild) {
        this.source[1] += '\n' + this.context.programs.join('\n') + '\n';
      }

      if (!this.environment.isSimple) {
        this.pushSource("return buffer;");
      }

      var params = this.isChild ? ["depth0", "data"] : ["Handlebars", "depth0", "helpers", "partials", "data"];

      for(var i=0, l=this.environment.depths.list.length; i<l; i++) {
        params.push("depth" + this.environment.depths.list[i]);
      }

      // Perform a second pass over the output to merge content when possible
      var source = this.mergeSource();

      if (!this.isChild) {
        source = this.compilerInfo()+source;
      }

      if (asObject) {
        params.push(source);

        return Function.apply(this, params);
      } else {
        var functionSource = 'function ' + (this.name || '') + '(' + params.join(',') + ') {\n  ' + source + '}';
        log('debug', functionSource + "\n\n");
        return functionSource;
      }
    },
    mergeSource: function() {
      // WARN: We are not handling the case where buffer is still populated as the source should
      // not have buffer append operations as their final action.
      var source = '',
          buffer;
      for (var i = 0, len = this.source.length; i < len; i++) {
        var line = this.source[i];
        if (line.appendToBuffer) {
          if (buffer) {
            buffer = buffer + '\n    + ' + line.content;
          } else {
            buffer = line.content;
          }
        } else {
          if (buffer) {
            source += 'buffer += ' + buffer + ';\n  ';
            buffer = undefined;
          }
          source += line + '\n  ';
        }
      }
      return source;
    },

    // [blockValue]
    //
    // On stack, before: hash, inverse, program, value
    // On stack, after: return value of blockHelperMissing
    //
    // The purpose of this opcode is to take a block of the form
    // `{{#foo}}...{{/foo}}`, resolve the value of `foo`, and
    // replace it on the stack with the result of properly
    // invoking blockHelperMissing.
    blockValue: function() {
      this.context.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

      var params = ["depth0"];
      this.setupParams(0, params);

      this.replaceStack(function(current) {
        params.splice(1, 0, current);
        return "blockHelperMissing.call(" + params.join(", ") + ")";
      });
    },

    // [ambiguousBlockValue]
    //
    // On stack, before: hash, inverse, program, value
    // Compiler value, before: lastHelper=value of last found helper, if any
    // On stack, after, if no lastHelper: same as [blockValue]
    // On stack, after, if lastHelper: value
    ambiguousBlockValue: function() {
      this.context.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

      var params = ["depth0"];
      this.setupParams(0, params);

      var current = this.topStack();
      params.splice(1, 0, current);

      this.pushSource("if (!" + this.lastHelper + ") { " + current + " = blockHelperMissing.call(" + params.join(", ") + "); }");
    },

    // [appendContent]
    //
    // On stack, before: ...
    // On stack, after: ...
    //
    // Appends the string value of `content` to the current buffer
    appendContent: function(content) {
      if (this.pendingContent) {
        content = this.pendingContent + content;
      }
      if (this.stripNext) {
        content = content.replace(/^\s+/, '');
      }

      this.pendingContent = content;
    },

    // [strip]
    //
    // On stack, before: ...
    // On stack, after: ...
    //
    // Removes any trailing whitespace from the prior content node and flags
    // the next operation for stripping if it is a content node.
    strip: function() {
      if (this.pendingContent) {
        this.pendingContent = this.pendingContent.replace(/\s+$/, '');
      }
      this.stripNext = 'strip';
    },

    // [append]
    //
    // On stack, before: value, ...
    // On stack, after: ...
    //
    // Coerces `value` to a String and appends it to the current buffer.
    //
    // If `value` is truthy, or 0, it is coerced into a string and appended
    // Otherwise, the empty string is appended
    append: function() {
      // Force anything that is inlined onto the stack so we don't have duplication
      // when we examine local
      this.flushInline();
      var local = this.popStack();
      this.pushSource("if(" + local + " || " + local + " === 0) { " + this.appendToBuffer(local) + " }");
      if (this.environment.isSimple) {
        this.pushSource("else { " + this.appendToBuffer("''") + " }");
      }
    },

    // [appendEscaped]
    //
    // On stack, before: value, ...
    // On stack, after: ...
    //
    // Escape `value` and append it to the buffer
    appendEscaped: function() {
      this.context.aliases.escapeExpression = 'this.escapeExpression';

      this.pushSource(this.appendToBuffer("escapeExpression(" + this.popStack() + ")"));
    },

    // [getContext]
    //
    // On stack, before: ...
    // On stack, after: ...
    // Compiler value, after: lastContext=depth
    //
    // Set the value of the `lastContext` compiler value to the depth
    getContext: function(depth) {
      if(this.lastContext !== depth) {
        this.lastContext = depth;
      }
    },

    // [lookupOnContext]
    //
    // On stack, before: ...
    // On stack, after: currentContext[name], ...
    //
    // Looks up the value of `name` on the current context and pushes
    // it onto the stack.
    lookupOnContext: function(name) {
      this.push(this.nameLookup('depth' + this.lastContext, name, 'context'));
    },

    // [pushContext]
    //
    // On stack, before: ...
    // On stack, after: currentContext, ...
    //
    // Pushes the value of the current context onto the stack.
    pushContext: function() {
      this.pushStackLiteral('depth' + this.lastContext);
    },

    // [resolvePossibleLambda]
    //
    // On stack, before: value, ...
    // On stack, after: resolved value, ...
    //
    // If the `value` is a lambda, replace it on the stack by
    // the return value of the lambda
    resolvePossibleLambda: function() {
      this.context.aliases.functionType = '"function"';

      this.replaceStack(function(current) {
        return "typeof " + current + " === functionType ? " + current + ".apply(depth0) : " + current;
      });
    },

    // [lookup]
    //
    // On stack, before: value, ...
    // On stack, after: value[name], ...
    //
    // Replace the value on the stack with the result of looking
    // up `name` on `value`
    lookup: function(name) {
      this.replaceStack(function(current) {
        return current + " == null || " + current + " === false ? " + current + " : " + this.nameLookup(current, name, 'context');
      });
    },

    // [lookupData]
    //
    // On stack, before: ...
    // On stack, after: data, ...
    //
    // Push the data lookup operator
    lookupData: function() {
      this.pushStackLiteral('data');
    },

    // [pushStringParam]
    //
    // On stack, before: ...
    // On stack, after: string, currentContext, ...
    //
    // This opcode is designed for use in string mode, which
    // provides the string value of a parameter along with its
    // depth rather than resolving it immediately.
    pushStringParam: function(string, type) {
      this.pushStackLiteral('depth' + this.lastContext);

      this.pushString(type);

      // If it's a subexpression, the string result
      // will be pushed after this opcode.
      if (type !== 'sexpr') {
        if (typeof string === 'string') {
          this.pushString(string);
        } else {
          this.pushStackLiteral(string);
        }
      }
    },

    emptyHash: function() {
      this.pushStackLiteral('{}');

      if (this.options.stringParams) {
        this.push('{}'); // hashContexts
        this.push('{}'); // hashTypes
      }
    },
    pushHash: function() {
      if (this.hash) {
        this.hashes.push(this.hash);
      }
      this.hash = {values: [], types: [], contexts: []};
    },
    popHash: function() {
      var hash = this.hash;
      this.hash = this.hashes.pop();

      if (this.options.stringParams) {
        this.push('{' + hash.contexts.join(',') + '}');
        this.push('{' + hash.types.join(',') + '}');
      }

      this.push('{\n    ' + hash.values.join(',\n    ') + '\n  }');
    },

    // [pushString]
    //
    // On stack, before: ...
    // On stack, after: quotedString(string), ...
    //
    // Push a quoted version of `string` onto the stack
    pushString: function(string) {
      this.pushStackLiteral(this.quotedString(string));
    },

    // [push]
    //
    // On stack, before: ...
    // On stack, after: expr, ...
    //
    // Push an expression onto the stack
    push: function(expr) {
      this.inlineStack.push(expr);
      return expr;
    },

    // [pushLiteral]
    //
    // On stack, before: ...
    // On stack, after: value, ...
    //
    // Pushes a value onto the stack. This operation prevents
    // the compiler from creating a temporary variable to hold
    // it.
    pushLiteral: function(value) {
      this.pushStackLiteral(value);
    },

    // [pushProgram]
    //
    // On stack, before: ...
    // On stack, after: program(guid), ...
    //
    // Push a program expression onto the stack. This takes
    // a compile-time guid and converts it into a runtime-accessible
    // expression.
    pushProgram: function(guid) {
      if (guid != null) {
        this.pushStackLiteral(this.programExpression(guid));
      } else {
        this.pushStackLiteral(null);
      }
    },

    // [invokeHelper]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of helper invocation
    //
    // Pops off the helper's parameters, invokes the helper,
    // and pushes the helper's return value onto the stack.
    //
    // If the helper is not found, `helperMissing` is called.
    invokeHelper: function(paramSize, name, isRoot) {
      this.context.aliases.helperMissing = 'helpers.helperMissing';
      this.useRegister('helper');

      var helper = this.lastHelper = this.setupHelper(paramSize, name, true);
      var nonHelper = this.nameLookup('depth' + this.lastContext, name, 'context');

      var lookup = 'helper = ' + helper.name + ' || ' + nonHelper;
      if (helper.paramsInit) {
        lookup += ',' + helper.paramsInit;
      }

      this.push(
        '('
          + lookup
          + ',helper '
            + '? helper.call(' + helper.callParams + ') '
            + ': helperMissing.call(' + helper.helperMissingParams + '))');

      // Always flush subexpressions. This is both to prevent the compounding size issue that
      // occurs when the code has to be duplicated for inlining and also to prevent errors
      // due to the incorrect options object being passed due to the shared register.
      if (!isRoot) {
        this.flushInline();
      }
    },

    // [invokeKnownHelper]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of helper invocation
    //
    // This operation is used when the helper is known to exist,
    // so a `helperMissing` fallback is not required.
    invokeKnownHelper: function(paramSize, name) {
      var helper = this.setupHelper(paramSize, name);
      this.push(helper.name + ".call(" + helper.callParams + ")");
    },

    // [invokeAmbiguous]
    //
    // On stack, before: hash, inverse, program, params..., ...
    // On stack, after: result of disambiguation
    //
    // This operation is used when an expression like `{{foo}}`
    // is provided, but we don't know at compile-time whether it
    // is a helper or a path.
    //
    // This operation emits more code than the other options,
    // and can be avoided by passing the `knownHelpers` and
    // `knownHelpersOnly` flags at compile-time.
    invokeAmbiguous: function(name, helperCall) {
      this.context.aliases.functionType = '"function"';
      this.useRegister('helper');

      this.emptyHash();
      var helper = this.setupHelper(0, name, helperCall);

      var helperName = this.lastHelper = this.nameLookup('helpers', name, 'helper');

      var nonHelper = this.nameLookup('depth' + this.lastContext, name, 'context');
      var nextStack = this.nextStack();

      if (helper.paramsInit) {
        this.pushSource(helper.paramsInit);
      }
      this.pushSource('if (helper = ' + helperName + ') { ' + nextStack + ' = helper.call(' + helper.callParams + '); }');
      this.pushSource('else { helper = ' + nonHelper + '; ' + nextStack + ' = typeof helper === functionType ? helper.call(' + helper.callParams + ') : helper; }');
    },

    // [invokePartial]
    //
    // On stack, before: context, ...
    // On stack after: result of partial invocation
    //
    // This operation pops off a context, invokes a partial with that context,
    // and pushes the result of the invocation back.
    invokePartial: function(name) {
      var params = [this.nameLookup('partials', name, 'partial'), "'" + name + "'", this.popStack(), "helpers", "partials"];

      if (this.options.data) {
        params.push("data");
      }

      this.context.aliases.self = "this";
      this.push("self.invokePartial(" + params.join(", ") + ")");
    },

    // [assignToHash]
    //
    // On stack, before: value, hash, ...
    // On stack, after: hash, ...
    //
    // Pops a value and hash off the stack, assigns `hash[key] = value`
    // and pushes the hash back onto the stack.
    assignToHash: function(key) {
      var value = this.popStack(),
          context,
          type;

      if (this.options.stringParams) {
        type = this.popStack();
        context = this.popStack();
      }

      var hash = this.hash;
      if (context) {
        hash.contexts.push("'" + key + "': " + context);
      }
      if (type) {
        hash.types.push("'" + key + "': " + type);
      }
      hash.values.push("'" + key + "': (" + value + ")");
    },

    // HELPERS

    compiler: JavaScriptCompiler,

    compileChildren: function(environment, options) {
      var children = environment.children, child, compiler;

      for(var i=0, l=children.length; i<l; i++) {
        child = children[i];
        compiler = new this.compiler();

        var index = this.matchExistingProgram(child);

        if (index == null) {
          this.context.programs.push('');     // Placeholder to prevent name conflicts for nested children
          index = this.context.programs.length;
          child.index = index;
          child.name = 'program' + index;
          this.context.programs[index] = compiler.compile(child, options, this.context);
          this.context.environments[index] = child;
        } else {
          child.index = index;
          child.name = 'program' + index;
        }
      }
    },
    matchExistingProgram: function(child) {
      for (var i = 0, len = this.context.environments.length; i < len; i++) {
        var environment = this.context.environments[i];
        if (environment && environment.equals(child)) {
          return i;
        }
      }
    },

    programExpression: function(guid) {
      this.context.aliases.self = "this";

      if(guid == null) {
        return "self.noop";
      }

      var child = this.environment.children[guid],
          depths = child.depths.list, depth;

      var programParams = [child.index, child.name, "data"];

      for(var i=0, l = depths.length; i<l; i++) {
        depth = depths[i];

        if(depth === 1) { programParams.push("depth0"); }
        else { programParams.push("depth" + (depth - 1)); }
      }

      return (depths.length === 0 ? "self.program(" : "self.programWithDepth(") + programParams.join(", ") + ")";
    },

    register: function(name, val) {
      this.useRegister(name);
      this.pushSource(name + " = " + val + ";");
    },

    useRegister: function(name) {
      if(!this.registers[name]) {
        this.registers[name] = true;
        this.registers.list.push(name);
      }
    },

    pushStackLiteral: function(item) {
      return this.push(new Literal(item));
    },

    pushSource: function(source) {
      if (this.pendingContent) {
        this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent)));
        this.pendingContent = undefined;
      }

      if (source) {
        this.source.push(source);
      }
    },

    pushStack: function(item) {
      this.flushInline();

      var stack = this.incrStack();
      if (item) {
        this.pushSource(stack + " = " + item + ";");
      }
      this.compileStack.push(stack);
      return stack;
    },

    replaceStack: function(callback) {
      var prefix = '',
          inline = this.isInline(),
          stack,
          createdStack,
          usedLiteral;

      // If we are currently inline then we want to merge the inline statement into the
      // replacement statement via ','
      if (inline) {
        var top = this.popStack(true);

        if (top instanceof Literal) {
          // Literals do not need to be inlined
          stack = top.value;
          usedLiteral = true;
        } else {
          // Get or create the current stack name for use by the inline
          createdStack = !this.stackSlot;
          var name = !createdStack ? this.topStackName() : this.incrStack();

          prefix = '(' + this.push(name) + ' = ' + top + '),';
          stack = this.topStack();
        }
      } else {
        stack = this.topStack();
      }

      var item = callback.call(this, stack);

      if (inline) {
        if (!usedLiteral) {
          this.popStack();
        }
        if (createdStack) {
          this.stackSlot--;
        }
        this.push('(' + prefix + item + ')');
      } else {
        // Prevent modification of the context depth variable. Through replaceStack
        if (!/^stack/.test(stack)) {
          stack = this.nextStack();
        }

        this.pushSource(stack + " = (" + prefix + item + ");");
      }
      return stack;
    },

    nextStack: function() {
      return this.pushStack();
    },

    incrStack: function() {
      this.stackSlot++;
      if(this.stackSlot > this.stackVars.length) { this.stackVars.push("stack" + this.stackSlot); }
      return this.topStackName();
    },
    topStackName: function() {
      return "stack" + this.stackSlot;
    },
    flushInline: function() {
      var inlineStack = this.inlineStack;
      if (inlineStack.length) {
        this.inlineStack = [];
        for (var i = 0, len = inlineStack.length; i < len; i++) {
          var entry = inlineStack[i];
          if (entry instanceof Literal) {
            this.compileStack.push(entry);
          } else {
            this.pushStack(entry);
          }
        }
      }
    },
    isInline: function() {
      return this.inlineStack.length;
    },

    popStack: function(wrapped) {
      var inline = this.isInline(),
          item = (inline ? this.inlineStack : this.compileStack).pop();

      if (!wrapped && (item instanceof Literal)) {
        return item.value;
      } else {
        if (!inline) {
          if (!this.stackSlot) {
            throw new Exception('Invalid stack pop');
          }
          this.stackSlot--;
        }
        return item;
      }
    },

    topStack: function(wrapped) {
      var stack = (this.isInline() ? this.inlineStack : this.compileStack),
          item = stack[stack.length - 1];

      if (!wrapped && (item instanceof Literal)) {
        return item.value;
      } else {
        return item;
      }
    },

    quotedString: function(str) {
      return '"' + str
        .replace(/\\/g, '\\\\')
        .replace(/"/g, '\\"')
        .replace(/\n/g, '\\n')
        .replace(/\r/g, '\\r')
        .replace(/\u2028/g, '\\u2028')   // Per Ecma-262 7.3 + 7.8.4
        .replace(/\u2029/g, '\\u2029') + '"';
    },

    setupHelper: function(paramSize, name, missingParams) {
      var params = [],
          paramsInit = this.setupParams(paramSize, params, missingParams);
      var foundHelper = this.nameLookup('helpers', name, 'helper');

      return {
        params: params,
        paramsInit: paramsInit,
        name: foundHelper,
        callParams: ["depth0"].concat(params).join(", "),
        helperMissingParams: missingParams && ["depth0", this.quotedString(name)].concat(params).join(", ")
      };
    },

    setupOptions: function(paramSize, params) {
      var options = [], contexts = [], types = [], param, inverse, program;

      options.push("hash:" + this.popStack());

      if (this.options.stringParams) {
        options.push("hashTypes:" + this.popStack());
        options.push("hashContexts:" + this.popStack());
      }

      inverse = this.popStack();
      program = this.popStack();

      // Avoid setting fn and inverse if neither are set. This allows
      // helpers to do a check for `if (options.fn)`
      if (program || inverse) {
        if (!program) {
          this.context.aliases.self = "this";
          program = "self.noop";
        }

        if (!inverse) {
          this.context.aliases.self = "this";
          inverse = "self.noop";
        }

        options.push("inverse:" + inverse);
        options.push("fn:" + program);
      }

      for(var i=0; i<paramSize; i++) {
        param = this.popStack();
        params.push(param);

        if(this.options.stringParams) {
          types.push(this.popStack());
          contexts.push(this.popStack());
        }
      }

      if (this.options.stringParams) {
        options.push("contexts:[" + contexts.join(",") + "]");
        options.push("types:[" + types.join(",") + "]");
      }

      if(this.options.data) {
        options.push("data:data");
      }

      return options;
    },

    // the params and contexts arguments are passed in arrays
    // to fill in
    setupParams: function(paramSize, params, useRegister) {
      var options = '{' + this.setupOptions(paramSize, params).join(',') + '}';

      if (useRegister) {
        this.useRegister('options');
        params.push('options');
        return 'options=' + options;
      } else {
        params.push(options);
        return '';
      }
    }
  };

  var reservedWords = (
    "break else new var" +
    " case finally return void" +
    " catch for switch while" +
    " continue function this with" +
    " default if throw" +
    " delete in try" +
    " do instanceof typeof" +
    " abstract enum int short" +
    " boolean export interface static" +
    " byte extends long super" +
    " char final native synchronized" +
    " class float package throws" +
    " const goto private transient" +
    " debugger implements protected volatile" +
    " double import public let yield"
  ).split(" ");

  var compilerWords = JavaScriptCompiler.RESERVED_WORDS = {};

  for(var i=0, l=reservedWords.length; i<l; i++) {
    compilerWords[reservedWords[i]] = true;
  }

  JavaScriptCompiler.isValidJavaScriptVariableName = function(name) {
    if(!JavaScriptCompiler.RESERVED_WORDS[name] && /^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name)) {
      return true;
    }
    return false;
  };

  __exports__ = JavaScriptCompiler;
  return __exports__;
})(__module2__, __module5__);

// handlebars.js
var __module0__ = (function(__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
  "use strict";
  var __exports__;
  /*globals Handlebars: true */
  var Handlebars = __dependency1__;

  // Compiler imports
  var AST = __dependency2__;
  var Parser = __dependency3__.parser;
  var parse = __dependency3__.parse;
  var Compiler = __dependency4__.Compiler;
  var compile = __dependency4__.compile;
  var precompile = __dependency4__.precompile;
  var JavaScriptCompiler = __dependency5__;

  var _create = Handlebars.create;
  var create = function() {
    var hb = _create();

    hb.compile = function(input, options) {
      return compile(input, options, hb);
    };
    hb.precompile = function (input, options) {
      return precompile(input, options, hb);
    };

    hb.AST = AST;
    hb.Compiler = Compiler;
    hb.JavaScriptCompiler = JavaScriptCompiler;
    hb.Parser = Parser;
    hb.parse = parse;

    return hb;
  };

  Handlebars = create();
  Handlebars.create = create;

  __exports__ = Handlebars;
  return __exports__;
})(__module1__, __module7__, __module8__, __module10__, __module11__);

  return __module0__;
})();

Handlebars.registerHelper('ifCond', function (v1, operator, v2, options) {
    switch (operator) {
        case '==':
            return (v1 == v2) ? options.fn(this) : options.inverse(this);
        case '===':
            return (v1 === v2) ? options.fn(this) : options.inverse(this);
        case '!=':
            return (v1 != v2) ? options.fn(this) : options.inverse(this);
        case '!==':
            return (v1 !== v2) ? options.fn(this) : options.inverse(this);
        case '<':
            return (v1 < v2) ? options.fn(this) : options.inverse(this);
        case '<=':
            return (v1 <= v2) ? options.fn(this) : options.inverse(this);
        case '>':
            return (v1 > v2) ? options.fn(this) : options.inverse(this);
        case '>=':
            return (v1 >= v2) ? options.fn(this) : options.inverse(this);
        case '&&':
            return (v1 && v2) ? options.fn(this) : options.inverse(this);
        case '||':
            return (v1 || v2) ? options.fn(this) : options.inverse(this);
        default:
            return options.inverse(this);
    }
});

Handlebars.registerHelper('ternary', function (cond, v1, v2, options) {
    return cond ? v1 : v2;
});

Handlebars.registerHelper('if_eq', function(a, b, opts) {
    if (a == b) {
        return opts.fn(this);
    } else {
        return opts.inverse(this);
    }
});

!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.vanillaTextMask=r():e.vanillaTextMask=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){var r=e.inputElement,t=(0,u.default)(e),n=function(e){var r=e.target.value;return t.update(r)};return r.addEventListener("input",n),t.update(r.value),{textMaskInputElement:t,destroy:function(){r.removeEventListener("input",n)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.conformToMask=void 0,r.maskInput=o;var i=t(2);Object.defineProperty(r,"conformToMask",{enumerable:!0,get:function(){return n(i).default}});var a=t(5),u=n(a);r.default=o},function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.placeholderChar="_",r.strFunction="function"},function(e,r,t){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(0,i.isArray)(r)){if(("undefined"==typeof r?"undefined":o(r))!==a.strFunction)throw new Error("Text-mask:conformToMask; The mask property must be an array.");r=r(e,t),r=(0,i.processCaretTraps)(r).maskWithoutCaretTraps}var n=t.guide,s=void 0===n||n,f=t.previousConformedValue,d=void 0===f?l:f,c=t.placeholderChar,p=void 0===c?a.placeholderChar:c,v=t.placeholder,h=void 0===v?(0,i.convertMaskToPlaceholder)(r,p):v,m=t.currentCaretPosition,y=t.keepCharPositions,g=s===!1&&void 0!==d,b=e.length,C=d.length,k=h.length,x=r.length,P=b-C,T=P>0,O=m+(T?-P:0),M=O+Math.abs(P);if(y===!0&&!T){for(var w=l,S=O;S<M;S++)h[S]===p&&(w+=p);e=e.slice(0,O)+w+e.slice(O,b)}for(var _=e.split(l).map(function(e,r){return{char:e,isNew:r>=O&&r<M}}),j=b-1;j>=0;j--){var V=_[j].char;if(V!==p){var A=j>=O&&C===x;V===h[A?j-P:j]&&_.splice(j,1)}}var E=l,N=!1;e:for(var F=0;F<k;F++){var I=h[F];if(I===p){if(_.length>0)for(;_.length>0;){var L=_.shift(),R=L.char,J=L.isNew;if(R===p&&g!==!0){E+=p;continue e}if(r[F].test(R)){if(y===!0&&J!==!1&&d!==l&&s!==!1&&T){for(var W=_.length,q=null,z=0;z<W;z++){var B=_[z];if(B.char!==p&&B.isNew===!1)break;if(B.char===p){q=z;break}}null!==q?(E+=R,_.splice(q,1)):F--}else E+=R;continue e}N=!0}g===!1&&(E+=h.substr(F,k));break}E+=I}if(g&&T===!1){for(var D=null,G=0;G<E.length;G++)h[G]===p&&(D=G);E=null!==D?E.substr(0,D+1):l}return{conformedValue:E,meta:{someCharsRejected:N}}}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.default=n;var i=t(3),a=t(1),u=[],l=""},function(e,r,t){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.placeholderChar;if(!o(e))throw new Error("Text-mask:convertMaskToPlaceholder; The mask property must be an array.");if(e.indexOf(r)!==-1)throw new Error("Placeholder character must not be used as part of the mask. Please specify a character that is not present in your mask as your placeholder character.\n\n"+("The placeholder character that was received is: "+JSON.stringify(r)+"\n\n")+("The mask that was received is: "+JSON.stringify(e)));return e.map(function(e){return e instanceof RegExp?r:e}).join("")}function o(e){return Array.isArray&&Array.isArray(e)||e instanceof Array}function i(e){return"string"==typeof e||e instanceof String}function a(e){return"number"==typeof e&&void 0===e.length&&!isNaN(e)}function u(e){for(var r=[],t=void 0;t=e.indexOf(f),t!==-1;)r.push(t),e.splice(t,1);return{maskWithoutCaretTraps:e,indexes:r}}Object.defineProperty(r,"__esModule",{value:!0}),r.convertMaskToPlaceholder=n,r.isArray=o,r.isString=i,r.isNumber=a,r.processCaretTraps=u;var l=t(1),s=[],f="[]"},function(e,r){"use strict";function t(e){var r=e.previousConformedValue,t=void 0===r?o:r,i=e.previousPlaceholder,a=void 0===i?o:i,u=e.currentCaretPosition,l=void 0===u?0:u,s=e.conformedValue,f=e.rawValue,d=e.placeholderChar,c=e.placeholder,p=e.indexesOfPipedChars,v=void 0===p?n:p,h=e.caretTrapIndexes,m=void 0===h?n:h;if(0===l||!f.length)return 0;var y=f.length,g=t.length,b=c.length,C=s.length,k=y-g,x=k>0,P=0===g,T=k>1&&!x&&!P;if(T)return l;var O=x&&(t===s||s===c),M=0,w=void 0,S=void 0;if(O)M=l-k;else{var _=s.toLowerCase(),j=f.toLowerCase(),V=j.substr(0,l).split(o),A=V.filter(function(e){return _.indexOf(e)!==-1});S=A[A.length-1];var E=a.substr(0,A.length).split(o).filter(function(e){return e!==d}).length,N=c.substr(0,A.length).split(o).filter(function(e){return e!==d}).length,F=N!==E,I=void 0!==a[A.length-1]&&void 0!==c[A.length-2]&&a[A.length-1]!==d&&a[A.length-1]!==c[A.length-1]&&a[A.length-1]===c[A.length-2];!x&&(F||I)&&E>0&&c.indexOf(S)>-1&&void 0!==f[l]&&(w=!0,S=f[l]);for(var L=v.map(function(e){return _[e]}),R=L.filter(function(e){return e===S}).length,J=A.filter(function(e){return e===S}).length,W=c.substr(0,c.indexOf(d)).split(o).filter(function(e,r){return e===S&&f[r]!==e}).length,q=W+J+R+(w?1:0),z=0,B=0;B<C;B++){var D=_[B];if(M=B+1,D===S&&z++,z>=q)break}}if(x){for(var G=M,H=M;H<=b;H++)if(c[H]===d&&(G=H),c[H]===d||m.indexOf(H)!==-1||H===b)return G}else if(w){for(var K=M-1;K>=0;K--)if(s[K]===S||m.indexOf(K)!==-1||0===K)return K}else for(var Q=M;Q>=0;Q--)if(c[Q-1]===d||m.indexOf(Q)!==-1||0===Q)return Q}Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;var n=[],o=""},function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){var r={previousConformedValue:void 0,previousPlaceholder:void 0};return{state:r,update:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=n.inputElement,s=n.mask,d=n.guide,m=n.pipe,g=n.placeholderChar,b=void 0===g?v.placeholderChar:g,C=n.keepCharPositions,k=void 0!==C&&C,x=n.showMask,P=void 0!==x&&x;if("undefined"==typeof t&&(t=o.value),t!==r.previousConformedValue){("undefined"==typeof s?"undefined":l(s))===y&&void 0!==s.pipe&&void 0!==s.mask&&(m=s.pipe,s=s.mask);var T=void 0,O=void 0;if(s instanceof Array&&(T=(0,p.convertMaskToPlaceholder)(s,b)),s!==!1){var M=a(t),w=o.selectionEnd,S=r.previousConformedValue,_=r.previousPlaceholder,j=void 0;if(("undefined"==typeof s?"undefined":l(s))===v.strFunction){if(O=s(M,{currentCaretPosition:w,previousConformedValue:S,placeholderChar:b}),O===!1)return;var V=(0,p.processCaretTraps)(O),A=V.maskWithoutCaretTraps,E=V.indexes;O=A,j=E,T=(0,p.convertMaskToPlaceholder)(O,b)}else O=s;var N={previousConformedValue:S,guide:d,placeholderChar:b,pipe:m,placeholder:T,currentCaretPosition:w,keepCharPositions:k},F=(0,c.default)(M,O,N),I=F.conformedValue,L=("undefined"==typeof m?"undefined":l(m))===v.strFunction,R={};L&&(R=m(I,u({rawValue:M},N)),R===!1?R={value:S,rejected:!0}:(0,p.isString)(R)&&(R={value:R}));var J=L?R.value:I,W=(0,f.default)({previousConformedValue:S,previousPlaceholder:_,conformedValue:J,placeholder:T,rawValue:M,currentCaretPosition:w,placeholderChar:b,indexesOfPipedChars:R.indexesOfPipedChars,caretTrapIndexes:j}),q=J===T&&0===W,z=P?T:h,B=q?z:J;r.previousConformedValue=B,r.previousPlaceholder=T,o.value!==B&&(o.value=B,i(o,W))}}}}}function i(e,r){document.activeElement===e&&(g?b(function(){return e.setSelectionRange(r,r,m)},0):e.setSelectionRange(r,r,m))}function a(e){if((0,p.isString)(e))return e;if((0,p.isNumber)(e))return String(e);if(void 0===e||null===e)return h;throw new Error("The 'value' provided to Text Mask needs to be a string or a number. The value received was:\n\n "+JSON.stringify(e))}Object.defineProperty(r,"__esModule",{value:!0});var u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.default=o;var s=t(4),f=n(s),d=t(2),c=n(d),p=t(3),v=t(1),h="",m="none",y="object",g="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),b="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:setTimeout}])});

const createNumberMaskDollarSign = '$'
const createNumberMaskEmptyString = ''
const createNumberMaskComma = ','
const createNumberMaskPeriod = '.'
const createNumberMaskMinus = '-'
const createNumberMaskMinusRegExp = /-/
const createNumberMaskNonDigitsRegExp = /\D+/g
const createNumberMaskNumber = 'number'
const createNumberMaskDigitRegExp = /\d/
const createNumberMaskCaretTrap = '[]'

function createNumberMask({
  prefix = createNumberMaskDollarSign,
  suffix = createNumberMaskEmptyString,
  includeThousandsSeparator = true,
  thousandsSeparatorSymbol = createNumberMaskComma,
  allowDecimal = false,
  decimalSymbol = createNumberMaskPeriod,
  decimalLimit = 2,
  requireDecimal = false,
  allowNegative = false,
  allowLeadingZeroes = false,
  integerLimit = null
} = {}) {
  const prefixLength = prefix && prefix.length || 0
  const suffixLength = suffix && suffix.length || 0
  const thousandsSeparatorSymbolLength = thousandsSeparatorSymbol && thousandsSeparatorSymbol.length || 0

  function numberMask(rawValue = createNumberMaskEmptyString) {
    const rawValueLength = rawValue.length

    if (
      rawValue === createNumberMaskEmptyString ||
      (rawValue[0] === prefix[0] && rawValueLength === 1)
    ) {
      return prefix.split(createNumberMaskEmptyString).concat([createNumberMaskDigitRegExp]).concat(suffix.split(createNumberMaskEmptyString))
    } else if(
      rawValue === decimalSymbol &&
      allowDecimal
    ) {
      return prefix.split(createNumberMaskEmptyString).concat(['0', decimalSymbol, createNumberMaskDigitRegExp]).concat(suffix.split(createNumberMaskEmptyString))
    }

    const isNegative = (rawValue[0] === createNumberMaskMinus) && allowNegative
    //If negative remove "-" sign
    if(isNegative) {
      rawValue = rawValue.toString().substr(1)
    }

    const indexOfLastDecimal = rawValue.lastIndexOf(decimalSymbol)
    const hasDecimal = indexOfLastDecimal !== -1

    let integer
    let fraction
    let mask

    // remove the suffix
    if (rawValue.slice(suffixLength * -1) === suffix) {
      rawValue = rawValue.slice(0, suffixLength * -1)
    }

    if (hasDecimal && (allowDecimal || requireDecimal)) {
      integer = rawValue.slice(rawValue.slice(0, prefixLength) === prefix ? prefixLength : 0, indexOfLastDecimal)

      fraction = rawValue.slice(indexOfLastDecimal + 1, rawValueLength)
      fraction = convertToMask(fraction.replace(createNumberMaskNonDigitsRegExp, createNumberMaskEmptyString))
    } else {
      if (rawValue.slice(0, prefixLength) === prefix) {
        integer = rawValue.slice(prefixLength)
      } else {
        integer = rawValue
      }
    }

    if (integerLimit && typeof integerLimit === createNumberMaskNumber) {
      const thousandsSeparatorRegex = thousandsSeparatorSymbol === '.' ? '[.]' : `${thousandsSeparatorSymbol}`
      const numberOfThousandSeparators = (integer.match(new RegExp(thousandsSeparatorRegex, 'g')) || []).length

      integer = integer.slice(0, integerLimit + (numberOfThousandSeparators * thousandsSeparatorSymbolLength))
    }

    integer = integer.replace(createNumberMaskNonDigitsRegExp, createNumberMaskEmptyString)

    if (!allowLeadingZeroes) {
      integer = integer.replace(/^0+(0$|[^0])/, '$1')
    }

    integer = (includeThousandsSeparator) ? addThousandsSeparator(integer, thousandsSeparatorSymbol) : integer

    mask = convertToMask(integer)

    if ((hasDecimal && allowDecimal) || requireDecimal === true) {
      if (rawValue[indexOfLastDecimal - 1] !== decimalSymbol) {
        mask.push(createNumberMaskCaretTrap)
      }

      mask.push(decimalSymbol, createNumberMaskCaretTrap)

      if (fraction) {
        if (typeof decimalLimit === createNumberMaskNumber) {
          fraction = fraction.slice(0, decimalLimit)
        }

        mask = mask.concat(fraction)
      }

      if (requireDecimal === true && rawValue[indexOfLastDecimal - 1] === decimalSymbol) {
        mask.push(createNumberMaskDigitRegExp)
      }
    }

    if (prefixLength > 0) {
      mask = prefix.split(createNumberMaskEmptyString).concat(mask)
    }

    if (isNegative) {
      // If user is entering a negative number, add a mask placeholder spot to attract the caret to it.
      if (mask.length === prefixLength) {
        mask.push(createNumberMaskDigitRegExp)
      }

      mask = [createNumberMaskMinusRegExp].concat(mask)
    }

    if (suffix.length > 0) {
      mask = mask.concat(suffix.split(createNumberMaskEmptyString))
    }

    return mask
  }

  numberMask.instanceOf = 'createNumberMask'

  return numberMask
}

function convertToMask(strNumber) {
  return strNumber
    .split(createNumberMaskEmptyString)
    .map((char) => createNumberMaskDigitRegExp.test(char) ? createNumberMaskDigitRegExp : char)
}

// http://stackoverflow.com/a/10899795/604296
function addThousandsSeparator(n, thousandsSeparatorSymbol) {
  return n.replace(/\B(?=(\d{3})+(?!\d))/g, thousandsSeparatorSymbol)
}
const GenericImage = (function() {
    const defaults = {
        "classes": {
            "loaded": "loaded"
        },
        "events": {
            "load": "load"
        }
    };

    return class {
        constructor($image) {
            this.$image = $image;
            this.initComponent();
        }

        initComponent() {
            if (this.$image.length > 0) {
                this.$image.toggleClass(defaults.classes.loaded, this.$image.get(0).complete);
            }

            this.bindEvents();
        }

        bindEvents() {
            const isComplete = this.$image.get(0) && this.$image.get(0).complete;

            if (!isComplete) {
                this.$image.one(defaults.events.load, () => {
                    this.$image.addClass(defaults.classes.loaded);
                });
            }
        }
    };
})();

/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.8.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
/* global window, document, define, jQuery, setInterval, clearInterval */
;(function(factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function($) {
    'use strict';
    var Slick = window.Slick || {};

    Slick = (function() {

        var instanceUid = 0;

        function Slick(element, settings) {

            var _ = this, dataSettings;

            _.defaults = {
                useCustomTransition: false, /* Plugin line Modified  */
                accessibility: true,
                adaptiveHeight: false,
                appendArrows: $(element),
                appendDots: $(element),
                arrows: true,
                asNavFor: null,
                prevArrow: '<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',
                nextArrow: '<button class="slick-next" aria-label="Next" type="button">Next</button>',
                autoplay: false,
                autoplaySpeed: 3000,
                centerMode: false,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function(slider, i) {
                    return $('<button type="button" />').text(i + 1);
                },
                dots: false,
                dotsClass: 'slick-dots',
                draggable: true,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: false,
                focusOnSelect: false,
                focusOnChange: false,
                infinite: true,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: false,
                pauseOnHover: true,
                pauseOnFocus: true,
                pauseOnDotsHover: false,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: false,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: true,
                swipeToSlide: false,
                touchMove: true,
                touchThreshold: 5,
                useCSS: true,
                useTransform: true,
                variableWidth: false,
                vertical: false,
                verticalSwiping: false,
                waitForAnimate: true,
                zIndex: 1000
            };

            _.initials = {
                animating: false,
                dragging: false,
                autoPlayTimer: null,
                currentDirection: 0,
                currentLeft: null,
                currentSlide: 0,
                direction: 1,
                $dots: null,
                listWidth: null,
                listHeight: null,
                loadIndex: 0,
                $nextArrow: null,
                $prevArrow: null,
                scrolling: false,
                slideCount: null,
                slideWidth: null,
                $slideTrack: null,
                $slides: null,
                sliding: false,
                slideOffset: 0,
                swipeLeft: null,
                swiping: false,
                $list: null,
                touchObject: {},
                transformsEnabled: false,
                unslicked: false
            };

            $.extend(_, _.initials);

            _.activeBreakpoint = null;
            _.animType = null;
            _.animProp = null;
            _.breakpoints = [];
            _.breakpointSettings = [];
            _.cssTransitions = false;
            _.focussed = false;
            _.interrupted = false;
            _.hidden = 'hidden';
            _.paused = true;
            _.positionProp = null;
            _.respondTo = null;
            _.rowCount = 1;
            _.shouldClick = true;
            _.$slider = $(element);
            _.$slidesCache = null;
            _.transformType = null;
            _.transitionType = null;
            _.visibilityChange = 'visibilitychange';
            _.windowWidth = 0;
            _.windowTimer = null;

            dataSettings = $(element).data('slick') || {};

            _.options = $.extend({}, _.defaults, settings, dataSettings);

            _.currentSlide = _.options.initialSlide;

            _.originalSettings = _.options;

            if (typeof document.mozHidden !== 'undefined') {
                _.hidden = 'mozHidden';
                _.visibilityChange = 'mozvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                _.hidden = 'webkitHidden';
                _.visibilityChange = 'webkitvisibilitychange';
            }

            _.autoPlay = $.proxy(_.autoPlay, _);
            _.autoPlayClear = $.proxy(_.autoPlayClear, _);
            _.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
            _.changeSlide = $.proxy(_.changeSlide, _);
            _.clickHandler = $.proxy(_.clickHandler, _);
            _.selectHandler = $.proxy(_.selectHandler, _);
            _.setPosition = $.proxy(_.setPosition, _);
            _.swipeHandler = $.proxy(_.swipeHandler, _);
            _.dragHandler = $.proxy(_.dragHandler, _);
            _.keyHandler = $.proxy(_.keyHandler, _);

            _.instanceUid = instanceUid++;

            // A simple way to check for HTML strings
            // Strict HTML recognition (must start with <)
            // Extracted from jQuery v1.11 source
            _.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;


            _.registerBreakpoints();
            _.init(true);

        }

        return Slick;

    }());

    Slick.prototype.activateADA = function() {
        var _ = this;

        _.$slideTrack.find('.slick-active').attr({
            'aria-hidden': 'false'
        }).find('a,\x20input,\x20button,\x20select').attr({
            'tabindex': '0'
        });

    };

    Slick.prototype.addSlide = Slick.prototype.slickAdd = function(markup, index, addBefore) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            addBefore = index;
            index = null;
        } else if (index < 0 || (index >= _.slideCount)) {
            return false;
        }

        _.unload();

        if (typeof(index) === 'number') {
            if (index === 0 && _.$slides.length === 0) {
                $(markup).appendTo(_.$slideTrack);
            } else if (addBefore) {
                $(markup).insertBefore(_.$slides.eq(index));
            } else {
                $(markup).insertAfter(_.$slides.eq(index));
            }
        } else {
            if (addBefore === true) {
                $(markup).prependTo(_.$slideTrack);
            } else {
                $(markup).appendTo(_.$slideTrack);
            }
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slides.each(function(index, element) {
            $(element).attr('data-slick-index', index);
        });

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.animateHeight = function() {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.animate({
                height: targetHeight
            }, _.options.speed);
        }
    };

    Slick.prototype.animateSlide = function(targetLeft, callback) {

        var animProps = {},
            _ = this;

        _.animateHeight();

        if (_.options.rtl === true && _.options.vertical === false) {
            targetLeft = -targetLeft;
        }
        if (_.transformsEnabled === false) {
            if (_.options.vertical === false) {
                _.$slideTrack.animate({
                    left: targetLeft
                }, _.options.speed, _.options.easing, callback);
            } else {
                _.$slideTrack.animate({
                    top: targetLeft
                }, _.options.speed, _.options.easing, callback);
            }

        } else {

            if (_.cssTransitions === false) {
                if (_.options.rtl === true) {
                    _.currentLeft = -(_.currentLeft);
                }
                $({
                    animStart: _.currentLeft
                }).animate({
                    animStart: targetLeft
                }, {
                    duration: _.options.speed,
                    easing: _.options.easing,
                    step: function(now) {
                        now = Math.ceil(now);
                        if (_.options.vertical === false) {
                            animProps[_.animType] = 'translate(' +
                                now + 'px, 0px)';
                            _.$slideTrack.css(animProps);
                        } else {
                            animProps[_.animType] = 'translate(0px,' +
                                now + 'px)';
                            _.$slideTrack.css(animProps);
                        }
                    },
                    complete: function() {
                        if (callback) {
                            callback.call();
                        }
                    }
                });

            } else {

                _.applyTransition();
                targetLeft = Math.ceil(targetLeft);

                if (_.options.vertical === false) {
                    animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
                } else {
                    animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
                }
                _.$slideTrack.css(animProps);

                if (callback) {
                    setTimeout(function() {

                        _.disableTransition();

                        callback.call();
                    }, _.options.speed);
                }

            }

        }

    };

    Slick.prototype.getNavTarget = function() {

        var _ = this,
            asNavFor = _.options.asNavFor;

        if ( asNavFor && asNavFor !== null ) {
            asNavFor = $(asNavFor).not(_.$slider);
        }

        return asNavFor;

    };

    Slick.prototype.asNavFor = function(index) {

        var _ = this,
            asNavFor = _.getNavTarget();

        if ( asNavFor !== null && typeof asNavFor === 'object' ) {
            asNavFor.each(function() {
                var target = $(this).slick('getSlick');
                if(!target.unslicked) {
                    target.slideHandler(index, true);
                }
            });
        }

    };

    Slick.prototype.applyTransition = function(slide) {

        var _ = this,
            transition = {};

        if (_.options.fade === false) {
            transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
        } else {
            transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
        }

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);            
        }

    };

    Slick.prototype.autoPlay = function() {

        var _ = this;

        _.autoPlayClear();

        if ( _.slideCount > _.options.slidesToShow ) {
            _.autoPlayTimer = setInterval( _.autoPlayIterator, _.options.autoplaySpeed );
        }

    };

    Slick.prototype.autoPlayClear = function() {

        var _ = this;

        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }

    };

    Slick.prototype.autoPlayIterator = function() {

        var _ = this,
            slideTo = _.currentSlide + _.options.slidesToScroll;

        if ( !_.paused && !_.interrupted && !_.focussed ) {

            if ( _.options.infinite === false ) {

                if ( _.direction === 1 && ( _.currentSlide + 1 ) === ( _.slideCount - 1 )) {
                    _.direction = 0;
                }

                else if ( _.direction === 0 ) {

                    slideTo = _.currentSlide - _.options.slidesToScroll;

                    if ( _.currentSlide - 1 === 0 ) {
                        _.direction = 1;
                    }

                }

            }

            _.slideHandler( slideTo );

        }

    };

    Slick.prototype.buildArrows = function() {

        var _ = this;

        if (_.options.arrows === true ) {

            _.$prevArrow = $(_.options.prevArrow).addClass('slick-arrow');
            _.$nextArrow = $(_.options.nextArrow).addClass('slick-arrow');

            if( _.slideCount > _.options.slidesToShow ) {

                _.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                _.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');

                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.prependTo(_.options.appendArrows);
                }

                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.appendTo(_.options.appendArrows);
                }

                if (_.options.infinite !== true) {
                    _.$prevArrow
                        .addClass('slick-disabled')
                        .attr('aria-disabled', 'true');
                }

            } else {

                _.$prevArrow.add( _.$nextArrow )

                    .addClass('slick-hidden')
                    .attr({
                        'aria-disabled': 'true',
                        'tabindex': '-1'
                    });

            }

        }

    };

    Slick.prototype.buildDots = function() {

        var _ = this,
            i, dot;

        if (_.options.dots === true) {

            _.$slider.addClass('slick-dotted');

            dot = $('<ul />').addClass(_.options.dotsClass);

            for (i = 0; i <= _.getDotCount(); i += 1) {
                dot.append($('<li />').append(_.options.customPaging.call(this, _, i)));
            }

            _.$dots = dot.appendTo(_.options.appendDots);

            _.$dots.find('li').first().addClass('slick-active');

        }

    };

    Slick.prototype.buildOut = function() {

        var _ = this;

        _.$slides =
            _.$slider
                .children( _.options.slide + ':not(.slick-cloned)')
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        _.$slides.each(function(index, element) {
            $(element)
                .attr('data-slick-index', index)
                .data('originalStyling', $(element).attr('style') || '');
        });

        _.$slider.addClass('slick-slider');

        _.$slideTrack = (_.slideCount === 0) ?
            $('<div class="slick-track"/>').appendTo(_.$slider) :
            _.$slides.wrapAll('<div class="slick-track"/>').parent();

        _.$list = _.$slideTrack.wrap(
            '<div class="slick-list"/>').parent();
        _.$slideTrack.css('opacity', 0);

        if (_.options.centerMode === true || _.options.swipeToSlide === true) {
            _.options.slidesToScroll = 1;
        }

        $('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');

        _.setupInfinite();

        _.buildArrows();

        _.buildDots();

        _.updateDots();


        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        if (_.options.draggable === true) {
            _.$list.addClass('draggable');
        }

    };

    Slick.prototype.buildRows = function() {

        var _ = this, a, b, c, newSlides, numOfSlides, originalSlides,slidesPerSection;

        newSlides = document.createDocumentFragment();
        originalSlides = _.$slider.children();

        if(_.options.rows > 1) {

            slidesPerSection = _.options.slidesPerRow * _.options.rows;
            numOfSlides = Math.ceil(
                originalSlides.length / slidesPerSection
            );

            for(a = 0; a < numOfSlides; a++){
                var slide = document.createElement('div');
                for(b = 0; b < _.options.rows; b++) {
                    var row = document.createElement('div');
                    for(c = 0; c < _.options.slidesPerRow; c++) {
                        var target = (a * slidesPerSection + ((b * _.options.slidesPerRow) + c));
                        if (originalSlides.get(target)) {
                            row.appendChild(originalSlides.get(target));
                        }
                    }
                    slide.appendChild(row);
                }
                newSlides.appendChild(slide);
            }

            _.$slider.empty().append(newSlides);
            _.$slider.children().children().children()
                .css({
                    'width':(100 / _.options.slidesPerRow) + '%',
                    'display': 'inline-block'
                });

        }

    };

    Slick.prototype.checkResponsive = function(initial, forceUpdate) {

        var _ = this,
            breakpoint, targetBreakpoint, respondToWidth, triggerBreakpoint = false;
        var sliderWidth = _.$slider.width();
        var windowWidth = window.innerWidth || $(window).width();

        if (_.respondTo === 'window') {
            respondToWidth = windowWidth;
        } else if (_.respondTo === 'slider') {
            respondToWidth = sliderWidth;
        } else if (_.respondTo === 'min') {
            respondToWidth = Math.min(windowWidth, sliderWidth);
        }

        if ( _.options.responsive &&
            _.options.responsive.length &&
            _.options.responsive !== null) {

            targetBreakpoint = null;

            for (breakpoint in _.breakpoints) {
                if (_.breakpoints.hasOwnProperty(breakpoint)) {
                    if (_.originalSettings.mobileFirst === false) {
                        if (respondToWidth < _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    } else {
                        if (respondToWidth > _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    }
                }
            }

            if (targetBreakpoint !== null) {
                if (_.activeBreakpoint !== null) {
                    if (targetBreakpoint !== _.activeBreakpoint || forceUpdate) {
                        _.activeBreakpoint =
                            targetBreakpoint;
                        if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                            _.unslick(targetBreakpoint);
                        } else {
                            _.options = $.extend({}, _.originalSettings,
                                _.breakpointSettings[
                                    targetBreakpoint]);
                            if (initial === true) {
                                _.currentSlide = _.options.initialSlide;
                            }
                            _.refresh(initial);
                        }
                        triggerBreakpoint = targetBreakpoint;
                    }
                } else {
                    _.activeBreakpoint = targetBreakpoint;
                    if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                        _.unslick(targetBreakpoint);
                    } else {
                        _.options = $.extend({}, _.originalSettings,
                            _.breakpointSettings[
                                targetBreakpoint]);
                        if (initial === true) {
                            _.currentSlide = _.options.initialSlide;
                        }
                        _.refresh(initial);
                    }
                    triggerBreakpoint = targetBreakpoint;
                }
            } else {
                if (_.activeBreakpoint !== null) {
                    _.activeBreakpoint = null;
                    _.options = _.originalSettings;
                    if (initial === true) {
                        _.currentSlide = _.options.initialSlide;
                    }
                    _.refresh(initial);
                    triggerBreakpoint = targetBreakpoint;
                }
            }

            // only trigger breakpoints during an actual break. not on initialize.
            if( !initial && triggerBreakpoint !== false ) {
                _.$slider.trigger('breakpoint', [_, triggerBreakpoint]);
            }
        }

    };

    Slick.prototype.changeSlide = function(event, dontAnimate) {

        var _ = this,
            $target = $(event.currentTarget),
            indexOffset, slideOffset, unevenOffset;

        // If target is a link, prevent default action.
        if($target.is('a')) {
            event.preventDefault();
        }

        // If target is not the <li> element (ie: a child), find the <li>.
        if(!$target.is('li')) {
            $target = $target.closest('li');
        }

        unevenOffset = (_.slideCount % _.options.slidesToScroll !== 0);
        indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;

        switch (event.data.message) {

            case 'previous':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide - slideOffset, false, dontAnimate);
                }
                break;

            case 'next':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
                }
                break;

            case 'index':
                var index = event.data.index === 0 ? 0 :
                    event.data.index || $target.index() * _.options.slidesToScroll;

                _.slideHandler(_.checkNavigable(index), false, dontAnimate);
                $target.children().trigger('focus');
                break;

            default:
                return;
        }

    };

    Slick.prototype.checkNavigable = function(index) {

        var _ = this,
            navigables, prevNavigable;

        navigables = _.getNavigableIndexes();
        prevNavigable = 0;
        if (index > navigables[navigables.length - 1]) {
            index = navigables[navigables.length - 1];
        } else {
            for (var n in navigables) {
                if (index < navigables[n]) {
                    index = prevNavigable;
                    break;
                }
                prevNavigable = navigables[n];
            }
        }

        return index;
    };

    Slick.prototype.cleanUpEvents = function() {

        var _ = this;

        if (_.options.dots && _.$dots !== null) {

            $('li', _.$dots)
                .off('click.slick', _.changeSlide)
                .off('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .off('mouseleave.slick', $.proxy(_.interrupt, _, false));

            if (_.options.accessibility === true) {
                _.$dots.off('keydown.slick', _.keyHandler);
            }
        }

        _.$slider.off('focus.slick blur.slick');

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow && _.$prevArrow.off('click.slick', _.changeSlide);
            _.$nextArrow && _.$nextArrow.off('click.slick', _.changeSlide);

            if (_.options.accessibility === true) {
                _.$prevArrow && _.$prevArrow.off('keydown.slick', _.keyHandler);
                _.$nextArrow && _.$nextArrow.off('keydown.slick', _.keyHandler);
            }
        }

        _.$list.off('touchstart.slick mousedown.slick', _.swipeHandler);
        _.$list.off('touchmove.slick mousemove.slick', _.swipeHandler);
        _.$list.off('touchend.slick mouseup.slick', _.swipeHandler);
        _.$list.off('touchcancel.slick mouseleave.slick', _.swipeHandler);

        _.$list.off('click.slick', _.clickHandler);

        $(document).off(_.visibilityChange, _.visibility);

        _.cleanUpSlideEvents();

        if (_.options.accessibility === true) {
            _.$list.off('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().off('click.slick', _.selectHandler);
        }

        $(window).off('orientationchange.slick.slick-' + _.instanceUid, _.orientationChange);

        $(window).off('resize.slick.slick-' + _.instanceUid, _.resize);

        $('[draggable!=true]', _.$slideTrack).off('dragstart', _.preventDefault);

        $(window).off('load.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.cleanUpSlideEvents = function() {

        var _ = this;

        _.$list.off('mouseenter.slick', $.proxy(_.interrupt, _, true));
        _.$list.off('mouseleave.slick', $.proxy(_.interrupt, _, false));

    };

    Slick.prototype.cleanUpRows = function() {

        var _ = this, originalSlides;

        if(_.options.rows > 1) {
            originalSlides = _.$slides.children().children();
            originalSlides.removeAttr('style');
            _.$slider.empty().append(originalSlides);
        }

    };

    Slick.prototype.clickHandler = function(event) {

        var _ = this;

        if (_.shouldClick === false) {
            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();
        }

    };

    Slick.prototype.destroy = function(refresh) {

        var _ = this;

        _.autoPlayClear();

        _.touchObject = {};

        _.cleanUpEvents();

        $('.slick-cloned', _.$slider).detach();

        if (_.$dots) {
            _.$dots.remove();
        }

        if ( _.$prevArrow && _.$prevArrow.length ) {

            _.$prevArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.prevArrow )) {
                _.$prevArrow.remove();
            }
        }

        if ( _.$nextArrow && _.$nextArrow.length ) {

            _.$nextArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display','');

            if ( _.htmlExpr.test( _.options.nextArrow )) {
                _.$nextArrow.remove();
            }
        }


        if (_.$slides) {

            _.$slides
                .removeClass('slick-slide slick-active slick-center slick-visible slick-current')
                .removeAttr('aria-hidden')
                .removeAttr('data-slick-index')
                .each(function(){
                    $(this).attr('style', $(this).data('originalStyling'));
                });

            _.$slideTrack.children(this.options.slide).detach();

            _.$slideTrack.detach();

            _.$list.detach();

            _.$slider.append(_.$slides);
        }

        _.cleanUpRows();

        _.$slider.removeClass('slick-slider');
        _.$slider.removeClass('slick-initialized');
        _.$slider.removeClass('slick-dotted');

        _.unslicked = true;

        if(!refresh) {
            _.$slider.trigger('destroy', [_]);
        }

    };

    Slick.prototype.disableTransition = function(slide) {

        var _ = this,
            transition = {};

        transition[_.transitionType] = '';

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.fadeSlide = function(slideIndex, callback) {

        var _ = this;

        if (_.cssTransitions === false) {
            
            _.$slides.eq(slideIndex).css({
                zIndex: _.options.zIndex
            });

            _.$slides.eq(slideIndex).animate({
                opacity: 1
            }, _.options.speed, _.options.easing, callback);

        } else {

            if(_.options.useCustomTransition){ /* Plugin line Modified  */

                _.$slides.eq(slideIndex).css({ 
                    opacity: 1
                });

            }else{ /* Plugin line Modified  */
                _.applyTransition(slideIndex); 
                _.$slides.eq(slideIndex).css({ 
                    opacity: 1,
                    zIndex: _.options.zIndex
                });
            }
            if (callback) { /* Plugin line Modified. Condition inside the prior "else" */
                setTimeout(function() {

                    _.disableTransition(slideIndex);

                    if(_.options.useCustomTransition){ /* Plugin line Modified */
                        _.$slides.eq(slideIndex).css({
                            zIndex: _.options.zIndex
                        }); 
                    }

                    callback.call();
                }, _.options.speed);
            }

        }

    };

    Slick.prototype.fadeSlideOut = function(slideIndex, callback) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).animate({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            }, _.options.speed, _.options.easing);

        } else {

            if(_.options.useCustomTransition){ /* Plugin line Modified */
                
                setTimeout(function(){
                    let curPosition = _.$slides.eq(slideIndex).css("left");
                    let slideWidth = _.$slides.eq(slideIndex).css("width");

                    let cal= parseInt(curPosition) == 0 ? parseInt(slideWidth) * (20/100 *(-1)) :
                                                parseInt(curPosition) * (20 / 100);
                    
                    _.$slides.eq(slideIndex).animate({
                            left: parseInt(curPosition) - cal,
                            opacity:0
                        }, {
                        duration: _.options.speed,
                        easing: 'easeInCubic',
                        complete: function(){
                            _.$slides.eq(slideIndex).css({
                                zIndex: _.options.zIndex - 2,
                                left:curPosition
                            }); 
                        }
                    });
                },10);

            }else{
                _.applyTransition(slideIndex); 
                _.$slides.eq(slideIndex).css({
                    opacity: 0,
                    zIndex: _.options.zIndex - 2
                });    
            }
        }

    };

    Slick.prototype.filterSlides = Slick.prototype.slickFilter = function(filter) {

        var _ = this;

        if (filter !== null) {

            _.$slidesCache = _.$slides;

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.filter(filter).appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.focusHandler = function() {

        var _ = this;

        _.$slider
            .off('focus.slick blur.slick')
            .on('focus.slick blur.slick', '*', function(event) {

            event.stopImmediatePropagation();
            var $sf = $(this);

            setTimeout(function() {

                if( _.options.pauseOnFocus ) {
                    _.focussed = $sf.is(':focus');
                    _.autoPlay();
                }

            }, 0);

        });
    };

    Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function() {

        var _ = this;
        return _.currentSlide;

    };

    Slick.prototype.getDotCount = function() {

        var _ = this;

        var breakPoint = 0;
        var counter = 0;
        var pagerQty = 0;

        if (_.options.infinite === true) {
            if (_.slideCount <= _.options.slidesToShow) {
                 ++pagerQty;
            } else {
                while (breakPoint < _.slideCount) {
                    ++pagerQty;
                    breakPoint = counter + _.options.slidesToScroll;
                    counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
                }
            }
        } else if (_.options.centerMode === true) {
            pagerQty = _.slideCount;
        } else if(!_.options.asNavFor) {
            pagerQty = 1 + Math.ceil((_.slideCount - _.options.slidesToShow) / _.options.slidesToScroll);
        }else {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        }

        return pagerQty - 1;

    };

    Slick.prototype.getLeft = function(slideIndex) {

        var _ = this,
            targetLeft,
            verticalHeight,
            verticalOffset = 0,
            targetSlide,
            coef;

        _.slideOffset = 0;
        verticalHeight = _.$slides.first().outerHeight(true);

        if (_.options.infinite === true) {
            if (_.slideCount > _.options.slidesToShow) {
                _.slideOffset = (_.slideWidth * _.options.slidesToShow) * -1;
                coef = -1

                if (_.options.vertical === true && _.options.centerMode === true) {
                    if (_.options.slidesToShow === 2) {
                        coef = -1.5;
                    } else if (_.options.slidesToShow === 1) {
                        coef = -2
                    }
                }
                verticalOffset = (verticalHeight * _.options.slidesToShow) * coef;
            }
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
                    if (slideIndex > _.slideCount) {
                        _.slideOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth) * -1;
                        verticalOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight) * -1;
                    } else {
                        _.slideOffset = ((_.slideCount % _.options.slidesToScroll) * _.slideWidth) * -1;
                        verticalOffset = ((_.slideCount % _.options.slidesToScroll) * verticalHeight) * -1;
                    }
                }
            }
        } else {
            if (slideIndex + _.options.slidesToShow > _.slideCount) {
                _.slideOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * _.slideWidth;
                verticalOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * verticalHeight;
            }
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.slideOffset = 0;
            verticalOffset = 0;
        }

        if (_.options.centerMode === true && _.slideCount <= _.options.slidesToShow) {
            _.slideOffset = ((_.slideWidth * Math.floor(_.options.slidesToShow)) / 2) - ((_.slideWidth * _.slideCount) / 2);
        } else if (_.options.centerMode === true && _.options.infinite === true) {
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
        } else if (_.options.centerMode === true) {
            _.slideOffset = 0;
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
        }

        if (_.options.vertical === false) {
            targetLeft = ((slideIndex * _.slideWidth) * -1) + _.slideOffset;
        } else {
            targetLeft = ((slideIndex * verticalHeight) * -1) + verticalOffset;
        }

        if (_.options.variableWidth === true) {

            if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
            } else {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
            }

            if (_.options.rtl === true) {
                if (targetSlide[0]) {
                    targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                } else {
                    targetLeft =  0;
                }
            } else {
                targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
            }

            if (_.options.centerMode === true) {
                if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
                } else {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
                }

                if (_.options.rtl === true) {
                    if (targetSlide[0]) {
                        targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                    } else {
                        targetLeft =  0;
                    }
                } else {
                    targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
                }

                targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
            }
        }

        return targetLeft;

    };

    Slick.prototype.getOption = Slick.prototype.slickGetOption = function(option) {

        var _ = this;

        return _.options[option];

    };

    Slick.prototype.getNavigableIndexes = function() {

        var _ = this,
            breakPoint = 0,
            counter = 0,
            indexes = [],
            max;

        if (_.options.infinite === false) {
            max = _.slideCount;
        } else {
            breakPoint = _.options.slidesToScroll * -1;
            counter = _.options.slidesToScroll * -1;
            max = _.slideCount * 2;
        }

        while (breakPoint < max) {
            indexes.push(breakPoint);
            breakPoint = counter + _.options.slidesToScroll;
            counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
        }

        return indexes;

    };

    Slick.prototype.getSlick = function() {

        return this;

    };

    Slick.prototype.getSlideCount = function() {

        var _ = this,
            slidesTraversed, swipedSlide, centerOffset;

        centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;

        if (_.options.swipeToSlide === true) {
            _.$slideTrack.find('.slick-slide').each(function(index, slide) {
                if (slide.offsetLeft - centerOffset + ($(slide).outerWidth() / 2) > (_.swipeLeft * -1)) {
                    swipedSlide = slide;
                    return false;
                }
            });

            slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;

            return slidesTraversed;

        } else {
            return _.options.slidesToScroll;
        }

    };

    Slick.prototype.goTo = Slick.prototype.slickGoTo = function(slide, dontAnimate) {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'index',
                index: parseInt(slide)
            }
        }, dontAnimate);

    };

    Slick.prototype.init = function(creation) {

        var _ = this;

        if (!$(_.$slider).hasClass('slick-initialized')) {

            $(_.$slider).addClass('slick-initialized');

            _.buildRows();
            _.buildOut();
            _.setProps();
            _.startLoad();
            _.loadSlider();
            _.initializeEvents();
            _.updateArrows();
            _.updateDots();
            _.checkResponsive(true);
            _.focusHandler();

        }

        if (creation) {
            _.$slider.trigger('init', [_]);
        }

        if (_.options.accessibility === true) {
            _.initADA();
        }

        if ( _.options.autoplay ) {

            _.paused = false;
            _.autoPlay();

        }

    };

    Slick.prototype.initADA = function() {
        var _ = this,
                numDotGroups = Math.ceil(_.slideCount / _.options.slidesToShow),
                tabControlIndexes = _.getNavigableIndexes().filter(function(val) {
                    return (val >= 0) && (val < _.slideCount);
                });

        _.$slides.add(_.$slideTrack.find('.slick-cloned')).attr({
            'aria-hidden': 'true',
            'tabindex': '-1'
        }).find('a,\x20input,\x20button,\x20select').attr({
            'tabindex': '-1'
        });

        if (_.$dots !== null) {
            _.$slides.not(_.$slideTrack.find('.slick-cloned')).each(function(i) {
                var slideControlIndex = tabControlIndexes.indexOf(i);

                $(this).attr({
                    'role': 'tabpanel',
                    'id': 'slick-slide' + _.instanceUid + i,
                    'tabindex': -1
                });

                if (slideControlIndex !== -1) {
                    $(this).attr({
                        'aria-describedby': 'slick-slide-control' + _.instanceUid + slideControlIndex
                    });
                }
            });

            _.$dots.attr('role', 'tablist').find('li').each(function(i) {
                var mappedSlideIndex = tabControlIndexes[i];

                $(this).attr({
                    'role': 'presentation'
                });

                $(this).find('button').first().attr({
                    'role': 'tab',
                    'id': 'slick-slide-control' + _.instanceUid + i,
                    'aria-controls': 'slick-slide' + _.instanceUid + mappedSlideIndex,
                    'aria-label': (i + 1) + ' of ' + numDotGroups,
                    'aria-selected': null,
                    'tabindex': '-1'
                });

            }).eq(_.currentSlide).find('button').attr({
                'aria-selected': 'true',
                'tabindex': '0'
            }).end();
        }

        for (var i=_.currentSlide, max=i+_.options.slidesToShow; i < max; i++) {
            _.$slides.eq(i).attr('tabindex', 0);
        }

        _.activateADA();

    };

    Slick.prototype.initArrowEvents = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow
               .off('click.slick')
               .on('click.slick', {
                    message: 'previous'
               }, _.changeSlide);
            _.$nextArrow
               .off('click.slick')
               .on('click.slick', {
                    message: 'next'
               }, _.changeSlide);

            if (_.options.accessibility === true) {
                _.$prevArrow.on('keydown.slick', _.keyHandler);
                _.$nextArrow.on('keydown.slick', _.keyHandler);
            }
        }

    };

    Slick.prototype.initDotEvents = function() {

        var _ = this;

        if (_.options.dots === true) {
            $('li', _.$dots).on('click.slick', {
                message: 'index'
            }, _.changeSlide);

            if (_.options.accessibility === true) {
                _.$dots.on('keydown.slick', _.keyHandler);
            }
        }

        if ( _.options.dots === true && _.options.pauseOnDotsHover === true ) {

            $('li', _.$dots)
                .on('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initSlideEvents = function() {

        var _ = this;

        if ( _.options.pauseOnHover ) {

            _.$list.on('mouseenter.slick', $.proxy(_.interrupt, _, true));
            _.$list.on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initializeEvents = function() {

        var _ = this;

        _.initArrowEvents();

        _.initDotEvents();
        _.initSlideEvents();

        _.$list.on('touchstart.slick mousedown.slick', {
            action: 'start'
        }, _.swipeHandler);
        _.$list.on('touchmove.slick mousemove.slick', {
            action: 'move'
        }, _.swipeHandler);
        _.$list.on('touchend.slick mouseup.slick', {
            action: 'end'
        }, _.swipeHandler);
        _.$list.on('touchcancel.slick mouseleave.slick', {
            action: 'end'
        }, _.swipeHandler);

        _.$list.on('click.slick', _.clickHandler);

        $(document).on(_.visibilityChange, $.proxy(_.visibility, _));

        if (_.options.accessibility === true) {
            _.$list.on('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        $(window).on('orientationchange.slick.slick-' + _.instanceUid, $.proxy(_.orientationChange, _));

        $(window).on('resize.slick.slick-' + _.instanceUid, $.proxy(_.resize, _));

        $('[draggable!=true]', _.$slideTrack).on('dragstart', _.preventDefault);

        $(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(_.setPosition);

    };

    Slick.prototype.initUI = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.show();
            _.$nextArrow.show();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.show();

        }

    };

    Slick.prototype.keyHandler = function(event) {

        var _ = this;
         //Dont slide if the cursor is inside the form fields and arrow keys are pressed
        if(!event.target.tagName.match('TEXTAREA|INPUT|SELECT')) {
            if (event.keyCode === 37 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'next' :  'previous'
                    }
                });
            } else if (event.keyCode === 39 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'previous' : 'next'
                    }
                });
            }
        }

    };

    Slick.prototype.lazyLoad = function() {

        var _ = this,
            loadRange, cloneRange, rangeStart, rangeEnd;

        function loadImages(imagesScope) {

            $('img[data-lazy]', imagesScope).each(function() {

                var image = $(this),
                    imageSource = $(this).attr('data-lazy'),
                    imageSrcSet = $(this).attr('data-srcset'),
                    imageSizes  = $(this).attr('data-sizes') || _.$slider.attr('data-sizes'),
                    imageToLoad = document.createElement('img');

                imageToLoad.onload = function() {

                    image
                        .animate({ opacity: 0 }, 100, function() {

                            if (imageSrcSet) {
                                image
                                    .attr('srcset', imageSrcSet );

                                if (imageSizes) {
                                    image
                                        .attr('sizes', imageSizes );
                                }
                            }

                            image
                                .attr('src', imageSource)
                                .animate({ opacity: 1 }, 200, function() {
                                    image
                                        .removeAttr('data-lazy data-srcset data-sizes')
                                        .removeClass('slick-loading');
                                });
                            _.$slider.trigger('lazyLoaded', [_, image, imageSource]);
                        });

                };

                imageToLoad.onerror = function() {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                };

                imageToLoad.src = imageSource;

            });

        }

        if (_.options.centerMode === true) {
            if (_.options.infinite === true) {
                rangeStart = _.currentSlide + (_.options.slidesToShow / 2 + 1);
                rangeEnd = rangeStart + _.options.slidesToShow + 2;
            } else {
                rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow / 2 + 1));
                rangeEnd = 2 + (_.options.slidesToShow / 2 + 1) + _.currentSlide;
            }
        } else {
            rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
            rangeEnd = Math.ceil(rangeStart + _.options.slidesToShow);
            if (_.options.fade === true) {
                if (rangeStart > 0) rangeStart--;
                if (rangeEnd <= _.slideCount) rangeEnd++;
            }
        }

        loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);

        if (_.options.lazyLoad === 'anticipated') {
            var prevSlide = rangeStart - 1,
                nextSlide = rangeEnd,
                $slides = _.$slider.find('.slick-slide');

            for (var i = 0; i < _.options.slidesToScroll; i++) {
                if (prevSlide < 0) prevSlide = _.slideCount - 1;
                loadRange = loadRange.add($slides.eq(prevSlide));
                loadRange = loadRange.add($slides.eq(nextSlide));
                prevSlide--;
                nextSlide++;
            }
        }

        loadImages(loadRange);

        if (_.slideCount <= _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-slide');
            loadImages(cloneRange);
        } else
        if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
            loadImages(cloneRange);
        } else if (_.currentSlide === 0) {
            cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
            loadImages(cloneRange);
        }

    };

    Slick.prototype.loadSlider = function() {

        var _ = this;

        _.setPosition();

        _.$slideTrack.css({
            opacity: 1
        });

        _.$slider.removeClass('slick-loading');

        _.initUI();

        if (_.options.lazyLoad === 'progressive') {
            _.progressiveLazyLoad();
        }

    };

    Slick.prototype.next = Slick.prototype.slickNext = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'next'
            }
        });

    };

    Slick.prototype.orientationChange = function() {

        var _ = this;

        _.checkResponsive();
        _.setPosition();

    };

    Slick.prototype.pause = Slick.prototype.slickPause = function() {

        var _ = this;

        _.autoPlayClear();
        _.paused = true;

    };

    Slick.prototype.play = Slick.prototype.slickPlay = function() {

        var _ = this;

        _.autoPlay();
        _.options.autoplay = true;
        _.paused = false;
        _.focussed = false;
        _.interrupted = false;

    };

    Slick.prototype.postSlide = function(index) {

        var _ = this;

        if( !_.unslicked ) {

            _.$slider.trigger('afterChange', [_, index]);

            _.animating = false;

            if (_.slideCount > _.options.slidesToShow) {
                _.setPosition();
            }

            _.swipeLeft = null;

            if ( _.options.autoplay ) {
                _.autoPlay();
            }

            if (_.options.accessibility === true) {
                _.initADA();
                
                if (_.options.focusOnChange) {
                    var $currentSlide = $(_.$slides.get(_.currentSlide));
                    $currentSlide.attr('tabindex', 0).focus();
                }
            }

        }

    };

    Slick.prototype.prev = Slick.prototype.slickPrev = function() {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'previous'
            }
        });

    };

    Slick.prototype.preventDefault = function(event) {

        event.preventDefault();

    };

    Slick.prototype.progressiveLazyLoad = function( tryCount ) {

        tryCount = tryCount || 1;

        var _ = this,
            $imgsToLoad = $( 'img[data-lazy]', _.$slider ),
            image,
            imageSource,
            imageSrcSet,
            imageSizes,
            imageToLoad;

        if ( $imgsToLoad.length ) {

            image = $imgsToLoad.first();
            imageSource = image.attr('data-lazy');
            imageSrcSet = image.attr('data-srcset');
            imageSizes  = image.attr('data-sizes') || _.$slider.attr('data-sizes');
            imageToLoad = document.createElement('img');

            imageToLoad.onload = function() {

                if (imageSrcSet) {
                    image
                        .attr('srcset', imageSrcSet );

                    if (imageSizes) {
                        image
                            .attr('sizes', imageSizes );
                    }
                }

                image
                    .attr( 'src', imageSource )
                    .removeAttr('data-lazy data-srcset data-sizes')
                    .removeClass('slick-loading');

                if ( _.options.adaptiveHeight === true ) {
                    _.setPosition();
                }

                _.$slider.trigger('lazyLoaded', [ _, image, imageSource ]);
                _.progressiveLazyLoad();

            };

            imageToLoad.onerror = function() {

                if ( tryCount < 3 ) {

                    /**
                     * try to load the image 3 times,
                     * leave a slight delay so we don't get
                     * servers blocking the request.
                     */
                    setTimeout( function() {
                        _.progressiveLazyLoad( tryCount + 1 );
                    }, 500 );

                } else {

                    image
                        .removeAttr( 'data-lazy' )
                        .removeClass( 'slick-loading' )
                        .addClass( 'slick-lazyload-error' );

                    _.$slider.trigger('lazyLoadError', [ _, image, imageSource ]);

                    _.progressiveLazyLoad();

                }

            };

            imageToLoad.src = imageSource;

        } else {

            _.$slider.trigger('allImagesLoaded', [ _ ]);

        }

    };

    Slick.prototype.refresh = function( initializing ) {

        var _ = this, currentSlide, lastVisibleIndex;

        lastVisibleIndex = _.slideCount - _.options.slidesToShow;

        // in non-infinite sliders, we don't want to go past the
        // last visible index.
        if( !_.options.infinite && ( _.currentSlide > lastVisibleIndex )) {
            _.currentSlide = lastVisibleIndex;
        }

        // if less slides than to show, go to start.
        if ( _.slideCount <= _.options.slidesToShow ) {
            _.currentSlide = 0;

        }

        currentSlide = _.currentSlide;

        _.destroy(true);

        $.extend(_, _.initials, { currentSlide: currentSlide });

        _.init();

        if( !initializing ) {

            _.changeSlide({
                data: {
                    message: 'index',
                    index: currentSlide
                }
            }, false);

        }

    };

    Slick.prototype.registerBreakpoints = function() {

        var _ = this, breakpoint, currentBreakpoint, l,
            responsiveSettings = _.options.responsive || null;

        if ( $.type(responsiveSettings) === 'array' && responsiveSettings.length ) {

            _.respondTo = _.options.respondTo || 'window';

            for ( breakpoint in responsiveSettings ) {

                l = _.breakpoints.length-1;

                if (responsiveSettings.hasOwnProperty(breakpoint)) {
                    currentBreakpoint = responsiveSettings[breakpoint].breakpoint;

                    // loop through the breakpoints and cut out any existing
                    // ones with the same breakpoint number, we don't want dupes.
                    while( l >= 0 ) {
                        if( _.breakpoints[l] && _.breakpoints[l] === currentBreakpoint ) {
                            _.breakpoints.splice(l,1);
                        }
                        l--;
                    }

                    _.breakpoints.push(currentBreakpoint);
                    _.breakpointSettings[currentBreakpoint] = responsiveSettings[breakpoint].settings;

                }

            }

            _.breakpoints.sort(function(a, b) {
                return ( _.options.mobileFirst ) ? a-b : b-a;
            });

        }

    };

    Slick.prototype.reinit = function() {

        var _ = this;

        _.$slides =
            _.$slideTrack
                .children(_.options.slide)
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
            _.currentSlide = _.currentSlide - _.options.slidesToScroll;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;
        }

        _.registerBreakpoints();

        _.setProps();
        _.setupInfinite();
        _.buildArrows();
        _.updateArrows();
        _.initArrowEvents();
        _.buildDots();
        _.updateDots();
        _.initDotEvents();
        _.cleanUpSlideEvents();
        _.initSlideEvents();

        _.checkResponsive(false, true);

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        _.setPosition();
        _.focusHandler();

        _.paused = !_.options.autoplay;
        _.autoPlay();

        _.$slider.trigger('reInit', [_]);

    };

    Slick.prototype.resize = function() {

        var _ = this;

        if ($(window).width() !== _.windowWidth) {
            clearTimeout(_.windowDelay);
            _.windowDelay = window.setTimeout(function() {
                _.windowWidth = $(window).width();
                _.checkResponsive();
                if( !_.unslicked ) { _.setPosition(); }
            }, 50);
        }
    };

    Slick.prototype.removeSlide = Slick.prototype.slickRemove = function(index, removeBefore, removeAll) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            removeBefore = index;
            index = removeBefore === true ? 0 : _.slideCount - 1;
        } else {
            index = removeBefore === true ? --index : index;
        }

        if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
            return false;
        }

        _.unload();

        if (removeAll === true) {
            _.$slideTrack.children().remove();
        } else {
            _.$slideTrack.children(this.options.slide).eq(index).remove();
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.setCSS = function(position) {

        var _ = this,
            positionProps = {},
            x, y;

        if (_.options.rtl === true) {
            position = -position;
        }
        x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
        y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';

        positionProps[_.positionProp] = position;

        if (_.transformsEnabled === false) {
            _.$slideTrack.css(positionProps);
        } else {
            positionProps = {};
            if (_.cssTransitions === false) {
                positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
                _.$slideTrack.css(positionProps);
            } else {
                positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
                _.$slideTrack.css(positionProps);
            }
        }

    };

    Slick.prototype.setDimensions = function() {

        var _ = this;

        if (_.options.vertical === false) {
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: ('0px ' + _.options.centerPadding)
                });
            }
        } else {
            _.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: (_.options.centerPadding + ' 0px')
                });
            }
        }

        _.listWidth = _.$list.width();
        _.listHeight = _.$list.height();


        if (_.options.vertical === false && _.options.variableWidth === false) {
            _.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
            _.$slideTrack.width(Math.ceil((_.slideWidth * _.$slideTrack.children('.slick-slide').length)));

        } else if (_.options.variableWidth === true) {
            _.$slideTrack.width(5000 * _.slideCount);
        } else {
            _.slideWidth = Math.ceil(_.listWidth);
            _.$slideTrack.height(Math.ceil((_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length)));
        }

        var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
        if (_.options.variableWidth === false) _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);

    };

    Slick.prototype.setFade = function() {

        var _ = this,
            targetLeft;

        _.$slides.each(function(index, element) {
            targetLeft = (_.slideWidth * index) * -1;
            if (_.options.rtl === true) {
                $(element).css({
                    position: 'relative',
                    right: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            } else {
                $(element).css({
                    position: 'relative',
                    left: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            }
        });

        _.$slides.eq(_.currentSlide).css({
            zIndex: _.options.zIndex - 1,
            opacity: 1
        });

    };

    Slick.prototype.setHeight = function() {

        var _ = this;

        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.css('height', targetHeight);
        }

    };

    Slick.prototype.setOption =
    Slick.prototype.slickSetOption = function() {

        /**
         * accepts arguments in format of:
         *
         *  - for changing a single option's value:
         *     .slick("setOption", option, value, refresh )
         *
         *  - for changing a set of responsive options:
         *     .slick("setOption", 'responsive', [{}, ...], refresh )
         *
         *  - for updating multiple values at once (not responsive)
         *     .slick("setOption", { 'option': value, ... }, refresh )
         */

        var _ = this, l, item, option, value, refresh = false, type;

        if( $.type( arguments[0] ) === 'object' ) {

            option =  arguments[0];
            refresh = arguments[1];
            type = 'multiple';

        } else if ( $.type( arguments[0] ) === 'string' ) {

            option =  arguments[0];
            value = arguments[1];
            refresh = arguments[2];

            if ( arguments[0] === 'responsive' && $.type( arguments[1] ) === 'array' ) {

                type = 'responsive';

            } else if ( typeof arguments[1] !== 'undefined' ) {

                type = 'single';

            }

        }

        if ( type === 'single' ) {

            _.options[option] = value;


        } else if ( type === 'multiple' ) {

            $.each( option , function( opt, val ) {

                _.options[opt] = val;

            });


        } else if ( type === 'responsive' ) {

            for ( item in value ) {

                if( $.type( _.options.responsive ) !== 'array' ) {

                    _.options.responsive = [ value[item] ];

                } else {

                    l = _.options.responsive.length-1;

                    // loop through the responsive object and splice out duplicates.
                    while( l >= 0 ) {

                        if( _.options.responsive[l].breakpoint === value[item].breakpoint ) {

                            _.options.responsive.splice(l,1);

                        }

                        l--;

                    }

                    _.options.responsive.push( value[item] );

                }

            }

        }

        if ( refresh ) {

            _.unload();
            _.reinit();

        }

    };

    Slick.prototype.setPosition = function() {

        var _ = this;

        _.setDimensions();

        _.setHeight();

        if (_.options.fade === false) {
            _.setCSS(_.getLeft(_.currentSlide));
        } else {
            _.setFade();
        }

        _.$slider.trigger('setPosition', [_]);

    };

    Slick.prototype.setProps = function() {

        var _ = this,
            bodyStyle = document.body.style;

        _.positionProp = _.options.vertical === true ? 'top' : 'left';

        if (_.positionProp === 'top') {
            _.$slider.addClass('slick-vertical');
        } else {
            _.$slider.removeClass('slick-vertical');
        }

        if (bodyStyle.WebkitTransition !== undefined ||
            bodyStyle.MozTransition !== undefined ||
            bodyStyle.msTransition !== undefined) {
            if (_.options.useCSS === true) {
                _.cssTransitions = true;
            }
        }

        if ( _.options.fade ) {
            if ( typeof _.options.zIndex === 'number' ) {
                if( _.options.zIndex < 3 ) {
                    _.options.zIndex = 3;
                }
            } else {
                _.options.zIndex = _.defaults.zIndex;
            }
        }

        if (bodyStyle.OTransform !== undefined) {
            _.animType = 'OTransform';
            _.transformType = '-o-transform';
            _.transitionType = 'OTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.MozTransform !== undefined) {
            _.animType = 'MozTransform';
            _.transformType = '-moz-transform';
            _.transitionType = 'MozTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.webkitTransform !== undefined) {
            _.animType = 'webkitTransform';
            _.transformType = '-webkit-transform';
            _.transitionType = 'webkitTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.msTransform !== undefined) {
            _.animType = 'msTransform';
            _.transformType = '-ms-transform';
            _.transitionType = 'msTransition';
            if (bodyStyle.msTransform === undefined) _.animType = false;
        }
        if (bodyStyle.transform !== undefined && _.animType !== false) {
            _.animType = 'transform';
            _.transformType = 'transform';
            _.transitionType = 'transition';
        }
        _.transformsEnabled = _.options.useTransform && (_.animType !== null && _.animType !== false);
    };


    Slick.prototype.setSlideClasses = function(index) {

        var _ = this,
            centerOffset, allSlides, indexOffset, remainder;

        allSlides = _.$slider
            .find('.slick-slide')
            .removeClass('slick-active slick-center slick-current')
            .attr('aria-hidden', 'true');

        _.$slides
            .eq(index)
            .addClass('slick-current');

        if (_.options.centerMode === true) {

            var evenCoef = _.options.slidesToShow % 2 === 0 ? 1 : 0;

            centerOffset = Math.floor(_.options.slidesToShow / 2);

            if (_.options.infinite === true) {

                if (index >= centerOffset && index <= (_.slideCount - 1) - centerOffset) {
                    _.$slides
                        .slice(index - centerOffset + evenCoef, index + centerOffset + 1)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    indexOffset = _.options.slidesToShow + index;
                    allSlides
                        .slice(indexOffset - centerOffset + 1 + evenCoef, indexOffset + centerOffset + 2)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

                if (index === 0) {

                    allSlides
                        .eq(allSlides.length - 1 - _.options.slidesToShow)
                        .addClass('slick-center');

                } else if (index === _.slideCount - 1) {

                    allSlides
                        .eq(_.options.slidesToShow)
                        .addClass('slick-center');

                }

            }

            _.$slides
                .eq(index)
                .addClass('slick-center');

        } else {

            if (index >= 0 && index <= (_.slideCount - _.options.slidesToShow)) {

                _.$slides
                    .slice(index, index + _.options.slidesToShow)
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else if (allSlides.length <= _.options.slidesToShow) {

                allSlides
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else {

                remainder = _.slideCount % _.options.slidesToShow;
                indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;

                if (_.options.slidesToShow == _.options.slidesToScroll && (_.slideCount - index) < _.options.slidesToShow) {

                    allSlides
                        .slice(indexOffset - (_.options.slidesToShow - remainder), indexOffset + remainder)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    allSlides
                        .slice(indexOffset, indexOffset + _.options.slidesToShow)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

            }

        }

        if (_.options.lazyLoad === 'ondemand' || _.options.lazyLoad === 'anticipated') {
            _.lazyLoad();
        }
    };

    Slick.prototype.setupInfinite = function() {

        var _ = this,
            i, slideIndex, infiniteCount;

        if (_.options.fade === true) {
            _.options.centerMode = false;
        }

        if (_.options.infinite === true && _.options.fade === false) {

            slideIndex = null;

            if (_.slideCount > _.options.slidesToShow) {

                if (_.options.centerMode === true) {
                    infiniteCount = _.options.slidesToShow + 1;
                } else {
                    infiniteCount = _.options.slidesToShow;
                }

                for (i = _.slideCount; i > (_.slideCount -
                        infiniteCount); i -= 1) {
                    slideIndex = i - 1;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex - _.slideCount)
                        .prependTo(_.$slideTrack).addClass('slick-cloned');
                }
                for (i = 0; i < infiniteCount  + _.slideCount; i += 1) {
                    slideIndex = i;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex + _.slideCount)
                        .appendTo(_.$slideTrack).addClass('slick-cloned');
                }
                _.$slideTrack.find('.slick-cloned').find('[id]').each(function() {
                    $(this).attr('id', '');
                });

            }

        }

    };

    Slick.prototype.interrupt = function( toggle ) {

        var _ = this;

        if( !toggle ) {
            _.autoPlay();
        }
        _.interrupted = toggle;

    };

    Slick.prototype.selectHandler = function(event) {

        var _ = this;

        var targetElement =
            $(event.target).is('.slick-slide') ?
                $(event.target) :
                $(event.target).parents('.slick-slide');

        var index = parseInt(targetElement.attr('data-slick-index'));

        if (!index) index = 0;

        if (_.slideCount <= _.options.slidesToShow) {

            _.slideHandler(index, false, true);
            return;

        }

        _.slideHandler(index);

    };

    Slick.prototype.slideHandler = function(index, sync, dontAnimate) {

        var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null,
            _ = this, navTarget;

        sync = sync || false;

        if (_.animating === true && _.options.waitForAnimate === true) {
            return;
        }

        if (_.options.fade === true && _.currentSlide === index) {
            return;
        }

        if (sync === false) {
            _.asNavFor(index);
        }

        targetSlide = index;
        targetLeft = _.getLeft(targetSlide);
        slideLeft = _.getLeft(_.currentSlide);

        _.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;

        if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        } else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > (_.slideCount - _.options.slidesToScroll))) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function() {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        }

        if ( _.options.autoplay ) {
            clearInterval(_.autoPlayTimer);
        }

        if (targetSlide < 0) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = _.slideCount - (_.slideCount % _.options.slidesToScroll);
            } else {
                animSlide = _.slideCount + targetSlide;
            }
        } else if (targetSlide >= _.slideCount) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = 0;
            } else {
                animSlide = targetSlide - _.slideCount;
            }
        } else {
            animSlide = targetSlide;
        }

        _.animating = true;

        _.$slider.trigger('beforeChange', [_, _.currentSlide, animSlide]);

        oldSlide = _.currentSlide;
        _.currentSlide = animSlide;

        _.setSlideClasses(_.currentSlide);

        if ( _.options.asNavFor ) {

            navTarget = _.getNavTarget();
            navTarget = navTarget.slick('getSlick');

            if ( navTarget.slideCount <= navTarget.options.slidesToShow ) {
                navTarget.setSlideClasses(_.currentSlide);
            }

        }

        _.updateDots();
        _.updateArrows();

        if (_.options.fade === true) {
            if (dontAnimate !== true) {
                _.fadeSlideOut(oldSlide);

                _.fadeSlide(animSlide, function() {
                    _.postSlide(animSlide);
                });
            } else {
                _.postSlide(animSlide);
            }
            _.animateHeight();
            return;
        }

        if (dontAnimate !== true) {
            _.animateSlide(targetLeft, function() {
                _.postSlide(animSlide);
            });
        } else {
            _.postSlide(animSlide);
        }

    };

    Slick.prototype.startLoad = function() {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.hide();
            _.$nextArrow.hide();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.hide();

        }

        _.$slider.addClass('slick-loading');

    };

    Slick.prototype.swipeDirection = function() {

        var xDist, yDist, r, swipeAngle, _ = this;

        xDist = _.touchObject.startX - _.touchObject.curX;
        yDist = _.touchObject.startY - _.touchObject.curY;
        r = Math.atan2(yDist, xDist);

        swipeAngle = Math.round(r * 180 / Math.PI);
        if (swipeAngle < 0) {
            swipeAngle = 360 - Math.abs(swipeAngle);
        }

        if ((swipeAngle <= 45) && (swipeAngle >= 0)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle <= 360) && (swipeAngle >= 315)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle >= 135) && (swipeAngle <= 225)) {
            return (_.options.rtl === false ? 'right' : 'left');
        }
        if (_.options.verticalSwiping === true) {
            if ((swipeAngle >= 35) && (swipeAngle <= 135)) {
                return 'down';
            } else {
                return 'up';
            }
        }

        return 'vertical';

    };

    Slick.prototype.swipeEnd = function(event) {

        var _ = this,
            slideCount,
            direction;

        _.dragging = false;
        _.swiping = false;

        if (_.scrolling) {
            _.scrolling = false;
            return false;
        }

        _.interrupted = false;
        _.shouldClick = ( _.touchObject.swipeLength > 10 ) ? false : true;

        if ( _.touchObject.curX === undefined ) {
            return false;
        }

        if ( _.touchObject.edgeHit === true ) {
            _.$slider.trigger('edge', [_, _.swipeDirection() ]);
        }

        if ( _.touchObject.swipeLength >= _.touchObject.minSwipe ) {

            direction = _.swipeDirection();

            switch ( direction ) {

                case 'left':
                case 'down':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide + _.getSlideCount() ) :
                            _.currentSlide + _.getSlideCount();

                    _.currentDirection = 0;

                    break;

                case 'right':
                case 'up':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable( _.currentSlide - _.getSlideCount() ) :
                            _.currentSlide - _.getSlideCount();

                    _.currentDirection = 1;

                    break;

                default:


            }

            if( direction != 'vertical' ) {

                _.slideHandler( slideCount );
                _.touchObject = {};
                _.$slider.trigger('swipe', [_, direction ]);

            }

        } else {

            if ( _.touchObject.startX !== _.touchObject.curX ) {

                _.slideHandler( _.currentSlide );
                _.touchObject = {};

            }

        }

    };

    Slick.prototype.swipeHandler = function(event) {

        var _ = this;

        if ((_.options.swipe === false) || ('ontouchend' in document && _.options.swipe === false)) {
            return;
        } else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
            return;
        }

        _.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ?
            event.originalEvent.touches.length : 1;

        _.touchObject.minSwipe = _.listWidth / _.options
            .touchThreshold;

        if (_.options.verticalSwiping === true) {
            _.touchObject.minSwipe = _.listHeight / _.options
                .touchThreshold;
        }

        switch (event.data.action) {

            case 'start':
                _.swipeStart(event);
                break;

            case 'move':
                _.swipeMove(event);
                break;

            case 'end':
                _.swipeEnd(event);
                break;

        }

    };

    Slick.prototype.swipeMove = function(event) {

        var _ = this,
            edgeWasHit = false,
            curLeft, swipeDirection, swipeLength, positionOffset, touches, verticalSwipeLength;

        touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;

        if (!_.dragging || _.scrolling || touches && touches.length !== 1) {
            return false;
        }

        curLeft = _.getLeft(_.currentSlide);

        _.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
        _.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;

        _.touchObject.swipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));

        verticalSwipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curY - _.touchObject.startY, 2)));

        if (!_.options.verticalSwiping && !_.swiping && verticalSwipeLength > 4) {
            _.scrolling = true;
            return false;
        }

        if (_.options.verticalSwiping === true) {
            _.touchObject.swipeLength = verticalSwipeLength;
        }

        swipeDirection = _.swipeDirection();

        if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
            _.swiping = true;
            event.preventDefault();
        }

        positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
        if (_.options.verticalSwiping === true) {
            positionOffset = _.touchObject.curY > _.touchObject.startY ? 1 : -1;
        }


        swipeLength = _.touchObject.swipeLength;

        _.touchObject.edgeHit = false;

        if (_.options.infinite === false) {
            if ((_.currentSlide === 0 && swipeDirection === 'right') || (_.currentSlide >= _.getDotCount() && swipeDirection === 'left')) {
                swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
                _.touchObject.edgeHit = true;
            }
        }

        if (_.options.vertical === false) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        } else {
            _.swipeLeft = curLeft + (swipeLength * (_.$list.height() / _.listWidth)) * positionOffset;
        }
        if (_.options.verticalSwiping === true) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        }

        if (_.options.fade === true || _.options.touchMove === false) {
            return false;
        }

        if (_.animating === true) {
            _.swipeLeft = null;
            return false;
        }

        _.setCSS(_.swipeLeft);

    };

    Slick.prototype.swipeStart = function(event) {

        var _ = this,
            touches;

        _.interrupted = true;

        if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
            _.touchObject = {};
            return false;
        }

        if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
            touches = event.originalEvent.touches[0];
        }

        _.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
        _.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;

        _.dragging = true;

    };

    Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function() {

        var _ = this;

        if (_.$slidesCache !== null) {

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.unload = function() {

        var _ = this;

        $('.slick-cloned', _.$slider).remove();

        if (_.$dots) {
            _.$dots.remove();
        }

        if (_.$prevArrow && _.htmlExpr.test(_.options.prevArrow)) {
            _.$prevArrow.remove();
        }

        if (_.$nextArrow && _.htmlExpr.test(_.options.nextArrow)) {
            _.$nextArrow.remove();
        }

        _.$slides
            .removeClass('slick-slide slick-active slick-visible slick-current')
            .attr('aria-hidden', 'true')
            .css('width', '');

    };

    Slick.prototype.unslick = function(fromBreakpoint) {

        var _ = this;
        _.$slider.trigger('unslick', [_, fromBreakpoint]);
        _.destroy();

    };

    Slick.prototype.updateArrows = function() {

        var _ = this,
            centerOffset;

        centerOffset = Math.floor(_.options.slidesToShow / 2);

        if ( _.options.arrows === true &&
            _.slideCount > _.options.slidesToShow &&
            !_.options.infinite ) {

            _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            if (_.currentSlide === 0) {

                _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            }

        }

    };

    Slick.prototype.updateDots = function() {

        var _ = this;

        if (_.$dots !== null) {

            _.$dots
                .find('li')
                    .removeClass('slick-active')
                    .end();

            _.$dots
                .find('li')
                .eq(Math.floor(_.currentSlide / _.options.slidesToScroll))
                .addClass('slick-active');

        }

    };

    Slick.prototype.visibility = function() {

        var _ = this;

        if ( _.options.autoplay ) {

            if ( document[_.hidden] ) {

                _.interrupted = true;

            } else {

                _.interrupted = false;

            }

        }

    };

    $.fn.slick = function() {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slick = new Slick(_[i], opt);
            else
                ret = _[i].slick[opt].apply(_[i].slick, args);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };

}));

/*
 Sticky-kit v1.1.2 | WTFPL | Leaf Corcoran 2015 | http://leafo.net
*/
(function(){var b,f;b=this.jQuery||window.jQuery;f=b(window);b.fn.stick_in_parent=function(d){var A,w,J,n,B,K,p,q,k,E,t;null==d&&(d={});t=d.sticky_class;B=d.inner_scrolling;E=d.recalc_every;k=d.parent;q=d.offset_top;p=d.spacer;w=d.bottoming;null==q&&(q=0);null==k&&(k=void 0);null==B&&(B=!0);null==t&&(t="is_stuck");A=b(document);null==w&&(w=!0);J=function(a,d,n,C,F,u,r,G){var v,H,m,D,I,c,g,x,y,z,h,l;if(!a.data("sticky_kit")){a.data("sticky_kit",!0);I=A.height();g=a.parent();null!=k&&(g=g.closest(k));
if(!g.length)throw"failed to find stick parent";v=m=!1;(h=null!=p?p&&a.closest(p):b("<div />"))&&h.css("position",a.css("position"));x=function(){var c,f,e;if(!G&&(I=A.height(),c=parseInt(g.css("border-top-width"),10),f=parseInt(g.css("padding-top"),10),d=parseInt(g.css("padding-bottom"),10),n=g.offset().top+c+f,C=g.height(),m&&(v=m=!1,null==p&&(a.insertAfter(h),h.detach()),a.css({position:"",top:"",width:"",bottom:""}).removeClass(t),e=!0),F=a.offset().top-(parseInt(a.css("margin-top"),10)||0)-q,
u=a.outerHeight(!0),r=a.css("float"),h&&h.css({width:a.outerWidth(!0),height:u,display:a.css("display"),"vertical-align":a.css("vertical-align"),"float":r}),e))return l()};x();if(u!==C)return D=void 0,c=q,z=E,l=function(){var b,l,e,k;if(!G&&(e=!1,null!=z&&(--z,0>=z&&(z=E,x(),e=!0)),e||A.height()===I||x(),e=f.scrollTop(),null!=D&&(l=e-D),D=e,m?(w&&(k=e+u+c>C+n,v&&!k&&(v=!1,a.css({position:"fixed",bottom:"",top:c}).trigger("sticky_kit:unbottom"))),e<F&&(m=!1,c=q,null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),
h.detach()),b={position:"",width:"",top:""},a.css(b).removeClass(t).trigger("sticky_kit:unstick")),B&&(b=f.height(),u+q>b&&!v&&(c-=l,c=Math.max(b-u,c),c=Math.min(q,c),m&&a.css({top:c+"px"})))):e>F&&(m=!0,b={position:"fixed",top:c},b.width="border-box"===a.css("box-sizing")?a.outerWidth()+"px":a.width()+"px",a.css(b).addClass(t),null==p&&(a.after(h),"left"!==r&&"right"!==r||h.append(a)),a.trigger("sticky_kit:stick")),m&&w&&(null==k&&(k=e+u+c>C+n),!v&&k)))return v=!0,"static"===g.css("position")&&g.css({position:"relative"}),
a.css({position:"absolute",bottom:d,top:"auto"}).trigger("sticky_kit:bottom")},y=function(){x();return l()},H=function(){G=!0;f.off("touchmove",l);f.off("scroll",l);f.off("resize",y);b(document.body).off("sticky_kit:recalc",y);a.off("sticky_kit:detach",H);a.removeData("sticky_kit");a.css({position:"",bottom:"",top:"",width:""});g.position("position","");if(m)return null==p&&("left"!==r&&"right"!==r||a.insertAfter(h),h.remove()),a.removeClass(t)},f.on("touchmove",l),f.on("scroll",l),f.on("resize",
y),b(document.body).on("sticky_kit:recalc",y),a.on("sticky_kit:detach",H),setTimeout(l,0)}};n=0;for(K=this.length;n<K;n++)d=this[n],J(b(d));return this}}).call(this);
const GenericSlidersDotManager = (function() {
    const defaults = {
        selectors: {
            slickDots: '.slick-dots',
            slickActive: '.slick-dots\x20.slick-active'
        },
        events: {
            sliderInit: 'init',
            sliderBeforeChange: 'beforeChange'
        },
        classes: {
            "disctintive": "independent-dots"
        }
    };

    return class {
        constructor(slider) {
            this.element = slider;
            this.slideSpeed = 50;
            this.initComponent();
        }

        initComponent() {
            this.bindEvents();
            this.addDisctintive();
        }


        


        bindEvents() {
            const el = this;

            this.element.on(defaults.events.sliderInit, function (slick) {
                el.initSliderDotTransition();
            });

            this.element.on(defaults.events.sliderBeforeChange, function (event, slick, currentSlide, nextSlide) {
                const ltr = nextSlide > currentSlide;

                if (el.playing) {
                    el.element.stop();
                    el.initSliderDotTransition();
                }

                if (nextSlide == currentSlide + 1 || nextSlide == currentSlide - 1) {
                    el.playSliderDotTransition(ltr);
                } else {
                    setTimeout(function () {
                        el.initSliderDotTransition();
                    }, 1);
                }
            });
        }

        initSliderDotTransition() {
            if (this.buttonActiveContainer) {
                this.buttonActiveContainer.removeChild(this.buttonActive);
                this.buttonActive = null;
                this.buttonActiveContainer = null;
            }

            this.buttonActiveContainer = $(defaults.selectors.slickActive, this.element).get(0);

            if (this.buttonActiveContainer) {
                this.buttonActive = document.createElement("BUTTON");
                this.buttonActive.id = "buttonTransition";
                this.buttonActive.classList.add('active-button');
                this.buttonActiveContainer.appendChild(this.buttonActive);
                this.$buttonActive = $(this.buttonActive);
            }
        }

        playSliderDotTransition(leftToRight) {
            if (this.$buttonActive) {
                const el = this;

                this.playing = true;

                this.$buttonActive.animate({
                    left: "+=" + 5,
                    width: 20 + "px"
                }, 20);

                setTimeout(function () {
                    el.$buttonActive.animate({
                        width: "40px"
                    },
                    {
                        queue: false,
                        duration: parseInt(el.slideSpeed) + 200,
                        easing: 'easeInCubic'
                    });

                    el.$buttonActive.animate({
                        left: leftToRight ? "+=" + 35 : "-=" + 45
                    },
                    {
                        queue: false,
                        duration: parseInt(el.slideSpeed) + 600,
                        complete: ()=> {
                            el.playing = false;
                        }
                    });
                }, 50);
            }
        }

        setTheme(themeName) {
            this.$slickDots = $(defaults.selectors.slickDots, this.element);

            switch (themeName) {
                case 'dark':
                    this.$slickDots.removeClass('light-theme');
                    this.$slickDots.addClass('dark-theme');
                    break;

                case 'light':
                    this.$slickDots.removeClass('dark-theme');
                    this.$slickDots.addClass('light-theme');
                    break;
                default:
                    break;
            }
        }

        addDisctintive() {
            this.element.addClass(defaults.classes.disctintive);
        }

        setSlideSpeed(speed) {
            this.slideSpeed = speed;
        }
    };
})();

(function (global, factory) {
    if (typeof define === "function" && define.amd) {
      define(['exports'], factory);
    } else if (typeof exports !== "undefined") {
      factory(exports);
    } else {
      var mod = {
        exports: {}
      };
      factory(mod.exports);
      global.bodyScrollLock = mod.exports;
    }
  })(this, function (exports) {
    'use strict';
  
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  
    function _toConsumableArray(arr) {
      if (Array.isArray(arr)) {
        for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
          arr2[i] = arr[i];
        }
  
        return arr2;
      } else {
        return Array.from(arr);
      }
    }
  
    // Older browsers don't support event options, feature detect it.
  
    // Adopted and modified solution from Bohdan Didukh (2017)
    // https://stackoverflow.com/questions/41594997/ios-10-safari-prevent-scrolling-behind-a-fixed-overlay-and-maintain-scroll-posi
  
    var hasPassiveEvents = false;
    if (typeof window !== 'undefined') {
      var passiveTestOptions = {
        get passive() {
          hasPassiveEvents = true;
          return undefined;
        }
      };
      window.addEventListener('testPassive', null, passiveTestOptions);
      window.removeEventListener('testPassive', null, passiveTestOptions);
    }
  
    var isIosDevice = typeof window !== 'undefined' && window.navigator && window.navigator.platform && /iP(ad|hone|od)/.test(window.navigator.platform);
  
  
    var locks = [];
    var documentListenerAdded = false;
    var initialClientY = -1;
    var previousBodyOverflowSetting = void 0;
    var previousBodyPaddingRight = void 0;
  
    // returns true if `el` should be allowed to receive touchmove events
    var allowTouchMove = function allowTouchMove(el) {
      return locks.some(function (lock) {
        if (lock.options.allowTouchMove && lock.options.allowTouchMove(el)) {
          return true;
        }
  
        return false;
      });
    };
  
    var preventDefault = function preventDefault(rawEvent) {
      var e = rawEvent || window.event;
  
      // For the case whereby consumers adds a touchmove event listener to document.
      // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })
      // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then
      // the touchmove event on document will break.
      if (allowTouchMove(e.target)) {
        return true;
      }
  
      // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom)
      if (e.touches.length > 1) return true;
  
      if (e.preventDefault) e.preventDefault();
  
      return false;
    };
  
    var setOverflowHidden = function setOverflowHidden(options) {
      // Setting overflow on body/documentElement synchronously in Desktop Safari slows down
      // the responsiveness for some reason. Setting within a setTimeout fixes this.
      setTimeout(function () {
        // If previousBodyPaddingRight is already set, don't set it again.
        if (previousBodyPaddingRight === undefined) {
          var _reserveScrollBarGap = !!options && options.reserveScrollBarGap === true;
          var scrollBarGap = window.innerWidth - document.documentElement.clientWidth;
  
          if (_reserveScrollBarGap && scrollBarGap > 0) {
            previousBodyPaddingRight = document.body.style.paddingRight;
            document.body.style.paddingRight = scrollBarGap + 'px';
          }
        }
  
        // If previousBodyOverflowSetting is already set, don't set it again.
        if (previousBodyOverflowSetting === undefined) {
          previousBodyOverflowSetting = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        }
      });
    };
  
    var restoreOverflowSetting = function restoreOverflowSetting() {
      // Setting overflow on body/documentElement synchronously in Desktop Safari slows down
      // the responsiveness for some reason. Setting within a setTimeout fixes this.
      setTimeout(function () {
        if (previousBodyPaddingRight !== undefined) {
          document.body.style.paddingRight = previousBodyPaddingRight;
  
          // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it
          // can be set again.
          previousBodyPaddingRight = undefined;
        }
  
        if (previousBodyOverflowSetting !== undefined) {
          document.body.style.overflow = previousBodyOverflowSetting;
  
          // Restore previousBodyOverflowSetting to undefined
          // so setOverflowHidden knows it can be set again.
          previousBodyOverflowSetting = undefined;
        }
      });
    };
  
    // https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions
    var isTargetElementTotallyScrolled = function isTargetElementTotallyScrolled(targetElement) {
      return targetElement ? targetElement.scrollHeight - targetElement.scrollTop <= targetElement.clientHeight : false;
    };
  
    var handleScroll = function handleScroll(event, targetElement) {
      var clientY = event.targetTouches[0].clientY - initialClientY;
  
      if (allowTouchMove(event.target)) {
        return false;
      }
  
      if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {
        // element is at the top of its scroll
        return preventDefault(event);
      }
  
      if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {
        // element is at the top of its scroll
        return preventDefault(event);
      }
  
      event.stopPropagation();
      return true;
    };
  
    var disableBodyScroll = exports.disableBodyScroll = function disableBodyScroll(targetElement, options) {
      if (isIosDevice) {
        // targetElement must be provided, and disableBodyScroll must not have been
        // called on this targetElement before.
        if (!targetElement) {
          // eslint-disable-next-line no-console
          console.error('disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.');
          return;
        }
  
        if (targetElement && !locks.some(function (lock) {
          return lock.targetElement === targetElement;
        })) {
          var lock = {
            targetElement: targetElement,
            options: options || {}
          };
  
          locks = [].concat(_toConsumableArray(locks), [lock]);
  
          targetElement.ontouchstart = function (event) {
            if (event.targetTouches.length === 1) {
              // detect single touch
              initialClientY = event.targetTouches[0].clientY;
            }
          };
          targetElement.ontouchmove = function (event) {
            if (event.targetTouches.length === 1) {
              // detect single touch
              handleScroll(event, targetElement);
            }
          };
  
          if (!documentListenerAdded) {
            document.addEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
            documentListenerAdded = true;
          }
        }
      } else {
        setOverflowHidden(options);
        var _lock = {
          targetElement: targetElement,
          options: options || {}
        };
  
        locks = [].concat(_toConsumableArray(locks), [_lock]);
      }
    };
  
    var clearAllBodyScrollLocks = exports.clearAllBodyScrollLocks = function clearAllBodyScrollLocks() {
      if (isIosDevice) {
        // Clear all locks ontouchstart/ontouchmove handlers, and the references
        locks.forEach(function (lock) {
          lock.targetElement.ontouchstart = null;
          lock.targetElement.ontouchmove = null;
        });
  
        if (documentListenerAdded) {
          document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
          documentListenerAdded = false;
        }
  
        locks = [];
  
        // Reset initial clientY
        initialClientY = -1;
      } else {
        restoreOverflowSetting();
        locks = [];
      }
    };
  
    var enableBodyScroll = exports.enableBodyScroll = function enableBodyScroll(targetElement) {
      if (isIosDevice) {
        if (!targetElement) {
          // eslint-disable-next-line no-console
          console.error('enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.');
          return;
        }
  
        targetElement.ontouchstart = null;
        targetElement.ontouchmove = null;
  
        locks = locks.filter(function (lock) {
          return lock.targetElement !== targetElement;
        });
  
        if (documentListenerAdded && locks.length === 0) {
          document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);
  
          documentListenerAdded = false;
        }
      } else if (locks.length === 1 && locks[0].targetElement === targetElement) {
        restoreOverflowSetting();
  
        locks = [];
      } else {
        locks = locks.filter(function (lock) {
          return lock.targetElement !== targetElement;
        });
      }
    };
  });

const DIRECTV_PUBLIC_SITES_CONSTANTS = {
    "COUNTRIES": {
        "AR": "ar",
        "CL": "cl",
        "CO": "co",
        "EC": "ec",
        "PE": "pe",
        "TT": "tt",
        "UY": "uy",
        "VE": "ve"
    },
    "DOCUMENT_VALIDATION": {
        "ar": "^[0-9]{2}.[0-9]{3}.[0-9]{3}$",
        "cl": "^[0-9]{2}.[0-9]{3}.[0-9]{3}-[0-9|kK]$",
        "DEFAULT": "^[0-9]+$"
    },
    "TEXT_VALIDATION": {
        "cl": "[a-zA-Z-\u00f1\u00d1\\s]*",
        "DEFAULT": "[a-zA-Z-\u00f1\u00d1\\s]*"
    },
    "ENDPOINTPATH": "/bin/public-sites/mock/",
    "ENDPOINTS": {
        "SETTINGS": "settings",
        "ALLMEDIA": "allmedia",
        "ALLCHANNELS": 'channels',
        "CATEGORIES": 'categories',
        "PLANS": 'plans',
        "PACKS": "premiumpacks",
        "OFFERRETAIL": "offers-retail",
        "LOCATIONSCOL": "/bin/public-sites/mock/internet-locations.html/co/es",
        "SEGMENTSCOL": "/bin/public-sites/mock/internet-segments.html/co/es",
        "MATCHES": "/bin/public-sites/mock/internet-segments.html/ar/es",
        "MATCHESCL": "/bin/public-sites/mock/internet-segments.html/cl/es",
        "MATCHESPE": "/bin/public-sites/mock/internet-segments.html/pe/es",
        "EVENTS": "/bin/public-sites/mock/events.html/ar/es",
        "EVENTSCL": "/bin/public-sites/mock/events.html/cl/es",
        "EVENTSPE": "/bin/public-sites/mock/events.html/pe/es",
        "ADQUISITION": "/bin/public-sites/acquisition"
    },
    "CALCULATOR": {
        "ESBAPI":       "/bin/public-sites/ESB/NewCalculator/ESBDataConsult.html"
    },
    "COMPONENTNAMES": {
        "ALERT": 'Alert',
        "CALLMENOW": 'callme-now',
        "SEGMENTSAUTOCOMPLETE": 'segments-autocomplete',
        "CALLMELATER": 'call me later',
        "CALLMELATER_MODAL": 'call me later popup'
    },
    "SETTINGSTYPE": {
        "POSTPAID": 'postpaid',
        "PREPAID": 'prepaid',
        "GENERAL": 'general',
        "DTVGO": 'dtvgo',
        "DTVFLEX": 'dtvflex',
        "STREAM": 'stream'
    },
    "PLAN_NAMES": {
        "ar": { postpaid: 'abono-mensual', prepaid: 'prepago', stream: 'tv-online' },
        "bo": { postpaid: 'postpago', prepaid: 'prepago', stream: 'tv-online' },
        "cl": { postpaid: 'postpago', prepaid: 'prepago', stream: 'tv-online' },
        "co": { postpaid: 'pospago', prepaid: 'prepago', stream: 'tv-online' },
        "ec": { postpaid: 'previopago', prepaid: 'prepago', stream: 'tv-online' },
        "pe": { postpaid: 'postpago', prepaid: 'prepago', stream: 'tv-online' },
        "pr": { postpaid: 'pospago', prepaid: 'prepago', stream: 'tv-online' },
        "tt": { postpaid: 'postpago', prepaid: 'prepago', stream: 'tv-online' },
        "uy": { postpaid: 'con-abono', prepaid: 'prepago', stream: 'tv-online' },
        "ve": { postpaid: 'previo-pago', prepaid: 'prepago', stream: 'tv-online' }
    },
    "OFFER_NAMES": {
        "ar": { prepaid: 'clientes-prepago', postpaid: 'clientes-abono-mensual', "non-client": 'clientes-nuevos' },
        "bo": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "cl": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "co": { prepaid: 'clientes-prepago', postpaid: 'clientes-pospago', "non-client": 'clientes-nuevos' },
        "ec": { prepaid: 'clientes-prepago', postpaid: 'clientes-previopago', "non-client": 'clientes-nuevos' },
        "pe": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "pr": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "tt": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "uy": { prepaid: 'clientes-prepago', postpaid: 'clientes-con-abono', "non-client": 'clientes-nuevos' },
        "ve": { prepaid: 'clientes-prepago', postpaid: 'clientes-previo-pago', "non-client": 'clientes-nuevos' }
    },
    "INTERNET_NAMES": {
        "ar": { prepaid: 'clientes-prepago', postpaid: 'clientes-abono-mensual', "non-client": 'clientes-nuevos' },
        "bo": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "cl": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "co": { prepaid: 'clientes-prepago', postpaid: 'clientes-pospago', "non-client": 'clientes-nuevos' },
        "ec": { prepaid: 'clientes-prepago', postpaid: 'clientes-previopago', "non-client": 'clientes-nuevos' },
        "pe": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "pr": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "tt": { prepaid: 'clientes-prepago', postpaid: 'clientes-postpago', "non-client": 'clientes-nuevos' },
        "uy": { prepaid: 'clientes-prepago', postpaid: 'clientes-con-abono', "non-client": 'clientes-nuevos' },
        "ve": { prepaid: 'clientes-prepago', postpaid: 'clientes-previo-pago', "non-client": 'clientes-nuevos' }
    },
    "IMPERVA_HEADER_COUNTRY": "INCAP-Country-Code"
};

var slidePopUp = false;
let countryPS  = "";
let languagePS = "";

if (document.querySelector("html").hasAttribute("data-lang-ps")) {
    countryPS = document.querySelector("html").getAttribute("data-country-ps");
    languagePS = document.querySelector("html").getAttribute("data-lang-ps");
} else {
    languagePS = "es";
    const hostName = window.location.hostname.split(".").slice(1).join(".");

    switch (hostName) {
        case "directv.com.ar":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.AR;
            break;
        case "directv.cl":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.CL;
            break;
        case "directv.com.co":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.CO;
            break;
        case "directv.com.ec":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.EC;
            break;
        case "directv.com.pe":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.PE;
            break;
        case "directv.com.uy":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.UY;
            break;
        case "directv.com.ve":
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.VE;
            break;
        default:
            countryPS = DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.AR;
            break;
    }
}

const requestCachedData = (function () {
    function calculateCacheMinutes(minutes) {
        return minutes * calculateCacheSeconds(60);
    }
    function calculateCacheSeconds(seconds) {
        return seconds * 1000;
    }
    function getSelectors(options) {
        if (options.selectors && options.selectors.length > 0) {
            return "." + options.selectors.join(".");
        } else {
            return "";
        }
    }
    function getSufixes(options) {
        if (options.suffixes && options.suffixes.length > 0) {
            return "/" + options.suffixes.join("/");
        } else {
            return "";
        }
    }
    function getQueryString(options) {
        let queryString = "";

        if (options.params && Object.keys(options.params).length > 0) {
            queryString = "?";

            for (let param in options.params) {
                queryString += `${param}=${encodeURIComponent(options.params[param])}&`
            }

            // remove the last &

            return queryString.slice(0, -1);
        } else {
            return "";
        }
    }
    function getTimestamp() {
        return (new Date()).getTime();
    }
    const SELECTOR_REPLACEMENT = "{selector}";
    const SUFFIX_REPLACEMENT = "{suffix}";
    const QUERYSTRING_REPLACEMENT = "{query-params}";
    /*
    a registered endpoint has to follow the next pattern
        {
            "path" : 'path to the end point',
                      the path can have the next info
                      {selector} ==> selectors that will be sent
                      {sufix} ==> sufix that will be sent
                      {query-params} ==> query params that will be sent
            "cacheTime" : time in miliseconds that the request is going to be store
        }
    */
    const registeredEndPoints = {};

    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.SETTINGS] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}settings.html${SUFFIX_REPLACEMENT}${QUERYSTRING_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };
    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ALLMEDIA] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}allmedia${SELECTOR_REPLACEMENT}.html${SUFFIX_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };
    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ALLCHANNELS] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}channels.html${SUFFIX_REPLACEMENT}${QUERYSTRING_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };
    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.CATEGORIES] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}categories.html${SUFFIX_REPLACEMENT}${QUERYSTRING_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };

    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.PLANS] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}plans.html${SUFFIX_REPLACEMENT}${QUERYSTRING_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };

    registeredEndPoints[DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.PACKS] = {
        "path": `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}premiumpacks.html${SUFFIX_REPLACEMENT}${QUERYSTRING_REPLACEMENT}`,
        "cacheTime": calculateCacheMinutes(5)
    };

    return {
        getAjax(options) {
            // return a promise.
            return new Promise(function (resolve, reject) {
                let endPointMetadata = registeredEndPoints[options.endpoint];

                // if the endpoint is not configure send an error

                if (!endPointMetadata) {
                    if (options.path) {
                        endPointMetadata = {
                            path: options.path,
                            cacheTime: calculateCacheMinutes(5)
                        };
                    } else {
                        reject(Error("Endpoint not configured"));
                    }
                }

                // generate the endpoint path
                const endPointPath = endPointMetadata.path
                    .replace(SELECTOR_REPLACEMENT, getSelectors(options))
                    .replace(SUFFIX_REPLACEMENT, getSufixes(options))
                    .replace(QUERYSTRING_REPLACEMENT, getQueryString(options));
                // get the stored item
                let storedItem = localStorage.getItem(endPointPath);

                // if there is data stored
                if (storedItem !== null) {
                    // compare the current time against the cache expiration time
                    const currentTimestamp = getTimestamp();

                    storedItem = JSON.parse(storedItem);

                    if (storedItem.expirationTimestamp >= currentTimestamp) {
                        // if the expiration timestamp is bigger the current time
                        // return the stored data
                        resolve(storedItem.data);
                    } else {
                        // if the item expired remove it from the storage and proceed
                        localStorage.removeItem(endPointPath);
                        storedItem = null;
                    }
                }

                if (storedItem === null) {
                    const request = new XMLHttpRequest();

                    request.open('GET', endPointPath);
                    request.onload = function () {
                        // the successful error codes are between 200 and 299
                        if (request.status >= 200 && request.status <= 299) {
                            try {
                                // it looks redundant, but if there is an error
                                // it will be cached when it is parsed
                                const data = JSON.parse(request.responseText);
                                const cachedData = {
                                    "data": data,
                                    // sum the current timestamp plus the endpoint cachetime
                                    "expirationTimestamp": getTimestamp() + endPointMetadata.cacheTime
                                };

                                localStorage.setItem(endPointPath, JSON.stringify(cachedData));
                                resolve(cachedData.data);
                            } catch (e) {
                                // send the error
                                reject(e);
                            }
                        } else {
                            // return the error message sent by the server
                            reject(Error(request.statusText));
                        }
                    };

                    // handle network errors
                    request.onerror = function () {
                        reject(Error("Network Error"));
                    };
                    // make the request
                    request.send();
                }
            });
        },
        cleanCachedDataFromPath(path) {
            /* we go backwards in order to avoid changing index value */
            try {
                for (let index = localStorage.length - 1; index >= 0; index--) {
                    const item = localStorage.key(index);

                    if (item.startsWith(path)) {
                        localStorage.removeItem(item);
                    }
                }
            } catch (error) {
                throw (error);
            }
        }
    };
})();

const GlobalSettings = (function() {
    const GlobalSettingsData = {};

    function getGlobalDataCall(callback) {
        requestCachedData.getAjax({
            "endpoint" : DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.SETTINGS,
            "suffixes" : [countryPS, languagePS]
        }).then((data) => {
            if (data) {
                if (callback) {
                    callback(data);
                }
            }
        }, (err) => {
            console.log('Hubo un error en la peticin');
        });
    }

    getGlobalDataCall((data) => {
        data.body.forEach((dataItem) => {
            GlobalSettingsData[dataItem.type] = dataItem;
        });
    });

    return GlobalSettingsData;
})();

const GlobalData = (function () {
    const globalData = {};

    globalData.defaults = {
        requestData: {
            SETTINGS: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.SETTINGS,
                suffixes: [ countryPS, languagePS ],
                doAfter: (result) =>
                    Object.assign(
                        {
                            prepaid: result.find((item) => item.type === DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID),
                            postpaid: result.find((item) => item.type === DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.POSTPAID),
                            general: result.find((item) => item.type === DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.GENERAL),
                            dtvgo: result.find((item) => item.type === DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.DTVGO),
                            dtvflex: result.find((item) => item.type === DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.DTVFLEX)
                        })
            },
            ALLCHANNELS: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ALLCHANNELS,
                suffixes: [ countryPS, languagePS ]
            },
            CATEGORIES: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.CATEGORIES,
                suffixes: [ countryPS, languagePS ]
            },
            PLANS: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.PLANS,
                suffixes: [ countryPS, languagePS ]
            },
            PACKS: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.PACKS,
                suffixes: [ countryPS, languagePS ]
            },
            ALLMEDIA: {
                endpoint: DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ALLMEDIA
            }
        }
    };

    globalData.getData = (requestData) => {
        return rxjs.from(requestCachedData.getAjax(requestData)).pipe(
            rxjs.operators.map((response) => response.body? response.body: response),
            rxjs.operators.map(requestData.doAfter ? requestData.doAfter : (data) => data),
            rxjs.operators.catchError((err) => {
                GeneralComponentContainer.setErrorAlert(err);
            })
        );
    };

    globalData.getMultipleData = (requestDataArray) =>
        rxjs.combineLatest(
            requestDataArray.map(
                (requestData) =>
                    globalData.getData(requestData)
            ))
            .pipe(
                rxjs.operators.catchError((err) => {
                    GeneralComponentContainer.setErrorAlert(err);
                }));

    globalData.cleanCachedDataFromPath = (path) => {
        try {
            requestCachedData.cleanCachedDataFromPath(path);
        } catch (error) {
            GeneralComponentContainer.setErrorAlert(err);
        }
    };

    return globalData;
})();

const GeneralComponentContainer = {
    components: {},
    getComponent(id) {
        return this.components[id];
    },

    setComponent(component, id) {
        this.components[id] = component;
    },

    getComponentByName(name) {
        return Object.values(this.components).find((comp) => comp.name === name);
    },

    /**
     * method to call the alert component and show an advice.
     */

    setErrorAlert(error) {
        const alert = this.getComponentByName( DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

        if (alert) {
            alert.setTitle(error.title);
            alert.setDescription(error.msg);
            alert.setStatus('error');
            alert.showAlert();
        }
    }
};

const spliceSlice = (str, index, count, add) => {
    // We cannot pass negative indexes directly to the 2nd slicing operation.
    if (index < 0) {
        index = str.length + index;

        if (index < 0) {
            index = 0;
        }
    }

    return str.slice(0, index) + (add || "") + str.slice(index + count);
};


$.easing.jswing = $.easing.swing;

$.extend($.easing,
{
    def: 'easeOutQuad',
    swing: function (x, t, b, c, d) {
        //alert($.easing.default);
        return $.easing[$.easing.def](x, t, b, c, d);
    },
    easeInQuad: function (x, t, b, c, d) {
        return c*(t/=d)*t + b;
    },
    easeOutQuad: function (x, t, b, c, d) {
        return -c *(t/=d)*(t-2) + b;
    },
    easeInOutQuad: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t + b;
        return -c/2 * ((--t)*(t-2) - 1) + b;
    },
    easeInCubic: function (x, t, b, c, d) {
        return c*(t/=d)*t*t + b;
    },
    easeOutCubic: function (x, t, b, c, d) {
        return c*((t=t/d-1)*t*t + 1) + b;
    },
    easeInOutCubic: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t + b;
        return c/2*((t-=2)*t*t + 2) + b;
    },
    easeInQuart: function (x, t, b, c, d) {
        return c*(t/=d)*t*t*t + b;
    },
    easeOutQuart: function (x, t, b, c, d) {
        return -c * ((t=t/d-1)*t*t*t - 1) + b;
    },
    easeInOutQuart: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
        return -c/2 * ((t-=2)*t*t*t - 2) + b;
    },
    easeInQuint: function (x, t, b, c, d) {
        return c*(t/=d)*t*t*t*t + b;
    },
    easeOutQuint: function (x, t, b, c, d) {
        return c*((t=t/d-1)*t*t*t*t + 1) + b;
    },
    easeInOutQuint: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
        return c/2*((t-=2)*t*t*t*t + 2) + b;
    },
    easeInSine: function (x, t, b, c, d) {
        return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
    },
    easeOutSine: function (x, t, b, c, d) {
        return c * Math.sin(t/d * (Math.PI/2)) + b;
    },
    easeInOutSine: function (x, t, b, c, d) {
        return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
    },
    easeInExpo: function (x, t, b, c, d) {
        return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
    },
    easeOutExpo: function (x, t, b, c, d) {
        return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
    },
    easeInOutExpo: function (x, t, b, c, d) {
        if (t==0) return b;
        if (t==d) return b+c;
        if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
        return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
    },
    easeInCirc: function (x, t, b, c, d) {
        return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
    },
    easeOutCirc: function (x, t, b, c, d) {
        return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
    },
    easeInOutCirc: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
        return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
    },
    easeInElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
    },
    easeOutElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
    },
    easeInOutElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
        return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
    },
    easeInBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        return c*(t/=d)*t*((s+1)*t - s) + b;
    },
    easeOutBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
    },
    easeInOutBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
        return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
    },
    easeInBounce: function (x, t, b, c, d) {
        return c - $.easing.easeOutBounce (x, d-t, 0, c, d) + b;
    },
    easeOutBounce: function (x, t, b, c, d) {
        if ((t/=d) < (1/2.75)) {
            return c*(7.5625*t*t) + b;
        } else if (t < (2/2.75)) {
            return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
        } else if (t < (2.5/2.75)) {
            return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
        } else {
            return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
        }
    },
    easeInOutBounce: function (x, t, b, c, d) {
        if (t < d/2) return $.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
        return $.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
    }
});
var accent_map = {'':'a', '':'e', '':'i','':'o','':'u','':'a', '':'e', '':'i','':'o','':'u'};
function accentFold (s) {
    if (!s) { return ''; }
    var ret = '';
    for (var i = 0; i < s.length; i++) {
        ret += accent_map[s.charAt(i)] || s.charAt(i);
    }
    return ret;
};
/* UI STEP INDICATOR JAVASCRIPT */
(function ($) {
    let currentIndex = 1;
    let el;

    $.fn.stepIndicatorComponent = function(options) {
        el = this;

        this.find('.step').each((index, element) => {
            $(element).addClass('step-inactive');
            $(element).click((event) =>{
                stepClick( $(element).data('stepIndex') );
            });
        });
        this.find('.step:first-of-type').removeClass('step-inactive');

        return this;
    };

    $.fn.setCurrentStep = function(step) {
        if (step <= 2) {
            stepClick(step);
        }
    };

    $.fn.getCurrentStep = function() {
        return currentIndex;
    };

    function stepClick(stepIndex) {
        if (stepIndex !== currentIndex) {
            el.find('.step').each((index, element) => {
                if (index+1 == currentIndex) {
                    $(element).addClass('step-inactive');

                    if (currentIndex == 1) {
                        $(element).addClass('step-done');
                    }
                } else {
                    $(element).removeClass('step-inactive');
                    $(element).removeClass('step-done');
                }
            });
            currentIndex = stepIndex;

            el.trigger('stepClick', currentIndex);
        }
    }
}(jQuery));

/* THIS IS THE UI-DROPDOWN JAVASCRIPT */
(function ($) {
    $.fn.decoDropdownComponent = function (options) {
        this.html(`
        <div class="dropdown-button">
            <div class="decotext-container">
            </div>
            <div class="drop-icon">
                <i class="arrow down"></i>
            </div>        
        </div>
        <div class="dropdown-content"></div>
        `);

        this.addClass('directv-ui-dropdown');

        const settings = Object.assign({}, {
            title: 'Default dropdown',
            index: 0,
            deleteMessage: 'Eliminar este decodificador',
            included: '0',
            deleteOption: false,
            selectedItem(item, ref) {
                console.log(item);
            },
            deleteItem(item) {
                console.log(item);
            },
            items: [{
                price: 1,
                name: 'default item'
            }]
        }, options);

        const setTitle = (item) => {
            this.find('.dropdown-button\x20.decotext-container')
                .html(`
                    <div class="deco-text">${settings.title}</div>
                    <div class="deco-name">${item.name}</div>
                    ${(item.price - settings.included) > 0 ? `
                            <div class="deco-price">
                                <span>$${item.price}</span>
                            </div>
                        `: `<div class="deco-price italic">
                                <span>incluido</span>
                            </div>`}
                `);
        };

        setTitle(settings.items[settings.index] ?
            settings.items[settings.index] :
            'No items');

        const dropContent = this.find('.dropdown-content');
        const dropButton = this.find('.dropdown-button');

        dropButton.on('click', () => {
            if (dropContent.hasClass('show-content')) {
                dropContent.removeClass('show-content');
                dropButton.removeClass('show-content');
            } else {
                dropContent.addClass('show-content');
                dropButton.addClass('show-content');
            }
        });

        settings.items.forEach((item, index) => {
            dropContent.decoDropdownAddItem(
                Object.assign({}, item, { price: (item.price - settings.included) > 0 ? item.price : 0 }),
                settings.index == index);
        });

        if (settings.deleteOption) {
            dropContent.append(`
                <div class="delete-option">
                    <span class="x">&#10005;</span><span class="text">${settings.deleteMessage}</span>
                </div>
            `);
            dropContent.find('.delete-option').on('click', () => {
                settings.deleteItem(this);
            });
        }

        const dropItems = dropContent.find('.dropdown-item');

        dropItems.on('click', (e) => {
            const selectedItem = settings.items.find(
                (item) => item.name == $(e.currentTarget).find('.deco-name').text());

            dropItems.removeClass('selected');
            $(e.currentTarget).addClass('selected');
            setTitle(selectedItem);
            settings.selectedItem(selectedItem, $(this));
        });

        $(document).mouseup((e) => {
            if (
                // (!dropContent.is(e.target) && dropContent.has(e.target).length === 0) &&
                (!dropButton.is(e.target) && dropButton.has(e.target).length === 0)
            ) {
                dropContent.removeClass('show-content');
                dropButton.removeClass('show-content');
            }
        });

        return this;
    };

    $.fn.decoDropdownAddItem = function (item, isSelected) {
        this.append(`        
        <div class="dropdown-item${isSelected ? ' selected' : ''}">
            <div class="decotext-container"> 
                <div class="deco-name">${item.name}</div>
                <div class="deco-price ${item.price ? '' : 'italic'}">
                    <span>${item.price ? '$' + item.price : 'incluido'}</span>${item.price ? '' : ''}
                </div>
            </div>
            <span class="checkmark"></span>
        </div>`);

        return this;
    };
}(jQuery));

/* THIS IS THE UI-BUTTON JAVASCRIPT */
(function ( $ ) {
    /** @description Initalize a button component.
     * @param {object} options button parameter.
     * @return {object} Button component
     */
    $.fn.buttonComponent = function(options) {
        const settings = $.extend({
            enabled: true,
            text: 'button component'
        }, options);

        this.addClass('directv-ui-button');
        this.text(this.html()=='' ? settings.text : this.html());

        return this;
    };

    /** @description Set button text
     * @param {string} text Button text
     *
     */
    $.fn.setText =function(text) {
        this.text(text);
    };

    /** @description Set button enabled / disabled states
     * @param {boolean} Enable / disabled value
     */

    $.fn.setEnabled = function(value) {
        value == false ? this.addClass('disabled') : this.removeClass('disabled');
    };
}( jQuery ));

/* THIS IS THE UI-INPUT JAVASCRIPT */
(function ($) {
    /*    $.validator.register({
            selector: ".directv-input-wrapper input",
            show: function (el, message) {
                const inputField = el.get(0);
    
                if (inputField.customToolTip) {
                    inputField.customToolTip(el, message);
                }
            },
            clear: function (el) {
                const inputField = el.get(0);
    
                if (inputField.customToolTip) {
                    inputField.customToolTip(el);
                }
            }
        });*/
    
        /** @description Initalize a input component.
         * @param {object} options button parameter.
         * @return {object} Input component
         */
        $.fn.inputComponent = function (options) {
            const inputField = this.get(0);
            const settings = $.extend({
                enabled: true,
                text: 'button component',
                errorSelector: '.directv-input-error',
                hintSelector: '.directv-input-help-text',
                hintAuxSelector: '.helper-text'
            }, options);
    
            this.addClass('directv-input');
            this.text(this.html() === '' ? settings.text : this.html());
            this.on('blur keydown keyup', function () {
                $(this).addClass('touched');
                $(this).get(0).customToolTip($(this));
            });
    
            if (inputField) {
                inputField.customToolTip = ($element) => {
                    const inputField = $element.get(0);
                    const $errorDiv = $element.parents('.directv-input-wrapper').find(settings.errorSelector);
                    const $helpDiv = $element.parents('.directv-input-wrapper').find(settings.hintSelector);
                    const $helpAuxDiv = $element.parents('.directv-input-wrapper').find(settings.hintAuxSelector);
                    if (!inputField.validity.valid) {
                        $(this).addClass('invalid');
                        $errorDiv.show();
                        $helpDiv.hide();
                    } else {
                        $(this).removeClass('invalid');
                        $errorDiv.hide();
                        if(!$helpAuxDiv){
                            $helpDiv.show();
                        } else if(!inputField.value){
                            $helpDiv.show();
                        }
                    }
                };
            }
    
            return this;
        };
    
        $.fn.inputComponentInvalidate = function (config) {
            const options = Object.assign({}, {
                errorSelector: '.directv-input-error'
            }, config)
            const $inputComponent = $(this);
    
            $inputComponent.removeClass('touched');
    
            if ($inputComponent.is('[type=checkbox]')) {
                $inputComponent.prop('checked', false);
            }
    
            const $errorDiv = $inputComponent.parents('.directv-input-wrapper').find(options.errorSelector);
    
            if ($errorDiv.length > 0) {
                $errorDiv.hide();
            }
    
            return this;
        };
    }(jQuery));

InputValidations = (function () {
    const defaults = {
        "attributes": {
            "pattern": "pattern",
            "minlength": "minlength",
            "maxlength": "maxlength",
            "separator": "-",
            "checked": "checked",
            "valid": ":valid",
            "input": "input"
        }
    };

    return class {
        constructor(inputRef, config) {
            this.config = {
                pattern: "[a-zA-Z-\\u00f1\\u00d1\\s]*",
                mask: null,
                blur: null,
                focus: null,
                inputCall: null,
            };
            this.config = Object.assign({}, this.config, config);
            this.inputRef = inputRef.length ? inputRef : null;
            this.inputRef && this.initComponent(this.config);
        }

        initComponent(config) {
            this.inputRef.inputComponent(config);
            this.setPattern(this.config.pattern);
            this.setInputMask(this.config);
            this.setInputListener(this.config.inputCall);
        }

        setPattern(pattern) {
            this.inputRef && this.inputRef.attr(defaults.attributes.pattern, pattern);
        }

        reset() {
            this.inputRef && this.inputRef.val('');
        }

        invalidate() {
            this.inputRef &&
                (this.inputRef.inputComponentInvalidate(this.config),
                    this.inputRef.inputComponent(this.config))

        }

        setInputListener(callBack) {
            this.inputRef && callBack && this.inputRef.on(defaults.attributes.input, callBack);
        }

        isValid() {
            return this.inputRef ? this.inputRef.is(defaults.attributes.valid) : true;
        }

        setValue(value) {
            this.inputRef && this.inputRef.val(value);
        }

        value() {
            return this.inputRef && this.inputRef.val();
        }

        show() {
            this.inputRef && this.inputRef.show();
        }

        hide() {
            this.inputRef && this.inputRef.hide();
        }

        setInputMask(data) {
            if (this.inputRef) {
                if (data.blur) {
                    this.inputRef.on('blur', () => {
                        if (this.inputRef.is(defaults.attributes.valid)) {
                            this.inputRef.val(data.blur(this.inputRef.val()));
                        }
                    });
                }

                if (data.focus) {
                    this.inputRef.on('focus', () => {
                        if (this.inputRef.is(defaults.attributes.valid)) {
                            this.inputRef.val(data.focus(this.inputRef.val()));
                        }
                    });
                }

                if (data.inputRule) {
                    this.inputRef.bind("paste drop", (event) => {
                        event.preventDefault();
                    });
                    this.inputRef.on("keypress", data.inputRule);
                }

                if (data.mask) {
                    this.inputRef.maskBuffer && this.inputRef.maskBuffer.destroy();

                    this.inputRef.maskBuffer = vanillaTextMask.maskInput({
                        inputElement: this.inputRef[0],
                        mask: data.mask,
                        guide: true
                    });
                }
            }
        }
    };
})();

/* global rxjs */

const ajax2Observable = function(ajax) {
    const observable$ = new rxjs.Subject();

    ajax.done((result) => {
        observable$.next(result);
    });
    ajax.fail((result) => {
        observable$.error(result);
    });

    return observable$;
};

const Helpers = (function () {
    return class {
        isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        getCookie(cname) {
            const name = cname + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const ca = decodedCookie.split(';');
            let cookieValue = "";

            ca.forEach(function (element) {
                let c = element;

                while (c.charAt(0) === ' ') {
                    c = c.substring(1);
                }

                if (c.indexOf(name) === 0) {
                    cookieValue = c.substring(name.length, c.length);
                }
            });

            return cookieValue;
        }

        getParameterByName(_name, url) {
            const name = _name.replace(/[[\]]/g, "\\$&");

            if (!url) {
                url = window.location.href;
            }

            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
            const results = regex.exec(url);

            return results && results[2] && decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        setCookie(cokieName, cookieValue, expireTime) {
            const cookieExpires = expireTime ? "; expires=" + expireTime : '';

            document.cookie = cokieName + "=" + cookieValue + ";path=/" + cookieExpires;
        }

        /**
         * Sets in Session or local Starage a value for limit time.
         * @param {Any} element Element to persist.
         * @param {String} storageKey Storage key.
         * @param {Number} minutes Time to live for element.
         * @param {Boolean} isLocalSt Save in: ***localstorage*** (true) or ***sessionstorage*** (false).
         */
        persistElement(element, storageKey, minutes, isLocalSt) {
            let maxDate = new Date();
            const persistValue = {
                element: element,
                expires: maxDate.setMinutes(maxDate.getMinutes() + minutes).valueOf()
            };

            if (isLocalSt) {
                localStorage.setItem(storageKey, JSON.stringify(persistValue));
            } else {
                sessionStorage.setItem(storageKey, JSON.stringify(persistValue));
            }
        }

        /**
         * Gets data form storage.
         * @param {String} storageKey Storage key.
         */
        readPersistElement(storageKey) {
            let result = sessionStorage.getItem(storageKey);
            if (!result) result = localStorage.getItem(storageKey);
            if (!result) return null;
            try {
                result = result ? JSON.parse(result) : null;

                if (result && result.element) {
                    const now = new Date().valueOf();
                    return result.expires > now ? result.element : null;
                } else {
                    return null;
                }
            } catch (error) {
                console.error(error);
                return null;
            }
        }

        /**
         * Removes data form storage.
         * @param {String} storageKey Storage key.
         */
        deletePersistElement(storageKey) {
            let result = sessionStorage.getItem(storageKey);
            if (result) {
                sessionStorage.removeItem(storageKey);
                return;
            }

            result = localStorage.getItem(storageKey);
            if (result) {
                localStorage.removeItem(storageKey);
            }
        }

        /**
         * Obtiene datos de configuracion de data-attributes del HTL y los convierte en objetos y luego elimina el elemento del HTML.
         * @param {String|Object|HtmlCollection|HtmlElement} elem Objeto jQuery, elemento HTML o string de busqueda de
         * elemento con data-attributes a convertir en objetos de configuracion.
         */
        getConfigDataFromHtl(elem) {
            if (!elem) return null;

            let res;

            if (elem instanceof jQuery && elem.length > 0) {
                res = elem[0].dataset;
                elem.remove();
            } else if ((elem instanceof HTMLCollection && elem.length) || elem instanceof HTMLElement) {
                res = elem.dataset;
                $(elem).remove();
            } else if (typeof elem === 'string') {
                res = $(elem)[0].dataset;
                $(elem).remove();
            } else {
                console.warn('Invalid element.');
                return null;
            }

            if (!res.length) console.warn(`${elem} no exist!`);

            return res;
        }
    };
})();


/**
 * String extension function to format string templates easily. Use 
 * {n} wildcard, where n is the parameter number to use. 
 */
 Object.defineProperty(String.prototype, 'format', {
    value: function format() {
        if (arguments.length < 1) throw new Error('No arguments received.');

        var result = this;
        for (var i = 0; i < arguments.length; i++) {
            var regex = new RegExp('\\{' + i + '\\}', 'g');
            if (typeof arguments[i] !== 'function' &&
                typeof arguments[i] !== 'symbol' &&
                typeof arguments[i] !== 'object' &&
                typeof arguments[i] !== 'undefined') {
                result = result.replace(regex, arguments[i]);
            } else if (typeof arguments[i] === 'object') {
                result = result.replace(regex, JSON.stringify(arguments[i]));
            } else {
                result = result.replace(regex, typeof arguments[i]);
            }
        }

        return result;
    },
    writable: true,
    configurable: true
});

/**
 * String empty constant.
 */
Object.defineProperty(String, 'empty', {
    value: '',
    enumerable: false,
    configurable: false,
    writable: false,
});
const loginData = (function () {
    const defaults = {
        "classes": {
            "loaded": "loaded"
        },
        "events": {
            "load": "load"
        },
        "values": {
            "menuCookie": "DTV.MENU",
            "postPaid": "@POST_PAID"
        }
    };

    return {
        readCookie(cname) {
            const cookieValue = new Helpers().getCookie(cname);

            return cookieValue && cookieValue.split("$");
        },
        isLoggedIn() {
            return this.readCookie(defaults.values.menuCookie) !== "";
        },
        isPostPaid() {
            const cookieValue = this.readCookie(defaults.values.menuCookie);

            return this.isLoggedIn() && cookieValue.length && cookieValue[1] === defaults.values.postPaid;
        },
        isPrePaid() {
            const cookieValue = this.readCookie(defaults.values.menuCookie);

            return this.isLoggedIn() && cookieValue.length && cookieValue[1] !== defaults.values.postPaid;
        },
        getUserName() {
            const cookieValue = this.readCookie(defaults.values.menuCookie);
            const userName = cookieValue.length && cookieValue[0];

            return userName && userName.toLowerCase();
        }
    };
})();


const HeaderHelpers = (function () {
    let cachedCookies = {};

    return class {
        isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        getCookie(cname) {
            const name = cname + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const ca = decodedCookie.split(';');
            let cookieValue = "";

            ca.forEach(function (element) {
                let c = element;

                while (c.charAt(0) === ' ') {
                    c = c.substring(1);
                }

                if (c.indexOf(name) === 0) {
                    cookieValue = c.substring(name.length, c.length);
                }
            });

            return cookieValue;
        }

        getParameterByName(_name, url) {
            const name = _name.replace(/[[\]]/g, "\\$&");

            if (!url) {
                url = window.location.href;
            }

            const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
            const results = regex.exec(url);

            return results && results[2] && decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        currentUrlParams() {
            var currentUrl = window.location.href;
            var indexHash = currentUrl.indexOf('#');
            var indexQuery = currentUrl.indexOf('?');
            
            if(indexHash != -1 && indexQuery != -1 && indexHash < indexQuery){
                var hash = location.hash.substr(0, location.hash.indexOf('?'));
                var query = location.hash.substr(location.hash.indexOf('?'));
                var newUrl = window.location.pathname + query + hash;
                
                history.pushState({}, null, newUrl);
            }
        }

        getCookieServer(_name) {
            if (typeof cachedCookies[_name] === 'undefined' && countryPS && languagePS) {
                const xhttp = new XMLHttpRequest();
                const path = `/bin/public-sites/cookie.html/${countryPS}/${languagePS}?name=${_name}&timestap=${new Date().getTime()}`;

                try {
                    xhttp.open("GET", path, false);
                    xhttp.send();

                    if (xhttp.status === 200) {
                        cachedCookies[_name] = JSON.parse(xhttp.response).body.value;
                    } else {
                        cachedCookies[_name] = "";
                    }
                } catch (e) {
                    cachedCookies[_name] = "";
                }
            }

            return cachedCookies[_name];
        }

        fetcher(route) {
            return fetch(route)
                .then((r) => {
                    if (r.ok) {
                        return r.json();
                    } else {
                        throw Error(`Request rejected with status ${r.status}`);
                    }
                })
                .catch((error) => {
                    console.error(error);
                });
        }
        
        hasCookie(_name) {

            const xhttp = new XMLHttpRequest();
            const path = "/bin/public-sites/find-cookie.html?name=" + _name;

            try {
                xhttp.open("GET", path, false);
                xhttp.send();

                if (xhttp.status === 200){
                    return JSON.parse(xhttp.response);
                } else {
                    return false;
                }
            } catch (e) {
                return false;
            }
        }

        // cookieExpire = Expire time in seconds
        setCookie(cookieName, cookieValue, cookieExpire) {
            var now = new Date();
            var time = now.getTime();

            if(cookieExpire){
                var expireTime = time + 1000*cookieExpire;
                now.setTime(expireTime);
            }

            document.cookie = cookieName + "=" + cookieValue + ";expires=" + now.toGMTString() + ";path=/";
        }
    };
})();


const HeaderLoginData = (function () {
    const defaults = {
        "classes": {
            "loaded": "loaded"
        },
        "events": {
            "load": "load"
        },
        "values": {
            "menuCookie": "DTV.MENU",
            "authenticatedCookie": "SSOAuth",
            "userCookie": "DTVMUI",
            "userPrepaid": "PRE_PAID",
            "userPostpaid": "POST_PAID",
            "postPaid": "@POST_PAID",
            "authDataDiv": "menu-auth-data",
            "menuAttribute": "menu",
            "userAttribute":"mui"
        },
        "storage": {
            "name": "DTV_ACNT"
        }
    };

    return {
        readCookie(cname) {
            const cookieValue = new HeaderHelpers().getCookie(cname);

            return cookieValue && cookieValue.split("$");
        },
        readCookieServer(cname) {
            const cookieValue = new HeaderHelpers().getCookieServer(cname);

            return cookieValue && cookieValue.split("$");
        },
        readAuthDataFromHtml(cname) {
            let elemAuthData = document.getElementById(defaults.values.authDataDiv);
            if (elemAuthData && elemAuthData.dataset) {
                let dataset = elemAuthData.dataset;
                const dataValue = Object.getOwnPropertyNames(dataset).some(x => x == cname) ? dataset[cname] : '';

                if (dataValue) {
                    return dataValue && dataValue.split('$');
                }
            }

            return '';
        },
        isLoggedIn() {
            return this.readAuthDataFromHtml(defaults.values.menuAttribute) !== '';
        },
        isAuthenticated() {
            return document.getElementById(defaults.values.authDataDiv) != null;
        },

        isPostPaid() {
            const cookieValue = this.readAuthDataFromHtml(defaults.values.menuAttribute);

            return this.isLoggedIn() && cookieValue.length && cookieValue[1] === defaults.values.postPaid;
        },
        isPrePaid() {
            const cookieValue = this.readAuthDataFromHtml(defaults.values.menuAttribute);

            return this.isLoggedIn() && cookieValue.length && cookieValue[1] !== defaults.values.postPaid;
        },
        getUserName() {
            const cookieValue = this.readAuthDataFromHtml(defaults.values.menuAttribute);
            let userName = cookieValue.length && cookieValue[0];
            
            if(userName){
                userName = decodeURI(userName);
            }

            return userName && userName.toLowerCase();
        },
        getDataAccount() {
            return rxjs.Observable.create((observer) => {
                let user_cookie = this.readAuthDataFromHtml(defaults.values.userAttribute);

                let data = {
                    type: '',
                    url_redirect: '/',
                    in_session: this.isLoggedIn()
                };

                if (user_cookie != "") {
                    let postpaid = user_cookie[0].toLowerCase().includes(defaults.values.userPostpaid.toLowerCase());

                    GlobalData.getData(
                        GlobalData.defaults.requestData.SETTINGS
                    ).subscribe(
                        (res) => {
                            if (postpaid) {
                                data.type = !this.isLoggedIn() ? DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.POSTPAID : '';
                                data.url_redirect = res.postpaid.homeUrl;
                            }
                            else {
                                data.type = !this.isLoggedIn() ? DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID : '';
                                data.url_redirect = res.prepaid.homeUrl;
                            }

                            observer.next(data);
                        }
                    );
                }

                observer.next(data);
            });
        }
    };
})();

const HeaderComponentContainer = {
    components: {},
    getComponent(id) {
        return this.components[id];
    },

    setComponent(component, id) {
        this.components[id] = component;
    }
};

/** global loginData **/

const MiDirectvMenu = (function () {
    const defaults = {
        "selectors": {
            "miDirectcContainer": "header .midirectv-container",
            "menuNoLogged": ".midirectv-no-logged",
            "menuLogged": ".midirectv-logged",
            "collapseMenu": ".collapse-menu",
            "firstLevelMenu": ".first-level",
            "menuPostPaid": ".midirectv-menu.post-paid",
            "menuPrePaid": ".midirectv-menu.pre-paid",
            "menuAvailable": ".midirectv-menu.available",
            "logoutOption": ".midirectv-menu.available > ul > li:last-child()",
            "userData": ".midirectv-user-data",
            "userName": ".midirectv-user-data .midrectv-user-name",
            "loggedUserIcon": ".midirectv-logged .dtv-public-icon-logged-user",
            "loggedUserIconDesktop": ".midirectv-logged .midirectv-icon",
            "loggedUserIconOpen": ".midirectv-logged .midirectv-icon.midirectv-icon-open",
            "loggedUserIconClose": ".midirectv-logged .midirectv-icon.midirectv-icon-close",
            "header": "header",
            "phones": ".header-phones",
            "rootComponent": ".root"
        },
        "classes": {
            "open": "open",
            "show": "show",
            "available": "available",
            "phonesVisible": "phones-visible"
        },
        "events": {
            "click": "click"
        },
        "values": {
            "durationTransition": 350,
            "logoutText": "Salir",
            "menuCookie": "DTV.MENU",
            "redirectCookie": "DTV.USERTYPE",
            "expiration": 2592000,
            "menuAttribute": "menu"
        },
        "breakpoints": {
            "mobile": 969
        }
    };

    return class {
        constructor() {
            this.component = $(defaults.selectors.miDirectcContainer);
            this.initComponent();
        }

        initComponent() {
            this.$menuLogged = this.component.find(defaults.selectors.menuLogged);
            this.$collapseMenu = $(document).find(defaults.selectors.collapseMenu);
            this.$firstLevelMenu = $(document).find(defaults.selectors.firstLevelMenu);
            this.$menuNoLogged = this.component.find(defaults.selectors.menuNoLogged);
            this.$menuPostPaid = this.component.find(defaults.selectors.menuPostPaid);
            this.$menuPrepaid = this.component.find(defaults.selectors.menuPrePaid);
            this.$userData = this.component.find(defaults.selectors.userData);
            this.$userName = this.component.find(defaults.selectors.userName);
            this.$loggedUserIcon = this.component.find(defaults.selectors.loggedUserIcon);
            this.$loggedUserIconDesktop = this.component.find(defaults.selectors.loggedUserIconDesktop);
            this.$loggedUserIconOpen = this.component.find(defaults.selectors.loggedUserIconOpen);
            this.$loggedUserIconClose = this.component.find(defaults.selectors.loggedUserIconClose);
            this.$header = $(defaults.selectors.header);
            this.$phonesContainer = $(defaults.selectors.phones);
            this.$rootComponent = $(defaults.selectors.rootComponent);
            this.validateMiDirectvSession();
            this.createRedirectionCookie();
            this.bindEvents();
        }

        bindEvents() {
            this.$loggedUserIconDesktop.bind(defaults.events.click, this.showContextualMenu.bind(this));
            $(document).bind(defaults.events.click, this.closeContextualMenu.bind(this));
        }

        validateMiDirectvSession() {
            const isLoggedIn = HeaderLoginData.isLoggedIn();

            this.$menuLogged.toggleClass(defaults.classes.show, isLoggedIn);
            this.$menuNoLogged.toggleClass(defaults.classes.show, !isLoggedIn);
            this.$userName.text(HeaderLoginData.getUserName());

            this.$menuPostPaid.toggleClass(defaults.classes.available, isLoggedIn);
            this.$menuAvailable = this.component.find(defaults.selectors.menuAvailable);

            this.$miDirectvLoggedMenuItem = this.$menuAvailable.find('li');
            this.$userData.attr('href', this.$menuAvailable.data('url'));
        }

        showContextualMenu(event) {
            event.preventDefault();
            this.updateMenuClasses();
        }

        updateMenuClasses() {
            if (this.$firstLevelMenu.hasClass(defaults.classes.open)) {
                this.$collapseMenu.toggleClass(defaults.classes.open);
                this.$firstLevelMenu.toggleClass(defaults.classes.open);
            }

            this.setOpenedHeight();
            this.$menuAvailable.slideToggle(defaults.values.durationTransition);
            this.$loggedUserIconOpen.toggleClass(defaults.classes.show);
            this.$loggedUserIconClose.toggleClass(defaults.classes.show);
        }

        closeContextualMenu(event) {
            const $target = $(event.target);

            if (this.$loggedUserIconClose.hasClass(defaults.classes.show) && !$target.hasClass('midirectv-icon-open')) {
                this.updateMenuClasses();
            }
        }

        setOpenedHeight() {
            this.$miDirectvLoggedMenuItem = this.$menuAvailable.find('li');
            const menuHeight = 60 * this.$miDirectvLoggedMenuItem.length;
            const headerheight = this.$header.innerHeight();
            const phonebarHeight = this.$phonesContainer.innerHeight();
            const distanceToTop = this.$rootComponent.hasClass(defaults.classes.phonesVisible) ? headerheight + phonebarHeight : headerheight;

            if (window.matchMedia(`(max-height: ${menuHeight + distanceToTop}px)`).matches || (window.matchMedia(`(max-width: ${defaults.breakpoints.mobile}px)`).matches && window.matchMedia(`(max-height: ${menuHeight + distanceToTop}px)`).matches)) {
                this.$menuAvailable.css('height', `calc( 100vh - ${distanceToTop}px )`);
            } else {
                this.$menuAvailable.css("height", menuHeight);
            }
        }

        createRedirectionCookie() {
            const cookieValue = HeaderLoginData.readAuthDataFromHtml(defaults.values.menuAttribute);
            if (cookieValue.length == 2 && cookieValue[1].length > 0) {
                new Helpers().setCookie(defaults.values.redirectCookie, cookieValue[1].replace('@', ''), defaults.values.expiration);
            }
        }
    };
})();

const Search = (function () {
    const defaults = {
        "selectors": {
            "searchOverlay": ".header-container--search-overlay",
            "searchTrigger": ".search-trigger",
            "searchInput": "#txt_header_search",
            "searchButton": ".search-btn",
            "closeButton": ".close-btn"
        },
        "classes": {
            "fadeOut": "fade-out",
            "animateShow": "animate-show",
            "expand": "expand",
            "open": "open",
            "closed": "closed",
            "show": "show"
        },
        "events": {
            "click": "click",
            "transitionEnds": "webkitTransitionEnd",
            "keyUp": "keyup",
            "openSearch": "openSearch",
            "closeSearch": "closeSearch"
        },
        "values": {
        },
        "endPoints": {
            "search": "/busqueda.aspx?&q="
        }
    };

    return class {
        constructor() {
            this.component = $(defaults.selectors.searchOverlay);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initComponent() {
            this.$search =$(defaults.selectors.searchTrigger);
            this.$close = this.component.find(defaults.selectors.closeButton);
            this.$searchInput = this.component.find(defaults.selectors.searchInput);
            this.$searchButton = this.component.find(defaults.selectors.searchButton);
            this.search = {
                "top": 0,
                "left": 0,
                "state": false
            };
            this.setSearchPosition();
            this.bindSearchEvents();
        }

        bindSearchEvents() {
            if (this.$search.length === 0) return;
            this.$search.bind(defaults.events.click, this.openSearch.bind(this));
            this.$close.bind(defaults.events.click, this.closeSearch.bind(this));
            this.$searchButton.bind(defaults.events.click, this.performSearch.bind(this));
            this.$searchInput.bind(defaults.events.keyUp, this.onEnterPressed.bind(this));
            this.component.bind(defaults.events.transitionEnds, this.handleAnimationsEnd.bind(this));
        }

        setSearchPosition() {
            this.getSearchPosition();

            if (this.search.state === false) {
                this.component.css('left', `${this.search.left}px`);
            }
        }

        openSearch() {
            this.$close.addClass(defaults.classes.open).removeClass(defaults.classes.closed);
            this.setSearchPosition();
            this.search.state = true;
            this.eventEmitter.next({
                event: defaults.events.openSearch,
                data: true
            });
            this.component.addClass(defaults.classes.animateShow);
            this.component.addClass(defaults.classes.show);
            this.component.css('left');
            this.component.addClass(defaults.classes.expand);
            this.component.css('left', '0px');
            this.$searchInput.focus();
            this.$searchInput.val('');
            this.$searchInput.addClass(defaults.classes.open);
        }

        closeSearch() {
            this.search.state = false;
            this.$close.removeClass(defaults.classes.open).addClass(defaults.classes.closed);
            this.eventEmitter.next({
                event: defaults.events.closeSearch,
                data: false
            });
            this.component.removeClass(defaults.classes.expand);
            this.$searchInput.removeClass(defaults.classes.open);
            this.setSearchPosition();
        }

        getSearchPosition() {
            if (this.$search.length === 0) return;
            const searchLeft = this.$search.offset().left;

            this.search.left = window.innerWidth >= 970 ? searchLeft - 30 : searchLeft - 15;
        }

        handleAnimationsEnd() {
            if (this.search.state === false) {
                this.component.removeClass(defaults.classes.show);
            }
        }

        onEnterPressed(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                this.performSearch();
            }
        }

        performSearch() {
            const criteria = this.$searchInput.val();

            if (criteria !== "") {
                window.location.href = defaults.endPoints.search + encodeURI(criteria);

                const customDimension = {
                    "advertContent": "",
                    "isPrepaid": ""
                };

                setInteraction("Search", page.pageName, criteria, 0, customDimension);
            }
        }
    };
})();

/** global loginData, _, rxjs **/
const HeaderContent = (function () {
    const defaults = {
        "selectors": {
            "header": "header",
            "phones": ".header-phones",
            "contentPusher": ".fix-height-container",
            "collapseMenu": ".collapse-menu",
            "firstLevelMenu": ".first-level",
            "viewMoreMenu": ".first-level .nav-item > a",
            "navItem": ".nav-item",
            "secondLevelMenu": ".second-level",
            "secondLevelMenuOption": ".second-level ul li a",
            "backButton": ".back-button",
            "headerContainer": ".header-container",
            "stickySeparator": ".sticky-separator",
            "headerSticker": ".header-sticker",
            "rootComponent": ".root",
            "homeLandingContainer": ".home-landing-container",
            "visible": ":visible",
            "myDirectvNav": ".my-directv-navigation",
            "myDirectvcollapseMenu": ".my-directv-collapse-menu",
            "myDirectvFirstLevelMenu": ".my-directv-first-level",
            "myDirectvNavItem": ".my-directv-first-level .nav-item",
            "myDirectvIcon": ".midirectv-container .midirectv-icon",
            "myDirectvMenu": ".midirectv-container",
            "myDirectvMenuItemsAuth": "ul.midirectv-menu.post-paid li"
        },
        "classes": {
            "open": "open",
            "subMenuOpen": "sub-menu-open",
            "shown": "shown",
            "phone": "phone-number ant-link ant-action",
            "fadeOut": "fade-out",
            "stickyStyle": "sticky-style",
            "superApp": "super-app",
            "phonesVisible": "phones-visible"
        },
        "events": {
            "click": "click",
            "resize": "resize",
            "scroll": "scroll",
            "transitionEnds": "webkitTransitionEnd",
            "keyUp": "keyup",
            "totalHeaderSizeChange": "totalHeaderSizeChange",
            "isHeaderStickyChange": "isHeaderStickyChange",
            "mouseover": "mouseover",
            "mouseleave": "mouseleave"
        },
        "values": {
            "phonesHeight": 33,
            "dtvSource": "dtvsource",
            "UTMSource": "utm_source",
            "LPUTMSource": 'lp_utm_source',
            "superApp": "superapp",
            "accountNumberKey": "accountNumber",
            "accountNumberCookie": "DTV.AN",
            "initDiv": "<div></div>",
            "storageKey": "loginMenuHtml",
            "useLocalStarage": false,
            "storageTTL": 60 * 2, //Time in minutes.
            "stateAN": "lastStateAN"
        },
        "endPoints": {
            "allMedia": "/bin/public-sites/mock/allmedia",
            "loggedMenuItems": "/bin/public-sites/menuitems?country={0}&lan={1}"
        },
        "breakpoints": {
            "mobile": 969
        }
    };

    return class {
        constructor(country, language, phonesEnable, path, properties, takeOverCinema, lineone, linetwo) {
            this.editMode = properties.editMode;
            this.country = country;
            this.language = language;
            this.path = path;
            this.showPhonesContainer = phonesEnable;
            this.component = $(defaults.selectors.header);
            if (!this.editMode) {
                this.redirect();
            }
            this.takeOverCinema = takeOverCinema;
            this.lineone = lineone;
            this.linetwo = linetwo;
            this.initComponent();
        }

        initComponent() {
            this.firstLoad = true;
            this.eventEmitter = new rxjs.Subject();
            this.initDomElements();
            this.lastknownHeight = 0;
            this.lastScrollTop = 0;
            this.helper = new HeaderHelpers();
            this.searchComponent = new Search();
            this.globalHelper = new Helpers();
            this.bindEvents();
            this.updateLoginMenuItems();
            this.validateSuperApp();
            this.validateUTMSource();
            this.helper.currentUrlParams();
            this.redirectWithUTM();

            this.eventEmitter.subscribe((action) => {
                if (action.event === defaults.events.totalHeaderSizeChange) {
                    $(defaults.selectors.contentPusher).css({ "height": action.data });
                }
            });

            this.href = window.location.href;
            if (this.href.indexOf('Cinema') > -1 || this.href.indexOf('cinema') > -1) {
                this.addDivToHeader();
            }
        }

        initDomElements() {
            this.$collapseMenu = this.component.find(defaults.selectors.collapseMenu);
            this.$firstLevelMenu = this.component.find(defaults.selectors.firstLevelMenu);
            this.$secondLevelMenu = this.component.find(defaults.selectors.secondLevelMenu);
            this.$viewMoreMenu = this.component.find(defaults.selectors.viewMoreMenu);
            this.$secondLevelMenuOption = this.component.find(defaults.selectors.secondLevelMenuOption);

            this.$backButton = this.component.find(defaults.selectors.backButton);
            this.$headerContainer = this.component.find(defaults.selectors.headerContainer);
            this.$header = $(defaults.selectors.header);
            this.$phonesContainer = $(defaults.selectors.phones);
            this.phonesHeight = defaults.values.phonesHeight;
            this.headerStickerComponent = document.querySelector(defaults.selectors.headerSticker);
            this.$myDirectvNav = this.component.find(defaults.selectors.myDirectvNav);
            this.$myDirectvCollapseMenu = this.component.find(defaults.selectors.myDirectvcollapseMenu);
            this.$myDirectvFirstLevelMenu = this.component.find(defaults.selectors.myDirectvFirstLevelMenu);
            this.$myDirectvFirstLevelMenuItems = this.component.find(defaults.selectors.myDirectvNavItem);
            this.$myDirectvIcon = this.component.find(defaults.selectors.myDirectvIcon);
            this.$myDirectvMenu = this.component.find(defaults.selectors.myDirectvMenu);
            this.$rootComponent = $(defaults.selectors.rootComponent);
        }

        addDivToHeader() {
            if (this.takeOverCinema) {
                let el = '<div id="cinema_minitakeover" style="display: block; width: 100%; padding: 15px; text-align: center; background-color: rgb(215,9,65); color: white;">' +
                    this.lineone + '<br>' + this.linetwo +
                    '</div>';
                $('Header').append(el);
            }
        }

        redirect() {
            let homePath = `contentpublic-sites${this.country}${this.language}home`;
            let actualPath = this.path.split('/').join('');

            if (homePath === actualPath || '' === actualPath) {
                HeaderLoginData.getDataAccount().subscribe(data => {
                    if (data.url_redirect.replace('.html', '').split('/').join('')) {
                        window.location.replace(data.url_redirect.replace('//', '/'));
                    }
                });
            }
        }

        bindEvents() {
            this.$collapseMenu.bind(defaults.events.click, this.onMenuCollapseClicked.bind(this));
            this.$viewMoreMenu.bind(defaults.events.click, this.onViewMoreClicked.bind(this));
            this.$secondLevelMenuOption.bind(defaults.events.click, this.onSecondLevelMenuClicked.bind(this));
            this.$backButton.bind(defaults.events.click, this.onBackButtonClicked.bind(this));
            this.searchComponent.eventEmitter.subscribe(this.onSearchComponentEvents.bind(this));
            this.component.bind('transitionend', this.onHeaderTranstionEnd.bind(this));
            this.$myDirectvMenu.on(defaults.events.click, this.$myDirectvIcon, this.onMyDirectvMenuCollapseClicked.bind(this));
            this.$myDirectvMenu.on(defaults.events.mouseover, this.$myDirectvNav, this.onMyDirectvMenuCollapseMouseOver.bind(this));
            this.$myDirectvMenu.on(defaults.events.mouseleave, this.$myDirectvNav, this.onMyDirectvMenuCollapseMouseLeave.bind(this));
        }

        onHeaderTranstionEnd(event) {
            this.calculateHeaderStickerTopPosition();
        }

        onSearchComponentEvents(searchEvent) {
            this.$headerContainer.toggleClass(defaults.classes.fadeOut, searchEvent.data);
        }

        validateUserSession() {
            this.isLoggedIn = HeaderLoginData.isLoggedIn();
            this.isAuthenticated = HeaderLoginData.isAuthenticated();
            HeaderLoginData.getDataAccount().subscribe(data => {
                this.$headerContainer.find('.home-link').attr('href', data.url_redirect);
            });

            if (!this.isLoggedIn && !this.isAuthenticated) {
                this.$phonesContainer.addClass(defaults.classes.shown);
            } else {
                this.showPhonesContainer = false;
                this.$phonesContainer.removeClass(defaults.classes.shown);
            }
        }

        /**
         * Create a new cookie with localstorage value.
         */
        setAccountNumber() {
            const accNum = localStorage.getItem(defaults.values.accountNumberKey),
                last = this.globalHelper.readPersistElement(defaults.values.stateAN) === 'true';

            if (accNum) {
                this.helper.setCookie(defaults.values.accountNumberCookie, accNum, (60 * 20));
                this.globalHelper.persistElement('true', defaults.values.stateAN, defaults.values.storageTTL, defaults.values.useLocalStarage)
            } else {
                this.helper.setCookie(defaults.values.accountNumberCookie, '', -1);
                this.globalHelper.deletePersistElement(defaults.values.stateAN);
            }

            if (last !== (accNum !== null)) {
                this.globalHelper.deletePersistElement(defaults.values.storageKey);
            }

            this.updateLoginMenuItems();
        }

        /**
         * Update login user menu items.
         */
        updateLoginMenuItems() {
            fetch(defaults.endPoints.loggedMenuItems.format(countryPS, languagePS))
                .then(res => {
                    if (!res.ok || res.status !== 200) {
                        throw new Error(`Invalid request. status: ${res.status || 0}`);
                    }

                    res.text().then(text => {
                        const htmlText = text.replaceAll('\n', '');
                        this.globalHelper.persistElement(htmlText, defaults.values.storageKey, defaults.values.storageTTL, defaults.values.useLocalStarage);
                        this.updateHtmlMenuItems(htmlText);
                    });
                })
                .catch(error => console.log(error, '%cbackground-color:red;color:white;'));
        }

        /**
         * Updates the DOM with HTML result.
         * @param {String} text HTML so set in DOM.
         */
        updateHtmlMenuItems(text) {
            this.$myDirectvMenu.children().remove();
            let $result = $(text);
            this.addLinksEvent($result.find(`${defaults.selectors.myDirectvFirstLevelMenu} li, ${defaults.selectors.myDirectvMenuItemsAuth}`));
            this.$myDirectvMenu.html($result);
            this.validateUserSession();
            this.initDomElements();
            this.miDirectvMenu = new MiDirectvMenu();

        }

        /**
         * Sets a redirect event to anchors in a list.
         * @param {jQueryElement} $container Element jQuery with items to add redirect event.
         */
        addLinksEvent($container) {
            $container.each((i, val) => {
                $(val).find('a').click(e => {
                    e.preventDefault();
                    if (e.currentTarget.target && e.currentTarget.target !== '_self') {
                        window.open(e.currentTarget.href, e.currentTarget.target);
                    } else {
                        document.location.href = e.currentTarget.href;
                    }
                });
            });
        }

        validateSuperApp() {
            const parameterUrl = this.helper.getParameterByName(defaults.values.dtvSource);
            const cookieValue = this.helper.getCookie(defaults.values.dtvSource);
            const isSuperApp = parameterUrl === defaults.values.superApp || cookieValue === defaults.values.superApp;

            if (isSuperApp) {
                this.helper.setCookie(defaults.values.dtvSource, defaults.values.superApp);
            }

            this.component.toggleClass(defaults.classes.superApp, isSuperApp);
        }

        validateUTMSource() {
            const parameterUrl = this.helper.getParameterByName(defaults.values.UTMSource);
            const cookieValue = this.helper.getCookie(defaults.values.UTMSource);
            const hasUTMSource = parameterUrl !== null && parameterUrl !== "";

            if (hasUTMSource) {
                this.helper.setCookie(defaults.values.UTMSource, parameterUrl, 1800);
                this.helper.setCookie(defaults.values.LPUTMSource, parameterUrl, 1800);
            }
        }

        onMenuCollapseClicked(event) {
            event.preventDefault();
            this.$firstLevelMenu.toggleClass(defaults.classes.open);
            this.$collapseMenu.toggleClass(defaults.classes.open);
            this.$firstLevelMenu.removeClass(defaults.classes.subMenuOpen);
            this.$secondLevelMenu.removeClass(defaults.classes.open);
            this.$header.toggleClass(defaults.classes.open);
            $(`${defaults.selectors.navItem}.open`).each(function() {
                $(this).removeClass(defaults.classes.open);
            });
        }

        onSecondLevelMenuClicked(event) {
            this.$firstLevelMenu.removeClass(defaults.classes.open);
            this.$collapseMenu.removeClass(defaults.classes.open);
            this.$firstLevelMenu.removeClass(defaults.classes.subMenuOpen);
            this.$secondLevelMenu.removeClass(defaults.classes.open);
        }

        setOpenedHeight(targetMenu, menuHeight) {
            const distanceToTop = $('header').outerHeight(true);
            if (window.matchMedia(`(max-height: ${menuHeight + distanceToTop}px)`).matches || (window.matchMedia(`(max-width: ${defaults.breakpoints.mobile}px)`).matches && window.matchMedia(`(max-height: ${menuHeight + distanceToTop}px)`).matches)) {
                targetMenu.css('height', `calc( 100vh - ${distanceToTop}px )`);
            } else {
                targetMenu.css("height", menuHeight);
            }
        }

        onMyDirectvMenuCollapseClicked(event) {
            event.preventDefault();

            this.$myDirectvFirstLevelMenu.toggleClass(defaults.classes.open);
            this.$myDirectvCollapseMenu.toggleClass(defaults.classes.open);
            this.$myDirectvIcon.toggleClass(defaults.classes.open);

            if (this.$myDirectvFirstLevelMenu.hasClass(defaults.classes.open)) {
                this.setOpenedHeight(this.$myDirectvFirstLevelMenu, this.$myDirectvFirstLevelMenuItems.length * 42);
            } else {
                this.$myDirectvFirstLevelMenu.css("height", 0);
            }
        }

        onMyDirectvMenuCollapseMouseOver(event) {
            event.preventDefault();

            setTimeout(() => {
                this.$myDirectvFirstLevelMenu.addClass(defaults.classes.open);
                this.$myDirectvCollapseMenu.addClass(defaults.classes.open);
                this.setOpenedHeight(this.$myDirectvFirstLevelMenu, this.$myDirectvFirstLevelMenuItems.length * 42);
            }, 500);
        }

        onMyDirectvMenuCollapseMouseLeave(event) {
            event.preventDefault();
            setTimeout(() => {
                this.$myDirectvFirstLevelMenu.removeClass(defaults.classes.open);
                this.$myDirectvCollapseMenu.removeClass(defaults.classes.open);
                this.$myDirectvFirstLevelMenu.css("height", 0);
            }, 500);
        }

        onViewMoreClicked(event) {
            const $currentTarget = $(event.currentTarget);
            const $withoutChildren = $($currentTarget[0].parentElement).hasClass('whitout-children');
            if (window.matchMedia(`(max-width: ${defaults.breakpoints.mobile}px)`).matches && !$withoutChildren) {
                event.preventDefault();
                const $currentOpened = $currentTarget.parents(defaults.selectors.navItem).find(defaults.selectors.secondLevelMenu);
                $currentOpened.toggleClass(defaults.classes.open);
                $($currentOpened[0].parentElement).toggleClass(defaults.classes.open);

                this.$firstLevelMenu.addClass(defaults.classes.subMenuOpen);
            }
        }

        onBackButtonClicked(event) {
            const $currentTarget = $(event.currentTarget);

            $currentTarget
                .parents(defaults.selectors.secondLevelMenu)
                .removeClass(defaults.classes.open);
            this.$firstLevelMenu.removeClass(defaults.classes.subMenuOpen);
        }

        getPhonesData() {
            let mediaName = this.helper.getCookie('lp_utm_source');
            GlobalData.getData(Object.assign(GlobalData.defaults.requestData.ALLMEDIA, {
                "selectors": [this.country, this.language],
                "suffixes": ((mediaName !== null && mediaName !== "") ? [mediaName] : null)
            })).subscribe(
                (j) => {
                    let html = '';
                    if (window.location.pathname.startsWith('/ayuda/') && j.helpPhone) {
                        if (j.phoneHidden) {
                            $('.header-phones').find('p').html('');
                        } else {
                            $('.header-phones').find('p').html(`${j.helpPhoneLabel} `);
                            html = this.loadPhones(j.helpPhone, j.secondHelpPhone);
                        }
                    } else {
                        html = this.loadPhones(j.phone1, j.phone2, j.customerText, j.customerLink);
                    }

                    this.eventEmitter.next({
                        event: 'phoneUpdated',
                        data: j
                    });

                    if (this.showPhonesContainer) {
                        const phoneTemp = document.querySelector(`${defaults.selectors.phones}\x20p`);

                        if (phoneTemp) phoneTemp.insertAdjacentHTML('beforeend', html);

                        this.generalResize();
                        this.onScroll();
                        this.resizeBehaviour();
                    } else {
                        this.calculateTotalHeaderSize();
                        this.headerSticker();
                        this.onScroll();
                        this.calculateHeaderStickerTopPosition();
                    }

                    this.addAnalytics(document.querySelectorAll('span.phone-number'));
                },
                (error) => {
                    console.log(error);
                    this.showPhonesContainer = false;
                    this.$phonesContainer.removeClass(defaults.classes.shown);
                    this.calculateTotalHeaderSize();
                    this.headerSticker();
                    this.onScroll();
                })
        }

        loadPhones(phone1, phone2, text, link) {
            const html = `<span>
            ${this.phoneWrapper(phone1 || '')} ${phone2 !== undefined && phone2 !== "" && phone2 !== "0" && phone2 !== phone1 ? '| ' + this.phoneWrapper(phone2) : ''}  ${text !== undefined && text !== "" && link !== undefined && link !== "" ? '| ' + this.linkWrapper(text, link) : ''}
            </span>`;

            if (this.country === DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.CO && phone1.replace(/\s/g, '').includes('018000')) {
                window.localStorage.setItem('defaultPhone', phone2);
            } else {
                window.localStorage.setItem('defaultPhone', phone1);
            }

            window.localStorage.setItem('contactphone', html);

            return html;
        }

        phoneWrapper(phone) {
            return this.helper.isMobile() ?
                `<a class='${defaults.classes.phone}' href="tel:${phone}" >${phone}</a>` :
                `<span class='${defaults.classes.phone}' >${phone}</span>`;
        }

        linkWrapper(text, link) {
            return this.helper.isMobile() ?
                `<a class='${defaults.classes.phone}' href="${link}" >${text}</a>` :
                `<span class='${defaults.classes.phone}' ><a class='${defaults.classes.phone}' href="${link}" >${text}</a></span>`;
        }

        resizeBehaviour() {
            setTimeout(() => {
                this.generalResize();
            }, 200);
            window.addEventListener(defaults.events.resize, () => this.generalResize());
            this.searchComponent.setSearchPosition();
        }

        getHeaderStickerComponent() {
            return !this.headerStickerComponent ?
                document.querySelector(defaults.selectors.headerSticker) : this.headerStickerComponent;
        }

        headerSticker() {
            this.headerStickerComponent = this.getHeaderStickerComponent();

            if (this.headerStickerComponent !== null) {
                const header = document.querySelector(defaults.selectors.header);
                const headerHeight = header.offsetHeight;
                const headerBottomDistance = headerHeight + header.offsetTop;
                const isHeaderSticky = $(window).scrollTop() > headerBottomDistance;

                if (isHeaderSticky) {
                    this.headerStickerComponent.classList.add(defaults.classes.stickyStyle);
                } else {
                    this.headerStickerComponent.classList.remove(defaults.classes.stickyStyle);
                }

                this.setIsHeaderStickerSticky(isHeaderSticky);
            }
        }

        calculateHeaderStickerTopPosition() {
            const header = document.querySelector(defaults.selectors.header);
            const headerHeight = header.offsetHeight;
            const headerBottomDistance = headerHeight + header.offsetTop;

            this.setHeaderStickerTopPosition(headerBottomDistance);
            this.calculateTotalHeaderSize();
        }

        onScroll() {
            window.addEventListener(defaults.events.scroll, this.throttle(() => {
                setTimeout(() => {
                    this.generalResize();
                }, 200);
                this.headerSticker();
            }, 250), false);
        }

        throttle(func, wait, options) {
            var context, args, result;
            var timeout = null;
            var previous = 0;
            if (!options) options = {};
            var later = function () {
                previous = options.leading === false ? 0 : Date.now();
                timeout = null;
                result = func.apply(context, args);
                if (!timeout) context = args = null;
            };
            return function () {
                var now = Date.now();
                if (!previous && options.leading === false) previous = now;
                var remaining = wait - (now - previous);
                context = this;
                args = arguments;
                if (remaining <= 0 || remaining > wait) {
                    if (timeout) {
                        clearTimeout(timeout);
                        timeout = null;
                    }
                    previous = now;
                    result = func.apply(context, args);
                    if (!timeout) context = args = null;
                } else if (!timeout && options.trailing !== false) {
                    timeout = setTimeout(later, remaining);
                }
                return result;
            };
        };

        setHeaderStickerTopPosition(topPosition) {
            this.headerStickerComponent = this.getHeaderStickerComponent();

            if (this.headerStickerComponent !== null) {
                this.headerStickerComponent.style.top = `${topPosition}px`;
            }
        }

        generalResize() {
            const windowWidth = window.innerWidth;
            const contentPusher = document.querySelector(defaults.selectors.contentPusher);
            const headerSticker = document.querySelector(defaults.selectors.headerSticker);
            const headerStickerHeight = headerSticker ? headerSticker.offsetHeight : 0;

            this.searchComponent.getSearchPosition();

            if (this.showPhonesContainer && windowWidth >= 768) {
                this.phonesHeight = 33;
            } else if (this.showPhonesContainer) {
                this.phonesHeight = this.$phonesContainer.outerHeight();
            } else {
                this.phonesHeight = 0;
            }

            if (this.lastknownHeight !== this.phonesHeight) {
                this.lastknownHeight = this.phonesHeight;
                this.component.css({ "margin-top": `${this.phonesHeight}px` });
            }

            this.calculateTotalHeaderSize();
            const pusherHeight = this.getTotalHeaderSize() + headerStickerHeight;

            contentPusher.style.height = `${pusherHeight}px`;

            this.headerSticker();
        }

        getTotalHeaderSize() {
            return this.totalHeaderSize;
        }

        calculateTotalHeaderSize() {
            const newTotalHeaderSize = ((this.isPhonesContainerVisible() && this.$phonesContainer.outerHeight()) || 0) +
                this.component.outerHeight();
            const hasChanged = this.totalHeaderSize !== newTotalHeaderSize;
            if (hasChanged) {
                this.totalHeaderSize = newTotalHeaderSize;
                this.eventEmitter.next({
                    event: defaults.events.totalHeaderSizeChange,
                    data: this.totalHeaderSize
                });
                this.checkPhonesContainerVisibility();
            }
        }

        getPhonesContainerSize() {
            return this.$phonesContainer.outerHeight();
        }

        isPhonesContainerVisible() {
            const phoneContainerComponent = this.$phonesContainer && this.$phonesContainer[0];

            return phoneContainerComponent &&
                (phoneContainerComponent.offsetHeight + phoneContainerComponent.offsetTop > 0);
        }

        checkPhonesContainerVisibility() {
            const isPhonesContainerVisible = this.isPhonesContainerVisible();
            const $homeLandingContainer = $(defaults.selectors.homeLandingContainer);

            if (this.$rootComponent.length) {
                this.$rootComponent.toggleClass(defaults.classes.phonesVisible, isPhonesContainerVisible);
            }

            if ($homeLandingContainer.length) {
                $homeLandingContainer.toggleClass(defaults.classes.phonesVisible, isPhonesContainerVisible);
            }
        }

        setIsHeaderStickerSticky(newIsHeaderSticky) {
            if (newIsHeaderSticky !== this.isHeaderSticky) {
                this.isHeaderSticky = newIsHeaderSticky;
                this.eventEmitter.next({
                    event: defaults.events.isHeaderStickyChange,
                    data: this.isHeaderSticky
                });
            }
        }

        addAnalytics(firstEncounter) {
            var foundIt = false;

            if (firstEncounter.length > 0) {
                foundIt = true;
            } else {
                foundIt = false;
            }
            console.log('first ' + firstEncounter.length);

            //            this.repeatOrMoveForward(foundIt, firstEncounter);
            this.replacePhoneDivs();
        }

        repeatOrMoveForward(bool, firstEncounter) {
            if (!bool) {
                this.addAnalytics(firstEncounter);
            } else {
                this.replacePhoneDivs();
            }
        }

        createNewHTML(elem, text) {
            var hidden = '<span class="hidden ant-value">' + text + '</span>';
            $(elem).parent().prepend(hidden);

            if (!$(elem).parent().hasClass('ant-level1')) {
                $(elem).parent().addClass('ant-level1');
            }

            if (!$(elem).hasClass('ant-level2')) {
                $(elem).addClass('ant-level2');
            }
        }

        replacePhoneDivs() {

            var $this = this;
            var text = '';
            var firstEncounter = document.querySelectorAll('span.phone-number');
            firstEncounter.forEach(element => {
                if ($(element).parent().parent().parent().hasClass('header-phones')) {
                    text = 'Header';
                } else {
                    text = 'Green card';
                }

                $this.createNewHTML(element, text)
            });

            var secondEncounter = document.querySelectorAll('a.oph_phone_anchor');
            secondEncounter.forEach(element => {
                text = 'Green Button';
                $this.createNewHTML(element, text)
            });

            var thirdEncounter = document.querySelectorAll('a.phone-number');
            thirdEncounter.forEach(element => {
                if ($(element).attr('href').indexOf('tel') > -1) {
                    if ($(element).parent().parent().parent().hasClass('header-phones')) {
                        text = 'Header';
                    } else {
                        text = 'Green card';
                    }
                    $this.createNewHTML(element, text)
                }
            });
        }

        redirectWithUTM() {
            const secondMenu = $('.main-navigation a');
            const url = window.location;
            secondMenu.each(function (index) {
                if (this.href.includes('tienda') && this.href.includes('comprar')) {
                    this.href = `${this.href}${url.search}`
                }
            });
        }
    };
})();

/**
 * @description Match the last option in header verify if the option has submenu
 * if the option not has submenu don't show submenu bar
 * @method fixAdditionalOption() Add styles and verify if we need to show submenu
 */
class AdditionalOptionHeader {
    constructor() {
        this.selector = "header .header-container .main-navigation > ul .nav-item"
        this.subMenuClass = ".second-level"
        this.arrowMobile = '.dtv-public-icon-next'
        this.lastOptionLink = '.ant-action'
        this.fixAdditionalOption()
    }

    fixAdditionalOption() {
        const headerLastChild = $(this.selector)
        const _this = this

        // Verify if the last option has submenu options
        headerLastChild.each(function(){
            let headerLastChild = $(this)
            if (headerLastChild.find('ul').length === 0) {
                let lastChildLink = headerLastChild.find(_this.lastOptionLink)
                // Hide right arrow in mobile menu
                headerLastChild.find(_this.arrowMobile).hide()
                // Set click event in mobile event
                lastChildLink.click(() => {
                    window.location.href = lastChildLink.attr('href')
                })
                // Hide submenu if there are not options
                headerLastChild.hover(() => {
                    headerLastChild.find(_this.subMenuClass).hide()
                })
            }
        })
    }
}

const componentsHeader = $('.header-client-ref');
componentsHeader.each((index, element) => {
    const component = $(element)
    const id = component.attr('id');
    const country = component.data('country');
    const language = component.data('language');
    const phonesEnable = component.data('phonesenable');
    const path = component.data('path');
    const showChatWhenLogged = component.data('showchatwhenlogged');
    const properties = {
        "editMode": component.data('editmode')
    };
    const takeOverCinema = component.data('showtakeovercinema');
    const lineone = component.data('lineone');
    const linetwo = component.data('linetwo');
    const headerContent = new HeaderContent(country, language, phonesEnable, path.replace('.html', ''), properties, takeOverCinema, lineone, linetwo);

    HeaderComponentContainer.setComponent(headerContent, id);
    headerContent.getPhonesData();

    // Fix last child option only in Colombia and Peru
    switch (country) {
        case 'co':
            new AdditionalOptionHeader()
            break;
        case 'pe':
            new AdditionalOptionHeader()
            break;
        default:
            break
    }

    HeaderLoginData.getDataAccount().subscribe((data) => {
        if (data.in_session && !showChatWhenLogged) {
            $('.chat-button').css('display', 'none');
        }
    });
});

const Autocomplete = (function() {
  const defaults = {
    selectors: {},
    classes: {},
    endPoints: {
      segments: "/bin/public-sites/mock/segments.html/"
    }
  };

  return class {
    constructor(id, options) {
      
      this.options = options;
      this.id = id;
      this.component = $("#" + id);

      this.bindEvents = function() {}

      this.addClases = function() {}

      this.initComponent = function() {
        this.bindEvents();
      }

      if (this.component.length) {
        this.component[0].instance = this;
        this.initComponent();
      }

      this.setOptions = function (options) {
        var parent = $(
          ".directv-autocomplete-container.ui-widget.directv-input-wrapper"
        );
        var elSelected = $(parent).children("select#" + this.id);

        if(options.length <= 1){
          
          this.calledFromSetOptions(options, elSelected);

  //        this.component.combobox({
  //          showAllLabel: this.options.showAllLabel,
  //          noResultsLabel: this.options.noResultsLabel
  //        });
        } else {
          $(elSelected).parent().children('span.custom-combobox').remove();
          $(elSelected).parent().children('ul.ui-menu.ui-widget').remove();
          $(elSelected).empty();
          
          this.calledFromSetOptions(options, elSelected);
        }
        
      }

      this.calledFromSetOptions = function(options, elSelected){
        const optionsList = this.component[0] && this.component[0].options;

          var span = '<span class="custom-combobox"></span>';
          $(elSelected).after(span);
          $(elSelected).hide();

          options.forEach(option => {
            optionsList.add(
              new Option(option.description, option.id, option.default)
            );

            if (option.default) {
              this.component.val(option.id);
            }
          });

          this.createAutocomplete(elSelected);
      }

      this.createAutocomplete = function(elSelected) {
        const selected = $(elSelected).children(":selected");
        const parentSelector =
          "." + Array.from(elSelected.parent()[0].classList || []).join(".");
        const value = selected.val() ? selected.text() : "";

        var input =
          '<input class="custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left directv-input" value="' +
          value +
          '">';
        var span = $(elSelected).parent().children("span.custom-combobox");
        $(span).append(input);
        this.addExtraItems(span);
      }

      this.addExtraItems = function(span) {
        var height = $(span).children('input').height();
        var id = $(span).parent().children('select').attr('id');
        var ul =
          '<ul id="'+id+'-ui-id-1" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front" style="display: none; top: 40px; left: 0px; width: 351px;border: 1px solid #c5c5c5; margin: 0;"></ul>';
        $(span).after(ul);

        var input = $(span).children("input.custom-combobox-input");
        var idNumber = 2;
        var a =
          '<a tabindex="-1" class="ui-button ui-widget ui-button-icon-only custom-combobox-toggle ui-corner-right" role="button"> <span class="ui-button-icon ui-icon dtv-public-icon-down"></span><span class="ui-button-icon-space"></span></a>';
        $(input).after(a);

        a = $(span).children("a.ui-button.custom-combobox-toggle");
        const $selectAutocomplete = $('.segments-autocomplete-new');

        document.addEventListener('click', function (event) {
          if (event.target.closest('.ui-menu-item') ){
            return;
          } else {
            if (event.target.closest('.custom-combobox-toggle')){
              $('ul.ui-autocomplete').each(function(){
                if($(this).css('display') === 'block'){
                  $(this).css('display', 'none');
                }
              });
              $(a).removeClass('open');
              $selectAutocomplete && $selectAutocomplete.removeClass('open');
              if($(event.target).parent('a').length > 0){
                $selectAutocomplete && $selectAutocomplete.addClass('open');
                $(event.target).parent(a).addClass('open');
                $(event.target).parent().parent().parent().children('ul.ui-widget-content.ui-autocomplete').css('display', 'block');
              } else {
                $selectAutocomplete && $selectAutocomplete.addClass('open');
                $(event.target).addClass('open');
                $(event.target).parent().parent().children('ul.ui-widget-content.ui-autocomplete').css('display', 'block');
              }             
              
            } else {
              $(a).each(function(){
                if ($(this).hasClass("open")) {
                  $(this).removeClass("open");
                  $selectAutocomplete && $selectAutocomplete.removeClass('open');
                }
              });
              $('ul.ui-autocomplete').css("display", "none");
            }
          }
        }, false);

        $(a).css('height', height);

        $(a).on("click", function() {
          if ($(a).hasClass("open")) {
            $selectAutocomplete && $selectAutocomplete.removeClass('open');
            $(a).removeClass("open");
            $("#"+id+"-ui-id-1").css("display", "none");
          } else {
            $selectAutocomplete && $selectAutocomplete.addClass('open');
            $(a).addClass("open");
            $("#"+id+"-ui-id-1").empty();
            $(span).parent().children("select.directv-autocomplete")
              .children("option")
              .each(function() {
                var li =
                  '<li class="ui-menu-item">' +
                  '<div id="'+id+'-ui-id-' +
                  idNumber +
                  '" tabindex="-1" class="ui-menu-item-wrapper" onclick="setSelect(\'' + id + '\',\'' +
                  $(this).val() +
                  '\',\'' +
                  $(this).text() +
                  '\')">' +
                  $(this).text() +
                  "</div>" +
                  "</li>";
                $("#"+id+"-ui-id-1").append(li);
                idNumber++;
              });
            $("#"+id+"-ui-id-1").css("display", "block");
          }
        });
      }
    }
  };
})();

function setSelect(id,value, text) {
  var elle = $('#'+id);
  var a = $(elle).parent().children('span').children("a.ui-button.custom-combobox-toggle");
  const $selectAutocomplete = $('.segments-autocomplete-new');
  if ($(a).hasClass("open")) {
    $(a).removeClass("open");
    $selectAutocomplete && $selectAutocomplete.removeClass('open');
    $("#"+id+"-ui-id-1").css("display", "none");
  }
  
  var greatgrandparent = $(elle).parent().parent().parent('section');
  const styleType = $(greatgrandparent).data('style');
  $(elle).children("option").each(function() {
    $(this).prop("selected", false);
    if ($(this).val() == value) {
      $(this).prop("selected", true);
      $(elle).parent().children('span').children('input.custom-combobox-input').val(value);
      if($(elle).parent().children('span').children('input.custom-combobox-input').val() == "select"){
        $(elle).parent().children('span').children('input.custom-combobox-input').val("Selecciona");
      }
      styleType !== 'new' && $(greatgrandparent).children('.segments-autocomplete--label').css('display', 'block');
      styleType !== 'new' && $(greatgrandparent).children('.segments-autocomplete--selected').css('display', 'block');
      styleType !== 'new' && $(greatgrandparent).children('.dtv-public-icon-pin-point.segments-autocomplete--icon').css('display', 'block');
      styleType !== 'new' && $(elle).parent().parent('.segments-autocomplete--autocomplete.medium').css('display', 'none');
      $(greatgrandparent).children('.segments-autocomplete--selected').html(value);
    }
  });
}

$(".directv-autocomplete-container").each(function() {
  const id = $(this).data("idgen");
  const showAllLabel = $(this).data("showalllabel");
  const noResultsLabel = $(this).data("noresultslabel");

  new Autocomplete(id, {
    showAllLabel: showAllLabel,
    noResultsLabel: noResultsLabel
  });
});
const SegmentsAutocomplete = (function () {
    const defaults = {
        "selectors": {
            "autocomplete": ".directv-autocomplete",
            "segmentSelectedText": ".segments-autocomplete--selected",
            "segmentLabel": ".segments-autocomplete--label",
            "segmentAutocomplete": ".segments-autocomplete--autocomplete",
            "segmentIcon": ".segments-autocomplete--icon"
        },
        "classes": {},
        "events": {
            "click": "click",
            "comboboxSelect": "comboboxselect",
            "segmentUpdated": "segmentUpdated"
        },
        "endPoints": {
            "segments": "/bin/public-sites/mock/segments.html/"
        },
        "values": {
            "segmentCookie": "segment",
            "segmentQueryParam": "segment"
        }
    };

    return class {
        constructor(id, country, language, queryString) {
            this.country = country;
            this.language = language;
            this.helpers = new Helpers();
            this.eventEmitter = new rxjs.BehaviorSubject();
            this.component = $('#' + id);
            this.selectedSegmentId = '';
            this.selectedSegmentDescription = '';
            this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.SEGMENTSAUTOCOMPLETE;
            this.queryString = queryString;

            if (this.component.length) {
                this.component[0].instance = this;
                this.styleType = $(this.component).data('style');
                this.initComponent();
            }
        }

        initComponent() {
            this.$segmentSelectedText = this.component.find(defaults.selectors.segmentSelectedText);
            this.$segmentLabel = this.component.find(defaults.selectors.segmentLabel);
            this.$segmentAutocomplete = this.component.find(defaults.selectors.segmentAutocomplete);
            this.$segmentIcon = this.component.find(defaults.selectors.segmentIcon);
            this.queryString = this.queryString || this.$segmentLabel.find('.text-container').text().trim().toLowerCase();            
            
            this.getSelectedSegment();
            this.getQueryParamSegment();
            this.getAutocomplete();
            this.bindEvents();
            this.getSegments();
        }

        getQueryParamSegment() {
            const urlParams = new URLSearchParams(window.location.search);

            this.queryParamSegment = urlParams.get(this.queryString);
            if (this.queryParamSegment) {
                this.setSegmentCookie({ value: this.queryParamSegment });
            }
        }

        getAutocomplete() {
            const autoCompleteComponent = this.component.find(defaults.selectors.autocomplete).get(0);

            this.autocomplete = autoCompleteComponent && autoCompleteComponent.instance;
        }

        bindEvents() {
            this.$segmentSelectedText.on(defaults.events.click, this.onSegmentselectedClick.bind(this));
        }

        onSegmentselectedClick() {
            this.showAutocomplete();
        }

        showAutocomplete() {
            this.$segmentLabel.hide();
            this.$segmentSelectedText.hide();
            this.$segmentIcon.hide();
            this.$segmentAutocomplete.show();
        }

        hideAutocomplete() {
            if (this.styleType !== 'new') {
                this.$segmentLabel.show();
                this.$segmentSelectedText.show();
                this.$segmentIcon.show();
                this.$segmentAutocomplete.hide();
            }
            this.getSegments();
        }

        getSegments() {
            fetch(`${defaults.endPoints.segments}${this.country}/${this.language}`)
                .then((resp) => resp.json())
                .then((data) => {
                    let segmentedOptions = data.body;
                    const segmentIndex = 0;

                    if (this.selectedSegment) {
                        const updatedSegment = { ...segmentedOptions[segmentIndex], default: false };
                        const segmentIndexSelected = segmentedOptions.findIndex((segment) => segment.id === this.selectedSegment);
                        const updatedSegmentSelected = { ...segmentedOptions[segmentIndexSelected], default: true };

                        segmentedOptions[segmentIndex] = updatedSegment;
                        segmentedOptions[segmentIndexSelected] = updatedSegmentSelected;
                        this.updateSelectedSegmentText(updatedSegmentSelected.description);
                    } else {
                        this.setSegmentCookie({ value: segmentedOptions[segmentIndex].id });
                        this.updateSelectedSegmentText(segmentedOptions[segmentIndex].description);
                    }

                    this.autocomplete.setOptions(segmentedOptions);

                    const $this = this;
                    const { get, set } = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
                    const input = document.querySelector('.segments-autocomplete--autocomplete > div .custom-combobox input');
                    Object.defineProperty(input, 'value', {
                        get() {
                            return get.call(this);
                        },
                        set(newVal) {
                            var item = {value: newVal};
                            console.log('New value assigned to input: ' + newVal);
                            $this.selectedSegment = newVal;
                            $this.setSegmentCookie(item);
                            $this.updateSelectedSegmentText(newVal);
                            $this.hideAutocomplete();

                            return set.call(this, newVal);
                        }
                    });
                })
                .catch((error) => {
                    console.log(error);
                });
        }

        getSelectedSegment() {
            const urlParams = new URLSearchParams(window.location.search);

            this.queryParamSegment = urlParams.get(this.queryString);            
            this.selectedSegment = this.queryParamSegment || this.helpers.getCookie(defaults.values.segmentCookie);
            this.updateUrl(this.selectedSegment);
        }

        updateSelectedSegmentText(updateSelectedSegment) {
            this.selectedSegmentDescription = updateSelectedSegment;
            this.$segmentSelectedText.text(this.selectedSegmentDescription)
        }

        setSegmentCookie(segmentSelected) {
            const now = new Date();
            now.setTime(now.getTime() + 7 * 3600 * 1000);
            this.helpers.setCookie(defaults.values.segmentCookie, segmentSelected.value, now.toUTCString());
            this.updateUrl(segmentSelected.value)
            this.eventEmitter.next({
                event: defaults.events.segmentUpdated,
                data: segmentSelected.value
            });
        }

        updateUrl(segmentSelected) {
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set(this.queryString, segmentSelected);
            const newRelativePathQuery = window.location.pathname + '?' + urlParams.toString() + window.location.hash;
            history.replaceState(null, '', newRelativePathQuery);
        }
    };
})();

$('.segments-widget').each(function () {
    const id = $(this).data('idgen');
    const country = $(this).data('country');
    const language = $(this).data('language');
    const queryString = $(this).data('querystring');

    GeneralComponentContainer.setComponent(
        new SegmentsAutocomplete(id, country, language,queryString), id
    );
});
class AcquisitionDropdown {
    constructor(component, componentData, callToAction) {
        this.component = component;
        this.componentData = componentData;
        this.isLanding = componentData.landing;
        this.eventEmitter = new rxjs.Subject();
        this.callToAction = callToAction;

        if (componentData !== null && componentData.path !== undefined) {
            this.getDataSingleDrop();
        } else {
            this.dropFillData(componentData);
        }
    }

    getDataSingleDrop() {
        let path = this.componentData.path;

        if (path) {
            GlobalData.getMultipleData([
                { path: path }
            ]).subscribe(
                (result) => {
                    try {
                        const dropData = result[0][0];
                        if (dropData) {
                            this.dropFillData(dropData);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                },
                (error) => {
                    console.log(error);
                }
            );
        }
    }

    dropFillData(data) {
        let dropInfo = {};

        if (this.isLanding) {
            dropInfo = {
                ctalabel: data.landingctalabel,
                ctalink: data.landingctalink,
                ctatarget: data.landingctatarget,
                ctacolor: data.landingctacolor,
                ctalabelcolor: data.landingctalabelcolor,
                highlightcolor: data.landinghighlightcolor,
                highlightlabelcolor: data.landinghighlightlabelcolor,
                type: data.type,
                level: data.level,
                options: data.landingoptions
            };
        } else {
            dropInfo = {
                ctalabel: data.cardctalabel,
                ctalink: data.cardctalink,
                ctatarget: data.cardctatarget,
                ctacolor: data.cardctacolor,
                ctalabelcolor: data.cardctalabelcolor,
                highlightcolor: data.cardhighlightcolor,
                highlightlabelcolor: data.cardhighlightlabelcolor,
                type: data.type,
                level: data.level,
                options: data.cardoptions
            };
        }

        this.fillData(dropInfo);
    }

    fillData(data) {
        let template = '';
        let withOptions = false;
        const isMobile = window.matchMedia("(max-width: 970px)").matches;

        if (data.ctalabel) {
            let defaultStyle = `color: ${data.ctalabelcolor};`;
            let highlightStyle = `background-color: ${data.highlightcolor}; color: ${data.highlightlabelcolor};`;
            withOptions = data.options.length > 0;

            let menu = !withOptions ? '' : `
			<input type="checkbox" class="dd-comp dd-input">

			<ul class="dd-menu" style="background-color:{{ctacolor}}; color:{{ctalabelcolor}};">
				{{#each options}}
					<li class=" ant-action ${withOptions ? 'ant-select' : 'ant-button'} ${data.level ? 'ant-level'+data.level : ''} ${data.type ? 'ant-'+data.type : ''}">                                         
                        <a data-link="{{#ifCond ${isMobile} '&&' optionlinkmobile}}{{optionlinkmobile}}{{else}}{{optionlink}}{{/ifCond}}" name="{{optiontype}}" data-target="{{optiontarget}}" style="{{#ternary highlight '${highlightStyle}' '${defaultStyle}'}}{{/ternary}}">
							{{#ifCond optionicon '!=' ""}}<img src="{{optionicon}}" alt="{{optionlabel}}">&nbsp;{{/ifCond}}
							<span>{{optionlabel}}</span>
						</a>
					</li>
				{{/each}}
			</ul>
			`;

            template = `
			<label class="acquisition-dropdown">
				<div class="dd-comp btn-select directv-ui-button ant-action ${withOptions ? 'ant-select' : 'ant-button'} ${data.level ? 'ant-level'+data.level : ''} ${data.type ? 'ant-'+data.type : ''}" style="background-color:{{ctacolor}}; color:{{ctalabelcolor}};">
					<span class="text">{{ctalabel}}</span>
				</div>
				${menu}
			</label>
			`;
        } else {
            template = `
			<label class="acquisition-dropdown">
				<div class="btn-select"></div>
			</label>
			`;
        }

        this.component.html(Handlebars.compile(template)(data));

        if (data.ctalabel) {
            if (withOptions) {
                this.component.find('.acquisition-dropdown>.btn-select').append('<span class="dtv-public-icon-down icon"></span>');
                this.generateEvents();
            } else {
                if (data.ctatarget === '_blank') {
                    this.component.find('.acquisition-dropdown>.btn-select').append('<i class="dtv-public-icon-external-link external-link"></i>');
                }
                this.component.find('.acquisition-dropdown>.btn-select').on('click', () => {
                    window.open(data.ctalink, data.ctatarget);
                });
            }
        }
    }

    generateEvents() {
        const that = this;
        const phoneNumber = (window.localStorage && window.localStorage.getItem('defaultPhone')) || '';

        this.bindEvents({ selector: '[name="custom"]' });
        this.bindEvents({ selector: '[name="cml"]' });
        this.bindEvents({ selector: '[name="cmn"]' });
        this.bindEvents({ selector: '[name="chat"]' });
        this.bindEvents({ selector: '[name="watson"]' });
        this.bindEvents({ selector: '[name="phone"]', link: phoneNumber });

        this.component.find('.acquisition-dropdown>input[type="checkbox"]').change(function() {
            let chevron = $(this).siblings('.btn-select').find('.dtv-public-icon-down');

            if ($(this).is(':checked')) {
                chevron.css('transform', 'rotate(180deg)');
            } else {
                chevron.removeAttr('style');
            }
        });

        $(document).on('click scroll', function(e) {
            if (!$(e.target).hasClass('dd-comp') && $(".dd-input").is(':checked')) {
                that.component.find('.acquisition-dropdown>input[type="checkbox"]').prop('checked', false).trigger("change");
            }
        });
    }

    bindEvents(properties) {
        const element = this.component.find(properties.selector);
        const ddLink = properties.link ? properties.link : element.data('link');

        if (element.length > 0) {
            switch (properties.selector) {
                case '[name="cml"]':
                    this.getCall(element, this.callToAction.cml);
                    this.getCall(element, this.openCallMeLater);
                    break;
                case '[name="cmn"]':
                    this.getCall(element, this.callToAction.cmn);
                    this.getCall(element, this.openCallMeNow);
                    break;
                case '[name="chat"]':
                    this.getCall(element, this.openChat.bind(this));
                    break;
                case '[name="watson"]':
                    this.getCall(element, this.openWatson.bind(this));
                    break;
                case '[name="phone"]':
                    this.openPhone(element, ddLink);
                    break;
                default:
                    element.each((i, v) => {
                        const component = $(v);
                        component.on('click', (event) => {
                            event.preventDefault();
                            window.open(component.data('link'), component.data('target'));
                        });
                    });
                    break;
            }
        }
    }

    getCall(element, call) {
        element.on('click', () => {
            call();
        });
    }

    openCallMeLater() {
        const $callmelaterModal = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER_MODAL);
        const $callmelater = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER);
        const $alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

        if ($callmelaterModal) {
            $callmelaterModal.openModal();
            $callmelater.eventEmitter.subscribe((info) => {
                if (info.event === 'callme-later-submit' && $alertComponent) {
                    $alertComponent.setTitle($callmelater.successTitle);
                    $alertComponent.setDescription($callmelater.successDescription);
                    $alertComponent.setStatus('success');
                    $alertComponent.showAlert();
                    $callmelaterModal.closeModal();
                }

                if (info.event === 'callme-later-submit-error' && $alertComponent) {
                    $alertComponent.setTitle($callmelater.errorTitle);
                    $alertComponent.setDescription($callmelater.errorDescription);
                    $alertComponent.setStatus('error');
                    $alertComponent.showAlert();
                }
            });
        }
    }

    openCallMeNow() {
        const $callmenow = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMENOW);
        const $alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

        if ($callmenow) {
            $callmenow.openModal();
            $callmenow.eventEmitter.subscribe((info) => {

                if (info.event === 'callmenow-submit' && $alertComponent) {
                    $callmenow.closeModal();
                    $alertComponent.setTitle($callmenow.successTitle);
                    $alertComponent.setDescription($callmenow.successDescription);
                    $alertComponent.setStatus('success');
                    $alertComponent.showAlert();
                }

                if (info.event === 'callmenow-submit-error' && $alertComponent) {
                    $alertComponent.setTitle($callmenow.errorTitle);
                    $alertComponent.setDescription($callmenow.errorDescription);
                    $alertComponent.setStatus('error');
                    $alertComponent.showAlert();
                }
            });
        }
    }

    openChat() {
        const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
        const chat_url = '/prev-chat.html' + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
        window.open(chat_url, "Chat", "width=450,height=450");
    }

    openWatson() {
        const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
        if ($('.watson-container').length > 0) {
            console.log('asda');

            $('.watson-container').removeClass('hidden');
            $('.watson-container .chat .card').removeClass('no-display');
            setTimeout(function() {
                $('.dd-input').attr('checked', false);
                $('.dtv-public-icon-down.icon').removeAttr('style');
            });

        }
    }

    openPhone(element, phone) {
        element[0].setAttribute('href', `tel:${phone}`);
        element.find('span').html(phone);
    }
}
const throwEvent = Symbol('throwEvent');

class WizardHeaderComponent {
    constructor(element, path, buttonTexts, headerType) {
        this.path = path;
        this.buttonTexts = buttonTexts;
        this.eventEmitter = new rxjs.Subject();
        this.component = element;
        this.price = 0;
        this.updateStickyState(false);
        this.currentStep = 0;
        this.finished = false;
        this.headerType = headerType;
        this.headerLoginData = HeaderLoginData;
        this.initComponent();

        if (this.path) {
            this.getData();
        }
    }

    initComponent() {
        const el = this;

        if (this.headerType === "plan") {
            let stepIndicator = null;
            const resumeOverlayLink = $('.order-resume-show');
            const resumeOverlay = $('.orderresume-wrapper');
            const wizresumeOverlay = $('#wizard-order-resume');

            this.component.addClass('header-wizard');
            this.buttonContinue = this.component.find('.directv-ui-button').buttonComponent();
            this.buttonContinue.click((event) => {
                if (this.buttonContinue.hasClass('disabled')) {
                    return;
                }

                if (this.currentStep < 3) {
                    this.currentStep = stepIndicator.getCurrentStep();

                    if (this.currentStep === 2) {
                        el[throwEvent]('header-step', 3);
                        this.component.addClass('finished-step');
                        this.buttonContinue.setText(el.buttonTexts.textFinished);
                        this.currentStep = 3;
                        this.component.trigger("sticky_kit:detach");
                        el.documentScrollTop();
                        el.updateStickyPosition();
                    } else {
                        this.currentStep++;
                        stepIndicator.setCurrentStep(this.currentStep);
                    }
                } else {
                    document.location.href = '/';
                }
            });

            stepIndicator = this.component.find('.directv-ui-stepindicator').stepIndicatorComponent();
            stepIndicator.on('stepClick', function (event, currentIndex) {
                this.buttonContinue.setText(currentIndex === 2 ? this.buttonContinue.setText(el.buttonTexts.textFinish) : this.buttonContinue.setText(el.buttonTexts.textNext));
                el.documentScrollTop();

                if (currentIndex === 1) {
                    this.buttonContinue.setEnabled(true);
                } else if (this.finished === false) {
                    this.buttonContinue.setEnabled(false);
                }

                if (currentIndex === 2) {
                    stepIndicator.removeClass('step-one');
                    stepIndicator.addClass('step-two');
                } else {
                    stepIndicator.removeClass('step-two');
                    stepIndicator.addClass('step-one');
                }

                el[throwEvent]('header-step', currentIndex);
            }.bind(this));

            window.addEventListener("orientationchange", function () {
                el.documentScrollTop();
            }, false);

            resumeOverlayLink.click((event) => {
                wizresumeOverlay.css({
                    "position": "fixed",
                    "z-index": "1001"
                });
                resumeOverlay.css('position', 'fixed');
                resumeOverlay.animate({ scrollTop: 0 }, "slow");
                showTab(0);
                wizresumeOverlay.show();
                resumeOverlay.show();
            });
        } else {
            const additionalButton = this.component.find('.additional-button');

            if(additionalButton.find('.button').length === 0){
                additionalButton.hide();
            }

            if(this.headerLoginData.isLoggedIn()){
                additionalButton.hide();
            }
            this.component.addClass('header-premium');
        }
    }

    getData() {
        GlobalData.getData({ path: this.path }).subscribe(
            (result) => {
                this.fillData(result[0]);
            }
        );
    }

    fillData(data) {
        const pathImagesType = "/content/dam/public-sites/plans/images";
        const imgPrepaid = "/prepago";
        const imgPostpaid = "/postpago";
        const fileExt = '.png';
        const imgStructure = {
            prepaid: {
                images: {
                    src: `${pathImagesType}${imgPrepaid}${fileExt}`
                }
            },
            postpaid: {
                images: {
                    src: `${pathImagesType}${imgPostpaid}${fileExt}`
                }
            }
        };

        this.price = data.price;
        this.formattedPrice = data.formattedPrice;
        this.headerBadge = this.component.find('.header-badge');
        this.headerTitle = this.component.find('.header-title');

        if (this.headerType === "plan") {
            if (data.type) {
                const imageSrc = imgStructure[data.type].images.src;
                const imageSrcset = imgStructure[data.type].images.srcSet;

                this.headerBadge.attr("src", imageSrc);
                this.headerBadge.attr("srcset", imageSrcset);
                this.component.find('.value-price').html(`${GlobalSettings.general.currency} ${this.formattedPrice}`);
                this.component.find('.value-offer').html(data.offer);
                this.headerTitle.html(data.title);
            }
        } else {
            const postpaid = !!data.postref && !!data.postref.infoPacks[0];
            const prepaid = !!data.preref && !!data.preref.infoPacks[0];

            this.component.find('.value-divider').toggleClass('hideElement', !(postpaid && prepaid));
            this.component.find('.value-postpaid').toggleClass('hideElement', !postpaid);
            this.component.find('.value-prepaid').toggleClass('hideElement', !prepaid);

            this.component.find(`.header-badge.postpaid`).removeAttr("src");
            this.component.find(`.header-badge.prepaid`).removeAttr("src");

            if (postpaid) {
                this.component.find('.value-postpaid .plan-type').text(data.postref.infoPacks[0].label);
                this.setReference(data.postref);
            }

            if (prepaid) {
                this.component.find('.value-prepaid .plan-type').text(data.preref.infoPacks[0].label);
                this.setReference(data.preref);
            }

            this.headerTitle.html(data.name);
        }

        this.component.find('.btn.primary').click(() => {
            document.location.href = data.subscribe;
        });

        this.component.find('.button-items\x20.button-item.chat').click(() => {
            document.location.href = data.calls.find((call) => call.name = "Chat").url;
        });

        this.component.find('.button-items\x20.button-item.call').click(() => {
            document.location.href = data.calls.find((call) => call.name = "Llama").url;
        });

        $(document.body).trigger("sticky_kit:recalc");
        this.eventEmitter.next({
            event: 'component-updated'
        });
    }

    setReference(pack) {
        const planPrice = pack.infoPacks[0].formattedPrice;
        const planType = pack.infoPacks[0].types[0];

        this.component.find(`.header-badge.${planType}`).attr("src", pack.infoPacks[0].badgetDark);
        this.component.find(`.value-${planType}\x20.value-price`).html(`${GlobalSettings.general.currency}${planPrice.toString().replace(/(\d{1})(\d{3})/, '$1.$2')}`);
        this.component.find(`.value-${planType}\x20.value-offer`).html(pack.infoPacks[0].offershort);
    }

    setAcquisitionDrop(data) {
        data.landing = true;
        data.level = 2;

        new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data);
    }

    getPrice() {
        return this.price;
    }

    addCost(price) {
        this.price += price;
        this.component.find('.value-price').html(`${GlobalSettings.general.currency}\x20${this.price}`);
    }

    substractCost(price) {
        if (this.price > 0) {
            this.price -= price;
            this.component.find('.value-price').html(`${GlobalSettings.general.currency}\x20${this.price}`);
        }
    }

    setPrice(price) {
        this.component.find('.value-price').html(`${GlobalSettings.general.currency}\x20${price}`);
    }

    setButtonContinueEnabled(canContinue) {
        this.buttonContinue.setEnabled(canContinue);
        this.finished = canContinue;
    }

    setHeaderType(type) {
        if (this.headerType !== type) {
            this.headerType = type;
            this.initComponent();
        }
    }

    /* To do: remove this method when data structure is defined */

    setHeaderBundleName(name) {
        this.component.find('.header-title').html(name);
    }

    [throwEvent](event, data) {
        this.eventEmitter.next({
            event: event,
            data: data
        });
    }

    documentScrollTop() {
        // Safari
        ["body", "html"].forEach((element) => {
            $(element).animate({ scrollTop: 0 }, 150, () => {
                setTimeout(() => {
                    if ($('.sticky-separator').outerHeight() !== this.component.outerHeight()) {
                        this.updateStickyPosition(() => {
                            this.updateStickyState(false);
                        });
                    }
                }, 100);
            });
        });
    }

    updateStickyPosition(callback) {
        if (callback) {
            callback();
        }
    }

    updateStickyState(sticky) {
        this.stickyApplied = sticky;
    }
}

const wizardheadercomponents = $('.wizard-header');
wizardheadercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');
    const headerType = component.data('headertype');

    const buttonTexts = {
        textNext: component.data('textnext'),
        textFinish: component.data('textfinish'),
        textFinished: component.data('textfinished'),
        wordDays: component.data('worddays'),
        wordMonth: component.data('wordmonth')
    };
    const wizardHeaderComponent = new WizardHeaderComponent($('#' + id), path, buttonTexts, headerType === "" ? 'plan' : headerType);
    GeneralComponentContainer.setComponent(wizardHeaderComponent, id);
});
const HEADEROPTION = "[name='./hoption']";

const HEADERPREMIUM = "[name='./hprpack']";

const HEADERPLAN = "[name='./hplan']";

const HEADERVALUE ="[name='./dataselected']";

function hgetOptionWiz(optionSelect) {
    $(HEADERPLAN).attr('hidden', !(optionSelect==='plan'));
    $(HEADERPREMIUM).attr('hidden', !(optionSelect==='prpackage'));

    $(HEADERPLAN).parent().find('label').attr('hidden', !(optionSelect==='plan'));
    $(HEADERPREMIUM).parent().find('label').attr('hidden', !(optionSelect==='prpackage'));
}

$(document).on("foundation-contentloaded", function () {
    $(HEADEROPTION).change((element)=>{
        hgetOptionWiz($(element.target).val());
    });

    $(`${HEADERPREMIUM},\x20${HEADERPLAN}`).off().on('change', (selected)=>{
        $(HEADERVALUE).val($(selected.target).val());
    });

    $(HEADERVALUE).attr('hidden', true);

    hgetOptionWiz($(HEADEROPTION).val());
});


/* ----------------------------------------------------------------------
*
* Usage:
*   <script src="isaac.js"></script>
*   var random_number = isaac.random();
*
* Output: [ 0x00000000; 0xffffffff]
*         [-2147483648; 2147483647]
*
*/


/* js string (ucs-2/utf16) to a 32-bit integer (utf-8 chars, little-endian) array */
String.prototype.toIntArray = function() {
    var w1, w2, u, r4 = [], r = [], i = 0;
    var s = this + '\0\0\0'; // pad string to avoid discarding last chars
    var l = s.length - 1;
   
    while(i < l) {
      w1 = s.charCodeAt(i++);
      w2 = s.charCodeAt(i+1);
      if       (w1 < 0x0080) {
        // 0x0000 - 0x007f code point: basic ascii
        r4.push(w1);
      } else if(w1 < 0x0800) {
        // 0x0080 - 0x07ff code point
        r4.push(((w1 >>>  6) & 0x1f) | 0xc0);
        r4.push(((w1 >>>  0) & 0x3f) | 0x80);
      } else if((w1 & 0xf800) != 0xd800) {
        // 0x0800 - 0xd7ff / 0xe000 - 0xffff code point
        r4.push(((w1 >>> 12) & 0x0f) | 0xe0);
        r4.push(((w1 >>>  6) & 0x3f) | 0x80);
        r4.push(((w1 >>>  0) & 0x3f) | 0x80);
      } else if(((w1 & 0xfc00) == 0xd800)
             && ((w2 & 0xfc00) == 0xdc00)) {
        // 0xd800 - 0xdfff surrogate / 0x10ffff - 0x10000 code point
        u = ((w2 & 0x3f) | ((w1 & 0x3f) << 10)) + 0x10000;
        r4.push(((u >>> 18) & 0x07) | 0xf0);
        r4.push(((u >>> 12) & 0x3f) | 0x80);
        r4.push(((u >>>  6) & 0x3f) | 0x80);
        r4.push(((u >>>  0) & 0x3f) | 0x80);
        i++;
      } else {
        // invalid char
      }
      /* add integer (four utf-8 value) to array */
      if(r4.length > 3) {
        // little endian
        r.push((r4.shift() <<  0) | (r4.shift() <<  8) |
               (r4.shift() << 16) | (r4.shift() << 24));
      }
    }
   
    return r;
   }
   
   /* isaac module pattern */
   var isaac = (function(){
   
    /* private: internal states */
    var m = Array(256), // internal memory
        acc = 0,        // accumulator
        brs = 0,        // last result
        cnt = 0,        // counter
        r = Array(256), // result array
        gnt = 0;        // generation counter
   
    seed(Math.random() * 0xffffffff);
   
    /* private: 32-bit integer safe adder */
    function add(x, y) {
      var lsb = (x & 0xffff) + (y & 0xffff);
      var msb = (x >>>   16) + (y >>>   16) + (lsb >>> 16);
      return (msb << 16) | (lsb & 0xffff);
    }
   
    /* public: initialisation */
    function reset() {
      acc = brs = cnt = 0;
      for(var i = 0; i < 256; ++i)
        m[i] = r[i] = 0;
      gnt = 0;
    }
   
    /* public: seeding function */
    function seed(s) {
      var a, b, c, d, e, f, g, h, i;
   
      /* seeding the seeds of love */
      a = b = c = d =
      e = f = g = h = 0x9e3779b9; /* the golden ratio */
   
      if(s && typeof(s) === 'string')
        s = s.toIntArray();
   
      if(s && typeof(s) === 'number') {
        s = [s];
      }
   
      if(s instanceof Array) {
        reset();
        for(i = 0; i < s.length; i++)
          r[i & 0xff] += (typeof(s[i]) === 'number') ? s[i] : 0;
      }
   
      /* private: seed mixer */
      function seed_mix() {
        a ^= b <<  11; d = add(d, a); b = add(b, c);
        b ^= c >>>  2; e = add(e, b); c = add(c, d);
        c ^= d <<   8; f = add(f, c); d = add(d, e);
        d ^= e >>> 16; g = add(g, d); e = add(e, f);
        e ^= f <<  10; h = add(h, e); f = add(f, g);
        f ^= g >>>  4; a = add(a, f); g = add(g, h);
        g ^= h <<   8; b = add(b, g); h = add(h, a);
        h ^= a >>>  9; c = add(c, h); a = add(a, b);
      }
   
      for(i = 0; i < 4; i++) /* scramble it */
        seed_mix();
   
      for(i = 0; i < 256; i += 8) {
        if(s) { /* use all the information in the seed */
          a = add(a, r[i + 0]); b = add(b, r[i + 1]);
          c = add(c, r[i + 2]); d = add(d, r[i + 3]);
          e = add(e, r[i + 4]); f = add(f, r[i + 5]);
          g = add(g, r[i + 6]); h = add(h, r[i + 7]);
        }
        seed_mix();
        /* fill in m[] with messy stuff */
        m[i + 0] = a; m[i + 1] = b; m[i + 2] = c; m[i + 3] = d;
        m[i + 4] = e; m[i + 5] = f; m[i + 6] = g; m[i + 7] = h;
      }
      if(s) {
        /* do a second pass to make all of the seed affect all of m[] */
        for(i = 0; i < 256; i += 8) {
          a = add(a, m[i + 0]); b = add(b, m[i + 1]);
          c = add(c, m[i + 2]); d = add(d, m[i + 3]);
          e = add(e, m[i + 4]); f = add(f, m[i + 5]);
          g = add(g, m[i + 6]); h = add(h, m[i + 7]);
          seed_mix();
          /* fill in m[] with messy stuff (again) */
          m[i + 0] = a; m[i + 1] = b; m[i + 2] = c; m[i + 3] = d;
          m[i + 4] = e; m[i + 5] = f; m[i + 6] = g; m[i + 7] = h;
        }
      }
   
      prng(); /* fill in the first set of results */
      gnt = 256;  /* prepare to use the first set of results */;
    }
   
    /* public: isaac generator, n = number of run */
    function prng(n){
      var i, x, y;
   
      n = (n && typeof(n) === 'number')
        ? Math.abs(Math.floor(n)) : 1;
   
      while(n--) {
        cnt = add(cnt,   1);
        brs = add(brs, cnt);
   
        for(i = 0; i < 256; i++) {
          switch(i & 3) {
            case 0: acc ^= acc <<  13; break;
            case 1: acc ^= acc >>>  6; break;
            case 2: acc ^= acc <<   2; break;
            case 3: acc ^= acc >>> 16; break;
          }
          acc        = add(m[(i +  128) & 0xff], acc); x = m[i];
          m[i] =   y = add(m[(x >>>  2) & 0xff], add(acc, brs));
          r[i] = brs = add(m[(y >>> 10) & 0xff], x);
        }
      }
    }
   
    /* public: return a random number between */
    function rand() {
      if(!gnt--) {
        prng(); gnt = 255;
      }
      return r[gnt];
    }
   
    /* public: return internals in an object*/
    function internals(){
      return {a: acc, b: brs, c: cnt, m: m, r: r};
    }
   
    /* return class object */
    return {
      'reset': reset,
      'seed':  seed,
      'prng':  prng,
      'rand':  rand,
      'internals': internals
    };
   })(); /* declare and execute */
   
   /* public: output*/
   isaac.random = function() {
    return 0.5 + this.rand() * 2.3283064365386963e-10; // 2^-32
   }
const WatsonComponent = (function () {

    const defaults = {
        "selectors": {
            "imClient": ".are-you-client .yes-no button:first-child",
            "imNotClient": ".are-you-client .yes-no button:last-child",

            "preConversation": ".card-body.pre-conversation",
            "conversation": ".card-body.msg_card_body",
            "inputContainer": ".card-footer .input",
            "closeButton": ".user-info span",
            "chat": ".card",
            "initialTime": ".time"
        },
        "classes": {
            "disabled": "disabled",
            "conversation": "conversation",
            "noShow": "no-display"
        },
        "events": {
            "click": "click",
            "scroll": "scroll"
        }
    };

    return class {

        constructor(element, chatUrl, websocket, extraparam, apk, welcome, image, buttonId, startWord) {

            this.element = element;
            this.chatUrl = chatUrl;
            this.websocket = websocket;
            this.extraparam = extraparam;
            this.socketConnection = false;
            this.avatar = image;
            this.token = apk;
            this.showWelcome = welcome;
            this.buttonId = buttonId;
            this.startWord = startWord || 'hola';
            this.closeEndFunctions = [];

            this.uniqueId = this.checkDecimals(isaac.random());

            this.initComponent();
        }

        checkDecimals(number) {
            let n = number.toString().split('.');
            let multiple = 1;
            for (let i = 0; i < n[1].length; i++) {
                multiple = multiple * 10;
            }
            let converted = (number * multiple).toString() + this.element.id;
            return converted;
        }

        initComponent() {
            if (this.showWelcome) {
                this.clientButton = this.element.querySelector(defaults.selectors.imClient);
                this.noClientButton = this.element.querySelector(defaults.selectors.imNotClient);
            }

            this.preConversation = this.element.querySelector(defaults.selectors.preConversation);
            this.conversation = this.element.querySelector(defaults.selectors.conversation);
            this.inputParent = this.element.querySelector(defaults.selectors.inputContainer);
            this.closeButton = this.element.querySelector(defaults.selectors.closeButton);
            this.chat = this.element.querySelector(defaults.selectors.chat);
            this.time = this.element.querySelector(defaults.selectors.initialTime);

            this.bindEvents();
        }



        bindEvents() {
            this.time.innerHTML = this.getTime();
            this.closeButton.onclick = this.closeChat.bind(this);
            if (this.showWelcome) {
                this.clientButton.onclick = this.openWatsonConnection.bind(this);
                if (this.buttonId) {
                    this.closeWatson(this.buttonId);
                } else {
                    this.noClientButton.onclick = this.openLivePerson.bind(this);
                }
                //                
            } else {
                this.openWatsonConnection(event);
            }

        }

        closeWatson(buttonId) {
            var lpButton2 = buttonId;

            function ensureInit(divId, callback) {
                let el = document.getElementById(divId);
                if (el && el !== null) {
                    useDiv(divId, callback);
                }
            }

            function useDiv(divId, callback) {
                if (!document.getElementById(divId).children.length > 0) {
                    setTimeout(function () {
                        ensureInit(divId, callback);

                    }, 50);
                } else {
                    document.getElementById(divId).classList.remove('disabled');
                    if (callback) {
                        callback();
                    }
                }
            }
            callEnsureInit(lpButton2);

            function callEnsureInit(divId) {
                ensureInit(divId, function () {
                    //                    document.getElementById(divId).style.display = "block";


                });


            }
        }

        openWatsonConnection(event) {
            if (this.extraparam && this.extraparam != "") {
                this.socket = io(this.websocket, { path: this.extraparam, withCredentials: true });
            } else {
                this.socket = io(this.websocket, { withCredentials: true });
            }
            this.sendToWS(this.startWord);
            this.socketHandler();
        }

        openLivePerson(event) {
            event.preventDefault();
            this.noShowChat();
            const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
            const chat_url = this.chatUrl + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
            window.open(chat_url, "Chat", "width=450,height=450");
        }

        closeChat(event) {
            this.noShowChat();
            if (this.socketConnection) {
                if (window.location.href.indexOf('ayuda') > -1 || window.location.href.indexOf('help') > -1) {
                    this.socket.emit('conversationClosed', { text: 'Adios', pais: cdsCountry.toUpperCase(), id: this.uniqueId });
                } else {
                    this.socket.emit('conversationClosed', { text: 'Adios', pais: countryPS.toUpperCase(), id: this.uniqueId });
                }
                this.socketConnection = false;

                //            this.toggleClasses();
                //            $('.card-footer .input input').attr('disabled', true);
            }

            if (this.closeEndFunctions.length > 0) {
                this.closeEndFunctions.forEach(func => func.call(event));
            }
        }

        noShowChat() {
            this.chat.classList.add(defaults.classes.noShow);
        }

        toggleClasses() {
            this.preConversation.classList.add(defaults.classes.conversation);
            this.conversation.classList.add(defaults.classes.conversation);
            this.inputParent.classList.remove(defaults.classes.disabled);
        }

        socketHandler() {

            this.socket.on('connect', () => {

                this.socketConnection = true;

                this.toggleClasses();
                $('.card-footer .input .input-group-append span img').remove();
                let el = '<img src="/content/dam/public-sites/watson/icono.svg">';
                $('.card-footer .input .input-group-append span').append(el);
                $('.card-footer .input input').removeAttr('disabled');

                let $this = this;
                this.scroll();

                $('.button-watson-chat').click(function () {
                    let text = $('.card-footer .input input').val();
                    $('.card-footer .input input').val('');
                    $this.printUserMsg(text);
                    $this.sendToWS(text);
                });
            });

            let input = document.getElementById("usr_input");

            input.addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    $('.button-watson-chat').click();
                }
            });

            this.socket.on("connected", (data) => {
                if (data.id) {
                    this.uniqueId = data.id
                }
            });

            this.socket.on('message', data => {
                if (data.id == null || data.id == 'undefined' || data.id == this.uniqueId) {
                    if (JSON.stringify(data).indexOf('{') > -1) {
                        data = this.realData(data);
                    }
                    this.printServerMsg(data);
                }
            });


            this.socket.on('greetings', (elem1, elem2, elem3) => { });
        }

        realData(json) {
            return json.text;
        }

        scroll() {
            let objDiv = this.conversation;
            $(objDiv).animate({
                scrollTop: objDiv.scrollHeight
            }, 800);
        }

        sendToWS(text) {
            if (text && text != "") {
                if (!text.replace(/\s/g, '').length) {
                    console.log('string only contains whitespace (ie. spaces, tabs or line breaks)');
                } else {
                    if (window.location.href.indexOf('ayuda') > -1 || window.location.href.indexOf('help') > -1) {
                        this.socket.emit('message', { text: text, pais: cdsCountry.toUpperCase(), id: this.uniqueId });
                    } else {
                        this.socket.emit('message', { text: text, pais: countryPS.toUpperCase(), id: this.uniqueId });
                    }
                }
            }
        }

        printServerMsg(message) {
            if (message && message.indexOf('conversationClosed') <= -1) {
                const $chatContainer = $('#divChat'),
                    msgContainer = `
                        <div class="are-you-client">
                            <div class="avatar">
                                <img src="${this.avatar}" alt="">
                            </div>
                        </div>`;
                message = this.injectLinkView(message, $chatContainer, msgContainer);

                const $msgContainer = $(msgContainer).append(`
                    <div class="question">
                        <span>${message.replace(/(\r\n|\n|\r)/gm, '<br />')}</span>
                        <span class="time">${this.getTime()}</span>
                    </div>
                `);

                $chatContainer.append($msgContainer);
            }
            this.scroll();
        }

        /**
         * Inject async link view from URL and generate redirect target blank.
         * @param {String} msgText Complete text to validate and inject.
         * @param {jQuery} $chatContainer Object jQuery with container chat.
         * @param {String} msgContainer Html string with message container.
         * @returns ***String*** with message to indications.
         */
        injectLinkView(msgText, $chatContainer, msgContainer) {
            if (typeof msgText !== 'string' || msgText.length < 1) return msgText;

            const regexWatsonLink = new RegExp(/%%(\w+)%%(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)?)%%/gim),
                groups = [...msgText.matchAll(regexWatsonLink)][0];
            if (!groups || groups.length < 3) return msgText;

            msgText = msgText.replace(new RegExp(groups[0], 'g'), '');
            const $msgContainer = $(msgContainer).append(`
                <a class="link-view" href="#">    
                    <div class="linkview question">
                        <div class="img-wrapper">
                            <div class="skeleton-box" style="width:100%;height:157px;">&nbsp;</div>
                            <img class="linkview-img hide" alt="" decoding="async">
                        </div>
                        <div class="container-text">
                            <div class="title">
                                <div class="skeleton-box" style="width:70%;">&nbsp;</div>
                            </div>
                            <div class="description">
                                <div class="skeleton-box" style="width:85%;">&nbsp;</div>
                                <div class="skeleton-box" style="width:75%;">&nbsp;</div>
                            </div>
                        </div>
                        <div class="msg-footer">
                            <div class="domain">
                                <div class="skeleton-box" style="width:70px;">&nbsp;</div>
                            </div>
                            <span class="time">${this.getTime()}</span>
                        </div>
                    </div>
                </a>`);

            $chatContainer.append($msgContainer);
            fetch(`/bin/public-sites/utils/getmetadataog?url=${encodeURIComponent(groups[2])}`).then(res => {
                if (res.ok) {
                    res.json().then(metadataOg => {
                        if (metadataOg && metadataOg.status == 200) {
                            $msgContainer.find('.skeleton-box').hide();
                            $msgContainer.find('.linkview-img').removeClass('hide').attr('src', metadataOg.image);
                            $msgContainer.find('.container-text .title').text(metadataOg.title);
                            $msgContainer.find('.container-text .description').text(metadataOg.description);
                            $msgContainer.find('.link-view').attr('href', metadataOg.url).attr('target', '_blank');
                            const uri = document.createElement('a');
                            uri.href = metadataOg.url;
                            $msgContainer.find('.msg-footer .domain').text(uri.hostname);
                        } else {
                            console.error('NO DATA.', metadataOg.message);
                            $msgContainer.remove();
                        }
                    });
                }
            });

            return msgText;
        }

        printUserMsg(message) {
            if (message) {
                if (!message.replace(/\s/g, '').length) {
                    console.log('string only contains whitespace (ie. spaces, tabs or line breaks)');
                } else {
                    let el = $('#divChat');
                    let msg = '<div class="client">' +
                        '<div class="answer">' +
                        '<span>' +
                        message +
                        '</span>' +
                        '<span class="time">' +
                        this.getTime() +
                        '</span>' +
                        '</div>' +
                        '</div>';
                    $(el).append(msg);
                }
            }
            this.scroll();
        }

        getTime() {
            let time = new Date();
            let timeFormatted;
            if (time.getMinutes() < 10) {
                timeFormatted = time.getHours() + ':0' + time.getMinutes();
            } else {
                timeFormatted = time.getHours() + ':' + time.getMinutes();
            }

            //            this.test();
            return timeFormatted;
        }

        closeCallbackAdd(func) {
            if (typeof func === 'function') {
                this.closeEndFunctions.push(func);
            }
        }
    };



})();

$('.watson-chat-container').each(function () {
    const id = $(this).attr('id'),
        chatpath = $(this).data('liveperson'),
        websocket = $(this).data('ws'),
        extraparam = $(this).data('extraparam'),
        apk = $(this).data('desa'),
        chatUrl = '/prev-chat.html',
        element = document.getElementById(id),
        image = $(this).data('watsonimage'),
        buttonId = $(this).data('buttonid');

    let welcome = false;
    if ($('.yes-no').length > 0) {
        welcome = true;
    }

    $('.watson-button').click(function () {
        const component = new WatsonComponent(element, chatUrl, websocket, extraparam, apk, welcome, image, buttonId);
        //    console.log(element);
        //    const component = new WatsonComponent(element)
    });

    if ($(this).parent().hasClass('cmp-watson--fullscreen')) {
        const urlParams = new URLSearchParams(window.location.search);
        const startWord = urlParams.has('word') ? urlParams.get('word') : null;
        const component = new WatsonComponent(element, chatUrl, websocket, extraparam, apk, welcome, image, buttonId, startWord);
    }
});
class TvPlanSolidFielCardComponent {
    constructor(id, properties, i18nData, locale) {
        this.id = id;
        this.properties = properties;
        this.i18nData = i18nData;
        this.locale = locale;

        this.component = $('#' + this.id);

        this.initComponent();
    }

    initComponent() {
        this.getData();
    }

    getData() {
        GlobalData.getMultipleData([
            { ...GlobalData.defaults.requestData.PLANS, ...{ params: { type: 'prepaid' } } },
            { ...GlobalData.defaults.requestData.PLANS, ...{ params: { type: 'postpaid' } } },
            GlobalData.defaults.requestData.SETTINGS
        ]).subscribe((data) => {
            try {
                this.fillData(data[0], data[1], data[2]);
            } catch (error) {
                GeneralComponentContainer.setErrorAlert(error);
            }
        });
    }

    fillData(prepaid, pospaid, settings) {
        const urlRedirect = settings.postpaid.plpLink;

        this.component.find('.icons-container').append(`<img src="${this.properties.icon}" alt="">`);
        this.component.find('.title').html(`<a target="_self" class="ant-action ant-link ant-value" href="${urlRedirect}">${this.i18nData.tvplans}<i class="chevron"></i></a>`);

        const plansData = [];
        const propertiesNames = {
            postpaid: {
                title: 'pospaidtitle',
                description: 'pospaid',
                i18n: 'pospaidplans'
            },
            prepaid: {
                title: 'prepaidtitle',
                description: 'prepaid',
                i18n: 'prepaidplans'
            }
        };
        const planTypeList = [
            { type: DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.POSTPAID, data: pospaid },
            { type: DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID, data: prepaid }
        ];

        planTypeList.forEach((planType) => {
            if (planType.data.length > 0) {
                let planTypeProps = propertiesNames[planType.type];
                let data = {
                    title: this.properties[planTypeProps.title] !== '' ? this.properties[planTypeProps.title] : this.i18nData[planTypeProps.i18n],
                    description: this.properties[planTypeProps.description],
                    urlredirect: `${urlRedirect}#${DIRECTV_PUBLIC_SITES_CONSTANTS.PLAN_NAMES[countryPS][planType.type]}`
                }

                plansData.push({ cardData: data, planData: planType.data });
            }
        });

        this.fillPlans(plansData);
    }

    fillPlans(plansData) {
        const planTemplate =
            `<div class="feature-container ant-level2">
            <div class="title"> 
                <a target="_self" class="ant-action ant-link ant-value" href="{{data.urlredirect}}">{{data.title}}<i class="chevron"></i></a>
            </div>
            <div class="description">{{data.description}}</div>
            <ul class="links">
                {{#each plans}}
                    <li>
                        <a target="_self" class="ant-action ant-link ant-value ant-level3 {{#ternary offer 'ant-offer' ''}}{{/ternary}}" href="{{moreInfo}}">
                            {{name}}
                            <i class="chevron"></i>
                            {{#ifCond offer '!==' ''}}
                                <span class="badge ant-offer">{{../../offerBadge}}</span>
                            {{/ifCond}}
                        </a>
                    </li>
                {{/each}}
            </ul>
        </div>`;

        const planCompiledTemplate = Handlebars.compile(planTemplate);

        plansData.forEach((plans) => {

            let plansBase = plans.planData
            .filter((item) => (item.hasOwnProperty('hidden') ? item.hidden === false : true) &&
            (item.hasOwnProperty('showOnlyCalculator') ? item.showOnlyCalculator === false : true));

            let planHtml = planCompiledTemplate({
                data: plans.cardData,
                plans: plansBase,
                offerBadge: this.i18nData.offerBadge.toUpperCase()
            });

            this.component.find('.plans-container').append(planHtml);
        });
    }

    cleanComponent() {
        this.component.find('.icons-container').html("");
        this.component.find('.title').html("");
        this.component.find('.plans-container').html("");
    }
}

const tvplanssolidfieldcomponents = $('.tv-plans-solid-field-card-container');
tvplanssolidfieldcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');

    const properties = {
        icon: component.data('icon'),
        pospaidtitle: component.data('pospaidtitle'),
        pospaid: component.data('pospaid'),
        prepaidtitle: component.data('prepaidtitle'),
        prepaid: component.data('prepaid')
    }
    const i18nData = {
        tvplans: component.data('tvplans'),
        pospaidplans: component.data('pospaidplans'),
        prepaidplans: component.data('prepaidplans'),
        offerBadge: component.data('offerbadge')
    }
    const locale = component.data('locale');
    new TvPlanSolidFielCardComponent(id, properties, i18nData, locale);
});
const tvcontentsectioncomponents = $('.tv-content-section-container');
tvcontentsectioncomponents.each((index, element) => {
    const component = $(element);
    component.find('.modal-link').on('click', (event) => {
        const modalId = event.currentTarget.id;
        const modalComponent = GeneralComponentContainer.getComponentByName(modalId);
        modalComponent.showModal(true);
    });
});

const triviaform = (function() {

	const messages = {
		'EMAIL'		: 'Escriba su email para poder notificarle si gana la trivia',
		'TERMINOS'	: 'Debe aceptar las bases y condiciones',
		'CAPTCHA' 	: 'Cdigo de validacin incorrecto'
	}

	return class {

		constructor(element, thankyoupage, data) {
			
			this.data = data;
			
			this.element = element;

			this.country = countryPS;

			this.questions = [];

			this.form = [];

			this.thankyoupage = thankyoupage;

			this.sendingForm = true;

			this.emailfield = document.querySelector('.trivia-container .emailuser');

			this.recaptcha  = this.element.querySelector('.recaptcha-field');

			this.initComponent();
		}

		initComponent() {
			let $this = this;

			this.questions = [
				{
					country: 'UY',
					questions: [{
						id: 1,
						text: " Cul es el nombre de los gemelos Scott?",
						type: "multiple_choice",
						answers: ["Jonathan y Drew Scott", "Oliver y Robert Scott", "Harry y John Scott", "Jack y Michael Scott"]
					},
					{
						id: 2,
						text: "Qu personaje de los Mini Beat Power Rockers toca la batera?",
						type: "multiple_choice",
						answers: ["Myo", "Carlos", "Wat", "Fuz"]
					},
					{
						id: 3,
						text: "Cmo se llama el Programa de Ed Stafford?",
						type: "multiple_choice",
						answers: ["Ed Stafford al extremo", "Ed Stafford vetrigo", "Ed Stafford adrenalina", "Ed Stafford al desnudo"]
					}]
				}
			];

			this.emailfield.addEventListener('keyup', function() {
				$this.validate(this);
			});

			this.displayQuestions();
		}

		displayQuestions() {
			let form = this.element.getElementsByClassName("questions-container")[0];
			this.questions.forEach(question => {
				if (question.country.toLowerCase() == this.country.toLowerCase()) {
					question.questions.forEach(item => {

						let q = document.createElement("div");
						q.innerHTML = item.text;
						q.classList.add("question-trivia");
						form.appendChild(q);

						let a = document.createElement("div");
						a.classList.add("answer-for-trivia");
						form.appendChild(a);

						this.createOptions(item, a);
					})
				}
			})
		}

		createOptions(q, parent) {
			var $this = this;
			q.answers.forEach(answer => {

				let input = '<div class="special-div-trivia"><input class="trivia-radio-button" type="radio" name="' + q.id + '" value="' + answer + '">' +
					'<label for="answer">' + answer + '</label></div>';
				$(parent).append(input);
			});

			$('input[type="radio"].trivia-radio-button').change(function(event) {
				$this.checkAndReplace(event);
			});
		}

		checkAndReplace(e) {			
			let id = e.currentTarget['name'];
			let val = e.currentTarget['value'];
			const $this = this;
			const index = this.form.findIndex(x => x['questionNumber'] == parseInt(id));
			if (index > -1) {
				this.form.splice(index, 1);
			}
			let question = {
				'questionNumber': parseInt(id),
				'answer': val
			}
			$this.form.push(question);

			if ($this.form.length == $('.question-trivia').length) {
				$('button.disabled').prop('disabled', false);
				$('button.disabled').removeClass('disabled');
				document.getElementById('triviaButton-' + $this.element.id).addEventListener('click', function() {				
					$this.sendForm();
				});
			}
		}

		getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return parts.pop().split(';').shift();
		}

		validateEmail(email) {
			const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			return re.test(email);
		}

		validate(str) {
			$('.fieldset .error').remove();
			const email = str.value;

			if (!this.validateEmail(email)) {
				$('.fieldset').append(`<p class="error error-email" style="color:red;font-size: 14px;">${messages.EMAIL}</p>`);
			}
		}

		validateToken(){
			$('.error-recaptcha').remove();
			if(!this.validateRecaptcha()) {
				$('.captcha-wrapper').append(`<p class="error error-recaptcha">${messages.CAPTCHA}</p>`);
			} 	
		}

		validateRecaptcha(){
			if(this.data.recaptchaEnabled && siteKey && this.recaptcha.value === 'false'){
				this.recaptcha.classList.add('validation-missing');
			}
			return ((this.data.recaptchaEnabled && this.recaptcha.value === 'true') || !this.data.recaptchaEnabled || !siteKey);
		}

		sendForm() {			
			var captchaRes;
			$('.error').remove();
			this.validateToken();

			if (!$('.input-for-byc-trivia input').prop('checked')) {
				$('.input-for-byc-trivia label').append(`<p class="error" style="color:red;font-size: 14px;">${messages.TERMINOS}</p>`);
				this.validate(this.emailfield);
			} else {
				if (!this.validateEmail(this.emailfield.value)) {
					$('.fieldset').append(`<p class="error error-email" style="color:red;font-size: 14px;">${messages.EMAIL}</p>`);
				} 
				else {
					if(!this.validateRecaptcha()) {
						this.validateToken();
					} 
					else {
						if(this.data.recaptchaEnabled){
							captchaRes = sessionStorage.getItem('captchaRes');
						} else {
							captchaRes = sessionStorage.setItem('captchaRes', "");
							captchaRes = '';
						}

						if (this.sendingForm) {
							this.sendingForm = false;
							$('button.disabled').prop('disabled', true);
							$('button.disabled').addClass('disabled');
							let trivia = {
								"triviaId": parseInt(this.element.id),
								"accountNumber": this.getCookie('SSONumber'),
								"internetUserName": this.emailfield.value,
								"answers": this.form,
								"captcha": this.data.recaptchaEnabled,
								"token": captchaRes,
								"pagePath": this.data.currentpage
							}
							return new Promise(() => {
								try {
									$.ajax({
										type: 'POST',
										url: '/bin/public-sites/mock/trivia',
										contentType: "application/json",
										data: JSON.stringify(trivia),
										success: (r) => {
											if (r.exito) {
												this.sendingForm = true;
												$('button.disabled').prop('disabled', true);
												$('button.disabled').removeClass('disabled');
												window.open(this.thankyoupage, '_self');
											}
											else {
												this.sendingForm = true;
												$('button.disabled').prop('disabled', false);
												$('button.disabled').removeClass('disabled');
												this.showAlert(r);
											}
										},
										error: (r) => {
	//										console.error("ERROR en invocacion", r);
											this.sendingForm = true;
											$('button.disabled').prop('disabled', false);
											$('button.disabled').removeClass('disabled');
											this.showAlert(r);
										}

									});
								} catch (err) {
									this.sendingForm = true;
									$('button.disabled').prop('disabled', false);
									$('button.disabled').removeClass('disabled');
									console.error("error al ejecutar AJAX", err);
								}
							});
						}
					}

				}
			}
		}

		showAlert(er) {
			let errorMessage = "";
			if (er.cod == 500) {
				errorMessage = "Hubo un error del servidor. Intente nuevamente."
			} else if (er.cod == 400) {
				errorMessage = "No se pudo realizar el envo. Intente ms tarde."
			} else {
				errorMessage = er.msg;
			}
			$('.actions').append('<p class="error" style="color:red;font-size: 14px;">' + errorMessage + '</p>');
		}
	}

})();

$('.trivia-container').each(function() {
	const id = $(this).attr('data-id');
	const element = document.getElementById(id);
	const thankyoupage = $(this).attr('data-thankyoupage');
	const data = {
		recaptchaEnabled: $(this).data('recaptchaenabled'),
		currentpage: $(this).data('currentpage')
	}
	const component = new triviaform(element, thankyoupage, data);
});
$(document).on("foundation-contentloaded", function () {
    if ($("input[name*='./subctitledesc']").length > 0) {
        const rteDiv = $("input[name*='./subctitledesc']").siblings(".coral-RichText-editable");
        const maxlen = 400;
        const arrKeys = [ 8, 17, 35, 36, 37, 39, 46, 90, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123 ];

        rteDiv.on("drop", function (e) {
            e.preventDefault();
            e.returnValue = false;
        });

        rteDiv.on("keydown", function (e) {
            const currLen = rteDiv.children(":first").text().length;
            const currText = rteDiv.children(":first").text();

            if (e.which == 13 || e.which == 9) {
                e.preventDefault();
                e.returnValue = false;

                return false;
            }

            if (currLen > maxlen - 1) {
                if (jQuery.inArray(e.which, arrKeys) === -1) {
                    e.preventDefault();
                    e.returnValue = false;

                    return false;
                }
            }
        });

        rteDiv.on("paste", function (e) {
            const currLen = rteDiv.children(":first").text().length;

            e.preventDefault();
            let inText;
            const clipb = (e.originalEvent || e).clipboardData;

            if (clipb === undefined || clipb === null) {
                inText = window.clipboardData.getData("text") || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxlen);
                    inText = inText.substring(0, maxlen - currLen);

                    if (window.getSelection) {
                        const newNode = document.createElement("span");

                        newNode.innerHTML = inText;
                        window.getSelection().getRangeAt(0).insertNode(newNode);
                    } else {
                        document.selection.createRange().pasteHTML(inText);
                    }
                }
            } else {
                inText = clipb.getData('text/plain') || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxlen - currLen);
                    document.execCommand('insertText', false, inText);
                }
            }
        });
    }
});

(function () {
    $(document).ready(function () {
        $('.steps').each(function () {
            let sls = $(this).find('.step-body .step-item.select');
            if (sls.length) {
                let add = true;
                $(this).find('.step-body .step-item').each(function () {
                    if ($(this).hasClass('select')) add = false
                    if (add) {
                        $(this).addClass('select');
                    }
                });
            }
        });
    });
})();
const SportSectionComponent = (function () {
    const defaults = {
        selectors: {
            cardsContainer: '.sport-section-cards-container'
        },
        events: {

        }
    };

    return class {
        constructor(element) {
            this.element = element;
            this.initComponent();
        }

        initComponent() {
            // Slider configuration
            var slider = this.element.find(defaults.selectors.cardsContainer);
            var autoplay = slider.length > 0 ? slider[0].getAttribute('autoplay') === 'true' : false;

                slider.slick({
                    centerMode: false,
                    slidesToShow: 3,
                    draggable: false,
                    arrows: false,
                    infinite: false,
                    responsive: [
                        {
                            breakpoint: 1024,
                            settings: {
                                slidesToShow: 1,
                                draggable: true,
                                dots: true,
                                centerPadding: '60px',
                                autoplay: autoplay,
                                infinite: true
                            }
                        }
                    ]
                });
        }
    };
})();

const sportsectioncomponents = $('.sport-section-container');
sportsectioncomponents.each((index, element) => {
    const id = $(element).attr('id');
    GeneralComponentContainer.setComponent(new SportSectionComponent($(element)), id);
});
class BaseGenericTabsComponent {
    constructor(idgen, isEditing) {
        this.id = idgen;
        this.component = $('#' + this.id);
        this.eventEmitter = new rxjs.Subject();

        if (!isEditing) {
            this.contentContainer = this.component.find('.tabs-content-container');
            this.contentContainer.find('.tab-content-item').hide();
            this.contentContainer.find('#content-tab-0').fadeIn(1000);
            this.eventsComponent();
        }
    }

    eventsComponent() {
        const params = new URLSearchParams(location.search);
        const listItemComponent = this.component.find('.generictabs-nav ul li');
        listItemComponent.on('click', (e) => {
            const queryString = $(e.target).attr('queryString');
            if (queryString) {
                params.set('tab', queryString);
                window.history.replaceState({}, '', `${location.pathname}?${params}`);
            }
            this.openSpecificTab(e.target);
        });

        if (params.get('tab')) {
            this.openSpecificTab(this.component.find('.generictabs-nav ul li[queryString=' + params.get('tab') + ']')[0]);
        }
    }

    openSpecificTab(target) {
        const tabId = target.id;
        this.component.find('#' + tabId).addClass('active').siblings().removeClass('active');
        this.contentContainer.find('.tab-content-item').hide();
        this.contentContainer.find('#content-' + tabId).fadeIn(500);
        const tabSel = [].slice.call(
            this.component.find('.generictabs-nav ul li')
            , 0).indexOf(target);
        const size = $('#' + tabId).width();
        const scroll = tabSel * size;
        this.component.find('.generictabs-nav').animate({
            scrollLeft: scroll - (size / 4)
        }, 'slow');
        this.eventEmitter.next({
            event: 'tab-opened',
            data: tabId
        });
    }
}

$('.generictabs-widget').each(function () {
    const id = $(this).data('idgen');
    const isEditing = $(this).data('isediting');
    GeneralComponentContainer.setComponent(
        new BaseGenericTabsComponent(id,isEditing), id
    );
});
const SportCardsWithSliderComponent = (function () {
    const defaults = {
        selectors: {
        },
        events: {
            sliderInit: 'init',
            sliderBeforeChange: 'beforeChange'
        }
    };

    return class {
        constructor(element, properties) {
            this.element = element;
            this.properties = properties;
            this.initComponent();
        }

        initComponent() {
            this.genericSliderDot = new GenericSlidersDotManager(this.element);
            this.initSlider();
            this.genericSliderDot.setTheme('dark');
        }

        initSlider() {
            if (!this.properties.editMode && !this.properties.previewMode) {
                this.element.on('init', function (event, slick) {
                    const slidesToShow = slick.slideCount > 4 ? 4 : slick.slideCount;

                    slick.slickSetOption('slidesToShow', slidesToShow, true);
                });

                this.element.slick({
                    slidesToScroll: 1,
                    autoplay: this.properties.autoplay,
                    dots: false,
                    arrows: true,
                    centerMode: true,
                    responsive: [
                        {
                            breakpoint: 480,
                            settings: {
                                slidesToShow: 1,
                                centerPadding: '10px',
                                dots: true,
                                arrows: false
                            }
                        },
                        {
                            breakpoint: 1025,
                            settings: {
                                slidesToShow: 2
                            }
                        }
                    ]
                });

                var tabs = GeneralComponentContainer.getComponent($('.generictabs-widget').data('idgen'));
                if (tabs){
                    tabs.eventEmitter.subscribe((info) => {
                        if (info.event === 'tab-opened') {
                            this.element.slick('refresh');
                        }
                    });
                }
            }
        }
    };
})();

const sportcardsslidercomponents = $('.sport-cards-slider-container');
sportcardsslidercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const properties = {
        previewMode: component.data('previewmode'),
        editMode: component.data('editmode'),
        autoplay: component.data('autoplay') ? component.data('autoplay') : false
    };
    GeneralComponentContainer.setComponent(new SportCardsWithSliderComponent(component, properties), id);
});
SmartCardComponent = (function () {
    const defaults = {
        "selectors": {
            "button": ".smart-card-button",
            "accessCard": ".access-card input",
            "country": ".country select",
            "successMsg": ".message.success",
            "errorMsg": ".message.alert"
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);

            this.initComponent();
        }

        initComponent() {
            this.$accessCard = this.component.find(defaults.selectors.accessCard);
            this.$country = this.component.find(defaults.selectors.country);
            this.$button = this.component.find(defaults.selectors.button);
            this.$success = this.component.find(defaults.selectors.successMsg);
            this.$error = this.component.find(defaults.selectors.errorMsg);

            this.$button.click(() => {
                this.doPost();
            });

            this.updateTexts();
        }

        updateTexts(){
            var cardMask = [/\d/, /\d/, /\d/, /\d/, '-', /\d/, /\d/, /\d/, /\d/, '-', /\d/, /\d/, /\d/, /\d/];

            var myInput = document.querySelector('[id="'+ this.id +'"] .access-card input');

            var maskedInputController = vanillaTextMask.maskInput({
                inputElement: myInput,
                mask: cardMask
            });

            this.$accessCard.keyup(() => {
                this.validateTexts();
            });

            this.$country.change(() => {
                this.validateTexts();
            });
        }

        validateTexts(){
            $('.message.success').addClass('hide');
            $('.message.alert').addClass('hide');
            if(this.$country.val() != ""){
                this.$country.removeClass('placeholder');
            } else {
                this.$country.addClass('placeholder');
            }

            if(this.$accessCard.val().length == 14 && this.$accessCard.val().indexOf('_') < 0){
                if(this.$country.val() != ""){
                    this.$button.removeAttr('disabled');
                } else {
                    this.$button.attr('disabled', true);
                }
            } else {
                this.$button.attr('disabled', true);
            }
        }

        extractData(){
            const sample = {
                identification: '0',
                fullname: 'smartcardForm',
                comments: "smart-card number: " + this.$accessCard.val(),
                withEmail: "0",
                reason: "621"
            };
            return sample;
        }

        doPost(){
            const url = "/bin/public-sites/acquisition";
            const data = Object.assign(
                {},
                this.extractData(),
                {
                    country: this.$country.val(),
                    urlparams: window.location.search
                }
            );

            return new Promise(() => {
                try {
                    $.ajax({
                        type: 'POST',
                        url: url,
                        data: data,
                        success: (r) => {
                            this.reasonId = 0;
                            this.showAlert('success');
                        },
                        error: (r) => {
                            this.reasonId = 0;
                            this.showAlert('error');
                        }

                    });
                } catch (err) {
                    this.reasonId = 0;
                    this.showAlert('error');
                }
            });
        }

        showAlert(str){
            this.$accessCard.val('');
            this.$country.val('');
            this.$country.addClass('placeholder');
            this.$button.attr('disabled', true);
            if(str == "success"){
                $('.message.success').removeClass('hide');
            } else {

                $('.message.alert').removeClass('hide');
            }
        }
    };
})();

const smartcardcomponent = $('.smart-card-container form');
smartcardcomponent.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new SmartCardComponent(id), id);
});
class SinglePlanCardComponent {
    constructor(component, componentData, i18nData, country) {
        this.component = component;
        this.i18nData = i18nData;
        this.country = country;
        this.options = {
            plan: 'plan',
            pack: 'prpackage'
        };
        this.eventEmitter = new rxjs.Subject();

        if (componentData.option === this.options.plan) {
            this.getDataSingleCard(componentData.singlecardplan, componentData.option);
        } else {
            this.getDataSingleCard(componentData.prpackages, componentData.option);
        }
    }

    getDataSingleCard(path, option) {
        if (path) {
            const settingsPath = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}settings.html`;
            GlobalData.getMultipleData([
                { path: path },
                GlobalData.defaults.requestData.SETTINGS
            ]).subscribe(
                (result) => {

                    try {
                        const cardData = result[0][0];
                        const settings = result[1];

                        if (cardData) {
                            (option === this.options.plan) ?
                                this.singlePlanCardfillData(cardData, settings[cardData.type])
                                : this.singlePackCardfillData(cardData, settings[cardData.type]);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                },
                (error) => {
                    console.log(error);
                }
            );
        }
    }

    singlePackCardfillData(data, setting) {

        this.component.addClass('premium-pack');
        this.component.addClass('ant-container');
        this.component.addClass('ant-level1');
        this.component.attr("product-type", data.type);
        if (data.type === 'postpaid') this.component.addClass('pospago');
        this.component.attr("product-category", data.category.type);
        //Campo adicionado para cumplir con la normativa CRC CO
        //Ver mas info DMM-16982
        this.component.attr("dane", data.dane || "00000");

        if (typeof data.estrato === 'object' && data.estrato.length) this.component.attr("estrato", (data.estrato.map((i) => i.id)).join(',') || "")

        this.component.attr("vigente", data.vigente);
        if (data.type === 'prepaid') {
            this.component.attr("duracion", data.days);
        }
        
        let channelsNum;
        if (data.superType === "streaming") {
            channelsNum = data.channelshide ? '' : `
            <div class="channel">
                <div class="number">
                    {{streamingPack.streamingFeatureQuantity}}
                </div>
                <div class="title">
                    {{streamingPack.streamingFeatureDescription}}
                </div>
            </div>
            `;
        } else {
            channelsNum = data.channelshide ? '' : `
            <div class="channel">
                <div class="number">
                    {{totalChannels}}
                </div>
                <div class="title">
                    {{infoPacks.channelDescription}}
                </div>
            </div>
            `;
        }

        const template = `
        <div class="{{#ifCond type '!=' "dtvgo"}}television{{/ifCond}}" tecnologia="1">
            <div class="header">
            <div class="title ant-value">{{name}}
                <img src="{{infoPacks.badgetDark}}" alt="">
            </div>
            <div class="plan titulo" style="display:none">
                {{name}}
            </div>
            </div>
            <div class="divider" style="background-color:{{infoPacks.color}};"}}">
                <div class="deco item1"></div>
                <div class="deco item2"></div>
            </div>
            <div class="body" style="background: url({{backgroundCardImage}});">
                <div class="warning truncate">
                    {{#ifCond type '==' "prepaid"}}
                        {{infoPacks.specialInstructionalText}} <a href="{{infoPacks.specialPackLink}}" target="{{infoPacks.specialPackTarget}}" class="ant-link ant-action ant-value ant-level2 ant-{{type}}">{{infoPacks.specialPackText}}</a>
                    {{/ifCond}}
                </div>
                <div class="channel-list">
                    {{#each channelsHighlighted}}
                        <img src={{logo}}  alt="{{name}}">
                    {{/each}}
                </div>
                <ul class="list">
                    {{#each infoPacks.features}}
                        <li class="truncate{{#ternary offer ' offer ant-offer-container' ''}}{{/ternary}}">{{description}}</li>
                    {{/each}}
                </ul>
            </div>
            <div class="footer">
                <div class="price">
                    ${channelsNum}
                    <div class="value">
                        <div class="number ant-price">
                            {{currency}}{{infoPacks.formattedPrice}}
                        </div>
                        <div class="valor-numerico hide">
                            {{infoPacks.price}}
                        </div>
                        <div class="title">
                            {{infoPacks.priceDescription}}
                        </div>
                    </div>
                </div>
                <div class="acquisition-dropdown-container"></div>
                <div class="more-info ant-link ant-action ant-value ant-level2 ant-{{type}}">
                    {{setting.packCardSecBtnText}}
                    <div class="chevron"></div>
                </div>
            </div>
        </div>
            `;

        this.component.html(Handlebars.compile(template)(
            Object.assign({}, data,
                { channelsHighlighted: data.channelsHighlighted.slice(0, 3) },
                { i18nData: this.i18nData },
                { infoPacks: data.infoPacks[0] },
                { features: data.features.slice(0, 5).sort((a, b) => a.offer - b.offer) },
                { currency: GlobalSettings.general.currency },
                { setting: setting }
            )
        ));

        data.infoPacks[0].landing = false;
        data.infoPacks[0].type = data.types[0];
        data.infoPacks[0].level = 2;

        new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data.infoPacks[0]);

        this.component.find('.footer\x20.more-info').on('click', () => {
            window.open(data.urlRedirect, '_self');
        });
    }

    singlePlanCardfillData(data, setting) {
       
        this.component.addClass('ant-container');
        this.component.addClass('ant-level1');
        this.component.attr("product-type", data.type);
        if (data.type === 'postpaid') this.component.addClass('pospago');
        this.component.data('price', data.price);
        //Campo adicionado para cumplir con la normativa CRC CO
        //Ver mas info DMM-16982
        this.component.attr("dane", data.dane || "00000");

        if (typeof data.estrato === 'object' && data.estrato.length) this.component.attr("estrato", (data.estrato.map((i) => i.id)).join(',') || "")

        if (data.type === 'prepaid') {
            this.component.attr("duracion", data.days);
        }

        if(data.order > 0){
            this.component.attr("orden", data.order); 
        }
        //console.log(data)
        const template = `
        <div class="{{#ifCond type '!=' "dtvgo"}}television{{/ifCond}}" tecnologia="1">
            <div class="header">
                <div class="title ant-value">
                    {{name}}
                    {{#if allowBadge}}
                        <img src="{{setting.badgeDark}}" alt="">
                    {{/if}}
                </div>
                <div class="titulo" style="display:none">
                    {{name}}
                </div>                
            </div>
            <div class="divider" style="background-color:{{color}};"}}">
                <div class="deco item1"></div>
                <div class="deco item2"></div>
            </div>
            <div class="body">
                <div class="warning truncate">
                    {{#ifCond type '==' "prepaid"}}
                        {{specialInstructionalText}} <a href="{{specialPlanLink}}" target="{{specialPlanTarget}}" class="ant-link ant-action ant-value ant-level2 ant-{{type}}">{{specialPlanText}}</a>
                    {{/ifCond}}
                </div>
                <ul class="list">
                {{#each features}}
                    {{#ifCond description '==' "DIRECTV GO sin costo adicional"}}
                        <li class="truncate{{#ternary offer ' offer ant-offer-container' ''}}{{/ternary}} caracteristica-adicional servicio-suscripcion">{{description}}</li>
                    {{else}}
                        <li class="truncate{{#ternary offer ' offer ant-offer-container' ''}}{{/ternary}} caracteristica-adicional">{{description}}</li>
                    {{/ifCond}}
                {{/each}}
                {{#ifCond type '==' "dtvgo"}}
                    <li class="truncate caracteristica-adicional servicio-suscripcion" style="display:none">DIRECTV GO. Pagas por mes, cancelas cuando quieras</li>            
                {{/ifCond}}
                </ul>
            </div>
            <div class="footer">
                <div class="price">
                    <div class="channel">
                        <div class="title">
                            &nbsp;{{channelLabel}}&nbsp;
                        </div>
                        <div class="number">
                            {{channelCount}}
                        </div>
                        <div class="canales-hd" style="display:none">
                            {{channelsHDCount}} 
                        </div>
                    </div>
                    <div class="value ant-price">
                        <div class="title">                                
                            {{#ifCond priceTitle '==' ""}}
                                {{i18nData.from}}
                            {{/ifCond}}
                            {{#ifCond priceTitle '!==' ""}}
                                {{priceTitle}}
                            {{/ifCond}}
                        </div>                            
                        <div class="title">
                            <span class="number">
                                {{currency}}{{formattedPrice}}
                            </span>
                            <span class="valor-numerico hide">
                                {{price}}
                            </span>
                            {{!-- <span class="month">/{{i18nData.month}}</span> --}}
                        </div>                        
                        <div class="tiny">{{priceLabel}}</div> 
                        <p>{{priceList}} <span style="text-decoration: line-through;">{{oldPrice}}</span></p>
                    </div>
                </div>
                <div class="acquisition-dropdown-container"></div>
                <div class="more-info ant-link ant-action ant-value ant-level2 ant-{{type}}">
                    {{setting.planCardSecBtnText}}
                    <div class="chevron"></div>
                </div>
            </div>
        </div>`;
        let channelsHDCount = 0
        data.channels.map((c) => {
            if (c.type === 'HD') {
                channelsHDCount++
            }
            return
        });

        this.component.html(Handlebars.compile(template)(
            Object.assign({}, data,
                { hlChannels: data.hlChannels.slice(0, 3) },
                { i18nData: this.i18nData },
                { features: data.features.slice(0, 5).sort((a, b) => a.offer - b.offer) },
                { setting: setting },
                { currency: GlobalSettings.general.currency },
                { allowBadge: !data.dtvgo || data.type === "prepaid" },
                { channelsHDCount: channelsHDCount }
            )
        ));

        data.landing = false;
        data.level = 2;

        new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data, this.loadCTA(data));

        this.component.find('.footer\x20.more-info').on('click', () => {
            window.open(data.moreInfo, '_self');
        });
    }

    loadCTA(data) {
        const mainContactPhone = (window.localStorage && window.localStorage.getItem('defaultPhone')) || '';
        const phoneNumber = mainContactPhone;

        return {
            cmn: () => {
                this.eventEmitter.next({
                    event: 'make-call',
                    data: data.name,
                    phone: phoneNumber
                });
            },
            cml: () => {
                this.eventEmitter.next({
                    event: 'leave-data',
                    data: data.name,
                    reasonId: data.reasonId
                });
            }
        };
    }
}

const singleplancardcomponents = $('.single-plan-card-container');
singleplancardcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const country = component.data('country');
    const translateData = {
        month: component.data('month'),
        channels: component.data('channels'),
        select: component.data('select'),
        recharge: component.data('recharge'),
        seemore: component.data('seemore'),
        get: component.data('get'),
        requires: component.data('requires'),
        prepaidkit: component.data('prepaidkit'),
        from: component.data('from'),
        prepaidText: component.data('prepaidtext'),
        postpaidText: component.data('postpaidtext'),
        packCardAdd: component.data('packcardadd'),
        packCardActive: component.data('packcardactive'),
        packCardBasic: component.data('packcardbasic'),
        chatUrl: component.data('chaturl')
    };
    const componentData = {
        option: component.data('option'),
        singlecardplan: component.data('singlecardplan'),
        prpackages: component.data('prpackages'),
    };

    new SinglePlanCardComponent($('#' + id), componentData, translateData, country);
})
var PLANCARDOPTION = "./option";
var PLANCARDPREMIUM = './prpackages';
var PLANCARDPLAN = './singlecardplan';

function getOption(optionSelect) {
    if (optionSelect==='plan') {
        activatePlan();
    } else {
        activatePrPackage();
    }
}

function activatePlan() {
    $("[name='" + PLANCARDPLAN +"']").parent().attr('hidden', false);
    $("[name='" + PLANCARDPREMIUM +"']").parent().attr('hidden', true);
}

function activatePrPackage() {
    $("[name='" + PLANCARDPREMIUM +"']").parent().attr('hidden', false);
    $("[name='" + PLANCARDPLAN +"']").parent().attr('hidden', true);
}

$(document).on("foundation-contentloaded", function () {
    $("[name='"+PLANCARDOPTION+"']").change(function() {
        getOption($(this).val());
    });

    getOption($("[name='"+PLANCARDOPTION+"']").val());
});

function getCardData(path, id, seemore, target) {
    if (path) {
        GlobalData.getMultipleData([
            { path: path },
            GlobalData.defaults.requestData.SETTINGS,
        ]
        ).subscribe(
            (res) => {
                try {
                    const cardData = res[0][0];
                    const currency = res[1]['general']['currency'];
                    this.fillCardData(cardData, id, seemore, target, currency);
                } catch (err) {
                }
            }
        );
    }
}

function fillCardData(result, id, seemore, target, currency) {
    const cardInfo = {};

    cardInfo.target = target;
    cardInfo.cover = {};
    cardInfo.cover.image = result.image;
    cardInfo.cover.type = result.labelDescription;
    cardInfo.body = {};
    cardInfo.body.title = result.name;
    cardInfo.body.specs = [];
    result.features.forEach((feature) => {
        cardInfo.body.specs.push(feature);
    });
    cardInfo.body.description = result.offer;

    if (result.hasOwnProperty('price')) {
        cardInfo.body.cost = `${currency}${result.price}`;
    } else {
        cardInfo.body.cost = '';
    }

    if (result.hasOwnProperty('viewmore')) {
        cardInfo.body.seemore = `${result.viewmore}>`;
    } else {
        cardInfo.body.seemore = `${seemore}>`;
    }

    cardInfo.body.uri = result.url;

    fillCard(id, cardInfo);
}


function fillCard(id, cardInfo) {
    const card = $('#' + id);

    card.find('.cover').children('img').attr("src", cardInfo.cover.image);
    card.find('.cover').children('.span').html(cardInfo.cover.type);
    card.find('.title').html(cardInfo.body.title);
    card.find('.description').html(cardInfo.body.description);
    card.find('.cost').html(cardInfo.body.cost);
    card.find('.footer').children('a').attr({ "href": cardInfo.body.uri, "target": cardInfo.target });
    card.find('.seemore').html(cardInfo.body.seemore);

    for (i = 0; i < cardInfo.body.specs.length; i++) {
        card.find('.specs')
            .append('<li>' + cardInfo.body.specs[i] + '</li>');
    }

    if (cardInfo.body.description == '') {
        card.find(".offer").remove();
    }

    if (cardInfo.body.cost == '') {
        card.find(".price").remove();
    }
}

const offercardcomponents = $('.offer-card');
offercardcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');
    const seemore = component.data('seemore');
    const target = component.data('target');
    getCardData(path, id, seemore, target);
});
class ValidateAndDoRequest {
    constructor() {
        this.patterns = {
            email: /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i,
        };
        this.createDecosUrl = "/bin/public-sites/decos";
        this.thankyouPage = $("#resale-decos-form").attr("data-decos-thankyou");
        this.validInputCount = 9;
        this.requestBody = {
            decos_name: "",
            phone_type: "",
            decos_phone_number: "",
            decos_phone_number_input: "",
            decos_phone_code: $("#cod-area").val() ? $("#cod-area").val() : "",
            decos_card_prepaid: 0,
            decos_email: "",
            decos_publication_url: "",
            decos_antiguedad: "",
            decos_ubicacion: "",
            decos_missing_parts: "",
        };
        this.internalErrorMsg = $("#resale-decos-form").attr(
            "data-internal-error"
        );
        this.successMsg = $("#resale-decos-form").attr("data-success-message");
    }

    validateInputFields({ type, value, name }) {
        switch (type) {
            case "email":
                if (this.patterns.email.test(value)) {
                    $(`#${name}_error`).hide();
                    $(`[name=${name}]`).removeClass("error");
                    this.requestBody[name] = value;
                } else {
                    this.requestBody[name] = "";
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "text":
                this.inputTextValidation(name, value);
                break;
            case "number":
                this.inputNumberValidation(name, value);
                break;
        }

        // Block or unblock success button
        this.showSuccessBtn();
    }

    showSuccessBtn() {
        if (this.isReadyToSubmit()) {
            $("#decos-btn-send").prop("disabled", false);
            $("#decos-btn-send").removeClass("disabled");
        } else {
            $("#decos-btn-send").prop("disabled", true);
            $("#decos-btn-send").addClass("disabled");
        }
    }

    handleChange(e) {
        this.requestBody["phone_type"] = $('input[type="radio"]:checked').val();

        const { target } = e;

        this.validateInputFields(target);
    }

    createDecos() {
        // Set phone number
        let phoneNumber = `${this.requestBody["decos_phone_code"]}-${this.requestBody["decos_phone_number_input"]}`;
        this.requestBody["decos_phone_number"] = phoneNumber;

        return new Promise(() => {
            try {
                $.ajax({
                    type: "POST",
                    url: this.createDecosUrl,
                    data: JSON.stringify(this.requestBody),
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: () => (window.location.href = this.thankyouPage),
                    error: () => this.showAlert("error", this.internalErrorMsg),
                });
            } catch (err) {
                this.showAlert("error", this.internalErrorMsg);
            }
        });
    }

    showAlert(type, msg) {
        const $alertComponent =
            GeneralComponentContainer.getComponentByName("Alert");

        if ($alertComponent) {
            switch (type) {
                case "error":
                    $alertComponent.setTitle("Error");
                    $alertComponent.setDescription(msg);
                    break;
                case "success":
                    $alertComponent.setTitle("Exto");
                    $alertComponent.setDescription(msg);
                    break;
            }

            $alertComponent.setStatus(type);
            $alertComponent.showAlert();
        }
    }

    isReadyToSubmit() {
        let isReady = false;
        const inputCount = Object.values(this.requestBody).filter(
            (body) => body !== "" && body !== 0
        ).length;

        if (inputCount >= this.validInputCount) {
            isReady = true;
        }
        if (inputCount === this.validInputCount) {
            isReady = this.requestBody["decos_missing_parts"] == "";
        }
        return isReady;
    }

    inputTextValidation(name, value) {
        switch (name) {
            case "decos_name":
                if (value.length <= 50) {
                    this.requestBody[name] = value;
                    $(`#${name}_error`).hide();

                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = "";
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "decos_publication_url":
                const publicationUrl = document.createElement("input");
                publicationUrl.setAttribute("type", "url");
                publicationUrl.value = value;
                if (publicationUrl.validity.valid) {
                    this.requestBody[name] = value;

                    $(`#${name}_error`).hide();
                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = "";
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "decos_antiguedad":
                if (value.length <= 15) {
                    this.requestBody[name] = value;
                    $(`#${name}_error`).hide();

                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = "";
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "decos_ubicacion":
                if (value.length <= 50) {
                    this.requestBody[name] = value;

                    $(`#${name}_error`).hide();
                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = "";

                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "decos_missing_parts":
                if (value.length <= 100) {
                    this.requestBody[name] = value;

                    $(`#${name}_error`).hide();
                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = "";

                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
        }
    }

    inputNumberValidation(name, value) {
        switch (name) {
            case "decos_card_prepaid":
                if (String(value).length === 12) {
                    this.requestBody[name] = value;

                    $(`#${name}_error`).hide();
                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = 0;

                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
        }
    }

    inputPhoneValidate(id, value) {
        switch (id) {
            case "cod-area":
                if (String(value).length !== 0) {
                    this.requestBody["decos_phone_code"] = value;

                    $(`#${id}`).removeClass("error");
                    $(`#decos_phone_code_error`).hide();
                } else {
                    this.requestBody["decos_phone_code"] = 0;

                    $(`#${id}`).addClass("error");
                    $(`#decos_phone_code_error`).show();
                }
                break;

            case "num-tel":
                if (String(value).length >= 8 && String(value).length <= 12) {
                    this.requestBody["decos_phone_number_input"] = value;

                    $(`#${id}`).removeClass("error");
                    $(`#decos_phone_number_input_error`).hide();
                } else {
                    this.requestBody[name] = 0;

                    $(`#${id}`).addClass("error");
                    $(`#decos_phone_number_input_error`).show();
                }
                break;
        }

        // Block or unblock success button
        this.showSuccessBtn();
    }
}

// Instance of controller to validate and do request
const DecosController = new ValidateAndDoRequest();

// Do request and create deco
$("#decos-btn-send").on("click", (event) => {
    let recaptchaErrorMsg = $("#resale-decos-form").attr(
        "data-recaptcha-error"
    );
    let errorMsg = $("#resale-decos-form").attr("data-error-message");

    const isValid = DecosController.isReadyToSubmit();

    if (isValid) {
        // check if recaptcha is ok
        if (grecaptcha.getResponse().length !== 0) {
            // Dispatch create decos method
            DecosController.createDecos();
        } else {
            DecosController.showAlert("error", recaptchaErrorMsg);
        }
    } else {
        DecosController.showAlert("error", errorMsg);
    }
});

// Handle change of phone code
$("#cod-area").on("change", (event) => {
    const { target } = event;
    DecosController.inputPhoneValidate(target.id, target.value);
});

// Handle oninput of phone number
$("#num-tel").on("input", (event) => {
    const { target } = event;
    DecosController.inputPhoneValidate(target.id, target.value);
});

// Validate each required input before submit
function handleChange(e) {
    DecosController.handleChange(e);
}

// Validate radio button of Phone or Cellphone
function handleClick(e) {
    if (e.target.name !== "phone_check") {
        $(`#cellphone_check`).prop("checked", true);
        $(`#phone_check`).prop("checked", false);
    } else {
        $(`#phone_check`).prop("checked", true);
        $(`#cellphone_check`).prop("checked", false);
    }
    DecosController.requestBody["phone_type"] = $(
        'input[type="radio"]:checked'
    ).val();
}


/**
 * Clase de funcionalidades para carousel reventa decos.
 * @class
 */
class CarouselDecos {

  /**
   * Constructor de la clase CarouseDecos. See {@link CarouselDecos}.
   * @constructor
   * @param {HtmlElement} component HTML del componente base.
   */
  constructor(component) {
    let owl = $(component).find('.owl-carousel');
    this.createDecosUrl = '/bin/public-sites/decos';
    this.decosToHtml(owl).then(() => {
      owl.owlCarousel({
        loop: false,
        margin: 10,
        navRewind: false,
        nav: true,
        dots: false,
        responsive: {
          0: {
            items: 1
          },
          600: {
            items: 2
          },
          978: {
            items: 3
          },
          1200: {
            items: 4
          },
          1400: {
            items: 5
          }
        }
      });
    });
  }

  /**
   * Obtiene los decos desde el servicio back AEM en utf-8 o iso.
   * @returns Promise con objeto de decos.
   */
  getDecos() {
    return new Promise((resolve, reject) => {
      let isIsoResponse = false;
      return fetch(this.createDecosUrl).then(response => {
        if (response.ok) {
          isIsoResponse = response.headers.get('Content-Type').includes('iso-8859-1');
          return isIsoResponse ? response.arrayBuffer() : response.json();
        } else {
          console.error(res);
          reject({ valid: false, result: 'service' })
        }
      })
        .then(buffer => {
          let resObj = {};
          if (isIsoResponse) {
            const decoder = new TextDecoder('iso-8859-1');
            const text = decoder.decode(buffer);
            resObj = JSON.parse(text);
          } else {
            resObj = buffer;
          }

          if (resObj.length > 0) {
            resolve({ valid: true, result: resObj });
          } else resolve({ valid: false, result: 'code' });
        });
    });
  }

  /**
   * Inyecta en el HTML los decos con la maqueta.
   * @param {jQuery} parent Elemento contenedor de los decos, un carousel owl.
   * @returns Promise vacia para que ejecute callback.
   */
  decosToHtml(parent) {
    return this.getDecos().then(res => {
      if (typeof res.valid === 'boolean' && res.valid) {
        let html = '';
        const target = parent.data('target') ? '_blank' : '_self';
        this.orderDecosBy(res.result, parent.data('order'));
        res.result.forEach((deco, i) => {
          html += `<div class="item">
                  <div class="title">${parent.data('kit') || 'Kit'} ${i + 1}</div>
                  <div class="description">
                    ${parent.data('antique')}:
                    <div class="description-content">${deco.antique}</div>
                    ${parent.data('location')}:
                    <div class="description-content">${deco.location}</div>
                    <div><a class="item-link" href="${deco.postURL}" target="${target}">${parent.data('publicidad')}</a></div>
                  </div>
                </div>`;
        });

        parent.html(html);
      }
    });
  }

  /**
   * Ordena arreglo de decos segun filtro deseado.
   * @param {Array} decos Arreglo de decos a ordenar.
   * @param {String} orderType tipo de filtro a aplicar, Por defect mismo orden del servicio ***serviceOrder***.
   */
  orderDecosBy(decos, orderType) {
    switch (orderType) {
      case 'antiqueAsc':
        decos.sort((a, b) => a.antique.toLowerCase().localeCompare(b.antique.toLowerCase()));
        break;
      case 'antiqueDesc':
        decos.sort((a, b) => (a.antique.toLowerCase().localeCompare(b.antique.toLowerCase())) * -1);
        break;
      case 'locationAsc':
        decos.sort((a, b) => a.location.toLowerCase().localeCompare(b.location.toLowerCase()));
        break;
      case 'locationDesc':
        decos.sort((a, b) => (a.location.toLowerCase().localeCompare(b.location.toLowerCase())) * -1);
        break;
    }
  }
}

// Ejecuta logica de todos los componentes en la pagina
document.querySelectorAll('.carousel-decos-container').forEach(elem => {
  const carousel = new CarouselDecos(elem);
}); 

class PopupPqr {
    constructor(idPopup) {
        if (!idPopup) throw Error('Invalid PopupPqr instance.');
        this.id = idPopup;
        this.popUpComponent = null;
        this.popUpComponent = $(`#${idPopup}`);
        this.bindEvents();
        this.initEvents();
    }

    bindEvents() {
        this.closeManualPopUp = this.closeManualPopUp.bind(this);
        this.activeManualPopUp = this.activeManualPopUp.bind(this);
    }

    initEvents() {
        this.popUpComponent.find('.new-modal-header-icon').click(this.closeManualPopUp);
    }

    activeManualPopUp() {
        this.popUpComponent.removeClass('close');
        this.popUpComponent.addClass('open');
    }

    closeManualPopUp() {
        this.popUpComponent.removeClass('open');
        this.popUpComponent.addClass('close');
    }

    replaceContentPopUp(html) {
        this.popUpComponent.find('.new-modal-content')
            .html(String.empty)
            .html(html || String.empty);
    }

    get $popUpComponent() {
        return this.popUpComponent;
    }
}

class PqrStatus {
    constructor(cunCode, cunCodeElem, sicCode, sicCodeElem, statusBody) {
        this.code500 = 500;
        this.code502 = 502;
        this.code400 = 400;
        this.statusBody = statusBody;
        this.cunCode = cunCode;
        this.sicCode = sicCode;
        this.getPqrStatusUrl = "/bin/public-sites/consultapqr";
        this.pqrStatusButton = document.getElementById("pqr-status-button");
        this.popupId = $('.resultadosPQR').data('idpopupdoc');
        this.labels = document.getElementById('pqr-status-body').dataset;
        this.popupComponent = new PopupPqr('popUpPqr');
        this.cunCodeElement = cunCodeElem;
        this.sicCodeElement = sicCodeElem;
        this.cunCodeElement.mask('0000-00-0000000000', { "placeholder": "0000-00-0000000000" });
        this.sicCodeElement.mask('0000-00-0000000000', { "placeholder": "Ej.:0000-00-0000000000" });
        this.docType = String.empty;
        this.cunValid = false;
        this.sicValid = false;
        this.docNum = String.empty;
        this.docNumValid = false;
        this.searchType = 'search-cun';
        this.results = [];
        this.bindEvents();
        this.initEvents();
    }

    bindEvents() {
        this.radioButtonEvent = this.radioButtonEvent.bind(this);
        this.handleChangeCunCode = this.handleChangeCunCode.bind(this);
        this.handleChangeSicCode = this.handleChangeSicCode.bind(this);
        this.handleChangeDocNum = this.handleChangeDocNum.bind(this);
        this.handleChangeDocList = this.handleChangeDocList.bind(this);
        this.moreDetailsEventClick = this.moreDetailsEventClick.bind(this);
    }

    initEvents() {
        $('input[name="search-type"]').on('change', this.radioButtonEvent);
        $('#pqr-cun-code').on('input', this.handleChangeCunCode);
        $('#pqr-sic-code').on('input', this.handleChangeSicCode);
        $('#pqr-num-doc').on('input', this.handleChangeDocNum);
        $('#cod-doc')
            .on('input', this.handleChangeDocList)
            .dropdown({ onChange: this.handleChangeDocList });
        $('.resultadosPQR').on('click','a[data-order]',this.moreDetailsEventClick);
    }

    getAndRenderStatus() {
        this.cunCode = this.cunCodeElement.val();
        this.sicCode = this.sicCodeElement.val();
        if (!this.isActiveButton()) {
            console.warn('CUN empty value.');
            return;
        }

        const dictionary = {
            "search-cun": {
                filter: this.cunCode,
                type: 'BY_CUN'
            },
            "search-doc": {
                filter: `${this.docType}-${this.docNum}`,
                type: 'BY_DOCUMENT'
            },
            "search-sic": {
                filter: this.sicCode,
                type: 'BY_SIC'
            }
        }

        const filter = dictionary[this.searchType].filter,
            type = dictionary[this.searchType].type,
            url = `${this.getPqrStatusUrl}?filter=${filter}&country=${countryPS}&type=${type}`;
            
        //fetch(`${this.getPqrStatusUrl}?filter=CC-80844813&country=${countryPS}&type=BY_DOCUMENT`).then((res) => {
        fetch(url).then((res) => {
            const statusCode = res.clone().status;
            if (statusCode === this.code500 || statusCode === this.code502) {
                this.showAlert('error', 'Intentelo mas tarde')
            }
            if (statusCode === this.code400) {
                this.showAlert('error', 'Bad request')
            }
            if (res.clone().ok) {
                res.clone().text().then(value => {
                    console.log(JSON.parse(value));
                    this.renderStatusHtml(JSON.parse(value));
                    this.statusBody.classList.remove("d-none");
                })
            }

        }).catch((err) => {
            console.error(err)
        })
    }

    showAlert(type, msg) {
        const $alertComponent =
            GeneralComponentContainer.getComponentByName("Alert");

        if ($alertComponent) {
            switch (type) {
                case "error":
                    $alertComponent.setTitle("Error");
                    $alertComponent.setDescription(msg);
                    break;
            }

            $alertComponent.setStatus(type);
            $alertComponent.showAlert();
        }
    }

    renderStatusHtml(data) {
        $('#pqr-status-body').hide();
        if (this.searchType === 'search-cun') {
            data = data instanceof Array && data.length > 0 ? data[0] : data;
            if (Object.keys(data).length > 0) {
                $("#pqrStatusName").text(data.customerName);
                $("#pqrStatusDocumentType").text(data.identificationType);
                $("#pqrStatusDocument").text(data.identificationNumber);
                $("#pqrStatusCunCode").text(data.cun);
                $("#pqrStatusDate").text(data.creationDate);
                $("#pqrStatusType").text(data.subcategory);
                $("#pqrStatusReason").text(data.reason);
                $("#pqrStatusState").text(data.status);
                $("#pqrStatusEstimatedDate").text(data.finishDate);
                $("#message").text(data.message);
                $('#pqr-status-body').show();
                $('#input_cun_error_incorrect').hide();
            } else {
                $('#input_cun_error_incorrect').show();
            }
        } else if (this.searchType === 'search-doc') {
            if (data instanceof Array && data.length > 0) {
                const $container = $('.doc-table-result'),
                    $mobContainer = $container.find('.mobile'),
                    $dskContainer = $container.find('.desktop');
                $container
                    .show()
                    .parent('.content-resultadosPQR')
                    .addClass('results-doc-mode')
                    .find('.content-form')
                    .hide();

                $mobContainer
                    .html('')
                    .html(this.createTableHtml(data, true, 'doc'));

                $dskContainer
                    .find('.docs-result-table')
                    .append(this.createTableHtml(data, false, 'doc'));

            } else if (Object.keys(data).length < 1) {
                const text = this.searchType === 'search-sic' ? 'No se han encontrado resultados de apelacin ante la SIC.' : 'El nmero de identificacin ingresado no tiene CUN asociados en el sistema'; 
                this.popupComponent.replaceContentPopUp(`<p class="popup-result-empty${this.searchType === 'search-sic' && ' sic'}">${text}<p>`);
                this.popupComponent.activeManualPopUp();
            } else {
                $('#input_cun_error_incorrect').show();
            }
        } else if (this.searchType === 'search-sic') {
            if (data instanceof Array && data.length > 0) {
                const $containerTitle = $('.content-resultados-title');
                const $container = $('.sic-table-result'),
                    $mobContainer = $container.find('.mobile'),
                    $dskContainer = $container.find('.desktop');
                $container
                    .show()
                    .parent('.content-resultadosPQR')
                    .addClass('results-sic-mode')
                    .find('.content-form')
                    .hide();
                
                $containerTitle.addClass('d-none');

                $mobContainer
                    .html('')
                    .html(this.createTableHtml(data, true, 'sic'));

                $dskContainer
                    .find('.sics-result-table')
                    .append(this.createTableHtml(data, false, 'sic'));

            } else if (Object.keys(data).length < 1) {
                const text = this.searchType === 'search-sic' ? 'No se han encontrado resultados de apelacin ante la SIC.' : 'El nmero de identificacin ingresado no tiene CUN asociados en el sistema'; 
                this.popupComponent.replaceContentPopUp(`<p class="popup-result-empty${this.searchType === 'search-sic' && ' sic'}">${text}<p>`);
                this.popupComponent.activeManualPopUp();
            } else {
                $('#input_sic_error_incorrect').show();
            }
        }
        else {
            $('#input_cun_error_incorrect').show();
        }
    }

    handleChangeCunCode(event) {
        if (event.target.value.length > 17) {
            $("#input_cun_error").hide();
            this.cunValid = true;
        } else {
            $("#input_cun_error").show();
            this.cunValid = false;
            //Oculto error cun incorrecto
            $('#input_cun_error_incorrect').hide();
        }

        this.isActiveButton();
    }

    handleChangeSicCode(event) {
        if (event.target.value.length > 17) {
            $("#input_sic_error").hide();
            $('#pqr-sic-code').removeClass('error')
            this.sicValid = true;
        } else {
            $("#input_sic_error").show();
            $('#pqr-sic-code').addClass('error')
            this.sicValid = false;
            //Oculto error sic incorrecto
            $('#input_sic_error_incorrect').hide();
        }

        this.isActiveButton();
    }

    radioButtonEvent(e) {
        const id = e.currentTarget.id;
        if (id === 'search-cun') {
            $('.container-cun').removeClass('hide');
            $('.container-doc').addClass('hide');
            $('.container-sic').addClass('hide');
        } else if (id === 'search-doc') {
            $('.container-cun').addClass('hide');
            $('.container-sic').addClass('hide');
            $('.container-doc').removeClass('hide');
        } else if (id === 'search-sic') {
            $('.container-cun').addClass('hide');
            $('.container-doc').addClass('hide');
            $('.container-sic').removeClass('hide');
        }

        this.searchType = id;
    }

    handleChangeDocNum(e) {
        if (e.currentTarget.value.length > 5 && e.currentTarget.value.length < 12) {
            $('#input_doc_error').hide();
            this.docNumValid = true;
        } else {
            $('#input_doc_error').show();
            this.docNumValid = false;
        }

        this.docNum = e.currentTarget.value;
        this.isActiveButton();
    }

    handleChangeDocList(val, text) {
        this.docType = val;

        if (!val) {
            $('#list_doc_error').show();
        } else {
            $('#list_doc_error').hide();
        }

        this.isActiveButton();
    }

    isActiveButton() {
        let active = false;
        if (this.searchType === 'search-cun') {
            active = this.cunValid;
        } else if (this.searchType === 'search-doc') {
            active = this.docNumValid && this.docType;
        } else if (this.searchType === 'search-sic') {
            active = this.sicValid;
        }

        $("#pqr-status-button").attr("disabled", !active);
        return active;
    }

    createTableHtml(data, isMobile, type) {
        let html = String.empty;
        this.results = data;
        data.forEach((el, i) => {
            const reason = el.subcategory.toLowerCase();
            const reasonCapitalize = reason.charAt(0).toUpperCase() + reason.slice(1);
            let status = el.status
            if (el.status.indexOf('') === 2) {
                status = status.replace('', '');
            } else if (el.status.indexOf('') === 50) {
                status = status.replace('', '');
            }
            if (isMobile) {
                html += `
            <div class="row">
                    <div class="cell ${type === 'doc' && 'd-none'}">
                        <div class="title">${this.labels.lblresponsedate}</div>
                        <div class="content">${el.creationDate}</div>
                    </div>
					<div class="cell">
						<div class="title">${this.labels.lblresponsecun}</div>
						<div class="content">${el.cun}</div>
					</div>
					<div class="cell ${type === 'sic' && 'd-none'}">
						<div class="title">${this.labels.lblresponsedate}</div>
						<div class="content">${el.finishDate}</div>
					</div>
					<div class="cell">
						<div class="title">${this.labels.lblresponsereason}</div>
						<div class="content">${type === 'doc' ? el.reason : reasonCapitalize}</div>
					</div>
					<div class="cell">
						<div class="title">${type === 'doc' ? this.labels.lblresponsestatus : this.labels.lblresponsestatussic}</div>
						<div class="content">${status}</div>
					</div>
					<div class="cell">
						<div class="title">${type === 'doc' ? this.labels.lblverdetalle : this.labels.lblmasdetallesic}</div>
						<div class="content"><a class="link-details" data-order="${i}" href="#">${type === 'doc' ? this.labels.lblverdetalle : this.labels.lblvermas}</a></div>
					</div>
				</div>
            `;
            } else {
                html += `
            <tr>
                <td>${type === 'doc' ? el.finishDate : el.creationDate}</td>
                <td>${el.cun}</td>
                <td>${type === 'doc' ? el.reason : reasonCapitalize}</td>
                <td>${status}</td>
                <td><a href="#" data-order="${i}">${type === 'doc' ? this.labels.lblverdetalle : this.labels.lblvermas}</a></td>
            </tr>
            `;
            }
        });

        return html;
    }

    moreDetailsEventClick(e) {
        const order = e.currentTarget.dataset.order;
        const detailsData = this.results[Number.parseInt(order)];
        const reason = detailsData.subcategory.toLowerCase();
        const reasonCapitalize = reason.charAt(0).toUpperCase() + reason.slice(1);
        let status = detailsData.status
        if (detailsData.status.indexOf('') === 2) {
            status = status.replace('', '');
        } else if (detailsData.status.indexOf('') === 50) {
            status = status.replace('', '');
        }
        const html = `
        <div class="${this.searchType === 'search-sic' ? 'sic' : 'doc'}-details-result">
                    <div class="item">
                        <div class="title">${this.labels.lblresponsename}</div>
                        <div class="content">${detailsData.customerName}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.searchType === 'search-sic' ? this.labels.lblresponsedocumenttypesic : this.labels.lblresponsedocumenttype}</div>
                        <div class="content">${detailsData.identificationType}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.labels.lblresponsedocument}</div>
                        <div class="content">${detailsData.identificationNumber}</div>
                    </div>
                    <div class="item${this.searchType === 'search-sic' && detailsData.enterpriseName ? ' d-flex' : ' d-none'}">
                        <div class="title">${this.labels.lblresponseEnterpriseName || this.labels.lblresponseenterprisename}</div>
                        <div class="content">${detailsData.enterpriseName}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.labels.lblresponsecun}</div>
                        <div class="content">${detailsData.cun}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.labels.lblresponsedate}</div>
                        <div class="content">${detailsData.creationDate}</div>
                    </div>
                    <div class="item ${this.searchType === 'search-sic' && 'd-none'}">
                        <div class="title">${this.labels.lblresponsetype}</div>
                        <div class="content">${detailsData.subcategory}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.labels.lblresponsereason}</div>
                        <div class="content">${this.searchType === 'search-sic' ? reasonCapitalize : detailsData.reason}</div>
                    </div>
                    <div class="item">
                        <div class="title">${this.searchType === 'search-sic' ? this.labels.lblresponsestatussic : this.labels.lblresponsestatus}</div>
                        <div class="content">${status}</div>
                    </div>
                    <div class="item${this.searchType === 'search-sic' && ' sic-last-item'}">
                        <div class="title">${this.searchType === 'search-sic' ? this.labels.lblresponseestimateddatesic : this.labels.lblresponseestimateddate}</div>
                        <div class="content">${(this.searchType === 'search-sic' ? detailsData.finishDate : detailsData.estimateDate) || '--'}</div>
                    </div>
                    <div class="item ${this.searchType === 'search-sic' && 'd-none'}">
                        <div class="title">${this.labels.lblresponseclientemessage}</div>
                        <div class="content">${detailsData.message || '--'}</div>
                    </div>
                </div>
        `;

        this.popupComponent.replaceContentPopUp(html);
        this.popupComponent.activeManualPopUp();
    }
}

$('.resultadosPQR').each((i, val) => {
    const cunCode = document.getElementById("pqr-cun-code").value,
        sicCode = document.getElementById("pqr-sic-code").value,
        statusBody = document.getElementById("pqr-status-body"),
        cunCodeElem = $(val).find('#pqr-cun-code'),
        sicCodeElement = $(val).find('#pqr-sic-code');

    const PQRStatusInstance = new PqrStatus(cunCode, cunCodeElem, sicCode, sicCodeElement, statusBody);
    $('#pqr-status-button').click(() => PQRStatusInstance.getAndRenderStatus());
});

//Input solo nmeros
function validaNumericos(event) {
    if (event.charCode >= 48 && event.charCode <= 57) {
        return true;
    }
    return false;
}


function get4kFeature(path, component) {
    if (path) {
        GlobalData.getData(
            { path: path }
        ).subscribe(
            (res) => {
                fill4kFeature(res[0], component);
            }
        );
    }
}

function fill4kFeature(data, component) {
    try {
        if (data /* && data.featuredEvents*/) {
            const elementData = data.featuredElements.find((item) => item.currentEvent);

            if (elementData) {
                let compContainer = component.find('.comparator-container\x20.comparator-header');

                compContainer.find('.comparator-title\x20.title').text(elementData.title);
                compContainer.find('.comparator-title\x20.subtitle').text(elementData.subtitle);

                compContainer = component.find('.comparator-container\x20.programs');
                compContainer.find('.programs-title\x20.programs-text').text(elementData.titleSeparator);
                compContainer = compContainer.find('.programs-icon');
                elementData.icons.forEach((icon) => {
                    if (icon) {
                        compContainer.append(`<div class="program-icon"><img src="${icon}"></img></div>`);
                    }
                });
            }
        }
    } catch (error) {
        console.log(error);
    }
}

const resolutioncomparatorcomponents = $('.resolution-comparator-container');
resolutioncomparatorcomponents.each((index, element) => {
    const component = $(element);
    const path= component.data('path');
    get4kFeature(path, component);
});
let lastMouseX = null;
let mousePressed = false;

function pushed(event, isTouchDevice) {
    if (event.button == 0 || isTouchDevice) {
        mousePressed = true;
        lastMouseX = parseInt(event.pageX);
    }
}

function released(event, isTouchDevice) {
    if (event.button == 0 || isTouchDevice) {
        mousePressed = false;
    }
}

function move(event, isTouchDevice) {
    if (mousePressed) {
        // var foregroundOffset = $('.foreground').offset();
        // i'm gonna use it if the us requires using mouse pointer movements
        let pageX;

        if (isTouchDevice) {
            const touch = event.originalEvent.touches[0] || event.originalEvent.changedTouches[0];

            pageX = touch.pageX;
        } else {
            pageX = event.pageX;
        }

        const diffPosX = lastMouseX - parseFloat(pageX);

        let foregroundWidth = parseFloat($(".resolution-comparator .foreground").css("width"));
        let vertLineLeft = parseFloat($(".resolution-comparator .vert-line").css("left"));
        let horiButtonLeft = parseFloat($(".resolution-comparator .hori-button").css("left"));
        const min = 82;
        const max = (890 - 82 - 82 - 94) + 82;

        if (((foregroundWidth - diffPosX) <= max) && ((foregroundWidth - diffPosX) >= 0)) {
            vertLineLeft = vertLineLeft - diffPosX;
            $('.resolution-comparator .vert-line').css("left", vertLineLeft + "px");

            foregroundWidth = vertLineLeft - min;
            $(".resolution-comparator .foreground").css("width", foregroundWidth + "px");

            horiButtonLeft = horiButtonLeft - diffPosX;
            $('.resolution-comparator .hori-button').css("left", horiButtonLeft + "px");
        }

        lastMouseX = parseFloat(pageX);
    }
}

$('.resolution-comparator .hori-button').on("mousedown", (event) => {
    isTouchDevice = false;
    pushed(event, false);
});

$('.resolution-comparator .hori-button').on("mouseup", (event) => {
    isTouchDevice = false;
    released(event, false);
});

$('.resolution-comparator .hori-button').on("touchstart", (event) => {
    isTouchDevice = true;
    pushed(event, true);
});

$('.resolution-comparator .hori-button').on("touchend", (event) => {
    isTouchDevice = true;
    released(event, true);
});

$(document).on("mouseup", (event) => {
    if (mousePressed) {
        mousePressed = false;
    }
});

$('.resolution-comparator .container').bind("touchmove", (event) => {
    move(event, true);
});

$('.resolution-comparator .container').mousemove((event) => {
    move(event, false);
});
/**
 * Aws config class.
 */
class AwsVideos {
    constructor(dataElement) {
        this.helpers = new Helpers();
        this.s3 = null;
        this.extAccepted = ['MOV', 'MPEG-1', 'MPEG-2', 'MPEG4', 'MP4', 'MPG', 'AVI', 'WMV', 'MPEGPS', 'FLV', 'WEBM'];
        this.albumName = 'Qatar';
        const awsData = this.helpers.getConfigDataFromHtl(dataElement);
        this.available = true;
        if (!awsData) {
            console.log('invalid config element data.');
            this.available = false;
            return;
        }

        this.bucketName = awsData.bucketname;
        this.bucketRegion = awsData.bucketregion;
        this.IdentityPoolId = awsData.poolid;
        this.uuid = awsData.uuid;
        this.extAccepted = awsData.extAccepted ? awsData.extAccepted.split(',') : this.extAccepted;
        this.albumName = awsData.albumName ? awsData.albumName : this.albumName;
        this.initAws();
        this.domElements = this.getDomElements();
    }

    /**
     * Initialize AWS service and constructors.
     */
    initAws() {
        const $this = this;
        $.getScript('https://sdk.amazonaws.com/js/aws-sdk-2.1158.0.min.js', function (data, textStatus, jqxhr) {
            if (jqxhr.status == 200) {
                AWS.config.update({
                    region: $this.bucketRegion,
                    credentials: new AWS.CognitoIdentityCredentials({
                        IdentityPoolId: $this.IdentityPoolId
                    })
                });

                $this.s3 = new AWS.S3({
                    apiVersion: '2006-03-01',
                    params: { Bucket: $this.bucketName }
                });
            }
            else {
                console.log('Error loading aws functions .. status :: ' + jqxhr.status);
                $this.available = false;
            }
        });
    }

    /**
     * Add new video to AWS bucket.
     * @param {String} numDoc Document number from user for to create new video.
     * @param {String} country Country from user.
     * @param {String} name Name from user.
     * @returns Promise with upload results.
     */
    addVideo(numDoc, country, name) {
        const files = this.domElements.videoUpload.files;
        if (!this.available || !this.validateVideo(files[0])) return new Promise((res, reject) => reject('Invalid File.'));

        let ext = files[0].name.split('.');
        ext = (ext[ext.length - 1]);
        const fileName = `${encodeURIComponent(this.albumName)}/${this.formatFileName(numDoc, country, name)}.${ext}`;

        const upload = this.s3.upload({ Key: fileName, Body: files[0] }, (err, data) => {
            if (err) {
                console.log('%cerr:>> ', 'background-color:red;color:white', err);
                console.log('%cdata:>> ', 'background-color:orange;color:black', data);
            } else {
                console.log('%cSuccessfully uploaded video.', 'background-color:red;color:white');
            }
        }
        ).on('httpUploadProgress', progress => {
            this.domElements.progress.style.display = 'block';
            this.domElements.progress.value = parseInt((progress.loaded * 100) / progress.total);
        });

        return upload.promise();
    }

    /**
     * Search and send the DOM elements especified.
     * @returns Object with elements from DOM.
     */
    getDomElements() {
        return {
            videoUpload: document.getElementById(`videoupload-${this.uuid}`),
            progress: document.getElementById(`progress-${this.uuid}`)
        };
    }

    /**
     * Validate if the file is a valid video.
     * @param {File} file Video to send to AWS bucket.
     * @returns True/False with the video metadata validated.
     */
    validateVideo(file) {
        file = file ? file : this.domElements.videoUpload.files[0];
        
        if (!file || !file instanceof File) return false;

        let ext = file.name.split('.');
        if (ext.length < 2) return false;

        ext = (ext[ext.length - 1]).toUpperCase();
        if (!this.extAccepted.some(el => el.toUpperCase() == ext)) return false;

        if (file.size > 62914560) return false;

        return true;
    }

    /**
     * Format the file name with specific data.
     * @param {String} numDoc Document number from user for to create new video.
     * @param {String} country Country from user.
     * @param {String} name Name from user.
     * @returns String with the name to upload.
     */
    formatFileName(numDoc, country, name) {
        name = name.replace(/\s/g, '_');
        name = `${country}_${name}_${numDoc}`;
        return name.toLocaleLowerCase();
    }
}
QatarFormModule = (function () {
    const defaults = {
        selectors: {
            fullname: '.module-qatar-form-fullName',
            age: '.module-qatar-form-age',
            email: '.module-qatar-form-email',
            comments: '.module-qatar-form-comments',
            document: '.module-qatar-form-document',
            phone: '.module-qatar-form-phone',
            country: '.module-qatar-form-country',
            tyc: ".module-qatar-form-tyc",
            recaptcha: '.module-qatar-recaptcha',
            recaptchaContainer: '.recaptcha-container',
            send: '.module-qatar-form-button.submit',
            awsData: '.aws-data',
            uploadBtn: '.upload-background',
            updateProgress: '#progress',
            videoupload: '#videoupload',
            closeBtn: '.close',
            fileBox: '.file-box',
            fileName: '.file-name',
            isClientCheck: 'input[name="is-client"]',
            clientNumber: '.module-qatar-form-client-num',
            clientNumFieldSet: '.client-num-fieldset',
            waitMsg: '.wait-msg-container',
            provincia: '.module-qatar-form-provincia'
        },
        classes: {},
        events: {
            input: 'input',
            click: 'click',
            change: 'change'
        }
    };

    return class {
        constructor(id, options, editMode) {
            this.id = id;
            this.component = $('#' + this.id);
            this.editMode = editMode;
            this.eventEmitter = new rxjs.Subject();
            this.recaptchaEnabled = options.recaptchaEnabled;
            this.thankYouPage = options.thankYouPage;
            this.internalErrorMsg = options.internalErrorMsg;
            this.waitTimeMsg = options.waitTimeMsg && !isNaN(options.waitTimeMsg) ? options.waitTimeMsg : 25;
            this.isUploading = false;

            this.initComponent();
        }

        initComponent() {
            const el = this;

            this.$awsData = this.component.find(defaults.selectors.awsData);
            const awsVideos = new AwsVideos(this.$awsData);
            this.$uploadBtn = this.component.find(defaults.selectors.uploadBtn);
            this.$updateProgress = this.component.find(`${defaults.selectors.updateProgress}-${this.id}`);
            this.$videoupload = this.component.find(`${defaults.selectors.videoupload}-${this.id}`);
            this.$closeBtn = this.component.find(defaults.selectors.closeBtn);
            this.$fileBox = this.component.find(defaults.selectors.fileBox);
            this.$fileName = this.component.find(defaults.selectors.fileName);
            this.$isClientCheck = this.component.find(defaults.selectors.isClientCheck);
            this.$clientNumber = this.component.find(defaults.selectors.clientNumber);
            this.$clientNumFieldSet = this.component.find(defaults.selectors.clientNumFieldSet);
            this.$waitMsg = this.component.find(defaults.selectors.waitMsg);
            this.$provincia = this.component.find(defaults.selectors.provincia);
            this.$uploadBtn.on(defaults.events.click, () => this.$videoupload.click());
            this.$isClientCheck.on(defaults.events.click, this.isClientChangeEvt);
            this.$closeBtn.on(defaults.events.click, () => {
                this.$fileBox.hide();
                this.$videoupload.val('');
            });

            this.$fullname = this.component.find(defaults.selectors.fullname);
            this.$age = this.component.find(defaults.selectors.age);
            this.$email = this.component.find(defaults.selectors.email);
            this.$comments = this.component.find(defaults.selectors.comments);
            this.$document = this.component.find(defaults.selectors.document);
            this.$phone = this.component.find(defaults.selectors.phone);
            this.$country = this.component.find(defaults.selectors.country);
            this.$tyc = this.component.find(defaults.selectors.tyc);
            this.$recaptcha = this.component.find(defaults.selectors.recaptcha);
            //btn envio
            this.$send = this.component.find(defaults.selectors.send);
            this.updateValidStateOfButton(false)

            this.$fullname.inputComponent({ errorMessage: '' });
            this.$age.inputComponent({ errorMessage: '' });
            this.$email.inputComponent({ errorMessage: '' });
            this.$comments.inputComponent({ errorMessage: '' });
            this.$document.inputComponent({ errorMessage: '' });
            this.$phone.inputComponent({ errorMessage: '' });
            this.$videoupload.inputComponent({ errorMessage: '' });
            this.$provincia.inputComponent({ errorMessage: '' });

            let v = []
            for (const key in defaults.selectors) {
                if (Object.hasOwnProperty.call(defaults.selectors, key)) {
                    v.push(defaults.selectors[key])
                }
            }

            $(v.join(',')).on(defaults.events.change, () => {
                this.check();
            });
            $(defaults.selectors.tyc).on(defaults.events.change, () => {
                if ($(defaults.selectors.tyc).is(':checked')) {
                    $('.check-error-container .directv-input-error').css('display', 'none')
                } else {
                    $('.check-error-container .directv-input-error').css('display', 'block')
                }
            });

            this.$videoupload.on(defaults.events.change, (e) => {
                const isValid = awsVideos.validateVideo();
                const $errMsg = $(e.target).siblings('.directv-input-error');
                this.$fileBox.show();
                this.$fileName.text(`${e.target.files[0].name} (${(e.target.files[0].size / 1048576).toFixed(2)} MB)`);

                if (isValid) {
                    $errMsg.hide();

                } else {
                    $errMsg.show();
                }
                el.check();
            });

            this.component.submit(function (e) {
                e.preventDefault();
                if (el.recaptchaEnabled && siteKey && el.$recaptcha.val() === 'false') {
                    return false
                }

                el.toggleButtons(false);
                // Activacion de mensaje de espera.
                el.isUploading = true;
                setTimeout(() => el.$waitMsg.removeClass('hide'), (el.waitTimeMsg * 1000));

                awsVideos.addVideo(el.$document.val(), el.$country.val(), el.$fullname.val())
                    .then(res => {
                        console.log('el.clientNumber.val() :>> ', el.$clientNumber.val());
                        el.isUploading = false;
                        $.ajax({
                            type: "POST",
                            data: {
                                FullName: el.$fullname.val(),
                                Age: el.$age.val(),
                                Country: el.$country.val(),
                                NumDoc: el.$document.val(),
                                CellPhone: el.$phone.val(),
                                Email: el.$email.val(),
                                Comment: el.$comments.val(),
                                CampaingName: 'Qatar',
                                clientNumber: el.$clientNumber.val() ? el.$clientNumber.val() : '0',
                                Attachment: res.Location,
                                provincia: el.$provincia.val()
                            },
                            url: "/bin/public-sites/qatar",
                        }).done(function (data) {
                            el.isUploading = false;
                            console.log('inicia redirect');
                            window.open(el.thankYouPage + data.id, '_self');
                        }).fail(function (jqXHR, textStatus, error) {
                            el.isUploading = false;
                            console.log(`%cERROR::${textStatus}::`, 'background-color:red;color:white;', error);
                            el.showAlert("error", this.internalErrorMsg);
                            el.toggleButtons(true);
                        });
                    })
                    .catch(err => {
                        console.log('err >> ', err);
                        el.$waitMsg.addClass('hide')
                        el.$updateProgress.hide();
                        el.$videoupload.siblings('.directv-input-error')
                            .show()
                            .find('.flex').text(el.internalErrorMsg);
                        el.showAlert("error", this.internalErrorMsg);
                        el.toggleButtons(true);
                    });
            });
        }
        check() {
            let isValid = true
            if (!$(this.$fullname).val() || $(this.$fullname).hasClass('invalid')) isValid = false
            if (!$(this.$age).val() || $(this.$age).hasClass('invalid')) isValid = false
            if (!$(this.$email).val() || $(this.$email).hasClass('invalid')) isValid = false
            if (!this.isClientSelected() || (this.isClientSelected() === 'si' && !this.$clientNumber.val())) isValid = false
            if (!$(this.$comments).val() || $(this.$comments).hasClass('invalid')) isValid = false
            if (!$(this.$document).val() || $(this.$document).hasClass('invalid')) isValid = false
            if (!$(this.$phone).val() || $(this.$phone).hasClass('invalid')) isValid = false
            if (!$(this.$country).val() || $(this.$country).hasClass('invalid')) isValid = false
            if (!$(this.$provincia).val() || $(this.$provincia).hasClass('invalid')) isValid = false
            if (!$(this.$videoupload).val() || $(this.$videoupload).hasClass('invalid')) isValid = false
            if (!$(this.$tyc).is(':checked')) isValid = false
            if (this.recaptchaEnabled && siteKey && this.$recaptcha.val() === 'false') isValid = false
            isValid = isValid && !this.isUploading;

            this.updateValidStateOfButton(isValid)
        }

        updateValidStateOfButton(isValid) {
            if (this.recaptchaEnabled && siteKey && this.$recaptcha.val() === 'false') {
                this.$recaptcha.addClass('validation-missing');
            }

            if (isValid && ((this.recaptchaEnabled && this.$recaptcha.val() === 'true') || !this.recaptchaEnabled || !siteKey)) {
                this.$send.addClass('btn-primary');
                this.$send.removeAttr('disabled', 'disabled');
                this.$recaptcha.removeClass('validation-missing');
            } else {
                this.$send.removeClass('btn-primary');
                this.$send.attr('disabled', 'disabled');
            }
        }

        showAlert(type, msg) {
            const $alertComponent =
                GeneralComponentContainer.getComponentByName("Alert");

            if ($alertComponent) {
                switch (type) {
                    case "error":
                        $alertComponent.setTitle("Error");
                        $alertComponent.setDescription(msg);
                        break;
                    case "success":
                        $alertComponent.setTitle("Exto");
                        $alertComponent.setDescription(msg);
                        break;
                }

                $alertComponent.setStatus(type);
                $alertComponent.showAlert();
            }
        }

        toggleButtons(isActive) {
            if (isActive) {
                this.$uploadBtn.removeAttr('disabled', 'disabled').addClass('btn-primary');
                this.component.find(defaults.selectors.recaptchaContainer).removeClass('no-visible');
                this.check();
            } else {
                this.$uploadBtn.attr('disabled', 'disabled').removeClass('btn-primary');
                this.$send.attr('disabled', 'disabled').removeClass('btn-primary');
                this.component.find(defaults.selectors.recaptchaContainer).addClass('no-visible');
            }
        }

        isClientSelected() {
            const selected = Array.from(this.$isClientCheck).find(x => x.checked);
            return selected ? selected.value : null;
        }

        isClientChangeEvt() {
            switch (this.isClientSelected()) {
                case 'si':
                    this.$clientNumFieldSet.show();
                    this.$clientNumber.attr('required', 'required');
                    break;

                default:
                    this.$clientNumFieldSet.hide();
                    this.$clientNumber.removeAttr('required');
                    break;
            }
        }
    };
})();

const QatarFormComponents = $('.module-qatar-form-component');
QatarFormComponents.each((_index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const editMode = component.data('editmode');
    const options = {
        recaptchaEnabled: component.data('recaptchaenabled'),
        thankYouPage: component.data('thankyoupage'),
        internalErrorMsg: component.data('internalerrormsg'),
        waitTimeMsg: component.data('waittimemsg')
    };

    GeneralComponentContainer.setComponent(new QatarFormModule(id, options, editMode), id);
});

class productOrderDataComponent {
    constructor(id, i18nData, locale, filter, country) {
        this.id = id;
        this.locale = locale;
        this.country = country;
        this.i18nData = i18nData;
        this.component = $('#' + this.id);
        this.filter = filter;
        this.filterSegments = {};
        this.cardsData = [];

        this.filterOptios = this.component.find('.plans-clasification .btn-option');
        this.allButton = this.component.find('#btn-all');
        this.posButton = this.component.find('#btn-post');
        this.preButton = this.component.find('#btn-pre');
        this.strButton = this.component.find('#btn-str');
        this.styleTypeValue = this.component.data('styletype') ? this.component.data('styletype') : 'old';
        this.styleTypeNew = this.styleTypeValue === 'new';

        this.lowToHigh = this.component.find('#btn-HighToLow');
        this.highToLow = this.component.find('#btn-LowToHigh');
        this.hoverCont = this.component.find('#hover-container');

        this.hoverCont.hover(
            () => {
                this.hoverCont.addClass('open');
            },
            () => {
                this.hoverCont.removeClass('open');
            }
        )

        this.hoverCont.find('.drop-action').on('click', () => {
            this.hoverCont.addClass('open');
        })

        this.eventEmitter = new rxjs.BehaviorSubject({ event: 'create', data: '' });

        this.btnOption = this.component.find('.btn-option');
        this.cardContainer = this.component.find('.cards-container');
        this.refreshPlans = false;
        this.filterNames = {
            all: '',
            post: DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.POSTPAID,
            pre: DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID,
            str: DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.DTVGO
        };
        this.getSegmentsAutocompleteComponent();

        if (this.segmentsAutocompleteComponent) {
            this.segmentsAutocompleteComponent.eventEmitter.pipe(
                rxjs.operators.filter(info => info && info.event === "segmentUpdated"),
                rxjs.operators.mergeMap(
                    (info) =>
                        rxjs.combineLatest(
                            ajax2Observable(
                                $.ajax({
                                    url: `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}plans.html/${this.locale}`
                                })
                            ).pipe(
                                rxjs.operators.map(data => data.body)
                            ),
                            GlobalData.getData(GlobalData.defaults.requestData.SETTINGS)
                        )
                )
            ).subscribe(
                (result) => {
                    this.fillComponent(result[0], result[1]);
                    this.refreshPlans = true;
                }
            )
        } else {
            this.getData().subscribe(
                (result) => {
                    this.fillComponent(result[0], result[1]);
                }
            );
        }
    }

    getSegmentsAutocompleteComponent() {
        if (!this.editMode) {
            const $segmentsAutocompleteComponent = this.component.find(".segments-autocomplete");

            if ($segmentsAutocompleteComponent.length) {
                this.segmentsAutocompleteComponent = $segmentsAutocompleteComponent[0]
                    && $segmentsAutocompleteComponent[0].instance;
            }
        }
    }

    getData() {
        return GlobalData.getMultipleData([
            { path: `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}plans.html/${this.locale}` },
            GlobalData.defaults.requestData.SETTINGS
        ]);
    }

    fillComponent(result, settings) {
        this.cardContainer.html("");

        if (result instanceof Array) {
            let count = 0;
            let plansPrioritized = [];
            let plansPrepaid = [];
            let planPostpaid = [];
            let plansDtvgo = [];
            let allPlans = [];
            const subjectsArray = [];
          
            let cardsPlan = result
                .filter((item) => (item.hasOwnProperty('hidden') ? item.hidden === false : true) &&
                    (item.hasOwnProperty('showOnlyCalculator') ? item.showOnlyCalculator === false : true));

            cardsPlan = cardsPlan.filter((item) => !item.legacy);
              
            cardsPlan.forEach((cardData) => {

                   if(cardData.type === "postpaid" && cardData.order < 1){
                    planPostpaid.push(cardData);
                   }

                   if(cardData.type === "prepaid" && cardData.order < 1){
                    plansPrepaid.push(cardData);
                   }

                   if(cardData.type === "dtvgo" && cardData.order < 1){
                    plansDtvgo.push(cardData);
                   }

                   if(cardData.order >= 1){
                    plansPrioritized.push(cardData);
                   }

                }
                
            );
             
            planPostpaid.sort((a,b)=> a.price < b.price ? 1:-1)
            plansPrepaid.sort((a,b)=> a.price < b.price ? 1:-1)
            plansDtvgo.sort((a,b)=> a.price < b.price ? 1:-1)
            plansPrioritized.sort((a,b)=> a.order > b.order ? 1:-1)

            allPlans = plansPrioritized.concat(planPostpaid,plansDtvgo,plansPrepaid);
          
            allPlans.forEach(
               
                (cardData) => {
                 
                    const component = this.styleTypeNew ? $(`<div class="single-plan-card-container ${cardData.hidden && 'hiddePlan'} plan internet-card-new-container"></div>`) : $(`<div class="single-plan-card-container ${cardData.hidden && 'hiddePlan'} plan"></div>`);
                    const planCard = this.styleTypeNew ? new InternetCardNewComponent(component, null) : new SinglePlanCardComponent(component, '', this.i18nData, this.country);
                    this.styleTypeNew ? planCard.singleInternetCardFillData(cardData) : planCard.singlePlanCardfillData(cardData, settings[cardData.type]);
                    subjectsArray.push(planCard.eventEmitter);
                    this.cardContainer.append(component);
                    count += 1;
               
    
                    if (count === allPlans.length) {       
                        this.setFilters();
                     
                    }
                   
                }
                
            );
           
            this.eventEmitter.next({ event: 'end-load', data: rxjs.from(subjectsArray).pipe(rxjs.operators.mergeMap((item) => item)) });
                document.querySelector('div[product-type=dtvgo]').classList.remove("plan");
            }
  
        }

    filterBySelectedFilter() {
        this.validateType(this.filterSegments.type);
        this.sortCards(this.filterSegments.sort);
    }

    setFilters() {
        this.cardContainer.removeClass('withfilter');
        this.cardContainer.removeClass('nofilter');

        this.cardContainer.find('.single-plan-card-container').each((index, element) => {
            const card = $(element);
            const price = card.data('price');
            const title = card.find('.header\x20.title').text();
            this.cardsData.push([card, price, title]);
      
        });

        if (this.filter.hide) {
            this.filterCards(this.filter.type);
            this.filterSegments.sort = this.filter.sort === 'lth';
            this.sortCards(this.filterSegments.sort);

            this.cardContainer.addClass('nofilter');
        } else {
            if (this.refreshPlans) {
                this.filterBySelectedFilter();
            } else {
                this.filterByQueryString();
            }

            this.cardContainer.addClass('withfilter');
            this.styleTypeNew && this.cardContainer.addClass('internet-cards-new-container');
            this.styleTypeNew && this.cardContainer.addClass('cards-new');
        }

        if (!this.refreshPlans) {
            this
            this.lowToHigh.on('click', () => {
                this.hoverCont.removeClass('open');
                this.filterSegments.sort = true;
                this.sortCards(true);
            });

            this.highToLow.on('click', () => {
                this.hoverCont.removeClass('open');
                this.filterSegments.sort = false;
                this.sortCards(false);
            });

            this.allButton.on('click', () => {
                this.btnOption.removeClass("selected");
                this.allButton.addClass('selected');
                this.filterSegments.type = this.allButton.data('type');
                this.filterCards(this.filterNames.all);
            });
            this.preButton.on('click', () => {
                this.btnOption.removeClass("selected");
                this.preButton.addClass('selected');
                this.filterSegments.type = this.preButton.data('type');
                this.filterCards(this.filterNames.pre);
            });
            this.posButton.on('click', () => {
                this.btnOption.removeClass("selected");
                this.posButton.addClass('selected');
                this.filterSegments.type = this.posButton.data('type');
                this.filterCards(this.filterNames.post);
            });
            this.strButton.on('click', () => {
                this.btnOption.removeClass("selected");
                this.strButton.addClass('selected');
                this.filterSegments.type = this.strButton.data('type');
                this.filterCards(this.filterNames.str);
            });
        }
    }
    
    sortCards(order) {
        this.cardsData.sort(
            (a, b) => {
                if (a[1] === b[1]) {
                    return [a[2], b[2]].sort()[0] === a[2] ? order ? -1 : 1 : order ? 1 : -1;
                } else {
                    return a[1] - b[1];
                }
            }
        ).forEach((item, index) => {
            item[0].css('order', JSON.stringify(order ? index : index * -1));
        });
    }
    
    filterByQueryString() {
        const _qs = new URLSearchParams(location.search);
        const plans = _qs.get('plans');

        if (plans != null) {
            this.filterSegments.type = plans;
            this.validateType(plans);
        } else {
            this.filterSegments.type = this.validateSegmentsType(countryPS, window.location.hash.replace('#', ''));
            this.validateType(this.filterSegments.type);
        }
    }

    validateType(type) {
        switch (type) {
            case DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID:
                this.btnOption.removeClass("selected");
                this.preButton.addClass('selected');
                this.filterCards(this.filterNames.pre);
                break;
            case DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.POSTPAID:
                this.btnOption.removeClass("selected");
                this.posButton.addClass('selected');
                this.filterCards(this.filterNames.post);
                break;
            case DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.STREAM:
                if (this.filter.enableGoFilter) {
                    this.btnOption.removeClass("selected");
                    this.strButton.addClass('selected');
                    this.filterCards(this.filterNames.str);
                }
                break;
            default:
                this.btnOption.removeClass("selected");
                this.allButton.addClass('selected');
                this.filterCards(this.filterNames.all);
        }
    }

    filterCards(filter) {
        this.cardContainer.find('.single-plan-card-container').each(
            (index, element) => {
                const card = $(element);
                const typeValue = card.attr('product-type');

                if (filter === this.filterNames.all) {
                    card.css('display', 'flex');
                } else {
                    card.css('display', filter == typeValue ? 'flex' : 'none');
                }
            }
        );
    }

    validateSegmentsType(country, segment) {
        const data = DIRECTV_PUBLIC_SITES_CONSTANTS.PLAN_NAMES[country];
        let value = '';

        Object.keys(data).map((name) => {
            if (data[name] === segment) {
                value = name;

                return;
            }
        });

        return value;
    }

}

const prodorderclasificationcomponents = $('.prod-order-clasification-cont');
prodorderclasificationcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const translateData = {
        month: component.data('month'),
        channels: component.data('channels'),
        select: component.data('select'),
        recharge: component.data('recharge'),
        seemore: component.data('seemore'),
        get: component.data('get'),
        requires: component.data('requires'),
        prepaidkit: component.data('prepaidkit'),
        from: component.data('from'),
        prepaidText: component.data('prepaidtext'),
        postpaidText: component.data('postpaidtext'),
        chatUrl: component.data('chaturl'),
    };
    const filter = {
        hide: component.data('hide'),
        type: component.data('type'),
        sort: component.data('sort'),
        enableGoFilter: component.data('enablegofilter') ? true : false
    };
    const locale = component.data('locale');
    const country = component.data('country');

    GeneralComponentContainer.setComponent(new productOrderDataComponent(id, translateData, locale, filter, country), id);
});
const HIDEFILTER = "[name='./hidefilter']";
const FILTEROPTION = "[name='./filter']";
const SORTOPTION = "[name='./sort']";

$(document).on("foundation-contentloaded", function () {
    $(HIDEFILTER).change((e) => {
        showFilterOptions($(e.target));
    });

    showFilterOptions($(HIDEFILTER));
});

function showFilterOptions(element) {
    let hidden = !element.prop('checked');

    $(FILTEROPTION).parent().parent().parent().attr('hidden', hidden);
    $(SORTOPTION).parent().parent().parent().attr('hidden', hidden);
}
ProductFeaturedContainer = (function () {
    const defaults = {
        cardTemplate: `
        <div class="feature-plan-icon">
            <div class="product-feature">
                <div class="feature-icon">
                    <img src="{{icon}}" alt="" />
                </div>
                <div class="feature-body ant-level1">
                    <div class="feature-title ant-value">{{title}}</div>
                    <div class="feature-description">
                        {{#if callToAction}}
                            <a target="{{target}}" class="ant-link ant-action ant-level2" href="{{url}}">{{description}}</a>
                        {{else}}
                            {{description}}
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>`,
        productTypes: {
            prepaid: 'prepaid',
            postpaid: 'postpaid',
            dtvgo: 'dtvgo',
            dtvflex: 'dtvflex'
        }
    };

    return class {
        constructor(path, id, target) {
            this.path = path;
            this.component = $('#' + id);
            this.target = target;
            this.initComponent();
        }

        initComponent() {
            if (typeof productDeatailsLandingComponent !== 'undefined') {
                const observable = productDeatailsLandingComponent.setObservable();

                if (observable) {
                    observable.subscribe((data) => {
                        if (data.plan.productFeatures) {
                            this.fillComponent(data.plan);
                        }
                    });
                }
            } else {
                this.getPlanData();
            }
        }

        getPlanData() {
            if (this.path) {
                GlobalData.getData(
                    { path: this.path }
                ).subscribe(
                    (res) => {
                        this.fillComponent(res[0]);
                    }
                );
            }
        }

        fillComponent(plan) {
            this.setBackgroundImages({
                "urlBackgroundImageDesktop": plan.urlBackgroundImageDesktop,
                "urlBackgroundImageMobile": plan.urlBackgroundImageMobile
            });
            this.setFeatures(plan.productFeatures);
            this.setResizedBackgroundImage(plan.type === defaults.productTypes.dtvgo)
        }
        
        setBackgroundImages(backgroundImages) {
            this.component.attr('style', `--bg-desktop: url('${backgroundImages.urlBackgroundImageDesktop}'); 
                --bg-mobile: url('${backgroundImages.urlBackgroundImageMobile}')`);
        }

        setFeatures(features) {
            this.component.find('.feature-plan-icon-container').empty();
            features.forEach((ft) => {
                this.setFeature(ft);
            });
        }

        setFeature(feature) {
            feature = {...feature, ...{ target: this.target || '_self' }};

            this.component.find('.feature-plan-icon-container').append(
                Handlebars.compile(defaults.cardTemplate)(feature)
            );
        }

        setResizedBackgroundImage(isDirectvGo) {
            this.setBackgroundImage(isDirectvGo);
            $(window).resize(() => {
                this.setBackgroundImage(isDirectvGo);
            });
        }

        setBackgroundImage(isDirectvGo) {
            const width = $(window).width();

            if (width < (isDirectvGo ? 768 : 480)) {
                this.component.addClass('mobile-tablets-style');
            } else {
                this.component.removeClass('mobile-tablets-style');
            }
        }
    };
})();

const productfeaturecontainercomponents = $('.product-feature-container');
productfeaturecontainercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    let path = component.data('path');
    let target =component.data('target');
    GeneralComponentContainer.setComponent(new ProductFeaturedContainer(path, id, target), id)
});
function CallMeLaterGeneralForm(context, config) {
    this.context = context;
    this.reqTyc;
    this.reqLti;
    this.reqCti;
    this.ltiStore; 
    this.ctiStore;
    this.config = Object.assign({}, {
        name: {
            pattern: "^(?:[A-Za-z0-9:\\u00f1\\u00d1\\s]*)$"
        },
        lastName: {},
        idclienteinput: {pattern: null},
        fullName: {},
        indicative: {
            pattern: "([0-9]*)$"
        },
        phone: {
            pattern: "([0-9]*)$"
        },
		mobileArea: {errorSelector: '.indicative-input-error-new', pattern: null},
        mobileNew: {errorSelector: '.phone-input-error-new', pattern: null},
        document: {},
        usercorp: {},
        wspInput: {
            pattern: "([0-9]*)$"
        },
        address: {
            pattern: "^([a-zA-Z-0-9#-:\\u00f1\\u00d1\\s]*)$"
        },
        zip: {
            pattern: "^(?:[A-Za-z0-9 _]*)$"
        },
        city: {
            pattern: "[()a-zA-Z-0-9:\\u00f1\\u00d1\\s]*"
        },
        urbanization: {
            pattern: "[a-zA-Z-0-9:\\u00f1\\u00d1\\s]*"
        },
        neighborhood: {
            pattern: "[a-zA-Z-0-9:\\u00f1\\u00d1\\s]*"
        },
        apartments: {
            pattern: "^[0-9]+$"
        },
        schedule: {
            pattern: "[a-zA-Z-0-9:\\u00f1\\u00d1\\s]*"
        },
        email: {
            pattern: "^([A-Za-z0-9_\\-.])+@([A-Za-z0-9_\\-.])+\\.([A-Za-z]{2,4})$"
        },
        comments: {},
        paymentReference: {},
        amountTv: {
            pattern: '^[1-2][0-9]?$|^[1-9]$|^30$'
        },
        depLabel: {
            pattern: "[a-zA-Z-0-9:\\u00f1\\u00d1\\s]*"
        }
    }, config);
}

CallMeLaterGeneralForm.prototype.getInputFields = function () {
    this.generalConfig = {
        inputCall: this.updateValidState.bind(this)
    };
    this.$fullName = new InputValidations(
        this.context.component.find('.module-callme-later-fullName'),
        Object.assign({}, this.generalConfig, this.config.fullName)
    );
    this.$name = new InputValidations(
        this.context.component.find('.module-callme-later-name'),
        Object.assign({}, this.generalConfig, this.config.name)
    );
    this.$lastName = new InputValidations(
        this.context.component.find('.module-callme-later-last-name'),
        Object.assign({}, this.generalConfig, this.config.lastname)
    );
    this.$idClienteInput = new InputValidations(
        this.context.component.find('.module-callme-later-idCliente'),
        Object.assign({}, this.generalConfig, this.config.idclienteinput)
    );
    this.$email = new InputValidations(
        this.context.component.find('.module-callme-later-email'),
        Object.assign({}, this.generalConfig, this.config.email)
    );
    this.$comments = new InputValidations(
        this.context.component.find('.module-callme-later-comments'),
        Object.assign({}, this.generalConfig, this.config.comments)
    );
    this.$document = new InputValidations(
        this.context.component.find('.module-callme-later-document'),
        Object.assign({}, this.generalConfig, this.config.document)
    );
    this.$indicative = new InputValidations(
        this.context.component.find('.phone-indicative-input'),
        Object.assign({}, this.generalConfig, this.config.indicative)
    );
    this.$phone = new InputValidations(
        this.context.component.find('.module-callme-later-phone'),
        Object.assign({}, this.generalConfig, this.config.phone)
    );
    // this.$mobileArea = new InputValidations(
    //     this.context.component.find('.mobile-indicative-select-new'),
    //     Object.assign({}, this.generalConfig, this.config.mobileArea)
    // );
    this.$mobileNew = new InputValidations(
        this.context.component.find('.module-callme-later-phone-new'),
        Object.assign({}, this.generalConfig, this.config.mobileNew)
    );
    this.$wspInput = new InputValidations(
        this.context.component.find('.wsp-info input'),
        Object.assign({}, this.generalConfig, this.config.wspInput)
    );
    this.$schedule = new InputValidations(
        this.context.component.find('.module-callme-later-schedule'),
        Object.assign({}, this.generalConfig, this.config.schedule)
    );
    this.$address = new InputValidations(
        this.context.component.find('.module-callme-later-address'),
        Object.assign({}, this.generalConfig, this.config.address)
    );
    this.$city = new InputValidations(
        this.context.component.find('.module-callme-later-city'),
        Object.assign({}, this.generalConfig, this.config.city)
    );
    this.$urbanization = new InputValidations(
        this.context.component.find('.module-callme-later-urbanization'),
        Object.assign({}, this.generalConfig, this.config.urbanization)
    );
    this.$neighborhood = new InputValidations(
        this.context.component.find('.module-callme-later-neighborhood'),
        Object.assign({}, this.generalConfig, this.config.neighborhood)
    );
    this.$zip = new InputValidations(
        this.context.component.find('.module-callme-later-zip'),
        Object.assign({}, this.generalConfig, this.config.zip)
    );
    this.$apartments = new InputValidations(
        this.context.component.find('.module-callme-later-apartments'),
        Object.assign({}, this.generalConfig, this.config.apartments)
    );

    this.$usercorp = new InputValidations(
        this.context.component.find('.module-callme-later-corpuser'),
        Object.assign({}, this.generalConfig, this.config.usercorp)
    );

    this.$amountTv = new InputValidations(
        this.context.component.find('.module-callme-later-amountTv'),
        Object.assign({}, this.generalConfig, this.config.amountTv)
    );
    this.$depLabel = new InputValidations(
        this.context.component.find('.module-callme-later-depLabel'),
        Object.assign({}, this.generalConfig, this.config.depLabel)
    );

    this.$areYouClient = this.context.component.find('.is-client-radio');
    this.$matches = this.context.component.find('.directv-input.select-matches');
    this.$locations = this.context.component.find('.directv-input.select-locations');
    this.$rublo = this.context.component.find('.category-rublo');
    this.$provincia = this.context.component.find('.category-provincia');
    this.$hour = this.context.component.find('.hour-select');
    //this.$comments = this.context.component.find('.module-callme-later-comments');
    this.$dateOfPayment = this.context.component.find('.module-callme-later-datepicker');
    this.$test = this.context.component.find('.module-callme-later-component');
    this.$inputCti = $('input#module-callme-later-cti');
    this.$inputLti = $('input#module-callme-later-data');
    this.$formComponent = $('.module-callme-later-component');
    this.$formComponent.each((index, element) => {
        const component = $(element);
        this.reqTyc   = component.data('usetycreq') ? component.data('usetycreq') : false;
        this.reqLti   = component.data('useltireq') ? component.data('useltireq') : false;
        this.reqCti   = component.data('usectireq') ? component.data('usectireq') : false;
        this.ltiStore = component.data('useltisave') ? component.data('useltisave') : false;
        this.ctiStore = component.data('usectisave') ? component.data('usectisave') : false;
    });
    

    this.$paymentReference = new InputValidations(
        this.context.component.find('.module-callme-later-paymentreference'),
        Object.assign({}, this.generalConfig, this.config.paymentReference)
    );

    if (this.context.useTyc) {
        this.$callmeLaterTyc = this.context.component.find('#module-callme-later-tyc');
        this.$callmeLaterTyc.inputComponent();
        this.$callmeLaterTyc.change(this.updateValidState.bind(this));
    }

    if (this.context.useLti) {
        this.$callmeLaterData = this.context.component.find('#module-callme-later-data');
        this.$callmeLaterData.inputComponent();
        this.$callmeLaterData.change(this.updateValidState.bind(this));
    }

    if (this.context.useCti) {
        this.$callmeLaterCti = this.context.component.find('#module-callme-later-cti');
        this.$callmeLaterCti.inputComponent();
        this.$callmeLaterCti.change(this.updateValidState.bind(this));
    }    

    if (this.context.useWhs) {
        this.$callmeLaterWhs = this.context.component.find('#module-callme-later-whatsapp');
        this.$callmeLaterWhs.inputComponent();
        this.$callmeLaterWhs.change(this.updateValidState.bind(this));
    }        

    if(this.$matches) {
        this.$matches.change(this.updateValidState.bind(this));
    }

    if(this.$locations) {
        this.$locations.change(this.updateValidState.bind(this));
    }

    if(this.$rublo) {
        this.$rublo.change(this.updateValidState.bind(this));
    }    

    if(this.$provincia) {
        this.$provincia.change(this.updateValidState.bind(this));
    }        

    if(this.$hour) {
        this.$hour.change(this.updateValidState.bind(this));
    }

    if(this.$dateOfPayment) {
        this.$dateOfPayment.change(this.updateValidState.bind(this));
    }
};

CallMeLaterGeneralForm.prototype.initProperties = function () {
    this.$fullName.reset();
    this.$name.reset();
    this.$lastName.reset();
    this.$idClienteInput.reset();
    this.$email.reset();
    this.$comments.reset();
    this.$document.reset();
    this.$schedule.reset();
    this.$indicative.reset();
    this.$phone.reset();
	if (typeof this.$mobileArea != "undefined") this.$mobileArea.reset();
    if (typeof this.$mobileNew != "undefined") this.$mobileNew.reset();
    this.$wspInput.reset();
    this.$address.reset();
    this.$city.reset();
    this.$urbanization.reset();
    this.$neighborhood.reset();
    this.$zip.reset();
    this.$apartments.reset();
    this.$usercorp.reset();
    this.$hour.find('option[value=""]').prop('selected',true);
    this.$matches.find('option[value=""]').prop('selected',true);
    this.$locations.find('option[value=""]').prop('selected',true);
    this.$rublo.find('option[value=""]').prop('selected',true);
    this.$provincia.find('option[value=""]').prop('selected',true);
    this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
    //this.$dateOfPayment.val('');
    this.$paymentReference.reset();
    this.$depLabel.reset();
};

CallMeLaterGeneralForm.prototype.validateWsp = function(){

}

CallMeLaterGeneralForm.prototype.updateValidState = function () {
    setTimeout(() => {
        let isvalid = [
            this.$fullName.isValid(),
            this.$name.isValid(),
            this.$lastName.isValid(),
            this.$email.isValid(),
            this.$comments.isValid(),
            this.$document.isValid(),
            this.$schedule.isValid(),
//            this.$phone.isValid(),
//            this.$mobileArea.isValid(),
//            this.$mobileNew.isValid(),
            this.$address.isValid(),
            this.$city.isValid(),
            this.$urbanization.isValid(),
            this.$neighborhood.isValid(),
            this.$zip.isValid(),
            this.$apartments.isValid(),
            this.$paymentReference.isValid(),
            this.$amountTv.isValid(),
            this.$depLabel.isValid(),
            this.reqTyc ? this.reqTyc : (this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true),
            this.reqLti ? this.reqLti : (this.context.useLti ? this.$callmeLaterData.prop('checked') && this.$callmeLaterData.is(':valid') : true),
            this.reqCti ? this.reqCti : (this.context.useCti ? this.$callmeLaterCti.prop('checked') && this.$callmeLaterCti.is(':valid') : true)
        ];

		if (g_useImprovedCtrls && this.$phoneType.filter(":checked").val() === 'mobile') {
			if (typeof this.$mobileArea != "undefined") isvalid.push(this.$mobileArea.isValid());
			if (typeof this.$mobileNew != "undefined") isvalid.push(this.$mobileNew.isValid());
		}
		else{
            isvalid.push(this.$indicative.isValid());
            isvalid.push(this.$phone.isValid());
		}

        let validcorp;
        if($('#cop-user-field').length > 0){
            validcorp = $('#cop-user-field').css('display') == 'none';
            isvalid.push(!validcorp ? this.$usercorp.isValid() : true);
        }

        // if($('.wsp-question input').length > 0 && $('.wsp-question input').prop('checked') == true){
        //     isvalid.push(this.$wspInput.isValid());
        // }

        const isValid = isvalid.reduce((isValid, inputValid) => {
            return isValid && inputValid;
        }, true);
		
        this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
    }, 200)
};

CallMeLaterGeneralForm.prototype.invalidateInputComponents = function () {
    this.$fullName.invalidate();
    this.$name.invalidate();
    this.$lastName.invalidate();
    this.$document.invalidate();
    this.$schedule.invalidate();
    this.$indicative.invalidate();
    this.$phone.invalidate();
    if (typeof this.$mobileArea != "undefined") this.$mobileArea.invalidate();
    if (typeof this.$mobileNew != "undefined") this.$mobileNew.invalidate();
    this.$wspInput.invalidate();
    this.$email.invalidate();
    this.$comments.invalidate();
    this.$address.invalidate();
    this.$city.invalidate();
    this.$urbanization.invalidate();
    this.$neighborhood.invalidate();
    this.$zip.invalidate();
    this.$apartments.invalidate();
    this.$usercorp.invalidate();
//    this.$dateOfPayment.invalidate();
    this.$paymentReference.invalidate();
    this.$amountTv.invalidate();
    this.$callmeLaterTyc && this.$callmeLaterTyc.inputComponentInvalidate();
    this.$callmeLaterData && this.$callmeLaterData.inputComponentInvalidate();
    this.$callmeLaterCti && this.$callmeLaterCti.inputComponentInvalidate();
    this.$callmeLaterWhs && this.$callmeLaterWhs.inputComponentInvalidate();
    this.$depLabel.invalidate();
};

CallMeLaterGeneralForm.prototype.extractData = function () {
    let fullname  = "";
    let acceptCti = this.$inputCti.is(":checked");
    let acceptLti = this.$inputLti.is(":checked");    

    fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();

    const sample = {
        identification: this.$document.value() || '0',
        fullname: fullname,
        phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
        email: this.$email.value(),
        schedule: this.$schedule.value(),
        isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
        comments: this.$comments.value().trim().slice(0, 500) || '',
        accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
        accept_promotionsContact: this.ctiStore ? acceptCti : false,
        idClientInput: parseInt(this.$idClienteInput.value()) || 0,
        depLabel: this.$depLabel.value()
    };

    return sample;
};

CallMeLaterGeneralForm.prototype.peruSpecializedLogic = function () {
    this.$phoneType = this.context.component.find('input[name="phone-type"]');
    this.$PhoneIndicative = this.context.component.find('.phone-indicative-select');
    this.$mobileIndicative = this.context.component.find('.mobile-indicative-select');
    this.$mobileIndicative.attr('disabled', true);
    const $matchesBox = $('#radio-group');
    $matchesBox.addClass('radio-group-peru');
    $($matchesBox[0]?.previousElementSibling).removeClass('province-field-set');
    
    if (this.$phoneType.length &&
        this.$PhoneIndicative.length &&
        this.$phone.inputRef
    ) {
        const resizeAction = () => {
            const width = this.context.component.outerWidth();
            if (width < 375) {
                this.$PhoneIndicative.css("max-width", "65px");
            } else {
                this.$PhoneIndicative.css("max-width", "unset");
            }
        }
        const phoneTypeAction = () => {
            const value = this.$phoneType.filter(":checked").val();

            this.$phone.reset();

            if (value === 'mobile') {
                this.$PhoneIndicative.hide();
                this.$mobileIndicative.show();
                this.$phone.setPattern("^9[0-9]{8}$");

                this.$phone.setInputMask(
                    {
                        mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/]
                    }
                );
            } else {
                this.$PhoneIndicative.show();
                this.$mobileIndicative.hide();
                indicativeAction();
            }
        };

        const indicativeAction = () => {
            const indicativeValue = this.$PhoneIndicative.find(":selected").val();
            const typeValue = this.$phoneType.filter(":checked").val();

            if (typeValue === 'landline') {
                if (indicativeValue === '01') {
                    this.$phone.setPattern("^[0-9]{7}$");
                    this.$phone.setInputMask(
                        {
                            mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/]
                        }
                    );
                } else {
                    this.$phone.setPattern("^[0-9]{6}$");
                    this.$phone.setInputMask(
                        {
                            mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/]
                        }
                    );
                }
            }
        };

        phoneTypeAction();
        indicativeAction();
        resizeAction();
        this.$phoneType.change(phoneTypeAction.bind(this));
        this.$PhoneIndicative.change(indicativeAction.bind(this));
        $(window).resize(resizeAction.bind(this));
    }
}

CallMeLaterGeneralForm.prototype.specializedUruguayLogic = function () {
    this.$Role = this.context.component.find('.module-callme-later-role');
    this.$phoneType = this.context.component.find('input[name="phone-type"]');
    const phoneTypeAction = () => {
        this.$phone.reset();
        const phoneTypeVal = this.$phoneType.filter(":checked").val();

        if (phoneTypeVal === 'mobile') {
            this.$phone.setPattern('^[0-9]{9}$');
            this.$phone.setInputMask({
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 9
                })
            });
        } else {
            this.$phone.setPattern('^[0-9]{8}$');
            this.$phone.setInputMask({
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 8
                })
            });
        }
    };

    phoneTypeAction();
    this.$phoneType.change(phoneTypeAction.bind(this));
};

CallMeLaterGeneralForm.prototype.specializedVenezuelaLogic = function () {
    this.$phone.setPattern('^[0-9]{0,11}$');
    this.$document.setPattern('^[0-9]{0,10}$');
}

CallMeLaterGeneralForm.prototype.specializedEcuadorLogic = function () {
    this.$phoneType = this.context.component.find('input[name="phone-type"]');
    this.$phone.setPattern('^[0-9]{0,8}$');
    this.$document.setPattern('^[0-9]{0,10}$');
}

CallMeLaterGeneralForm.prototype.setClassesOnCalendar = function(){
    
    $('.pmu-today').removeClass('pmu-selected');
    $('.pmu-next.pmu-button').addClass('dtv-public-icon-chevron-left');
    $('.pmu-prev.pmu-button').addClass('dtv-public-icon-chevron-right');
}
callMeLaterVenezuelaBuilding = (context)=> {
    const venezuelaBuildingform = new CallMeLaterGeneralForm(context);

    venezuelaBuildingform.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");        
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const interestedIn = this.context.component.find('.module-callme-later-interestedIn').find(":selected").val();
        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            utmSource: "",
            interestedIn: interestedIn,
            fullname: fullname,
            phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            address: this.$address.value(),
            city: this.$city.value(),
            urbanization: this.$urbanization.value(),
            neighborhood: this.$neighborhood.value(),
            apartments: this.$apartments.value(),
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: this.$comments && this.$comments.value(),
            clientNumber: 0,
            isBuilding: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };
        return sample;
    };

    venezuelaBuildingform.getInputFields();
    venezuelaBuildingform.initProperties();
    venezuelaBuildingform.specializedVenezuelaLogic();

    return venezuelaBuildingform;
};

callMeLaterVenezuelaCorp = (context)=> {
    const venezuelaCorpform = new CallMeLaterGeneralForm(context);

    venezuelaCorpform.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");        
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const interestedIn = this.context.component.find('.module-callme-later-comercialservices').find(":selected").val();
        const interestedInText = this.context.component.find('.module-callme-later-comercialservices').find(":selected").text();
        let extraColumn = "";
        extraColumn = "RIF.: " + this.$document.value().replace(/\./g, '') + " // Tipo de empresa: " + this.context.component.find('.module-callme-later-enterpriseKind').find(":selected").val() + " // Estado: " + this.$urbanization.value() + " // Ciudad: " + this.$city.value() + " // Interesado en: " + interestedInText;
        const sample = {
            identification: '0',
            utmSource: "",
            extracolumn: extraColumn,
            interestedIn: interestedIn,
            fullname: fullname,
            phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: this.$comments && this.$comments.value(),
            clientNumber: 0,
            isBuilding: 0,
            isCorp: 1,
            isRegistered: true,
            prostectId: "string",
            referrerIbsId: 0,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };
        return sample;
    };

    venezuelaCorpform.getInputFields();
    venezuelaCorpform.initProperties();
    venezuelaCorpform.specializedVenezuelaLogic();

    return venezuelaCorpform;
};

callMeLaterArgentinaBuilding = (context)=> {
    const ecuadorForm = new CallMeLaterGeneralForm(context);

    ecuadorForm.getInputFields();
    ecuadorForm.initProperties();

    return ecuadorForm;
};

callMeLaterArgentinaInternet = (context) => {
    const argentinaInternetForm = new CallMeLaterGeneralForm(context, {
        phone: {
            errorSelector: '.phone-input-error',
        },
        document: {
            mask: createNumberMask({
                prefix: '',
                thousandsSeparatorSymbol: '.',
                integerLimit: 20
            }),
            pattern: '^\\d+(\\d|\\.)*\\d+$'
        },
    });
    /// General Selectors
    const allSelectors = {
        matcheSel:      document.getElementById('matcheSel'),
        locationSel:    document.getElementById('locationSel'),
        radioOption:    document.getElementById('radio-group'),
        queryMatches:   $('#matcheSel'),
        queryLocation:  $('#locationSel')
    }    

    argentinaInternetForm.locationsMatchesValidation = function () {
        if (allSelectors.matcheSel && allSelectors.locationSel) {
            return true;
        } 
        return false;
    }

    argentinaInternetForm.initLocations = function () {
        const {fetchSegments, onChangeItem} = argentinaInternetForm;
        fetchSegments();
        argentinaInternetForm.locationsMatchesValidation() && onChangeItem(allSelectors.matcheSel);
    }


    argentinaInternetForm.handleClickItems = function (selector) {
        const {fetchData, validLocations} = argentinaInternetForm;
        selector.onclick = function(e){
            fetchData(e, '');
            if (argentinaInternetForm.locationsMatchesValidation()) {
                validLocations(false);
            }
        }
    }


    argentinaInternetForm.onChangeItem = function (selector) {
        const { tagCreator, setAtt, setAppend } = argentinaInternetForm;
        const { locationSel, queryLocation } = allSelectors;

        selector.onchange =  async function () {
            let setMatch = $(this).find('option:selected').attr("class");
            
            if(setMatch !== undefined){
                const getEvents = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTS}/${setMatch}`;
                try{

                    let getDataC = await fetch(getEvents);
       
                    if(getDataC.status === 200){
                        let dataLoc = await getDataC.json();   
                        let targetEl       = document.createElement('option');
                        let getPlaceholder = $('.module-callme-later-component').attr('data-locationsPlaceholder');

                        setAtt(targetEl, {"value": ""});
                        targetEl.innerHTML = getPlaceholder; 
                        setAppend(locationSel, {targetEl});          
                        queryLocation.find('option').not(':first').remove();
                         for(let i of dataLoc.body){
                            for (let a of i.locations){   
                                    tagCreator(a, locationSel);
                                }
                            }                   
                            // Transform Options
                            $("#locationSel option").each(function() {
                                $(this).text($(this).text().charAt(0).toUpperCase() + $(this).text().slice(1).toLowerCase());
                    
                        });          
                                            
                    }else{ throw new Error('Error en la peticion') }            
                } catch(err){console.log(err)} 
            } else {
                console.log('Error en la peticion');
            }

        }
    }


    argentinaInternetForm.fetchData = async function(e, load){
        var saveVal;
        if(load !== ''){
            saveVal = load;
        } else { 
            saveVal = e.target.value; 
        }
        
        const { matcheSel, queryMatches, queryLocation } = allSelectors;            
        const getSegment = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHES}/${saveVal}`;
        try{
            let getData = await fetch(getSegment);
            if(getData.status === 200){
                let dataSeg = await getData.json();

                if (argentinaInternetForm.locationsMatchesValidation()) {
                    queryMatches.find('option').not(':first').remove();
                    queryLocation.find('option').remove();
                    for(let i of dataSeg.body){
                        for (let a of i.events){            
                            argentinaInternetForm.tagCreator(a, matcheSel);
                        }
                    }
                }
    
            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }
    }


    argentinaInternetForm.fetchSegments = async function(){
        const {tagRadioCreator, setAtt, handleClickItems, fetchData} = argentinaInternetForm;
        const getSegme = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHES}`;
        
        try{
            let getData = await fetch(getSegme);
            if(getData.status === 200){

                let dataSeg = await getData.json();   
                let revBody = dataSeg.body;

                let total =dataSeg.total;
                let classCol="col-3";
                if(total===1){
                    classCol ="col-12"
                }
        
                if(total===2){
                    classCol ="col-6"
                }
        
                if(total===3){
                    classCol ="col-4"
                }
                for(let i in revBody){         
                    tagRadioCreator(revBody[i], classCol,allSelectors.radioOption, i);
                }
                const check0 =  document.getElementById('check0');
                setAtt(check0, {"checked": "checked"});

                // Call consulta
                fetchData(null, check0.value);

                const check1 =  document.getElementById('check1');
                const check2 =  document.getElementById('check2');
                handleClickItems(check0);
                handleClickItems(check1);
                handleClickItems(check2);  

            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }                     
    }   



    argentinaInternetForm.tagCreator = function (data, selector){
        if(data !== null){
            const { setAtt, setAppend } = argentinaInternetForm;
            let elem  = document.createElement('option');
            let value = document.createTextNode([data.name]);
            setAtt(elem, {"class": [data.id], "value": [data.name]});
            setAppend(elem, {value});
            setAppend(selector, {elem});   
        }
        
    }       


    argentinaInternetForm.tagRadioCreator = function (data,classCol, selector, index){
        const { setAtt, setAppend } = argentinaInternetForm;
        let col  = document.createElement('div');
        setAtt(col, {"class": classCol});

        let cell = document.createElement('div');
        setAtt(cell, {"class": "cell"});

        let label = document.createElement('label');
        
        let labelVal;

        if(data !== null){
            labelVal = document.createTextNode([data.name]);
        }

        let input = document.createElement('input');
        setAtt(input, {"type": "radio", "value": [data.id], "name": "segments", "id": `check${index}`, "class": "radio-service"});

        let span = document.createElement('span');
        setAtt(span, {"class": "checkmark"});

        setAppend(label, {labelVal, input, span});
        setAppend(cell, {label});
        setAppend(col, {cell});
        setAppend(selector, {col});

    }    

    argentinaInternetForm.setAtt = function (el, attrs) {
        for(var key in attrs) {
            el.setAttribute(key, attrs[key]);
        }
    }    
    
    argentinaInternetForm.setAppend = function (elm, att) {
        for(var key in att) {
            elm.appendChild(att[key]);
        }
    }     

    argentinaInternetForm.validLocations = function (val) {
        if (argentinaInternetForm.locationsMatchesValidation()) {
            let selElm  = document.querySelector('.select-locations'); 
            let eleText = document.querySelector('.directv-select-help-text'); 
            let ele     = document.querySelector('.directv-select-error');
            if(val){
                selElm.classList.add('touched');
                eleText.style.display = 'none';
                ele.style.display = 'block';
            } else {
                selElm.classList.remove('touched');
                ele.classList.remove('select-locations-error');
                ele.style.display = 'none';
            }
        }
    }         


    argentinaInternetForm.updateValidState = function () {
        const { validLocations } = argentinaInternetForm;
        const setLocations = () => {
            let hasclas = $(".directv-select-error" ).hasClass( "select-locations-error" );

            if(hasclas === true){
                validLocations(false);
            }

            if(this.$locations.val() !== ""){
                validLocations(false);
                return this;
            }

            if(this.$locations.val() === "" && hasclas === false){
                validLocations(true);
            }
        }

        setTimeout(() => {
            let inputPhone = document.querySelector(".module-callme-later-phone-new").value;
            let isvalid = [
                this.$fullName.isValid(),
                this.$name.isValid(),
                this.$lastName.isValid(),
                this.$email.isValid(),
                this.$document.isValid(),
                inputPhone !== "",
                this.$matches.val() !== "",
                setLocations(),
                this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true,
                this.context.useLti ? this.$callmeLaterData.prop('checked') & this.$callmeLaterData.is(':valid') : true
            ]

            const isValid = isvalid.reduce((isValid, inputValid) => {
                return isValid && inputValid;
            }, true);
    
            this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
        }, 200)        
    };

    argentinaInternetForm.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');
        this.$planName  = context.component.find('.module-callme-later-planName');
        this.$dni       = context.component.find('.module-callme-later-document');
        this.$address   = context.component.find('.module-callme-later-address');
        this.$location  = context.component.find('.select-locations');
        
        this.phoneIndicativeValidations = () => {

            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phone.setPattern(`15[0-9]{${7 - value.length},${11 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                } else {
                    this.$phone.setPattern(`[0-9]{${9 - value.length},${13 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                }
            }
        }
        
        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            const phoneTypeVal = this.$phoneType.filter(":checked").val();
            this.$phoneIndicative.setValue('');
            if (phoneTypeVal === 'mobile') {
                this.$phone.setValue('15');
            } else {
                this.$phone.setValue('');
            }
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "^0((11[0-9]{0,2})|((2|3)[0-9]{1,3}))$",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );
        
        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
        
    };

    argentinaInternetForm.extractData = function () {
        var addressAr;
        var zipAr;
        if(document.querySelector('.module-callme-later-address')){
            addressAr = document.querySelector('.module-callme-later-address').value;
        } else { addressAr = ""; }

        if(document.querySelector('.module-callme-later-zip')){
            zipAr = document.querySelector('.module-callme-later-zip').value;
        } else { zipAr = ""; }
        
        let fullname    = "";
        let acceptCti   = this.$inputCti.is(":checked");
        let acceptLti   = this.$inputLti.is(":checked");        
        const planName  = this.$planName.val();
        const dni       = this.$dni.val();
        const location  = this.$location.find(":selected").val();
        const segment = $(allSelectors.radioOption).find(":checked")[0].labels[0].innerText;
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();

        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            fullname: fullname,
            email: this.$email.value(),
            neighborhood: '',
            dep_label: '',
            phone: this.$phoneIndicative.value() + this.$phone.value(),
            city: `${location ? location : ''}`,
            segment,
            product: `${planName === "" ? '' : planName}`,
            comments: `Solicitud: ${planName === "" ? '' : planName}, DNI: ${dni}, Direccin: ${addressAr === "" ? 'Direccin' : addressAr}, Cd. Postal: ${zipAr === "" ? 'Cdigo Postal' : zipAr}, Localidad: ${location ? location : ''}, Segment: ${segment ? segment : ''} Comentarios: ${this.$comments.length && this.$comments.value().trim().slice(0, 500) || ''}`,
            isInternet: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };

    argentinaInternetForm.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phoneIndicative.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$callmeLaterTyc && this.$callmeLaterTyc.inputComponentInvalidate();
        this.$callmeLaterData && this.$callmeLaterData.inputComponentInvalidate();
    };

    argentinaInternetForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$phoneIndicative.reset();
        this.$comments.reset();
        this.$matches.find('option[value=""]').prop('selected',true);
        this.$locations.find('option[value=""]').prop('selected',true);
        argentinaInternetForm.phoneTypeAction();
    };

    argentinaInternetForm.getInputFields();
    argentinaInternetForm.specializedLogic();
    argentinaInternetForm.initProperties();
    // Init Locations dropdown
    argentinaInternetForm.initLocations();

    return argentinaInternetForm;
};

callMeLaterArgentinaCorp = (context)=> {
    const argentinaCorporateForm = new CallMeLaterGeneralForm(context, {
        phone: {
            errorSelector: '.phone-input-error'
        },
        document: {
            mask: createNumberMask({
                prefix: '',
                thousandsSeparatorSymbol: '.',
                integerLimit: 20
            }),
            pattern: '^\\d+(\\d|\\.)*\\d+$'
        },
    });

    // updateValidState
    argentinaCorporateForm.updateValidState();
    //  = function () {
    //     const validcorp = $('#cop-user-field').css('display') == 'none';
    //     argentinaCorporateForm.updateValidState();
    //     setTimeout(() => {
    //         const isValid = [
    //             this.$fullName.isValid(),
    //             this.$name.isValid(),
    //             this.$lastName.isValid(),
    //             this.$email.isValid(),
    //             this.$document.isValid(),
    //             this.$phone.isValid(),
    //             !validcorp ? this.$usercorp.isValid() : true,
    //             this.$rublo.val() !== "0",
    //             this.$provincia.val() !== "0",
    //             this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true,
    //             this.context.useLti ? this.$callmeLaterData.prop('checked') & this.$callmeLaterData.is(':valid') : true
    //         ].reduce((isValid, inputValid) => {
    //             return isValid && inputValid;
    //         }, true);

    //         this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
    //     }, 200)
    // };
    
    // updateValidState
    argentinaCorporateForm.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');

        this.phoneIndicativeValidations = () => {
            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phone.setPattern(`15[0-9]{${7 - value.length},${11 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                } else {
                    this.$phone.setPattern(`[0-9]{${9 - value.length},${13 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                }
            }
        }

        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            const phoneTypeVal = this.$phoneType.filter(":checked").val();
            this.$phoneIndicative.setValue('');
            if (phoneTypeVal === 'mobile') {
                this.$phone.setValue('15');
            } else {
                this.$phone.setValue('');
            }
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "^0((11[0-9]{0,2})|((2|3)[0-9]{1,3}))$",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );

        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
    };    

    // extractData
    argentinaCorporateForm.extractData = function () {

        let razonsocial = this.$name.value();
        let fullname    = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        let provincia   = this.$provincia.find(":selected").val();
        let rubro       = this.$rublo.find(":selected").val();
        let comments    = "Usuario: " + this.$usercorp.value() + " // Provincia: " + this.$provincia.find(":selected").text() + " // Rubro: " + rubro + " // Razon Social: " + razonsocial + " // Comentarios: " + this.$comments.value().trim().slice(0,500);
        let acceptCti   = this.$inputCti.is(":checked");
        let acceptLti   = this.$inputLti.is(":checked");        

        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            fullname: fullname,
            email: this.$email.value(),
            isClient: 0,
            phone: this.$phoneIndicative.value() + this.$phone.value(),
            comments: comments,
            clientNumber: 0,
            isCorp: 1,
            aditionalEmailsTo: provincia,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };    

    // invalidateInputComponents
    argentinaCorporateForm.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$phoneIndicative.invalidate();
        this.$usercorp.invalidate();
        this.$callmeLaterTyc && this.$callmeLaterTyc.inputComponentInvalidate();
        this.$callmeLaterData && this.$callmeLaterData.inputComponentInvalidate();
    };    

    // initProperties
    argentinaCorporateForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$phoneIndicative.reset();
        this.$comments.reset();
        this.$usercorp.reset();
        this.$rublo.find('option[value=""]').prop('selected',true);
        this.$provincia.find('option[value=""]').prop('selected',true);        
        argentinaCorporateForm.phoneTypeAction();
    };    

    // setParamUser
    argentinaCorporateForm.setParamUser = function () {
        let userInput    = document.getElementById('cop-user-field');
        let queryParams  = window.location.search;
        let urlParams    = new URLSearchParams(queryParams); 
        let checkParam   = urlParams.has('useractive');
        return checkParam ? userInput.style.display = 'block' : userInput.style.display = 'none';
    }

    argentinaCorporateForm.getInputFields();
    argentinaCorporateForm.specializedLogic();
    argentinaCorporateForm.initProperties();
    argentinaCorporateForm.setParamUser();


    return argentinaCorporateForm;
};
callMeLaterArgentina = (context) => {
    const argentinaForm = new CallMeLaterGeneralForm(context, {
        phone: {
            errorSelector: '.phone-input-error'
        },
        document: {
            mask: createNumberMask({
                prefix: '',
                thousandsSeparatorSymbol: '',
                integerLimit: 20
            }),
            pattern: '^\\d{0,20}$'
        },
    });

    argentinaForm.updateValidState();
    //  = function () {
    //     setTimeout(() => {
    //         const isValid = [
    //             this.$fullName.isValid(),
    //             this.$name.isValid(),
    //             this.$lastName.isValid(),
    //             this.$email.isValid(),
    //             this.$document.isValid(),
    //             this.$schedule.isValid(),
    //             this.$phone.isValid(),
    //             this.$phoneIndicative.isValid(),
    //             this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true,
    //             this.context.useLti ? this.$callmeLaterData.prop('checked') & this.$callmeLaterData.is(':valid') : true
    //         ].reduce((isValid, inputValid) => {
    //             return isValid && inputValid;
    //         }, true);

    //         this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
    //     }, 200)
    // };

    argentinaForm.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');
        this.$category = context.component.find('.category-select');
        this.$cardType = context.component.find('.card-type-select');

        this.phoneIndicativeValidations = () => {
            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phone.setPattern(`15[0-9]{${7 - value.length},${11 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                } else {
                    this.$phone.setPattern(`[0-9]{${9 - value.length},${13 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                }
            }
        }

        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            const phoneTypeVal = this.$phoneType.filter(":checked").val();
            this.$phoneIndicative.setValue('');
            if (phoneTypeVal === 'mobile') {
                this.$phone.setValue('15');
            } else {
                this.$phone.setValue('');
            }
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "^0((11[0-9]{0,2})|((2|3)[0-9]{1,3}))$",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );

        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
    };

    argentinaForm.extractData = function () {
        let fullname    = "";
        let acceptCti   = this.$inputCti.is(":checked");
        let acceptLti   = this.$inputLti.is(":checked");   
        const category  = this.$category.find(":selected").val();
        const cardType  = this.$cardType.find(":selected").val();     

        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const sample = {
            category: category,
            identificationType: cardType,
            identification: this.$document.value() || '0',
            fullname: fullname,
            email: this.$email.value(),
            schedule: this.$schedule.value(),
            phone: this.$phoneIndicative.value() + this.$phone.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: this.$comments && this.$comments.inputRef && this.$comments.inputRef.length && this.$comments.value().trim().slice(0, 500) || '',
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };

        return sample;
    };

    argentinaForm.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$schedule.invalidate();
        this.$phoneIndicative.invalidate();
        this.$callmeLaterTyc && this.$callmeLaterTyc.inputComponentInvalidate();
        this.$callmeLaterData && this.$callmeLaterData.inputComponentInvalidate();
    };

    argentinaForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$schedule.reset();
        this.$phone.reset();
        this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
        this.$phoneIndicative.reset();
        this.$comments.reset();
        argentinaForm.phoneTypeAction();
    };

    argentinaForm.getInputFields();
    argentinaForm.specializedLogic();
    argentinaForm.initProperties();

    return argentinaForm;
};

callMeLaterEcuador = (context)=> {
    const ecuadorForm = new CallMeLaterGeneralForm(context,
        { phone: {
            mask: createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: 10
            }),
            pattern: "^[0-9]{7,10}$"
        },
        document: {
            mask: [ /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, '-', /\d/ ],
            pattern: '^[0-9]{9}-[0-9]{1}$'
        }
        });

    ecuadorForm.getInputFields();
    ecuadorForm.initProperties();

    return ecuadorForm;
};


callMeLaterEcuadorInternet = (context) => {    
    const ecuadorInternetForm = new CallMeLaterGeneralForm(context,
        {
            document: {
                mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/],
                pattern: '^[0-9]{10}$'
            },
            isValidCallBack: context.updateValidStateOfButton.bind(context),
            useTyc: context.useTyc,
            useLti: context.useLti,
            useCti: context.useCti,
            useWhs: context.useWhs,
            specialLogic: {},
            getData: {}
        });

    ecuadorInternetForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();        
        let identification  = this.$document.value().replace(/\./g, '') || '0';
        let city            = document.querySelector('.module-callme-later-city').value;
        let provincia         = document.querySelector('.module-callme-later-urbanization').value;
        let comments = this.$comments.value();        
        // let dep = provincia;

        const sample = {
            identification: identification,
            fullname: fullname,
            email: this.$email.value(),
            isClient: (this.$areYouClient.length > 0 && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: `Internet, COMENTARIOS: ${comments}, CDULA: ${identification}, CIUDAD: ${city}, PROVINCIA: ${provincia}`,
            city,
            dep_label: provincia,
            product:'Internet-Ecuador',
            phone: this.$phone.value(),
            isInternet: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        
        return sample;
    };

    ecuadorInternetForm.getInputFields();
    ecuadorInternetForm.initProperties();
    ecuadorInternetForm.specializedEcuadorLogic();

    return ecuadorInternetForm;
};

callMeLaterUruguay = (context)=> {
    const uruguayForm = new CallMeLaterGeneralForm(context);

    uruguayForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$idClienteInput.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
        this.$comments && this.$comments.reset();
        this.specializedUruguayLogic();
    };

    uruguayForm.getInputFields();
    uruguayForm.initProperties();
    uruguayForm.specializedUruguayLogic();

    return uruguayForm;
};

callMeLaterColombia = (context) => {
    const colombiaForm = new CallMeLaterGeneralForm(context,
        {
            phone: {
                focus: (val) => {
                    val = val.replace(/ /g, '');
                    val = val.replace(/-/g, '');
                    val = val.replace(/\(/g, '');
                    val = val.replace(/\)/g, '');

                    return val;
                },
                blur: (val) => {
                    if (!val.includes(' ')) {
                        val = spliceSlice(val, -2, 0, ' ');
                        val = spliceSlice(val, -5, 0, ' ');
                        val = spliceSlice(val, -9, 0, ' ');
                    }

                    return val.trim();
                },
                inputRule: (event) => {
                    return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 10) ? true : false
                },
                pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$',
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 7
                }),
            },
            document: {
                mask: createNumberMask({
                    prefix: '',
                    thousandsSeparatorSymbol: '.',
                    integerLimit: 10
                }),
                pattern: '^\\d+(\\d|\\.)*\\d+$'
            }
        });

    colombiaForm.updateValidState();
    //  = function () {
    //     setTimeout(() => {
    //         const isValid = [
    //             this.$fullName.isValid(),
    //             this.$name.isValid(),
    //             this.$lastName.isValid(),
    //             this.$email.isValid(),
    //             this.$document.isValid(),
    //             this.$phone.isValid(),
    //             this.$phoneIndicative.isValid()
    //         ].reduce((isValid, inputValid) => {
    //             return isValid && inputValid;
    //         }, true);

    //         this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
    //     }, 200)
    // };

    colombiaForm.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');

        this.phoneIndicativeValidations = () => {
            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phoneIndicative.setPattern(`3(0|1|2|5)[0-9]`);
                    this.$phoneIndicative.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 3
                        })
                    });
                } else {
                    this.$phoneIndicative.setPattern(`(1|2|4|5|6|7|8){1}`);
                    this.$phoneIndicative.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 1
                        })
                    });
                }
            }
        }

        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            this.$phoneIndicative.setValue('');
            this.$phone.setValue('');
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "^[0-9]{3}$",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );

        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
    };

    colombiaForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            fullname: fullname,
            phone: this.$phoneIndicative.value() + this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: this.$comments && this.$comments.inputRef && this.$comments.inputRef.length && this.$comments.value().trim().slice(0, 500) || '',
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };
        return sample;
    };

    colombiaForm.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$phoneIndicative.invalidate();
    };

    colombiaForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
        this.$phoneIndicative.reset();
        this.$comments.reset();
        colombiaForm.phoneTypeAction();
    };

    colombiaForm.getInputFields();
    colombiaForm.specializedLogic();
    colombiaForm.initProperties();

    return colombiaForm;
};


callMeLaterPeru = (context) => {    
    const peruForm = new CallMeLaterGeneralForm(context,
        {
            document: {
                mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/],
                pattern: '^[0-9]{8}$'
            },
            isValidCallBack: context.updateValidStateOfButton.bind(context),
            useTyc: context.useTyc,
            useLti: context.useLti,
            useCti: context.useCti,
            useWhs: context.useWhs,
            specialLogic: {},
            getData: {}
        });

    peruForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const indicativeValue = this.$PhoneIndicative.find(":selected").val();
        const typeValue = this.$phoneType.filter(":checked").val();
        
        const sample = {
            identification: this.$document.value() || '0',
            fullname: fullname,
            email: this.$email.value(),
            isClient: $('input[name="is-client"]:checked').val().toLowerCase() === 'si' ? 1 : 0,
            comments: `Internet ${this.$comments && this.$comments.inputRef && this.$comments.inputRef.length && this.$comments.value().trim().slice(0, 500) || ''}`,
            phone: (typeValue === 'landline' ? indicativeValue : '') + this.$phone.value(),
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };

    peruForm.getInputFields();
    peruForm.initProperties();
    peruForm.peruSpecializedLogic();

    return peruForm;
};

callMeLaterPeruCorp = (context) => {
    const peruCorporateForm = new CallMeLaterGeneralForm(context,
        {
            document: {
                mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/],
                pattern: '^[0-9]{11}$'
            },
            isValidCallBack: context.updateValidStateOfButton.bind(context),
            useTyc: context.useTyc,
            useLti: context.useLti,
            specialLogic: {},
            getData: {},
        });

    peruCorporateForm.extractData = function () {
        let razonsocial = "";
        let comments = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        razonsocial = this.$name.value();
        const amountTv = this.$amountTv.value() || 0;
        comments = "rSocial: " + this.$document.value().replace(/\./g, '') + " //" + 'amountTv: ' + amountTv + ' //Comentarios: ' + this.$comments.value().trim().slice(0, 500)  +  ' //DepInstalacion: ' + this.$depLabel.value();
        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            utmSource: "",
            fullname: razonsocial,
            phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: comments,
            clientNumber: 0,
            isCorp: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false,
        };
        return sample;
    };

    peruCorporateForm.initProperties = function(){
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$usercorp.reset();
        this.$amountTv.reset();
        this.$comments.reset();
        this.$depLabel.reset();
    };

    peruCorporateForm.getInputFields();
    peruCorporateForm.initProperties();
    peruCorporateForm.peruSpecializedLogic();

    return peruCorporateForm;
};


callMeLaterPeruInternet = (context) => {
    context.component && context.country && $(context.component).addClass(context.country);
    const peruInternetForm = new CallMeLaterGeneralForm(context, {
        document: {
            mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/],
            pattern: '^[0-9]{8}$'
        },
        isValidCallBack: context.updateValidStateOfButton.bind(context),
        useTyc: context.useTyc,
        useLti: context.useLti,
        useCti: context.useCti,
        useWhs: context.useWhs,
        specialLogic: {},
        getData: {}
    });

    /// General Selectors
    const allSelectors = {
        matcheSel:      document.getElementById('matcheSel'),
        locationSel:    document.getElementById('locationSel'),
        radioOption:    document.getElementById('radio-group'),
        queryMatches:   $('#matcheSel'),
        queryLocation:  $('#locationSel')
    }

    peruInternetForm.initLocations = function () {
        const {fetchSegments, onChangeItem} = peruInternetForm;
        fetchSegments();
        onChangeItem(allSelectors.matcheSel);
    }

    peruInternetForm.handleClickItems = function (selector){
        const {fetchData, validLocations} = peruInternetForm;
        selector.onchange = function(e){
            fetchData(e, '');
            validLocations(false);
        }           
    }

    peruInternetForm.onChangeItem = function (selector) {
        const { tagCreator, setAtt, setAppend } = peruInternetForm;
        const { locationSel, queryLocation } = allSelectors;

        selector.onchange =  async function () {
            let setMatch = $(this).find('option:selected').attr("class");
            if(setMatch !== undefined){
                const getEvents = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTSPE}/${setMatch}`;
                try {
                    let getDataC = await fetch(getEvents);
                    if (getDataC.status === 200) {
                        let dataLoc = await getDataC.json();   
                        let targetEl       = document.createElement('option');
                        let getPlaceholder = $('.module-callme-later-component').attr('data-locationsPlaceholder');

                        setAtt(targetEl, {"value": ""});
                        targetEl.innerHTML = `-${getPlaceholder}-*`;
                        setAppend(locationSel, {targetEl});         
                        queryLocation.find('option').not(':first').remove();
                        
                        for(let i of dataLoc.body) {
                            for (let a of i.locations) {   
                                tagCreator(a, locationSel);
                            }
                        }                   
                        
                        // Transform Options
                        $("#locationSel option").each(function() {
                            $(this).text($(this).text().charAt(0) + $(this).text().slice(1));
                        });
                    } else {
                        throw new Error('Error en la peticion')
                    }            
                } catch (err) {
                    console.log(err)
                } 
            } else {
                console.log('Error en la peticion');
            }

        }
    }

    peruInternetForm.fetchData = async function(e, load){
        var saveVal;
        if(load !== ''){
            saveVal = load;
        } else { 
            saveVal = e.target.value; 
        }
        const { matcheSel, queryMatches, queryLocation } = allSelectors;            
        const getSegment = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHESPE}/${saveVal}`;
        try{
            let getData = await fetch(getSegment);
            if(getData.status === 200){
                let dataSeg = await getData.json();

                queryMatches.find('option').not(':first').remove();
                queryLocation.find('option').not(':first').remove();
    
                for(let i of dataSeg.body){
                    for (let a of i.events){            
                        peruInternetForm.tagCreator(a, matcheSel);
                    }
                }
            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }        
    }

    peruInternetForm.fetchSegments = async function(){
        const {tagSelectCreator, fetchData} = peruInternetForm;
        const getSegme = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHESPE}`;
        try{
            let getData = await fetch(getSegme);
            if(getData.status === 200){

                let dataSeg = await getData.json();   
                let revBody = dataSeg.body;

                tagSelectCreator(revBody, allSelectors.radioOption);

                const $select = $('#radio-group select');
                const selected0 =  $select[0].selectedOptions[0].value;

                // Call consulta
                fetchData(null, selected0);

                $select.on('change', function(e) {
                    fetchData(e, '');
                }); 

            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }                     
    }

    peruInternetForm.tagCreator = function (data, selector){
        if(data !== null){
            const { setAtt, setAppend } = peruInternetForm;
            let elem  = document.createElement('option');
            let value = document.createTextNode([data.name]);
            setAtt(elem, {"class": [data.id], "value": [data.name]});
            setAppend(elem, {value});
            setAppend(selector, {elem});
        }
        
    }

    peruInternetForm.tagSelectCreator = function (data, selector){
        const { setAtt, setAppend } = peruInternetForm;
        const $select = document.createElement('select');
        $($select).addClass('directv-input');
        const $selectWrapper = document.createElement('div');
        $($selectWrapper).addClass('directv-custom-select')
        const $arrowSelect = document.createElement('span');
        $($arrowSelect).addClass('directv-select-arrow');
        for (let item of data) {
            if(item !== null){
                let elem  = document.createElement('option');
                let value = document.createTextNode([item.name]);
                setAtt(elem, {"class": 'option-match', "value": [item.id]});
                setAppend(elem, {value});
                setAppend($select, {elem});
            }
        }
        $selectWrapper.append($select);
        $selectWrapper.append($arrowSelect);
        selector.append($selectWrapper);
    }

    peruInternetForm.setAtt = function (el, attrs) {
        for(var key in attrs) {
            el.setAttribute(key, attrs[key]);
        }
    }    
    
    peruInternetForm.setAppend = function (elm, att) {
        for(var key in att) {
            elm.appendChild(att[key]);
        }
    }

    peruInternetForm.validLocations = function (val) {
        let selElm  = document.querySelector('.select-locations'); 
        let eleText = document.querySelector('.directv-select-help-text'); 
        let ele     = document.querySelector('.directv-select-error');
        if(val){
            selElm.classList.add('touched');
            eleText.style.display = 'none';
            ele.style.display = 'block';
        } else {
            selElm.classList.remove('touched');
            ele.classList.remove('select-locations-error');
            ele.style.display = 'none';
        }
    }

    peruInternetForm.updateValidState = function () {
        const { validLocations } = peruInternetForm;
        const setLocations = () => {
            let hasclas = $(".directv-select-error" ).hasClass( "select-locations-error" );

            if(hasclas === true){
                validLocations(false);
            }

            if(this.$locations.val() !== ""){
                validLocations(false);
                return this;
            }

            if(this.$locations.val() === "" && hasclas === false){
                validLocations(true);
            }
        }

        setTimeout(() => {
            let inputPhone = document.querySelector(".module-callme-later-phone").value;
            let isvalid = [
                this.$fullName.isValid(),
                this.$name.isValid(),
                this.$lastName.isValid(),
                this.$email.isValid(),
                this.$document.isValid(),
                this.$address.isValid(),
                inputPhone !== "",
                this.$matches.val() !== "",
                setLocations(),
                this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true,
                this.context.useLti ? this.$callmeLaterData.prop('checked') & this.$callmeLaterData.is(':valid') : true
            ]

            const isValid = isvalid.reduce((isValid, inputValid) => {
                return isValid && inputValid;
            }, true);
    
            this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
        }, 200)        
    };

    peruInternetForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();        
        let identification  = this.$document.value().replace(/\./g, '') || '0';
        const department = $('#radio-group select').find(":selected").val();
        const region = this.$matches.find(":selected").val();
        const location  = $('#locationSel').find(":selected").val();
        let address            = document.querySelector('.module-callme-later-address').value;
        let comments = this.$comments.value();        
        let dep = location;
        
        const sample = {
            identification: identification,
            fullname: fullname,
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: `Internet, location: ${location}, city: ${department}, region: ${region}, COMENTARIOS: ${comments}, DNI: ${identification}, DIRECCION: ${address}`,
            location,
            region,
            address,
            city: department,
            dep_label:dep,
            product:'Internet-Peru',
            phone: this.$phone.value(),
            isInternet: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };

    peruInternetForm.getInputFields();
    peruInternetForm.initProperties();
    peruInternetForm.peruSpecializedLogic();
    peruInternetForm.initLocations();

    return peruInternetForm;
};

callMeLaterUruguayBuilding = (context)=> {
    const uruguayBuildingForm = new CallMeLaterGeneralForm(context);

    uruguayBuildingForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$idClienteInput.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
        this.$comments && this.$comments.reset();
        this.specializedUruguayLogic();
    };

    uruguayBuildingForm.extractData = function () {
        const role = this.$Role.find(":selected").val();
        let comments = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        razonsocial = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        comments = this.$comments.value().trim().slice(0,500) + ". Soy: " + role + ". Vivo en: " + this.$address.value() + ". CP: " + this.$zip.value() + ". Unidades funcionales: " + this.$apartments.value()
        const sample = {
            identification: '0',
            utmSource: "",
            fullname: razonsocial,
            phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            email: this.$email.value(),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            comments: comments,
            clientNumber: 0,
            isCorp: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false,
            idClientInput: parseInt(this.$idClienteInput.value()) || 0
        };
        return sample;
    };

    uruguayBuildingForm.getInputFields();
    uruguayBuildingForm.initProperties();
    uruguayBuildingForm.specializedUruguayLogic();

    return uruguayBuildingForm;
};

callMeLaterColombiaCorp = (context)=> {
    const colombiaCorporateForm = new CallMeLaterGeneralForm(context, {
        phone: {
            focus: (val) => {
                val = val.replace(/ /g, '');
                val = val.replace(/-/g, '');
                val = val.replace(/\(/g, '');
                val = val.replace(/\)/g, '');

                return val;
            },
            blur: (val) => {
                if (!val.includes(' ')) {
                    val = spliceSlice(val, -2, 0, ' ');
                    val = spliceSlice(val, -5, 0, ' ');
                    val = spliceSlice(val, -9, 0, ' ');
                }

                return val.trim();
            },
            inputRule: (event) => {
                return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 10) ? true : false
            },
            pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$',
            mask: createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: 7
            }),
        },
        indicative: {
            inputRule: (event) => {
                return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 3) ? true : false
            },
            //pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$'
            pattern: '^[0-9]{3}$',
            mask: createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: 3
            }),
        },
        document: {
            mask: createNumberMask({
                prefix: '',
                thousandsSeparatorSymbol: '.',
                integerLimit: 10
            }),
            pattern: '^\\d+(\\d|\\.)*\\d+$'
        }
    });

    colombiaCorporateForm.extractData = function () {
        let razonsocial = "";
        let comments = "";
        let url = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");           
        //razonsocial = this.$name.value();
        razonsocial    = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        comments = "NIT: " + this.$document.value().replace(/\./g, '') + " // Nombre de contacto: " + this.$fullName.value() + " // " + this.$comments.value().trim().slice(0,500);
        url = window.location.href;
        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            utmSource: "",
            fullname: razonsocial,
            phone: '' + this.$indicative.value() + this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            email: this.$email.value(),
            isClient: 0,
            comments: comments,
            clientNumber: 0,
            isCorp: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };
        return sample;
    }; 

    colombiaCorporateForm.getInputFields();
    colombiaCorporateForm.initProperties();

    return colombiaCorporateForm;
};

callMeLaterColombiaInter = (context) => {
    const colombiaFormInter = new CallMeLaterGeneralForm(context,
        {
            phone: {
                focus: (val) => {
                    val = val.replace(/ /g, '');
                    val = val.replace(/-/g, '');
                    val = val.replace(/\(/g, '');
                    val = val.replace(/\)/g, '');

                    return val;
                },
                blur: (val) => {
                    if (!val.includes(' ')) {
                        val = spliceSlice(val, -2, 0, ' ');
                        val = spliceSlice(val, -5, 0, ' ');
                        val = spliceSlice(val, -9, 0, ' ');
                    }

                    return val.trim();
                },
                inputRule: (event) => {
                    return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 10) ? true : false
                },
                pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$',
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 7
                }),
            },
            document: {
                mask: createNumberMask({
                    prefix: '',
                    thousandsSeparatorSymbol: '.',
                    integerLimit: 10
                }),
                pattern: '^\\d+(\\d|\\.)*\\d+$'
            }
        });

    colombiaFormInter.updateValidState();
    //  = function () {
    //     setTimeout(() => {
    //         const isValid = [
    //             this.$fullName.isValid(),
    //             this.$name.isValid(),
    //             this.$lastName.isValid(),
    //             this.$email.isValid(),
    //             this.$document.isValid(),
    //             this.$phone.isValid(),
    //             this.$address.isValid(),
    //             this.$city.isValid(),
    //             this.$neighborhood.isValid(),
    //             this.$hour.val() !== "",
    //             this.$phoneIndicative.isValid()
    //         ].reduce((isValid, inputValid) => {
    //             return isValid && inputValid;
    //         }, true);

    //         this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
    //     }, 200)
    // };

    colombiaFormInter.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');
        

        this.phoneIndicativeValidations = () => {
            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phoneIndicative.setPattern(`3(0|1|2|5)[0-9]`);
                    this.$phoneIndicative.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 3
                        })
                    });
                } else {
                    this.$phoneIndicative.setPattern(`(1|2|4|5|6|7|8){1}`);
                    this.$phoneIndicative.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 1
                        })
                    });
                }
            }
        }

        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            this.$phoneIndicative.setValue('');
            this.$phone.setValue('');
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "^[0-9]{3}$",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );

        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
    };

    colombiaFormInter.extractData = function () {

        let address         = document.querySelector('.module-callme-later-address').value;
        let neighborhood    = document.querySelector('.module-callme-later-neighborhood').value;
        let city            = document.querySelector('.module-callme-later-city').value;
        let planName        = document.querySelector('.module-callme-later-planName').value;
        let hour            = document.querySelector('.hour-select');
        let hourVal         = hour.options[hour.selectedIndex].value;
        let fullname        = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        let identification  = this.$document.value().replace(/\./g, '') || '0';
        let acceptCti       = this.$inputCti.is(":checked");
        let acceptLti       = this.$inputLti.is(":checked");
                
        const sample = {
            identification: identification,
            fullname,
            email: this.$email.value(),
            phone: this.$phoneIndicative.value() + this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            isClient: (this.$areYouClient.length && (this.$areYouClient.find('input[name="is-client"]:checked').val() === 'si' ? true : false)) ? 1 : 0,
            city,
            extracolumn: `${city} / Acepta ser contactado.`,
            neighborhood,
            product: planName,
            dep_label: neighborhood,
            comments: `SOLICITUD: ${planName === "" ? '' : planName}, CEDULA: ${identification}, BARRIO: ${neighborhood}, DIRECCIN: ${address}, HORA DE CONTACTO: ${hourVal}, COMENTARIOS: `,
            isInternet: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };     

        return sample;
    };

    colombiaFormInter.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$phoneIndicative.reset();
        this.$city.invalidate();
        this.$neighborhood.invalidate();
        this.$address.invalidate();        
    };

    colombiaFormInter.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$areYouClient.find('input[name="is-client"]').attr('checked', false);
        this.$phoneIndicative.reset();
        this.$comments.reset();          
        this.$hour.find('option[value=""]').prop('selected',true);  
        colombiaFormInter.phoneTypeAction();
    };

    // Autocomplete Module
    document.getElementById('onAutocomplete').onkeyup = (e) => {
        let chekLong = e.target.value.split("");
        if(chekLong.length >= 3){
            colombiaFormInter.fillInputCities(e.target.value);
        } else {
            colombiaFormInter.fillInputCities('0');
        }
    }

    
    colombiaFormInter.fillInputCities = function(value){

        let getDataAutocomplete = JSON.parse(localStorage.getItem('dataAutoSegments'));

        let finalResult = getDataAutocomplete.filter(item => item.includes(value) || item.toLowerCase().includes(value.toLowerCase()));        
    
        const selectors = {
            idinput: document.getElementById('onAutocomplete'),
            listBoz: document.getElementById('autocomplete-box'),
            cleanBox: function(){
                colombiaFormInter.setAtt(this.idinput, { "value": finalResult[0] });
                this.idinput.value = finalResult[0];
                this.listBoz.style.display = 'none';                
            }
        }

        selectors.idinput.onblur = () => {
            if(finalResult.length === 0){
                selectors.idinput.value = '';
                $('.showB').show();
            }
            else if(value.split("").length >= 3 && finalResult.length === 1){
                selectors.cleanBox();
            }
        }
        // Clear
        selectors.listBoz.innerHTML = "";
        if(finalResult.length === 0) {selectors.listBoz.style.display = 'none';} else { selectors.listBoz.style.display = 'block'; }

        for(i in finalResult){
            const { setAppend } = this;
            let liItem      = document.createElement('li');
            let liItemText  = document.createTextNode(finalResult[i]);            
            setAppend(liItem, { liItemText });
            setAppend(selectors.listBoz, { liItem });
        }

        const results = document.querySelectorAll("#autocomplete-box li");
        for (const items of results) {
          items.addEventListener('click', function(event) {
              colombiaFormInter.setAtt(selectors.idinput, { "value": event.target.innerText });
              selectors.idinput.value = event.target.innerText;
              selectors.listBoz.style.display = 'none';
          })
        }
    }

    colombiaFormInter.getInputSegments = async function(){
        var acc = [];
        const urldata = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.SEGMENTSCOL}`;
    
        try{
            let getData = await fetch(urldata);
            if(getData.status === 200){
                let data = await getData.json();         
                for(let item in data.body){
                    for(let i in data.body[item].locations){
                        acc.push(data.body[item].locations[i]);
                    }
                }
                localStorage.setItem('dataAutoSegments',  JSON.stringify(acc));
            } else{
                throw new Error('Fallo al solicitar Locations')
            }
        } catch (err){console.log(err) }
        
    }    

    colombiaFormInter.setAppend = (elm, att) => {
        for(var key in att) { elm.appendChild(att[key]); }
    }    

    colombiaFormInter.setAtt = (el, attrs) => {
        for(var key in attrs) { el.setAttribute(key, attrs[key]); }
    }      

    colombiaFormInter.getInputFields();
    colombiaFormInter.specializedLogic();
    colombiaFormInter.initProperties();
    colombiaFormInter.getInputSegments();

    return colombiaFormInter;
};

callMeLaterChile = (context)=> {
    const chileForm = new CallMeLaterGeneralForm(context,
        {
            document: {
                pattern: '[0-9]{7,8}-([0-9]|k|K){1}'
            },
            isValidCallBack: context.updateValidStateOfButton.bind(context),
            useTyc: context.useTyc,
            useLti: context.useLti,
            useCti: context.useCti,
            useWhs: context.useWhs,
            specialLogic: {},
            getData: {}
        });

    chileForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const indicativeValue = this.$PhoneIndicative ? this.$PhoneIndicative.find(":selected").val() : '';
        const typeValue = this.$phoneType ? this.$phoneType.filter(":checked").val() : '';
        
        const sample = {
            identification: this.$document.value() || '0',
            fullname: fullname,
            email: this.$email.value(),
            isClient: $('input[name="is-client"]:checked').val().toLowerCase() === 'si' ? 1 : 0,
            comments: `Internet ${this.$comments && this.$comments.inputRef && this.$comments.inputRef.length && this.$comments.value().trim().slice(0, 500) || ''}`,
            phone: (typeValue === 'landline' ? indicativeValue : '') + this.$phone.value(),
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };

    chileForm.getInputFields();
    chileForm.initProperties();

    return chileForm;
};

callMeLaterChileInternet = (context) => {
    const chileInternetForm = new CallMeLaterGeneralForm(context, {
        phone: {
            errorSelector: '.phone-input-error',
        },
        document: {
            pattern: '[0-9]{7,8}-([0-9]|k|K){1}'
        },
    });
    /// General Selectors
    const allSelectors = {
        matcheSel:      document.getElementById('matcheSel'),
        locationSel:    document.getElementById('locationSel'),
        radioOption:    document.getElementById('radio-group'),
        queryMatches:   $('#matcheSel'),
        queryLocation:  $('#locationSel')
    }


    chileInternetForm.initLocations = function () {
        const {fetchSegments, onChangeItem} = chileInternetForm;
        fetchSegments();
        onChangeItem(allSelectors.matcheSel);
    }


    chileInternetForm.handleClickItems = function (selector){
        const {fetchData, validLocations} = chileInternetForm;
        selector.onclick = function(e){
            fetchData(e, '');
            validLocations(false);
        }           
    }


    chileInternetForm.onChangeItem = function (selector) {
        const { tagCreator, setAtt, setAppend } = chileInternetForm;
        const { locationSel, queryLocation } = allSelectors;

        selector.onchange =  async function () {
            let setMatch = $(this).find('option:selected').attr("class");
            console.log({setMatch})
            if(setMatch !== undefined){
                const getEvents = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTSCL}/${setMatch}`;
                try {
                    let getDataC = await fetch(getEvents);
                    if (getDataC.status === 200) {
                        let dataLoc = await getDataC.json();   
                        let targetEl       = document.createElement('option');
                        let getPlaceholder = $('.module-callme-later-component').attr('data-locationsPlaceholder');

                        setAtt(targetEl, {"value": ""});
                        targetEl.innerHTML = `-${getPlaceholder}-*`;
                        setAppend(locationSel, {targetEl});         
                        queryLocation.find('option').not(':first').remove();
                        
                        for(let i of dataLoc.body) {
                            for (let a of i.locations) {   
                                tagCreator(a, locationSel);
                            }
                        }                   
                        
                        // Transform Options
                        $("#locationSel option").each(function() {
                            $(this).text($(this).text().charAt(0) + $(this).text().slice(1));
                        });
                    } else {
                        throw new Error('Error en la peticion')
                    }            
                } catch (err) {
                    console.log(err)
                } 
            } else {
                console.log('Error en la peticion');
            }

        }
    }


    chileInternetForm.fetchData = async function(e, load){
        var saveVal;
        if(load !== ''){
            saveVal = load;
        } else { 
            saveVal = e.target.value; 
        }
        const { matcheSel, queryMatches, queryLocation } = allSelectors;            
        const getSegment = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHESCL}/${saveVal}`;
        try{
            let getData = await fetch(getSegment);
            if(getData.status === 200){
                let dataSeg = await getData.json();

                queryMatches.find('option').not(':first').remove();
                queryLocation.find('option').not(':first').remove();
    
                for(let i of dataSeg.body){
                    for (let a of i.events){            
                        chileInternetForm.tagCreator(a, matcheSel);
                    }
                }
            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }        
    }

    chileInternetForm.fetchSegments = async function(){
        const {tagRadioCreator, setAtt, handleClickItems, fetchData} = chileInternetForm;
        const getSegme = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHESCL}`;
        try{
            let getData = await fetch(getSegme);
            if(getData.status === 200){

                let dataSeg = await getData.json();   
                let revBody = dataSeg.body;

                let total =dataSeg.total;
                let classCol="col-3";
                if(total===1){
                    classCol ="col-12"
                }
        
                if(total===2){
                    classCol ="col-6"
                }
        
                if(total===3){
                    classCol ="col-4"
                }
                for(let i in revBody){         
                    tagRadioCreator(revBody[i], classCol,allSelectors.radioOption, i);
                }
                const check0 =  document.getElementById('check0');
                setAtt(check0, {"checked": "checked"});

                // Call consulta
                fetchData(null, check0.value);

                const check1 =  document.getElementById('check1');
                const check2 =  document.getElementById('check2');
                handleClickItems(check0);
                handleClickItems(check1);
                handleClickItems(check2);   

            } else{ throw new Error('Fallo al solicitar Segmento') }   
        } catch(err){ console.log(err) }                     
    }   

    chileInternetForm.tagCreator = function (data, selector){
        if(data !== null){
            const { setAtt, setAppend } = chileInternetForm;
            let elem  = document.createElement('option');
            let value = document.createTextNode([data.name]);
            setAtt(elem, {"class": [data.id], "value": [data.name]});
            setAppend(elem, {value});
            setAppend(selector, {elem});
        }
        
    }       

    chileInternetForm.tagRadioCreator = function (data,classCol, selector, index){
        const { setAtt, setAppend } = chileInternetForm;

        let col  = document.createElement('div');
        setAtt(col, {"class": classCol});

        let cell = document.createElement('div');
        setAtt(cell, {"class": "cell"});

        let label = document.createElement('label');
        
        let labelVal;

        if(data !== null){
            labelVal = document.createTextNode([data.name]);
        }
        

        let input = document.createElement('input');
        setAtt(input, {"type": "radio", "value": [data.id], "name": "segments", "id": `check${index}`, "class": "radio-service"});

        let span = document.createElement('span');
        setAtt(span, {"class": "checkmark"});

        setAppend(label, {labelVal, input, span});
        setAppend(cell, {label});
        setAppend(col, {cell});
        setAppend(selector, {col});

    }    

    chileInternetForm.setAtt = function (el, attrs) {
        for(var key in attrs) {
            el.setAttribute(key, attrs[key]);
        }
    }    
    
    chileInternetForm.setAppend = function (elm, att) {
        for(var key in att) {
            elm.appendChild(att[key]);
        }
    }     

    chileInternetForm.validLocations = function (val) {
        let selElm  = document.querySelector('.select-locations'); 
        let eleText = document.querySelector('.directv-select-help-text'); 
        let ele     = document.querySelector('.directv-select-error');
        if(val){
            selElm.classList.add('touched');
            eleText.style.display = 'none';
            ele.style.display = 'block';
        } else {
            selElm.classList.remove('touched');
            ele.classList.remove('select-locations-error');
            ele.style.display = 'none';
        }
    }         

    chileInternetForm.updateValidState = function () {
        const { validLocations } = chileInternetForm;
        const setLocations = () => {
            let hasclas = $(".directv-select-error" ).hasClass( "select-locations-error" );

            if(hasclas === true){
                validLocations(false);
            }

            if(this.$locations.val() !== ""){
                validLocations(false);
                return this;
            }

            if(this.$locations.val() === "" && hasclas === false){
                validLocations(true);
            }
        }

        setTimeout(() => {
            let inputPhone = document.querySelector(".module-callme-later-phone-new").value;
            this.$address   = context.component.find('.module-callme-later-address');

            let isvalid = [
                this.$fullName.isValid(),
                this.$name.isValid(),
                this.$lastName.isValid(),
                this.$email.isValid(),
                this.$document.isValid(),
                this.$address.val() !== '',
                inputPhone !== '',
                this.$matches.val() !== '',
                setLocations(),
                this.context.useTyc ? this.$callmeLaterTyc.prop('checked') && this.$callmeLaterTyc.is(':valid') : true,
                this.context.useLti ? this.$callmeLaterData.prop('checked') & this.$callmeLaterData.is(':valid') : true
            ]

            const isValid = isvalid.reduce((isValid, inputValid) => {
                return isValid && inputValid;
            }, true);
    
            this.context.updateValidStateOfButton && this.context.updateValidStateOfButton(isValid);
        }, 200)        
    };

    chileInternetForm.specializedLogic = function () {
        this.$phoneType = context.component.find('input[name="phone-type"]');
        this.$planName  = context.component.find('.module-callme-later-planName');
        this.$dni       = context.component.find('.module-callme-later-document');
        this.$address   = context.component.find('.module-callme-later-address');
        this.$location  = context.component.find('.select-locations');
        
        this.phoneIndicativeValidations = () => {

            const value = this.$phoneIndicative.value();
            if(this.$phone && value){
                const phoneTypeVal = this.$phoneType.filter(":checked").val();
                if (phoneTypeVal === 'mobile') {
                    this.$phone.setPattern(`9[0-9]{${7 - value.length},${11 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                } else {
                    this.$phone.setPattern(`2[0-9]{${9 - value.length},${13 - value.length}}`);
                    this.$phone.setInputMask({
                        mask: createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: 13 - value.length
                        })
                    });
                }
            }
        }
        
        this.indicativeAction = () => {
            this.phoneIndicativeValidations();
            this.updateValidState();
        };

        this.phoneTypeAction = () => {
            const phoneTypeVal = this.$phoneType.filter(":checked").val();
            this.$phoneIndicative.setValue('');
        }

        this.$phoneIndicative = new InputValidations(
            context.component.find('.phone-indicative-input'),
            {
                inputCall: this.indicativeAction,
                mask: createNumberMask({
                    prefix: '',
                    includeThousandsSeparator: false,
                    allowLeadingZeroes: true,
                    integerLimit: 5
                }),
                pattern: "56[0-9]{0,2}",
                errorSelector: '.indicative-input-error',
                hintSelector: ''
            }
        );
        
        this.phoneIndicativeValidations();
        this.phoneTypeAction();
        this.$phoneType.change(this.phoneTypeAction);
        
    };

    chileInternetForm.extractData = function () {
        var addressAr;
        var zipAr;
        if(document.querySelector('.module-callme-later-address')){
            addressAr = document.querySelector('.module-callme-later-address').value;
        } else { addressAr = ""; }

        if(document.querySelector('.module-callme-later-zip')){
            zipAr = document.querySelector('.module-callme-later-zip').value;
        } else { zipAr = ""; }
        
        let fullname    = "";
        let acceptCti   = this.$inputCti.is(":checked");
        let acceptLti   = this.$inputLti.is(":checked");        
        const planName  = this.$planName.val();
        const dni       = this.$dni.val();
        const region = this.$matches.find(":selected").val();
        const location  = this.$location.find(":selected").val();
        fullname = this.$name.value();
        const areaCode = this.context.component.find('.phone-indicative-input').val();
        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            fullname: fullname,
            email: this.$email.value(),
            neighborhood: '',
            dep_label: '',
            phone: areaCode + this.$phone.value(),
            city: `${location}`,
            region: region,
            address: addressAr,
            product: `${planName === "" ? '' : planName}`,
            comments: `Internet, city: ${location}, region: ${region}, RUT: ${dni}, Direccin: ${addressAr === "" ? 'Direccin' : addressAr}, Localidad: ${location}, Comentarios: ${this.$comments.value()}`,
            isInternet: 1,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };
        return sample;
    };

    chileInternetForm.invalidateInputComponents = function () {
        this.$fullName.invalidate();
        this.$name.invalidate();
        this.$lastName.invalidate();
        this.$document.invalidate();
        this.$phoneIndicative.invalidate();
        this.$phone.invalidate();
        this.$email.invalidate();
        this.$callmeLaterTyc && this.$callmeLaterTyc.inputComponentInvalidate();
        this.$callmeLaterData && this.$callmeLaterData.inputComponentInvalidate();
    };

    chileInternetForm.initProperties = function () {
        this.$fullName.reset();
        this.$name.reset();
        this.$lastName.reset();
        this.$email.reset();
        this.$document.reset();
        this.$phone.reset();
        this.$phoneIndicative.reset();
        this.$comments.reset();
        this.$matches.find('option[value=""]').prop('selected',true);
        this.$locations.find('option[value=""]').prop('selected',true);
        chileInternetForm.phoneTypeAction();
    };

    chileInternetForm.getInputFields();
    chileInternetForm.specializedLogic();
    chileInternetForm.initProperties();
    // Init Locations dropdown
    chileInternetForm.initLocations();

    return chileInternetForm;
};

callMeLaterChileCorp = (context) => {
    const corpCLForm = callMeLaterChile(context);

    corpCLForm.extractData = function () {
        let razonsocial = this.$name.value(),
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value(),
        provincia = this.$provincia.find(":selected").val(),
        rubro = this.$rublo.find(":selected").val(),
        comments = "Usuario: " + (this.$usercorp.value() || '') + " // Provincia: " + this.$provincia.find(":selected").text() + " // Rubro: " + rubro + " // Razon Social: " + razonsocial + " // Comentarios: " + this.$comments.value().trim().slice(0, 500),
        acceptCti = this.$inputCti.is(":checked"),
        tel=this.$phone.value().replace(/-/,'').replace(' ',''),
        acceptLti = this.$inputLti.is(":checked");

        const sample = {
            identification: this.$document.value().replace(/\./g, '') || '0',
            fullname: fullname,
            email: this.$email.value(),
            isClient: 0,
            phone: tel,
            comments: comments,
            clientNumber: 0,
            isCorp: 1,
            aditionalEmailsTo: provincia,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false
        };

        return sample;
    }

    return corpCLForm;
};
callMeLaterPayment = (context)=> {
  const paymentForm = new CallMeLaterGeneralForm(context,
    {
        phone: {
            focus: (val) => {
                val = val.replace(/ /g, '');
                val = val.replace(/-/g, '');
                val = val.replace(/\(/g, '');
                val = val.replace(/\)/g, '');

                return val;
            },
            blur: (val) => {
                if (!val.includes(' ')) {
                    val = spliceSlice(val, -2, 0, ' ');
                    val = spliceSlice(val, -5, 0, ' ');
                    val = spliceSlice(val, -9, 0, ' ');
                }

                return val.trim();
            },
            inputRule: (event) => {
                return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 10) ? true : false
            },
            pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$',
            mask: createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: 7
            }),
        },
        dateOfPayment: {
          focus: (val) => {
              val = val.replace(/ /g, '');
              val = val.replace(/-/g, '');
              val = val.replace(/\(/g, '');
              val = val.replace(/\)/g, '');

              return val;
          },
          blur: (val) => {
              if (!val.includes(' ')) {
                  val = spliceSlice(val, -2, 0, ' ');
                  val = spliceSlice(val, -5, 0, ' ');
                  val = spliceSlice(val, -9, 0, ' ');
              }

              return val.trim();
          },
          inputRule: (event) => {
              return (/[0-9]/.test(event.key) && event.currentTarget.value.length < 15) ? true : false
          },
          pattern: '^(0?(1|2|4|5|6|7|8)?[0-9]{7})|(3[0-9]{9})|(0?(1|2|4|5|6|7|8)? ?[0-9]{3} [0-9]{2} [0-9]{2})|(3[0-9]{2} [0-9]{3} [0-9]{2} [0-9]{2})$',
          mask: createNumberMask({
              prefix: '',
              includeThousandsSeparator: false,
              allowLeadingZeroes: true,
              integerLimit: 7
          }),
        },
        document: {
            mask: createNumberMask({
                prefix: '',
                thousandsSeparatorSymbol: '.',
                integerLimit: 10
            }),
            pattern: '^\\d+(\\d|\\.)*\\d+$'
        }
    });

  paymentForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        const sample = {
            type: "payment",
            identification: this.$document.value().replace(/\./g, ''),
            fullname: fullname,
            email: this.$email.value(),
            phone: this.$phone.value().replace(/ /g, '').replace(/-/g, ''),
            comments: "/ Fecha de pago: " + this.$dateOfPayment.val() + " / Observaciones: " + this.$comments.value(),
            isClient: 0,
            extracolumn: "/ Referencia de pago: " + this.$paymentReference.value(),
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false            
        };
        return sample;
    };

    paymentForm.getInputFields();
    paymentForm.initProperties();
    paymentForm.setClassesOnCalendar();

    return paymentForm;
};
callMeLaterAlliance = (context)=> {
    const countryValidations = {
        pe: {
            document: {
                mask: [/\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/, /\d/],
                pattern: '^[0-9]{8}$'
            },
            phone: {
                pattern: '^9[0-9]{8}$'
            }
        },
        uy: {
            document: {
                pattern: '[0-9]{7,8}',
            },
            phone: {
                pattern: '[0-9]{8,9}',
            }
        }
    }

    const allianceForm = new CallMeLaterGeneralForm(context,
        {
            document: countryValidations[countryPS].document,
            phone: countryValidations[countryPS].phone,
            isValidCallBack: context.updateValidStateOfButton.bind(context),
            useTyc: context.useTyc,
            useLti: context.useLti,
            useCti: context.useCti,
            useWhs: context.useWhs,
            specialLogic: {},
            getData: {}
        });

    allianceForm.extractData = function () {
        let fullname  = "";
        let acceptCti = this.$inputCti.is(":checked");
        let acceptLti = this.$inputLti.is(":checked");
        let identification  = this.$document.value().replace(/\./g, '') || '0';
        fullname = this.$fullName.value() || this.$name.value() + ' ' + this.$lastName.value();
        
        const sample = {
            identification: identification, 
            fullname: fullname,
            email: this.$email.value(),
            isClient: $('input[name="is-client"]:checked').val().toLowerCase() === 'si' ? 1 : 0,
            comments: `Beneficios, ${this.$comments && this.$comments.inputRef && this.$comments.inputRef.length && this.$comments.value() || ''}`,
            accept_PrivacyPolicy: this.ltiStore ? acceptLti : false,
            accept_promotionsContact: this.ctiStore ? acceptCti : false,
            product:'Beneficios',
            phone: this.$phone.value(),
        };
        return sample;
    };

    allianceForm.getInputFields();
    allianceForm.initProperties();

    return allianceForm;
};

CallmeLaterModule = (function () {
    const defaults = {
        "selectors": {
            "callmeLaterContainer": ".module-callme-later-container",
            "callmeLaterFullName": ".module-callme-later-fullName",
            "callmeLaterName": ".module-callme-later-name",
            "callmeLaterLastName": ".module-callme-later-last-name",
            "callmeLaterDocument": ".module-callme-later-document",
            "callmeLaterPhone": ".module-callme-later-phone",
            "callmeLaterMobileArea": ".mobile-indicative-select",
            "callmeLaterMobileNew": ".module-callme-later-phone-new",
            "callmeLaterPhoneType": "input[name='phone-type']",
            "callmeLaterPhoneIndicative": ".phone-indicative-select",
            "callmeLaterIndicativeInput": ".phone-indicative-input",
            "callmeLaterEmail": ".module-callme-later-email",
            "callmeLaterSchedule": ".module-callme-later-schedule",
            "callmeLaterComments": ".module-callme-later-comments",
            "callmeLaterButton": ".module-callme-later-button",
            "callmeLaterAlert": ".panel-container p",
            "callmeLaterTyc": "#module-callme-later-tyc",
            "callmeLaterData": "#module-callme-later-data",
            "recaptcha": ".module-callme-later-recaptcha",
            "valid": ":valid",
            "isClientDefault": "#is-client-no",
            "phoneTypeDefault": "#phone-type-mobile",
            "wspInfo": ".wsp-info",
            "wspQuestion": ".wsp-question input"
        },
        "classes": {},
        "attributes": {
            "pattern": "pattern",
            "minlength": "minlength",
            "maxlength": "maxlength",
            "separator": "-",
            "checked": "checked"
        },
        "events": {
            "keyPress": "keypress",
            "input": "input",
            "click": "click"
        },
        "phoneTypes": {
            "mobile": 'mobile',
            "landline": 'landline'
        }
    };

    return class {
        constructor(id, options, editMode, reasonId) {
            this.id = id;
            this.formReasonId = reasonId;
            this.reasonId = 0;
            this.editMode = editMode;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER;

            this.type = options.type;
            this.isClientIdActive = options.isClientIdActive

            this.country = options.country;

            this.useTyc = options.useTyc;
            this.useLti = options.useLti;
            this.useCti = options.useCti;
            this.useWhs = options.useWhs;

            this.triviaId = options.triviaId;

            this.successTitle = options.successTitle;
            this.successDescription = options.successDescription;
            this.errorTitle = options.errorTitle;
            this.errorDescription = options.errorDescription;
            this.recaptchaEnabled = options.recaptchaEnabled;
            this.noemail = options.noemail;
            this.forclient = options.forclient;
            this.thankYouPage = options.thankYouPage === undefined || options.thankYouPage === "" ? "/ventas-ok" : options.thankYouPage;
            this.phoneType = this.component.find("input[name='phone-type']").length > 0 ? 0 : 1;
            this.wspPhone = this.component.find(defaults.selectors.wspInfo);
            this.wspQuestion = this.component.find(defaults.selectors.wspQuestion);

            this.allSelectors = {
                matcheSel:      document.getElementById('matcheSel'),
                locationSel:    document.getElementById('locationSel'),
                radioOption:    document.getElementById('radio-group'),
                queryMatches:   $('#matcheSel'),
                queryLocation:  $('#locationSel')
            }

            this.initComponent();
        }

        initComponent() {
            const el = this;
            const thankYouPageAux = this.thankYouPage;

            this.$phoneTypeDefault = this.component.find(defaults.selectors.phoneTypeDefault);
            if (this.$phoneTypeDefault) {
                this.$phoneTypeDefault.prop('checked', true);
            }

            this.wspQuestion.prop('checked', false);

            if(this.type == 'paymentpromise'){
                var now = new Date();
                now.setHours(0,0,0,0);
                var fiveDays = new Date(new Date(). getTime()+(4*24*60*60*1000));
                pickmeup('.date-picker', {
                    position       : 'bottom',
                    hide_on_select : true,
                    locale: 'en',
                    render : function (date) {
                        if (date < now) {
                            return {disabled : true, class_name : 'date-in-past'};
                        }
                        if(date >= fiveDays){
                            return {disabled : true, class_name : 'date-in-future'};
                        }
                        return {};
                    }
                });
                this.callMeLaterForm = callMeLaterPayment(this);
            } else {
				if(this.type === 'alliance') {
					this.callMeLaterForm = callMeLaterAlliance(this);					
				} else{
	                switch (this.country) {
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.CL:
	                        switch (this.type) {
	                            case 'internet':
	                                this.callMeLaterForm = callMeLaterChileInternet(this);
	                                break;
	                            case 'corporative':
	                                this.callMeLaterForm = callMeLaterChileCorp(this);
	                                break;                                
	                            default: this.callMeLaterForm = callMeLaterChile(this);
	                        }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.AR:
	                        switch (this.type) {
	                            case 'internet':
	                                this.callMeLaterForm = callMeLaterArgentinaInternet(this);
	                                break;
	                            case 'corporative':
	                                this.callMeLaterForm = callMeLaterArgentinaCorp(this);
	                                break;                                
	                            default: this.callMeLaterForm = callMeLaterArgentina(this);
	                        }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.UY:
	                        switch (this.type) {
	                            case 'build':
	                                this.callMeLaterForm = callMeLaterUruguayBuilding(this);
	                                break;
	                            default: this.callMeLaterForm = callMeLaterUruguay(this);
	                        }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.CO:
	                        switch (this.type) {
	                            case 'internet':
	                                this.callMeLaterForm = callMeLaterColombiaInter(this);
	                                break;
	                            case 'corporative':
	                                this.callMeLaterForm = callMeLaterColombiaCorp(this);
	                                break;
	                            default: this.callMeLaterForm = callMeLaterColombia(this);
	                        }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.EC:
                            switch (this.type) {
                                case 'internet':
                                    this.callMeLaterForm = callMeLaterEcuadorInternet(this);
                                    break;
                                default: this.callMeLaterForm = callMeLaterEcuador(this);
                            }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.PE:
	                        switch (this.type) {
								case 'internet':
	                                this.callMeLaterForm = callMeLaterPeruInternet(this);
	                                break;
	                            case 'corporative':
	                                this.callMeLaterForm = callMeLaterPeruCorp(this);
	                                break;
	                            default: this.callMeLaterForm = callMeLaterPeru(this);
	                        }
	                        break;
	                    case DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.VE:
	                        switch (this.type) {
	                            case 'build':
	                                this.callMeLaterForm = callMeLaterVenezuelaBuilding(this);
	                                break;
	                            case 'corporative':
	                                this.callMeLaterForm = callMeLaterVenezuelaCorp(this);
	                                break;
	                            default: this.callMeLaterForm = callMeLaterVenezuelaBuilding(this);
	                        }
	                        break;
	                    default:
	                        this.callMeLaterForm = callMeLaterPeru(this);
	                        break;
	                }
            }}

            this.getHeaderComponent();

            this.$callmeLaterAlert = this.component.find(defaults.selectors.callmeLaterAlert);
            this.$callmeLaterButton = this.component.find(defaults.selectors.callmeLaterButton);
            this.$callmeLaterClose = this.component.find(defaults.selectors.callmeLaterClose);
            this.$recaptcha = this.component.find(defaults.selectors.recaptcha);
            this.$recaptchaButton = this.component.find(defaults.selectors.recaptchaButton);
            this.$isClientDefault = this.component.find(defaults.selectors.isClientDefault);

            this.wspQuestion.change(function(){

                if($('input[name="phone-type"]').length > 0){
                    $('input[name="phone-type"]').each(function(){
                        if($(this).prop('checked') == true){
                            if($(this).val() == "landline"){
                                el.wspPhone.toggleClass('hidehome');
                            } else {
                                el.wspPhone.addClass('hidehome');
                            }
                        }
                    });
                } else {
                    el.wspPhone.toggleClass('hidehome');
                }
                

                if(el.wspPhone.hasClass('hidehome')  && el.phoneType == 0 && el.wspQuestion.prop('checked') == true){
                    el.getNumberForWsp();
                }

            });

            $('.phone-type-radio input[name="phone-type"]').change(function(){
                let valphone = $('.module-callme-later-phone').val();
                valphone !== '' ? el.updateValidStateOfButton(true) : el.updateValidStateOfButton(false);
            });

            $('.wsp-info input').blur(function(){
                if($('.wsp-info input').val() == ''){
                    $('.wsp-info .directv-input-error').css('display', 'block');
                }
            });

            $('.wsp-info input').focus(function(){
                $('.wsp-info .directv-input-error').css('display', 'none');
            });

            if (this.$isClientDefault) {
                this.$isClientDefault.prop('checked', true);
            }

            this.updateTexts();
            this.callMeLaterForm.updateValidState();

            this.$callmeLaterButton.click(() => {
                this.updateValidStateOfButton(false);
                this.doPost();
            });

            $("input[name='is-client']").change(function(e) {
                let tooltip = $(`#is-client-${this.value}`).data('tooltip');
                let helptext = $(`#is-client-${this.value}`).data('helptext');
                let tkspage = $(`#is-client-${this.value}`).data('tkspage');

                el.thankYouPage = !tkspage ? thankYouPageAux : tkspage;

                $('.tooltip').html(!helptext ? '' : helptext);
                $('.tooltip').removeClass('tooltip-on');

                if(tooltip){
                    let html = `<img src="/content/dam/public-sites/icons/Icon%20alert.png" alt="alert icon"><div class="directv-input-help-text-content">${tooltip}</div>`;
                    $('.tooltip').html('');
                    $('.tooltip').addClass('tooltip-on');
                    $('.tooltip').append(html);
                }

                // show or hide id cliente input
                if (tooltip && el.isClientIdActive) {
                    $('#id-cliente-input').removeClass('d-none')
                } else {
                    // Hide id cliente input
                    $('.module-callme-later-idCliente').val('')
                    $('#id-cliente-input').addClass('d-none')
                }
            });

            $('.wsp-info input').keypress(function(event){
                var ASCIICode = (event.which) ? event.which : event.keyCode 
                if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57)) 
                    return false; 
                return true;
            });

            $("input[name='phone-type']").change(function(e) {
                el.phoneType = this.value === 'mobile' ? 0 : 1;

                if(el.phoneType == 0){
                    el.wspPhone.addClass('hidehome');
                } else {
                    if(el.wspQuestion.prop('checked') == true){
                        el.wspPhone.removeClass('hidehome');
                    }
                }
            });

            $('.phone-container input').blur(function(){
                if(el.wspPhone.hasClass('hidehome') && el.phoneType == 0 && el.wspQuestion.prop('checked') == true){
                    el.getNumberForWsp();
                }
            });

            if (this.$headerComponent) {
                this.$headerComponent.eventEmitter.subscribe((action) => {
                    if (action.event === 'phoneUpdated') {
                        this.updateTexts();
                    } else {
                        console.log(action.event);
                    }
                });
            }

        }

        getNumberForWsp(){
            let indicative = $('.phone-container .phone-indicative-input').val() || '';
            let phonumber  = $('.phone-container .module-callme-later-phone').val() || '';
            let prefix = '';

            if (g_useImprovedCtrls && $("input[name='phone-type']").val() === 'mobile') {
				indicative = document.querySelector(".optional-selects.mobile-indicative-select-new") == null ? "" : document.querySelector(".optional-selects.mobile-indicative-select-new").value;
				prefix = document.querySelector(".directv-input.phone-indicative-input-new") == null ? "" : document.querySelector(".directv-input.phone-indicative-input-new").value;
				phonumber = document.querySelector(".directv-input.module-callme-later-phone-new") == null ? "" : document.querySelector(".directv-input.module-callme-later-phone-new").value;
			} 

            $('.wsp-info input').val(indicative + prefix + phonumber);
        }

        doPost() {    
            const url = "/bin/public-sites/acquisition";
            const data = Object.assign(
                {},
                this.callMeLaterForm.extractData(),
                {
                    country: this.country,
                    urlparams: window.location.search
                }
            );

			if (g_useImprovedCtrls && $("input[name='phone-type']").val() === 'mobile') {
				var selectedAreaCode = document.querySelector(".optional-selects.mobile-indicative-select-new") == null ? "" : document.querySelector(".optional-selects.mobile-indicative-select-new").value;
				var prefix = document.querySelector(".directv-input.phone-indicative-input-new") == null ? "" : document.querySelector(".directv-input.phone-indicative-input-new").value;
				var phoneNumber = document.querySelector(".directv-input.module-callme-later-phone-new") == null ? "" : document.querySelector(".directv-input.module-callme-later-phone-new").value;
				data.phone = selectedAreaCode + prefix + phoneNumber;
			} 

            if(this.triviaId && Number(this.triviaId > 0)){
                data["triviaId"] = this.triviaId;
                let cityTemp = $('.module-callme-later-city');
                let urbanizationTemp = $('.module-callme-later-urbanization');
                let neighborhoodTemp = $('.module-callme-later-neighborhood');
                
                if(cityTemp.length > 0){
                    data["city"] = cityTemp.val();
                }
                if(urbanizationTemp.length > 0){
                    data["urbanization"] = urbanizationTemp.val();
                }
                if(neighborhoodTemp.length > 0){
                    data["neighborhood"] = neighborhoodTemp.val();
                }
            }
            
            if (this.reasonId || this.formReasonId) {
                data["reason"] = this.reasonId || this.formReasonId;
                data["keepcon"] = this.keepconParam();
                data["isPhone"] = this.phoneType;
                data["withEmail"] = this.noemail ? 0 : 1;
                data["whatsapp"] = this.wspQuestion.prop('checked') ? 1 : 0;
                data["wspContactInfo"] = $('.wsp-info input').val() || 0;
                if(this.forclient !== undefined && (data.country !== 'pe' && data.country !== 'ec')){
                    data["isClient"] = this.forclient;
                }
                return new Promise(() => {
                    try {
                        $.ajax({
                            type: 'POST',
                            url: url,
                            data: data,
                            success: (r) => {
                                this.reasonId = 0;
                                window.open(this.thankYouPage, '_self');
                            },
                            error: (r) => {
                                this.reasonId = 0;
                                this.showAlert('error');
                            }

                        });
                    } catch (err) {
                        this.reasonId = 0;
                        this.showAlert('error');
                    }
                });
            }
        }

        keepconParam() {
            if (this.country === DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.AR
                || this.country === DIRECTV_PUBLIC_SITES_CONSTANTS.COUNTRIES.UY) {
                return "1";
            } else {
                return "0";
            }
        }

        getHeaderComponent() {
            if (!this.editMode) {
                this.$headerComponent = $("header");

                if (this.$headerComponent) {
                    this.$headerComponent = HeaderComponentContainer.getComponent(this.$headerComponent.attr('id'));
                }
            }
        }

        updateTexts() {
            const contactPhone = window.localStorage.getItem('contactphone');

            this.$callmeLaterAlert.find('span').remove();
            this.$callmeLaterAlert.html(`${this.$callmeLaterAlert.html()} ${contactPhone ? contactPhone : ''}`);
        }

        updateValidStateOfButton(isValid) {

            if (isValid && this.recaptchaEnabled && siteKey && this.$recaptcha.val() === 'false') {
                this.$recaptcha.addClass('validation-missing');
            }

            if (isValid && ((this.recaptchaEnabled && this.$recaptcha.val() === 'true') || !this.recaptchaEnabled || !siteKey)) {
                if((this.wspQuestion.length > 0 && (this.wspQuestion.prop('checked') == true && $('.wsp-info input').val() != '' || this.wspQuestion.prop('checked') == false) || this.wspQuestion.length <= 0 )){
                    this.$callmeLaterButton.addClass('btn-primary');
                    this.$callmeLaterButton.removeAttr('disabled', 'disabled');
                    this.$recaptcha.removeClass('validation-missing');
                } else {
                    this.$callmeLaterButton.removeClass('btn-primary');
                    this.$callmeLaterButton.attr('disabled', 'disabled');
                }
            } else {
                this.$callmeLaterButton.removeClass('btn-primary');
                this.$callmeLaterButton.attr('disabled', 'disabled');
            }
        }

        invalidateRecaptha() {
            this.$recaptcha.val('false');
        }

        setReasonId(reasonId) {
            this.reasonId = reasonId;
        }

        showAlert(type) {
            const $alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

            if ($alertComponent) {
                switch (type) {
                    case 'error':
                        $alertComponent.setTitle(this.errorTitle);
                        $alertComponent.setDescription(this.errorDescription);
                        break;
                    case 'success':
                        $alertComponent.setTitle(this.successTitle);
                        $alertComponent.setDescription(this.successDescription);
                        break;
                    default:
                        break;
                }

                $alertComponent.setStatus(type);
                $alertComponent.showAlert();
            }
        }
    };
})();

const callmelatercomponents = $('.module-callme-later-component');
callmelatercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const editMode = component.data('editmode');
    const reasonId = component.data('reasonid');
    const options = {
        type: component.data('type'),
        country: component.data('country'),
        successTitle:component.data('successtitle'),
        successDescription:component.data('successdescription'),
        errorTitle:component.data('errortitle'),
        errorDescription:component.data('errordescription'),
        useTyc:component.data('usetyc'),
        useLti:component.data('uselti'),
        useCti:component.data('usecti'),
        useWhs:component.data('usewhs'),
        recaptchaEnabled:component.data('recaptchaenabled'),
        noemail:component.data('noemail'),
        forclient:component.data('forclient'),
        triviaId:component.data('triviaid'),
        thankYouPage:component.data('thankyoupage'),
        isClientIdActive: component.data('isclientactive')
    };

    GeneralComponentContainer.setComponent(new CallmeLaterModule(id, options, editMode, reasonId), id);
});
CallmeLaterComponent = (function () {
    const defaults = {
        "selectors": {
            "callmeLaterContainer": ".callme-later-container",
            "callmeLaterClose": ".callme-later-header-icon",
            "callmeLaterTitle": ".callme-later-header-title > h3",
            "callmeLaterFormModule": ".module-callme-later-component",
            "callmeLaterContent": ".callme-later-content",
            "isClientDefault" : "#is-client-no",
            "phoneTypeDefault" : "#phone-type-mobile"
        }
    };

    return class {
        constructor(id, options, editMode, reasonId) {
            this.id = id;
            this.component = $('#' + this.id);
            this.successTitle = options.successTitle;
            this.successDescription = options.successDescription;
            this.errorTitle = options.errorTitle;
            this.errorDescription = options.errorDescription;
            this.eventEmitter = new rxjs.Subject();
            this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER_MODAL;
            this.initComponent(options);
        }

        initComponent(options) {
            this.$callmeLaterContainer = this.component.find(defaults.selectors.callmeLaterContainer);
            this.$callmeLaterClose = this.component.find(defaults.selectors.callmeLaterClose);
            this.$callmeLaterTitle = this.component.find(defaults.selectors.callmeLaterTitle);
            this.$callmeLaterContent = this.component.find(defaults.selectors.callmeLaterContent);
            this.$callmeFormModule = this.component.find(defaults.selectors.callmeLaterFormModule);

            this.$callmeLaterClose.click(() => {
                this.closeModal();
                this.eventEmitter.next({
                    event: 'callme-later-close',
                    data: this.isValid
                });
            });
        }

        openModal() {
            const $callmeFormComponent = GeneralComponentContainer.getComponent(this.$callmeFormModule.attr('id'));

            if (this.$callmeFormModule.length > 0) {
                $callmeFormComponent.callMeLaterForm.invalidateInputComponents();
                $callmeFormComponent.callMeLaterForm.initProperties();
                $callmeFormComponent.updateValidStateOfButton(false); 
                $callmeFormComponent.invalidateRecaptha();

                this.$isClientDefault = this.component.find(defaults.selectors.isClientDefault);

                this.$phoneTypeDefault = this.component.find(defaults.selectors.phoneTypeDefault);

                if(this.$isClientDefault){
                    this.$isClientDefault.prop('checked', true);
                }

                if(this.$phoneTypeDefault){
                    this.$phoneTypeDefault.prop('checked', true);
                }
            }

            this.component.addClass('open');
            this.component.removeClass('close');
            this.$callmeLaterContent.get(0).scrollTop = 0;
        }

        closeModal() {
            this.component.addClass('close');
            this.component.removeClass('open');
            this.$callmeLaterContainer.css('top', '');
        }
    };
})();

$('.callme-later-component').each(function () {
    let idgen = $(this).data('idgen');
    
    GeneralComponentContainer.setComponent(new CallmeLaterComponent(idgen, {}),idgen);
});
class ProductDeatailsLandingComponent {
    constructor() {
        this.path = null;
        this.allPlanInfo = null;
    }

    setProperties(path, locale, editMode, country) {
        this.locale = locale;
        this.path = path;
        this.component = $('.product-details-page-container');
        this.editMode = editMode;
        this.country = country;
        this.helpers = new Helpers();
        this.setObservable();
        this.getComponents();
        this.getGlobalDataCall(false);
    }

    setObservable() {
        if (!this.allPlanInfo) {
            this.allPlanInfo = new rxjs.Subject();
        }

        return this.allPlanInfo;
    }

    getComponents() {
        this.productDetailHeader = GeneralComponentContainer
            .getComponent(this.component.find("#product-detail-header\x20.sticky-separator").children().attr('id'));
        this.callmeNowComponent = GeneralComponentContainer
            .getComponent(this.component.find("#callmenow-container").children().attr('id'));
        this.callmeLaterComponent = GeneralComponentContainer
            .getComponent(this.component.find("#callme-later-component").children().attr('id'));
        this.callmeLaterModule = GeneralComponentContainer
            .getComponent(this.component.find(".module-callme-later-component").attr('id'));

        this.getAlert();
        this.getCallmeLaterComponent();
        this.getCallmeNowComponent();
        this.getHeaderComponent();
        this.getSegmentsAutocompleteComponent();

        this.productDetailHeader.eventEmitter.subscribe((info) => {
            let modalTitle = "";

            if (info.event === 'make-call') {
                if (this.callmeNowComponent) {
                    modalTitle = `${this.callmeNowComponent.modalTitle}\x20${info.data}`;
                    this.callmeNowComponent.$title.html(modalTitle);
                    this.callmeNowComponent.openModal();
                } else if (this.helpers.isMobile()) {
                    window.open(`tel:${info.phone}`, '_system');
                }
            }

            if (info.event === 'leave-data') {
                modalTitle = `${this.callmeLaterComponent.modalTitle}\x20${info.data}`;
                this.callmeLaterComponent.$callmeLaterTitle.html(modalTitle);
                this.callmeLaterModule.callMeLaterForm.initProperties();
                this.callmeLaterModule.setReasonId(info.reasonId);
                this.callmeLaterComponent.openModal();
            }

            if (this.$headerComponent && info.event === 'component-updated') {
                this.$headerComponent.generalResize();
            }
        });

        if (this.segmentsAutocompleteComponent) {
            this.segmentsAutocompleteComponent.eventEmitter.subscribe((info) => {
                if (info && info.event === "segmentUpdated") {
                    this.getGlobalDataCall(true);
                }
            });
        }
    }

    getSegmentsAutocompleteComponent() {
        if (!this.editMode) {
            const $segmentsAutocompleteComponent = this.component.find(".segments-autocomplete");

            if ($segmentsAutocompleteComponent.length) {
                this.segmentsAutocompleteComponent = $segmentsAutocompleteComponent[0]
                    && $segmentsAutocompleteComponent[0].instance;
            }
        }
    }

    getHeaderComponent() {
        if (!this.editMode) {
            this.$headerComponent = this.component.find("header");

            if (this.$headerComponent) {
                this.$headerComponent = HeaderComponentContainer.getComponent(this.$headerComponent.attr('id'));
            }
        }
    }

    getGlobalDataCall(segmentUpdated) {
        if (this.path) {
            if (segmentUpdated) {
                GlobalData.cleanCachedDataFromPath(this.path);
            }

            GlobalData.getMultipleData([
                { path: this.path },
                GlobalData.defaults.requestData.SETTINGS
            ]
            ).subscribe(
                (result) => {
                    this.allPlanInfo.next({
                        plan: result[0][0],
                        setting: result[1],
                        segmentUpdated: segmentUpdated
                    });
                }
            );
        }
    }

    getCallmeLaterComponent() {
        if (!this.editMode) {
            if (this.callmeLaterComponent) {
                this.callmeLaterComponent.eventEmitter.subscribe((info) => {
                    if (info.event === 'callme-later-submit') {
                        this.callmeLaterComponent.closeModal();
                        this.$alertComponent.setTitle(this.callmeLaterComponent.successTitle);
                        this.$alertComponent.setDescription(this.callmeLaterComponent.successDescription);
                        this.$alertComponent.setStatus('success');
                        this.$alertComponent.showAlert();
                    }

                    if (info.event === 'callme-later-submit-error') {
                        this.$alertComponent.setTitle(this.callmeLaterComponent.errorTitle);
                        this.$alertComponent.setDescription(this.callmeLaterComponent.errorDescription);
                        this.$alertComponent.setStatus('error');
                        this.$alertComponent.showAlert();
                    }
                });
                this.callmeLaterComponent.modalTitle = this.callmeLaterComponent.$callmeLaterTitle.html();
            }
        }
    }

    getCallmeNowComponent() {
        if (!this.editMode) {
            if (this.callmeNowComponent) {
                this.callmeNowComponent.eventEmitter.subscribe((info) => {
                    if (info.event === 'callmenow-submit') {
                        this.callmeNowComponent.closeModal();
                        this.$alertComponent.setTitle(this.callmeNowComponent.successTitle);
                        this.$alertComponent.setDescription(this.callmeNowComponent.successDescription);
                        this.$alertComponent.setStatus('success');
                        this.$alertComponent.showAlert();
                    }

                    if (info.event === 'callmenow-submit-error') {
                        this.$alertComponent.setTitle(this.callmeNowComponent.errorTitle);
                        this.$alertComponent.setDescription(this.callmeNowComponent.errorDescription);
                        this.$alertComponent.setStatus('error');
                        this.$alertComponent.showAlert();
                    }
                });

                this.callmeNowComponent.closeModal();
                this.callmeNowComponent.modalTitle = this.callmeNowComponent.$title.html();
            }
        }
    }
    getAlert() {
        if (!this.editMode) {
            this.$alertComponent = this.component.find(".alert-component");

            if (this.$alertComponent) {
                this.$alertComponent = GeneralComponentContainer.getComponent(this.$alertComponent.children().attr('id'));
            }
        }
    }
};

const componentsProductDetailsPage = $('.product-details-page-container');
componentsProductDetailsPage.each((index, element) => {
    productDeatailsLandingComponent = new ProductDeatailsLandingComponent();
});
const productDetailHeaderComponent =
    (function() {
        const defaults = {
            productTypes: {
                prepaid: 'prepaid',
                postpaid: 'postpaid',
                dtvgo: 'dtvgo',
                dtvflex: 'dtvflex'
            }
        };

        return class {
            constructor(path, id, country, thirdOption) {
                this.path = path;
                this.id = id;
                this.country = country;
                this.eventEmitter = new rxjs.Subject();
                this.component = $('#' + id);
                this.thirdOption = thirdOption;
                this.initComponent();
            }

            initComponent() {
                if (typeof productDeatailsLandingComponent !== 'undefined') {
                    const observable = productDeatailsLandingComponent.setObservable();

                    if (observable) {
                        observable.subscribe((result) => {
                            this.fillData(result.plan, result.setting, result.segmentUpdated);
                        });
                    }
                } else {
                    this.getData();
                }
            }

            getData() {
                if (this.path) {
                    GlobalData.getMultipleData([
                        { path: this.path },
                        GlobalData.defaults.requestData.SETTINGS
                    ]).subscribe(
                        (data) => {
                            this.fillData(data[0][0], data[1]);
                        }
                    );
                }
            }

            setImage(imageSrc) {
                this.component.find('.header-badge').attr("src", imageSrc);
                this.component.find('.header-badge').attr("srcset", imageSrc);
            }

            fillData(result, setting, segmentUpdated) {
                switch (result.type) {
                    case defaults.productTypes.postpaid:
                        this.setImage(setting.postpaid.badgeDark);
                        break;
                    case defaults.productTypes.prepaid:
                        this.setImage(setting.prepaid.badgeDark);
                        break;
                    case defaults.productTypes.dtvgo:
                        break;
                    case defaults.productTypes.dtvflex:
                        this.setImage(setting.dtvflex.badgeDark);
                }

                this.acquisitionDrop(result);

                this.component.find('.color-divider').css('background-color', result.color);
                this.component.find('.header-title').html(result.name);

                this.component.find('.value-price').html(setting.general.currency + result.formattedPrice);
                this.component.find('.value-offer').html(result.offer);

                this.component.find('.button-items\x20.button-item.chat').click(() => {
                    document.location.href = result.calls.find((call) => call.name = "Chat").url;
                });

                this.component.find('.button-items\x20.button-item.call').click(() => {
                    document.location.href = result.calls.find((call) => call.name = "Llama").url;
                });
                this.component.find('.btn.primary').click(() => {
                    document.location.href = result.subscribe;
                });
                // this.component.find('.live-chat-btn').on('click', (event) => {
                //     //                    event.preventDefault();

                //     if ($('.open-watson-btn').length <= 0 && $('.watson-container').length <= 0) {

                //         if (this.optionallink) window.open(this.optionallink, this.optionallinktarget);
                //         else if (result.type === defaults.productTypes.dtvgo) window.open(setting.postpaid.dtvgoChat, '_blank');
                //         else window.open('/prev-chat.html', "Chat", "width=450,height=450");
                //     }
                // });

                if (!segmentUpdated) {
                    this.eventEmitter.next({
                        event: 'component-updated'
                    });
                }
            }

            acquisitionDrop(data) {
                data.landing = true;
                data.level = 2;

                new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data, this.loadCTA(data));
            }

            loadCTA(data) {
                const mainContactPhone = (window.localStorage && window.localStorage.getItem('defaultPhone')) || '';
                const phoneNumber = mainContactPhone;

                return {
                    cmn: () => {
                        this.eventEmitter.next({
                            event: 'make-call',
                            data: data.name,
                            phone: phoneNumber
                        });
                    },
                    cml: () => {
                        this.eventEmitter.next({
                            event: 'leave-data',
                            data: data.name,
                            reasonId: data.reasonId
                        });
                    }
                };
            }
        };
    })();

const productdetailheadercomponents = $('.product-detail-header');
productdetailheadercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');
    const country = component.data('country');
    const thirdOption = component.data('thirdoption');
    GeneralComponentContainer
        .setComponent(new productDetailHeaderComponent(path, id, country, thirdOption), id);
})
class PrepaidCalculatorComponent {
    constructor(calcType, id, locale, properties, editMode) {
        this.calcType = calcType;
        this.id = id;
        this.locale = locale;
        this.properties = properties;
        this.editMode = editMode;
        this.offerSelect = false;
        this.component = $('#calculator-' + this.id);
        this.days = 0;
        this.calcConfig = {};
        this.calculator = {
            packs: []
        };
        this.data = {};
        this.initComponent();
    }

    initComponent() {
        this.plansContainer = this.component.find('.plan_picker .plans-container');
        this.rechargeAmount = this.component.find('.recharge_amount');
        this.packages = this.component.find('.packages .packages-list');
        this.calculateButton = this.component.find('.directv-ui-button');
        this.otherAmount = this.component.find('#txt_other_amount');

        this.getData();
        this.bindEvents();
    }

    getData() {
        const path = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}calculator.html/${this.locale}`;
        const settingsPath = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}settings.html/${this.locale}`;

        rxjs.combineLatest(
            [path, settingsPath].map(
                (path) =>
                ajax2Observable(
                    $.ajax({
                        url: path
                    })
                )
            )).subscribe(
            (result) => {
                try {
                    this.fillCalculator(result[0].body[0], result[1].body.find((s) => s.type === 'general'));
                } catch (e) {
                    console.log(e);
                }
            },
            (error) => {
                console.log(error);
            }
        );
    }

    fillPlanInfoOptions(data) {
        const $planInfoTemplate = Handlebars.compile(this.component.find('#calc-plan-information-template').html());

        this.data.plans.forEach((plan, planIndex) => {
            const planData = {
                planName: '',
                typeDataList: [],
                planModal: plan.modal ? 'plan-modal-callmenow' : '',
                planLink: plan.modal ? '' : `href=${plan.link}`,
                planLinkTarget: plan.target,
                planLinkText: plan.planLinkText,
                netPlan: plan.internet,
                tvPlan: plan.tv
            };
            const typeData = {};

            this.calculator.adeudo = 0;
            planData.planName = plan.name;

            const planTypes = [...plan.types].sort((typeA, typeB) => {
                if (typeA.typeId > typeB.typeId) {
                    return 1;
                } else {
                    return -1;
                }
            });

            planTypes.forEach((type, typeIndex) => {
                if (planIndex == 0 && typeIndex == 0) {
                    this.calculator.plan = `${plan.name} ${type.desc}`;
                    this.calculator.planId = type.id;
                    this.calculator.planOneShot = parseFloat(type.oneShot);
                    this.calculator.planParcial = parseFloat(type.parcial);
                    this.setOffer(this.calculator.planOneShot);
                    typeData.checked = 'checked';
                }

                typeData.id = type.id;
                typeData.oneShot = type.oneShot;
                typeData.planId = `plan_${type.id}@${type.oneShot}`;
                typeData.description = `${plan.hideButtons ? plan.singleButtonText : type.desc}`;
                typeData.parcial = type.parcial;
                typeData.netPlan = planData.netPlan,
                    typeData.tvPlan = planData.tvPlan
                planData.typeDataList.push({...typeData });
                typeData.checked = '';


                if (plan.hideButtons) {
                    typeData.hideButton = true;
                } else if (plan.types.length === 1) {
                    typeData.hideButton = true;
                    typeData.emptyType = true;
                    planData.typeDataList.push({...typeData });
                }
            });

            this.plansContainer.append($planInfoTemplate(planData));
        });
    }

    fillCalculator(result, settings) {
        this.data = result;

        this.calcConfig = {
            currency: settings.currency,
            minAmount: parseFloat(this.data.minRecharge),
            maxOneShot: parseFloat(this.data.maxOneShot),
            maxDays: parseFloat(this.data.daysMonth),
            dameSaldoDays: parseInt(this.data.dameSaldoDays),
            sosDays: parseInt(this.data.sosDays)
        };

        this.fillPlanInfoOptions(result);

        this.data.baseAmounts.forEach((amount, i) => {
            let checked = '';
            let firstPlanClass = '';
            let isFirst = false;

            if (i === 0) {
                this.calculator.amount = amount;
                isFirst = true;
                checked = 'checked';
                firstPlanClass = 'first-amount';
            }

            this.rechargeAmount.find('.recharge_amount-values').append(`<label class="unique_selection middle">
                <input type="radio" ${checked} name="base_amount_picker">
                <div data-amount="${amount}" class="content unique_selection_amount ${firstPlanClass}"><span class="content_text">${this.currencyFormat(amount, this.calcConfig.currency)} <span class="content_text_offer">${isFirst ? this.properties.minrechargetext : ''}</span></span></div>
            </label>`);
        });

        this.data.packs.forEach((pack) => {
            this.packages.append(`<article class="packages-list-element">
                <ul class="packages-list-element-options directv-input-wrapper">
                    <li class="packages-list-element-options-picker directv-input-checkbox">
                        <label>
                            <input id="package_${pack.id}" class="directv-input-checkbox unique_selection_pack" type="checkbox" data-pack="${pack.name}">
                            <span class="dtv-public-icon-check directv-input-checkbox-check-mark"></span>
                        </label>
                    </li>
                    <li class="packages-list-element-options-name">
                        <span>${pack.name}</span>
                    </li>
                    <li class="packages-list-element-options-link link">
                        <a href="${pack.link}" target="${pack.target}">${this.data.packLinkText}<span class="dtv-public-icon-next"></span></a>
                    </li>
                </ul>
            </article>`);
        });

        if (this.calcType == 'net') {
            $('.packages').remove();
            $('.plan-info-container').each(function() {
                if ($(this).attr('data-net') != 'true') {
                    $(this).remove();
                }
            })
        }

        if (this.calcType == 'tv') {
            $('.plan-info-container').each(function() {
                if ($(this).attr('data-tv') != 'true') {
                    $(this).remove();
                }
            })
        }



        this.otherAmount.attr("placeholder", `${this.currencyFormat(this.calcConfig.minAmount, this.calcConfig.currency)} ${this.properties.otherAmountPlaceholder}`);
        this.component.find('.sos-container').css('display', !this.data.sos ? 'none' : '');
        this.component.find('.give_me-container').css('display', !this.data.dameSaldo ? 'none' : '');

        this.calculatorResult();
    }

    calculatorResult() {
        const alert = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

        try {
            if (this.calculator.amount < this.calcConfig.minAmount) {
                alert.setTitle(this.properties.insufficientAmountMessage.title);
                alert.setDescription(this.properties.insufficientAmountMessage.description);
                alert.setStatus('error');
                alert.showAlert();
            } else {
                let resultContainer = this.component.find('.output');
                let packs = '';
                let daysResult = 0;
                this.days = this.getDays(this.getAdjustment());

                if (this.calcType == 'net' && this.calculator.plan.indexOf('SD') > -1) {

                } else {
                    resultContainer.find('.result-plan').text(this.calculator.plan);
                }

                resultContainer.find('.result-packs li').remove();

                if (this.calculator.packs.length > 0) {
                    this.calculator.packs.forEach((pack) => {
                        packs += `<li>
                                <span>${pack.name}</span>
                            </li>`;
                    });
                    resultContainer.find('.result-pack-container').removeAttr('style');
                    resultContainer.find('.result-packs').append(packs);
                } else {
                    resultContainer.find('.result-pack-container').css('display', 'none');
                }

                daysResult = this.days + this.calculator.adeudo;

                resultContainer.find('.output-days--amount').text(daysResult > 0 ? daysResult : 0);
                resultContainer.find('.result-value').text(this.currencyFormat(parseInt(this.calculator.amount), this.calcConfig.currency));
            }
        } catch (e) {
            alert.setTitle(this.properties.exceptionMessage.title);
            alert.setDescription(this.properties.exceptionMessage.description);
            alert.setStatus('error');
            alert.showAlert();
        }

    }

    getAdjustment() {
        let sumId = parseInt(this.calculator.planId);
        let adjustment = {};

        if (this.calculator.packs.length > 0) {
            this.calculator.packs.forEach((pack) => {
                sumId += pack.id;
            });
            let objAdjustment = this.data.adjustments.filter((adj) => adj.id === sumId);
            adjustment.oneShot = parseFloat(objAdjustment[0].oneShot);
            adjustment.parcial = parseFloat(objAdjustment[0].parcial);
        } else {
            adjustment.oneShot = parseFloat(this.calculator.planOneShot);
            adjustment.parcial = parseFloat(this.calculator.planParcial);
        }

        return adjustment;
    }

    validatePackagesIncluded(pack, checked) {
        pack.packagesIncluded.forEach((p) => {
            this.component.find('#package_' + p).attr("disabled", checked).attr("checked", false);
            if (checked) {
                let index = this.calculator.packs.findIndex((pck) => pck.id === p);
                if (index >= 0) {
                    this.calculator.packs.splice(index, 1);
                }
            }
        });

        let packsFilter = this.data.packs.filter((p) => jQuery.inArray(pack.id, p.packagesIncluded) >= 0);

        packsFilter.forEach((pck) => {
            let included = pck.packagesIncluded.slice();

            this.component.find('#package_' + pck.id).attr("disabled", false);

            included.forEach((pk) => {
                this.component.find('#package_' + pk).attr("disabled", false);
            });

            if (checked) {
                this.calculator.packs.forEach((pk) => {
                    if (this.calculator.packs.filter((p) => p.id === pk.id).length > 0) {
                        let idx = included.findIndex((pck) => pck === pk.id);
                        if (idx >= 0) {
                            included.splice(idx, 1);
                        }
                    }
                });

                if (1 === included.length) {
                    this.component.find('#package_' + pck.id).attr("disabled", true).attr("checked", false);
                    this.component.find('#package_' + included[0]).attr("disabled", true).attr("checked", false);
                    let index = this.calculator.packs.findIndex((pck) => pck.id === included[0]);
                    if (index >= 0) {
                        this.calculator.packs.splice(index, 1);
                    }
                }
            }
        });
    }

    validateOnlySelected(pack, checked) {
        this.data.packs.filter((pk) => pk.id !== pack.id).forEach((p) => {
            let onlyThis = p.onlyThis;
            if (pack.onlyThis || this.calculator.packs.length === 0) {
                this.component.find('#package_' + p.id).attr("disabled", checked).attr("checked", false);
            }
            if (checked && onlyThis) {
                this.component.find('#package_' + p.id).attr("disabled", true).attr("checked", false);
            }

            if ((pack.onlyThis && checked) || onlyThis) {
                let index = this.calculator.packs.findIndex((pck) => pck.id === p.id);
                if (index >= 0) {
                    this.calculator.packs.splice(index, 1);
                }
            }
        });
    }

    getDays(adjust) {
        if (this.calculator.amount < adjust.oneShot) {
            return Math.floor(this.calculator.amount / adjust.parcial * this.calcConfig.maxDays);
        } else if (this.calculator.amount > adjust.oneShot) {
            let oneShotPay = Math.floor(this.calculator.amount / adjust.oneShot);
            oneShotPay = this.calcConfig.maxOneShot > 0 && oneShotPay > this.calcConfig.maxOneShot ? this.calcConfig.maxOneShot : oneShotPay;

            let balance = this.calculator.amount - oneShotPay * adjust.oneShot;
            let plusDays = Math.floor(balance / adjust.parcial * this.calcConfig.maxDays);

            return oneShotPay * this.calcConfig.maxDays + plusDays;
        } else {
            return this.calcConfig.maxDays;
        }
    }

    getOfferPrice() {
        let adjust = this.getAdjustment();
        this.setOffer(adjust.oneShot);
    }

    setOffer(price) {
        this.component.find('.unique_selection_offer').text('');
        this.component.find('.unique_selection_offer').append(`
            <input class="data-offer" type="radio" name="base_amount_picker" data-amount="${price}">
            <div class="content">
                <span class="content_text">${this.currencyFormat(price, this.calcConfig.currency)} <span class="content_text_offer">${this.properties.offertext}</span></span>
            </div>`);
    }

    bindEvents() {
        $(this.component).on("click", '.unique_selection_plan', (e) => {
            let planSelect = e.currentTarget;

            this.calculator.plan = planSelect.getAttribute('data-plan').split('@')[0];
            this.calculator.planId = planSelect.id.split('@')[0].split('_')[1];
            this.calculator.planOneShot = planSelect.id.split('@')[1];
            this.calculator.planParcial = planSelect.getAttribute('data-plan').split('@')[1];

            this.getOfferPrice();

            if (this.offerSelect) {
                this.component.find('.unique_selection_offer .data-offer').attr('checked', 'checked');
                this.calculator.amount = parseFloat(this.calculator.planOneShot);
            }
        });

        $(this.component).on("click", '.plan-modal-callmenow', () => {
            this.getCallmeNowComponent();
        });

        $(this.component).on("click", '.unique_selection_amount', (e) => {
            const amountSelect = e.currentTarget;

            this.calculator.amount = parseFloat(amountSelect.getAttribute('data-amount'));
            this.offerSelect = false;

            this.otherAmount.val('');
        });

        $(this.component).on("click", '.unique_selection_offer', (e) => {
            let amountSelect = e.currentTarget.children[0];

            this.calculator.amount = parseFloat(amountSelect.getAttribute('data-amount'));
            this.offerSelect = true;

            this.otherAmount.val('');
        });

        $(this.component).on("change", '#txt_other_amount', (e) => {
            this.calculator.amount = parseFloat(e.currentTarget.value);
            this.offerSelect = false;

            if (this.calculator.amount === '') {
                this.component.find('.first-amount').click();
                this.component.find('.first-amount').parentElement.firstElementChild.checked
            }

            this.component.find('.recharge_amount-values .unique_selection input').removeAttr('checked');
            this.component.find('.recharge_amount-monthly_offer .unique_selection input').removeAttr('checked');
        });

        $(this.component).on("click", '.unique_selection_pack', (e) => {
            let packSelect = e.currentTarget;
            let pack = {};

            pack.name = packSelect.getAttribute('data-pack');
            pack.id = parseInt(packSelect.id.split('@')[0].split('_')[1]);

            let packFilter = this.data.packs.filter((p) => p.id === pack.id);
            pack.packagesIncluded = packFilter[0].packagesIncluded;
            pack.onlyThis = packFilter[0].onlyThis;

            if (packSelect.checked) {
                this.calculator.packs.push(pack);
            } else {
                const index = this.calculator.packs.findIndex((pck) => pck.id === pack.id);
                this.calculator.packs.splice(index, 1);
            }

            this.validatePackagesIncluded(pack, packSelect.checked);
            this.validateOnlySelected(pack, packSelect.checked);

            this.getOfferPrice();
        });

        $(this.component).on("click", '.directv-ui-button', () => {
            this.calculatorResult();
        });

        $(this.component).on("click", '#sos', (e) => {
            if (e.currentTarget.checked) {
                this.calculator.adeudo -= this.calcConfig.sosDays;
                if (this.component.find('#give_me').is(':checked')) {
                    this.calculator.adeudo += this.calcConfig.dameSaldoDays;
                }
            } else {
                this.calculator.adeudo += this.calcConfig.sosDays;
                if (this.component.find('#give_me').is(':checked')) {
                    this.calculator.adeudo -= this.calcConfig.dameSaldoDays;
                }
            }

            this.component.find('#give_me').attr("checked", false);
        });

        $(this.component).on("click", '#give_me', (e) => {
            if (e.currentTarget.checked) {
                this.calculator.adeudo -= this.calcConfig.dameSaldoDays;
                if (this.component.find('#sos').is(':checked')) {
                    this.calculator.adeudo += this.calcConfig.sosDays;
                }
            } else {
                this.calculator.adeudo += this.calcConfig.dameSaldoDays;
                if (this.component.find('#sos').is(':checked')) {
                    this.calculator.adeudo -= this.calcConfig.sosDays;
                }
            }

            this.component.find('#sos').attr("checked", false);
        });
    }

    getCallmeNowComponent() {
        const callmeNowComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMENOW);
        const alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

        if (!this.editMode) {
            if (callmeNowComponent) {
                callmeNowComponent.eventEmitter.subscribe((info) => {

                    if (info.event === 'callmenow-submit') {
                        callmeNowComponent.closeModal();
                        alertComponent.setTitle(callmeNowComponent.successTitle);
                        alertComponent.setDescription(callmeNowComponent.successDescription);
                        alertComponent.setStatus('success');
                        alertComponent.showAlert();
                    }

                    if (info.event === 'callmenow-submit-error') {
                        alertComponent.setTitle(callmeNowComponent.errorTitle);
                        alertComponent.setDescription(callmeNowComponent.errorDescription);
                        alertComponent.setStatus('error');
                        alertComponent.showAlert();
                    }
                });

                callmeNowComponent.modalTitle = callmeNowComponent.$title.html();
            }

            callmeNowComponent.openModal();
        }
    }

    currencyFormat(num, sign) {
        return sign + ' ' + (
            num
            .toFixed(0)
            .replace('.', ',')
            .replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.')
        )
    }
}

$('.calculator-widget').each(function() {
    const calcType = $(this).data('calctype');
    const id = $(this).data('idgen');
    const country = $(this).data('country');
    const language = $(this).data('language');
    const locale = country + '/' + language;
    const editMode = $(this).data('edit');
    const properties = {
        minrechargetext: $(this).data('minrechargetext'),
        offertext: $(this).data('offertext'),
        otherAmountPlaceholder: $(this).data('otheramountplaceholder'),
        oneShotMessage: {
            title: $(this).data('msgsuccessfuloneshottitle'),
            description: $(this).data('msgsuccessfuloneshotdescription'),
        },
        insufficientAmountMessage: {
            title: $(this).data('msginsufficentamounttitle'),
            description: $(this).data('msginsufficentamountdescription'),
        },
        exceptionMessage: {
            title: $(this).data('msgexceptiontitle'),
            description: $(this).data('msgexceptiondescription'),
        }
    };

    GeneralComponentContainer.setComponent(new PrepaidCalculatorComponent(calcType, id, locale, properties, editMode), id);
});
class PremiumTabsComponent {
    constructor(id, path, translateData) {
        this.tabPositions = [];
        this.id = id;
        this.path = path;
        this.translateData = translateData;
        this.component = $('#' + this.id);
        this.eventEmitter = new rxjs.BehaviorSubject({ event: 'create', data: '' });
        this.getData(this.initComponent);
    }

    initComponent(rootClass) {
        let activeTab = rootClass.component.find('.tabs-container\x20.tab-item.tab-active');
        const tabIndicator = rootClass.component.find('.tabs-container\x20.tab-indicator');
        let activeTabContent = rootClass.component.find('.tabs-contents\x20.tab-content.tab-content-active');

        const tabClick = function (event) {
            activeTab.removeClass('tab-active');
            activeTab = $(event.target).hasClass('tab-indicator') ? $(event.target).parent() : $(event.target);
            activeTab.addClass('tab-active');

            activeTabContent.removeClass('tab-content-active');
            activeTabContent = $(event.target).parent().parent().find(`.tabs-contents\x20.tab-index-${activeTab.data('tabIndex')}`);
            activeTabContent.addClass('tab-content-active');
        };

        rootClass.component.find(`.tabs-container\x20.tab-item`).on('click', tabClick);
        rootClass.component.find('.tabs-container\x20.tab-item\x20.tab-indicator').on('click', tabClick);
    }

    getData(callback) {
        if (this.path) {
            $.ajax({
                url: this.path,
                success:
                    (result) => {
                        this.fillData(result.body, () => {
                            callback(this);
                        });
                    },
                error: (err) => {
                    console.log('Hubo un error en la peticin');
                }
            });
        }
    }

    setData(data, planType) {
        this.fillData(data.filter((plan) => plan.type == planType), ()=>{
            this.initComponent(this);
        });
    }

    fillData(result, callback) {
        // Fill the category list
        const categoryList = [ ...new Set(result.map((item) => item.category)) ];

        if (this.component.find('.tabs-container').children().length == 0) {
            categoryList.forEach((data, index) => {
                this.component.find('.tabs-container').append(`
                <div class="${index == 0 ? 'tab-item tab-active' : 'tab-item'}" data-tab-index="${index}">
                    ${data}
                    <div class="tab-indicator" data-tab-index="${index}"></div>
                </div>
                `);
            });
        }

        const contentTabs = this.component.find('.tabs-contents');
        const subjectsArray = [];

        categoryList.forEach((category, catIndex) => {
            contentTabs.append(`
                    <div class="${catIndex == 0 ? 'tab-content tab-content-active tab-index-' + catIndex : 'tab-content tab-index-' + catIndex}">
                    </div>`);
            const contentTab = contentTabs.find('.tab-content.tab-index-' + catIndex);

            result.filter((item) => item.category === category).forEach((data, index) => {
                contentTab.append(`<div class="premium-package-container content-index-${index}"><div>`);
                const packageContainer = contentTab.find('.content-index-' + index);
                const premiumPackCompo = new PremiumPackageContainerComponent('', '', this.translateData);

                premiumPackCompo.externalInitComponent(packageContainer, data);
                subjectsArray.push(premiumPackCompo.eventEmitter);
            });
        });
        this.eventEmitter.next({ event: 'end-load', data: rxjs.from(subjectsArray).pipe(rxjs.operators.mergeMap((item) => item)) });

        if (callback) {
            callback();
        }
    }
}

const premiumpackagestabscomponents = $('.premium-packages-tabs');
premiumpackagestabscomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');

    const translateData = {
        seeMore: component.data('seemore'),
        seeLess: component.data('seeless'),
        include:  component.data('include'),
        included: component.data('included'),
        remove: component.data('remove'),
        month:  component.data('month'),
        channels: component.data('channels'),
        from:  component.data('from'),
        freeInclude:  component.data('freeinclude')
    }
    GeneralComponentContainer
        .setComponent(new PremiumTabsComponent(id, path, translateData), id);
});
PremiumPackFeatured = (function () {
    const defaults = {
        "selectors": {
            "channels": ".channels",
            "channelsTemplate": "#channels-template",
            "featuredImage": ".dtv-premium-pack-featured-header-content img",
            "featuredPremiere": ".dtv-premium-pack-featured-premiere",
            "featuredContent": ".dtv-premium-pack-featured-content"
        },
        "classes": {
            "loaded": "loaded",
            "monoChannel": "mono-channel"
        },
        "attributes": {},
        "events": {
            "load": "load"
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.highlighetedChannels = [];
            this.options = options;
            this.viewChannels = false;
            this.initComponent();
        }

        initComponent() {
            this.channelsTemplate = Handlebars.compile(this.component.find(defaults.selectors.channelsTemplate).html());
            this.$channels = this.component.find(defaults.selectors.channels);
            this.$featuredImage = this.component.find(defaults.selectors.featuredImage);
            this.$featuredPremiere = this.component.find(defaults.selectors.featuredPremiere);
            this.$featuredContent = this.component.find(defaults.selectors.featuredContent);
            const genericFeaturedImage = new GenericImage(this.$featuredImage);
        }

        setHighlightedChannels(channels) {
            if (channels.length > 0) {
                this.viewChannels = true;
                this.highlighetedChannels = [ ...channels ];
                this.renderHighlightedChannels();
            }

            this.showPremiumPackFeatured();
        }

        renderHighlightedChannels() {
            const highlighetedChannels = this.channelsTemplate({
                channels: this.highlighetedChannels
            });

            this.$channels.html(highlighetedChannels);
        }

        showPremiumPackFeatured() {
            const viewPremiere = this.options.featuredPremiere;

            if (!this.viewChannels && !viewPremiere) {
                this.$featuredContent.remove();
            } else if (this.viewChannels && viewPremiere) {
                this.$channels.addClass('display-border');
            } else {
                if (!this.viewChannels && viewPremiere) {
                    this.$featuredPremiere.addClass('full-width');
                    this.$channels.remove();
                }

                if (this.viewChannels && !viewPremiere) {
                    this.$channels.addClass('full-width');
                    this.$featuredPremiere.remove();
                }
            }
        }
    };
})();

const premiumfeaturedcomponents = $('.dtv-premium-pack-featured');
premiumfeaturedcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    let title =  component.data('title');
    let subtitle =  component.data('subtitle');
    const options = {
        "desktopImg":  component.data('desktopimg'),
        "mobileImg":  component.data('mobileimg'),
        "featuredPremiere": title || subtitle ? true : false
    };
    GeneralComponentContainer.setComponent(new PremiumPackFeatured(id, options), id);
});
class PremiumPackDataComponent {
    constructor(id, i18nData, locale) {
        this.locale = locale;
        this.path = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + 'premiumpacks.html/' + this.locale;
        this.categoriePath = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + "categories.html/" + this.locale + "?type=package";
        this.settingsPath = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + "settings.html/" + this.locale;
        this.id = id;
        this.i18nData = i18nData;
        this.component = $('#' + this.id);

        this.cardsData = [];
        this.cardsFilter = {};

        this.posButton = this.component.find('#btn-post');
        this.preButton = this.component.find('#btn-pre');
        this.todosButton = this.component.find('#btn-todos')
        this.btnOption = this.component.find('.btn-option');
        this.cardContainer = this.component.find('.prempack-cards-container');

        this.filterNames = {
            post: 'postpaid',
            pre: 'prepaid'
        };

        this.getData();
    }

    getData() {
        rxjs.combineLatest(
            [this.settingsPath, this.categoriePath, this.path].map(
                (path) =>
                    ajax2Observable(
                        $.ajax({
                            url: path
                        })
                    )
            )).subscribe(
                (data) => {
                    try {
                        this.settings = data[0].body;
                        this.setCategories(data[1].body);
                        this.fillData(data[2].body);
                    } catch (e) {
                        console.log(e);
                    }
                },
                (error) => {
                    console.log(error);
                }
            );
    }

    setCategories(categoryList) {
        const categories = $('#prempack-items');
        const selectButton = $('#prempack-drop');

        if (categories.children().length == 0) {
            categories.append(`
                <li><a class="prempack-item allcat ant-action ant-button">${this.i18nData.allCategories}</a></li>
                `);
            categoryList.forEach((data) => {
                categories.append(`
                <li><a class="prempack-item ant-action ant-button" id="${data.id}">${data.name}</a></li>
                `);
            });
        }

        $(document).mouseup((e) => {
            if ((!selectButton.is(e.target) && selectButton.has(e.target).length === 0)) {
                this.component.find('.prempack-categories-dropdown').removeClass('open');
            }
        });
    }

    // Fill the category list
    fillData(data) {
        this.cardsData = data;
        this.setFilters();
        this.filterType = this.validateSegmentsType(countryPS, window.location.hash.replace('#', ''));
        this.validateType(this.filterType);
    }

    validateType(type) {
        switch (type) {
            case DIRECTV_PUBLIC_SITES_CONSTANTS.SETTINGSTYPE.PREPAID:
                this.btnOption.removeClass("selected");
                this.preButton.addClass('selected');
                this.cardsFilter.type = this.filterNames.pre;
                this.filterCards();
                break;
            default:
                this.btnOption.removeClass("selected");
                this.posButton.addClass('selected');
                this.cardsFilter.type = this.filterNames.post;
                this.filterCards();
                break;
        }
    }

    validateSegmentsType(country, segment) {
        const data = DIRECTV_PUBLIC_SITES_CONSTANTS.PLAN_NAMES[country];
        let value = '';

        Object.keys(data).map((name) => {
            if (data[name] === segment) {
                value = name;

                return;
            }
        });

        return value;
    }

    setFilters() {
        this.preButton.on('click', () => {
            this.btnOption.removeClass("selected");
            this.preButton.addClass('selected');
            this.cardsFilter.type = this.filterNames.pre;
            this.filterCards();
        });
        this.posButton.on('click', () => {
            this.btnOption.removeClass("selected");
            this.posButton.addClass('selected');
            this.cardsFilter.type = this.filterNames.post;
            this.filterCards();
        });
        this.todosButton.on('click', () => {
            this.btnOption.removeClass("selected");
            this.todosButton.addClass('selected');
            this.cardsFilter.type = null;
            this.filterCards();
        });

        $('.drop-action').on('click', (e) => {
            if (this.component.find('.prempack-categories-dropdown').hasClass('open')) {
                this.component.find('.prempack-categories-dropdown').removeClass('open');
            } else {
                this.component.find('.prempack-categories-dropdown').addClass('open');
            }
        });
        $('.prempack-item').on('click', (e) => {
            if ($(e.target).hasClass('allcat')) {
                delete this.cardsFilter.category;
            } else {
                this.cardsFilter.category = $(e.target).attr('id');
            }

            this.filterCards();
            $('#prempack-drop .dropdown-label').text($(e.target).text());
            this.component.find('.prempack-categories-dropdown').removeClass('open');
        });
    }

    filterCards() {

        const cards = this.cardsData
            .filter((item) => this.cardsFilter.type ? this.cardsFilter.type == item.types[0] : true)
            .filter((item) => this.cardsFilter.category ? this.cardsFilter.category == item.category.id : true)
            .filter((item) => (item.hasOwnProperty('hidden') ? item.hidden === false : true) &&
                (item.hasOwnProperty('showOnlyCalculator') ? item.showOnlyCalculator === false : true));

        this.cardContainer.html('');

        cards.forEach(
            (cardData) => {

                cardData.urlRedirect = cardData.link;
                const component = $(`<div class="single-plan-card-container ${cardData.hidden && 'hiddePlan'} plan"></div>`);

                new SinglePlanCardComponent(component, '', this.i18nData).singlePackCardfillData(cardData, this.settings.find((s) => s.type === cardData.type));
                this.cardContainer.append(component);
            }
        );
    }
}

const prempackcomponents = $('.prempack-wrapper');
prempackcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    let translateData = {
        month: component.data('month'),
        channels: component.data('channels'),
        select: component.data('select'),
        recharge: component.data('recharge'),
        seemore: component.data('seemore'),
        get: component.data('get'),
        requires: component.data('requires'),
        prepaidkit: component.data('prepaidkit'),
        from: component.data('from'),
        prepaidText: component.data('prepaidtext'),
        postpaidText: component.data('postpaidtext'),
        allCategories: component.data('allcategories'),
        packCardAdd: component.data('packcardadd'),
        packCardActive: component.data('packcardactive'),
        packCardBasic: component.data('packcardbasic')

    }
    const country = component.data('country');
    const language = component.data('language');
    const locale = country + '/' + language;
    new PremiumPackDataComponent(id, translateData, locale);
});
PremiumPackChannelOnlyComponent = (function () {
    const defaults = {
        cardTemplate: `
        <div class="channel-container" >
            <div class="back-wrap"></div>
            <div class="card-body" style="background-image:url('{{backImage}}')">
                <div class="channel-card">
                    <img class="logo" src="{{logo}}" alt="alt">
                    <div class="name">{{name}}</div>
                    <div class="number">{{number}}</div>
                </div>
                {{!-- <span>/{{i18nData.month}}</span> --}}
                <div class="price">
                    {{currency}}{{price}}
                </div>
                <button class="btn-select directv-ui-button">
                    {{ctaText}}
                </button>
            </div>
            <div class="footer-description">{{description}}</div>
        </div>`
    };

    return class {
        constructor(component, i18nData) {
            this.component = component;
            this.i18nData = i18nData;
        }

        setChannel(channel) {
            this.component.append(
                Handlebars.compile(defaults.cardTemplate)(
                    Object.assign({}, channel, { i18nData: this.i18nData })
                )
            );

            this.component.find('.btn-select').on('click', () => {
                window.open(channel.url_redirect, '_self');
            });
        }
    };
})();

const premiumpackchannelonlycomponents = $('.premiumpackchannelonly-container');
premiumpackchannelonlycomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const translateData = {
        month: component.data('month')
    }
    GeneralComponentContainer.setComponent(new PremiumPackChannelOnlyComponent($('#' + id),translateData), id);
});
class PremiumPackageContainerComponent {
    constructor(id, path, i18nData) {
        this.closeDesktopHeight = 185;
        this.closeMobileHeight = 408;
        this.closeMobileHeight2 = 226;
        this.isIncluded = false;
        this.path = path;
        this.id = id;
        this.i18nData = i18nData;
        this.component = $('#' + this.id);
        this.eventEmitter = new rxjs.Subject();
        this.getData();
    }

    getData() {
        this.initComponent(premiumPackMock.body[0]);
        // $.ajax({
        //     url: this.path,
        //     success:
        //         (result) => {
        //             this.fillData(result, $('#deco-slider-cont-' + this.id));
        //         },
        //     error: (err) => {
        //         console.log('Hubo un error en la peticin')
        //     }
        // });
    }

    externalInitComponent(component, packData) {
        this.component = component;
        this.initComponent(packData);
    }

    initComponent(packData) {
        this.fillData(packData);
        const accActionButton = this.component.find('.accordeon-action-btn\x20div');
        const accordeonCont = this.component.find('.accordeon-container');
        const addPackBtn = this.component.find('.add-pack-btn');
        const removePackBtn = this.component.find('.remove-pack-btn');

        addPackBtn.text(this.i18nData.include);
        this.closeAccordeon(accordeonCont, accActionButton);

        // callback that assign click action in the add pack button.
        addPackBtn.on('click', () => {
            addPackBtn.text(this.i18nData.included);
            addPackBtn.addClass('disabled');
            accordeonCont.addClass('remove-pack');
            this.isIncluded = true;

            if (!accordeonCont.hasClass('open-accordeon')) {
                this.closeAccordeon(accordeonCont, accActionButton);
            }

            this.eventEmitter.next({
                event: 'add-pack',
                data: packData
            });
        });

        // callback that assign click action in the remove pack label
        removePackBtn.on('click', () => {
            addPackBtn.text(this.i18nData.include);
            addPackBtn.removeClass('disabled');
            this.isIncluded = false;
            accordeonCont.removeClass('remove-pack');

            if (!accordeonCont.hasClass('open-accordeon')) {
                this.closeAccordeon(accordeonCont, accActionButton);
            }

            this.eventEmitter.next({
                event: 'remove-pack',
                data: packData
            });
        });

        // callback in the resize event, to accomadte the measurements of the accordeon.
        $(window).resize(() => {
            accordeonCont.hasClass('open-accordeon') ?
                this.openAccordeon(accordeonCont, accActionButton) :
                this.closeAccordeon(accordeonCont, accActionButton);
        });

        // callback in the action on the click event of the open and close accordeon.
        accActionButton.on('click', () => {
            accordeonCont.css('transition', 'height 1s ease-out');
            accordeonCont.find('.main').css('transition', 'height 1s ease-out');
            accordeonCont.hasClass('open-accordeon') ?
                this.closeAccordeon(accordeonCont, accActionButton) :
                this.openAccordeon(accordeonCont, accActionButton);
            setTimeout(() => {
                accordeonCont.css('transition', 'none');
                accordeonCont.find('.main').css('transition', 'none');
            }, 1000);
        });
    }

    // method that open the accordeon, it depends of the current resolution.
    openAccordeon(accordeonCont, viewMoreButton) {
        if ($(window).width() > 768) {
            accordeonCont.find('.main').css('height', 'auto');
            accordeonCont.height(accordeonCont.find('.accordeon-content').outerHeight());
        } else {
            accordeonCont.find('.main').height(accordeonCont.find('.main-content').outerHeight());
            accordeonCont.height(accordeonCont.find('.main-content').outerHeight() + this.closeDesktopHeight);
        }

        accordeonCont.addClass('open-accordeon');
        viewMoreButton
            .html(`<span class="text">${this.i18nData.seeLess}</span>
                <span class="dtv-public-icon-close x"></span>`);
    }

    // method to close the accordeon.
    closeAccordeon(accordeonCont, viewMoreButton) {
        if ($(window).width() > 768) {
            accordeonCont.find('.main').css('height', 'auto');
            accordeonCont.height(this.closeDesktopHeight + (this.isIncluded ? 50 : 0));
        } else {
            accordeonCont.find('.main').height(this.closeMobileHeight2);
            accordeonCont.height(this.closeMobileHeight);
        }

        accordeonCont.removeClass('open-accordeon');
        viewMoreButton
            .html(`<span class="text">${this.i18nData.seeMore}</span>
                <span class="dtv-public-icon-add plus"></span>`);
    }

    fillData(packData) {
        this.component.html(`  
            <div class="component-content">
                <div class="header"></div>
                <div class="color-divider">
                    <div class="logo item1"></div>
                    <div class="logo item2"></div>
                </div>
                <div class="accordeon-container">
                    <div class="accordeon-content">
                        <div class="main">
                            <div class="main-content">
                            <div class="description"></div>
                            <div class="logos-container"></div>
                            <div class="without-cost includes">
                                ${this.i18nData.freeInclude}
                            </div>
                            <div class="logos-container includes"></div>
                            <div class="divider"></div>
                            <ul class="features"></ul>
                        </div>
                    </div>
                    <div class="lateral-menu">
                        <div class="chann-price">
                            <div class="item1">
                                <div class="label">
                                    ${this.i18nData.channels}
                                </div>
                                <div class="value">
                                </div>
                            </div>
                            <div class="item2">
                                <div class="label">
                                    ${this.i18nData.from}
                                </div>
                                <div class="value"></div>
                            </div>
                        </div>
                        <button class="directv-ui-button add-pack-btn"></button>
                        <div class="remove-pack-btn">
                            <span class="dtv-public-icon-close x dtv-public-icon-x2"></span>${this.i18nData.remove}
                        </div>
                    </div>
                    <div class="accordeon-action-btn">
                        <div></div>
                    </div>
                </div>
            </div>
        </div>`);
        this.component.find('.component-content\x20.header').text(packData.name);
        const mainContent = this.component.find('.accordeon-container\x20.accordeon-content\x20.main\x20.main-content');

        this.component.find('.component-content\x20.color-divider').css('background-color', packData.color);
        mainContent.find('.description').text(packData.description);
        mainContent.find('.logos-container').html('');
        packData.channels.filter((channel) => !channel.marked).forEach((channel) => {
            mainContent.find('.logos-container:not(.includes)').append(`<img src="${channel.logo}" alt="${channel.alt}">`);
        });
        const packDataMarkedList = packData.channels.filter((channel) => channel.marked);

        if (packDataMarkedList.length) {
            packDataMarkedList.forEach((channel) => {
                mainContent.find('.logos-container.includes').append(`<img src="${channel.logo}" alt="${channel.alt}">`);
            });
        } else {
            mainContent.find('.includes').css('display', 'none');
        }

        mainContent.find('.features').html('');
        packData.features.sort((a, b) => a.offer - b.offer).forEach((feature) => {
            mainContent.find('.features').append(`<li class="${feature.offer ? 'offer' : ''}"><span class="dtv-public-icon-check"></span>${feature.description}</li>`);
        });
        this.component.find('.accordeon-container\x20.accordeon-content\x20.lateral-menu\x20.chann-price\x20.item1\x20.value').text(packData.chanCount);
        // <span class="month">/${this.i18nData.month}</span>
        this.component.find('.accordeon-container\x20.accordeon-content\x20.lateral-menu\x20.chann-price\x20.item2\x20.value').html(`${packData.price}`);
    }
}

const premiumPackMock = {
    "status": true,
    "total": 1,
    "body": [
        {
            "node": "98",
            "name": "HBO MAX",
            "color": "#00aeef",
            "description": "El paquete ms completo de HBO, MAX y Max Prime con acceso sin costo adicional a HBO GO.",
            "hlSentence": "Incluye sin costo",
            "logo": "/content/dam/public-sites/packages/images/524.png",
            "link": "/content/public-sites/co/es",
            "price": "$33.900",
            "chanCount": 10,
            "features": [
                {
                    "description": "Disfruta del HBO MAX Fest 4 das sin costo! del 27 al 31 de octubre.",
                    "link": "",
                    "offer": true
                },
                {
                    "description": "Estrenos exclusivos y las pelculas ms taquilleras",
                    "link": "",
                    "offer": false
                },
                {
                    "description": "Series originales exclusivas ms premiadas de la TV norteamericana",
                    "link": "",
                    "offer": false
                },
                {
                    "description": "Ms variedad de pelculas de accin, aventuras y series de adultos",
                    "link": "",
                    "offer": false
                },
                {
                    "description": "Con un canal dedicado de HBO destacando el cine latino, europeo y asitico",
                    "link": "",
                    "offer": false
                }
            ],
            "channels": [
                {
                    "name": "HBO 2 HD",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/1525.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO 2 HD",
                    "marked": false
                },
                {
                    "name": "HBO",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/524.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO",
                    "marked": false
                },
                {
                    "name": "HBO Plus Este",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/526.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO Plus Este",
                    "marked": false
                },
                {
                    "name": "HBO Signature",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/528.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO Signature",
                    "marked": false
                },
                {
                    "name": "HBO 2",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/525.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO 2",
                    "marked": false
                },
                {
                    "name": "HBO Plus Oeste",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/532.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO Plus Oeste",
                    "marked": false
                },
                {
                    "name": "HBO Family",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/534.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "HBO Family",
                    "marked": false
                },
                {
                    "name": "MAXPRIME Oeste",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/538.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "MAXPRIME Oeste",
                    "marked": false
                },
                {
                    "name": "MAX E",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/540.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "MAX E",
                    "marked": false
                },
                {
                    "name": "MAX UP",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/541.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "MAX UP",
                    "marked": false
                },
                {
                    "name": "MAXPRIME E",
                    "logo": "http://www.ondirectv.com/Thumbnail.ashx?image\u003dLOGOS/Canales/CO/542.png\u0026width\u003d64\u0026height\u003d32",
                    "alt": "MAXPRIME E",
                    "marked": false
                }
            ]
        }
    ]
};

const premiumpackagecomponents = $('.premium-package-container');
premiumpackagecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');

    const translateData = {
        seeMore: component.data('seemore'),
        seeLess: component.data('seeless'),
        include: component.data('include'),
        included: component.data('included'),
        remove: component.data('remove'),
        month: component.data('month'),
        channels: component.data('channels'),
        from: component.data('from'),
        freeInclude: component.data('freeinclude'),
    }
    GeneralComponentContainer
        .setComponent(new PremiumPackageContainerComponent(id, path, translateData), id);
});
function getDataPremiumCard(path, id) {
    path = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + 'bundles.html' + (path ? path.split('html')[1] : '');

    if (path) {
        $.ajax({
            url: path,
            success:
                (result) => {
                    const card = $('#' + id);

                    result.body[0] && premiumCardfillData(card, result.body[0]);
                },
            error: (err) => {
                console.log( err);
            }
        });
    }
}

function premiumCardfillData(card, data) {

    try {
        card.click(()=>{
            document.location.href = data.link;
        });

        card.addClass('ant-action');
        card.addClass('ant-link');
        card.html(`
        <a href="${data.packs[0].link}">
            <div class="imagecontainer">
                <img class="imagetitle" src="${data.logo}" alt="">
            </div>
            <div class="description">
                <span> ${data.name} </span>
            </div>
        </a>`);
    } catch (error) {
        console.log(error);
    }
}

const premiumchannelcardcomponents = $('.premiumchannelcard');
premiumchannelcardcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path =  component.data('path');
    getDataPremiumCard(path, id);
});
$(document).on("foundation-contentloaded", function () {
    if ($("input[name*='./description']").length > 0) {
        const rteDiv = $("input[name*='./description']").siblings(".coral-RichText-editable");
        const maxlen = 300;
        const arrKeys = [ 8, 17, 35, 36, 37, 39, 46, 90, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123 ];

        rteDiv.on("drop", function (e) {
            e.preventDefault();
            e.returnValue = false;
        });

        rteDiv.on("keydown", function (e) {
            const currLen = rteDiv.children(":first").text().length;

            if (e.which == 13 || e.which == 9) {
                e.preventDefault();
                e.returnValue = false;

                return false;
            }

            if (currLen > maxlen - 1) {
                if (jQuery.inArray(e.which, arrKeys) === -1) {
                    e.preventDefault();
                    e.returnValue = false;

                    return false;
                }
            }
        });

        rteDiv.on("paste", function (e) {
            const currLen = rteDiv.children(":first").text().length;

            e.preventDefault();
            let inText;
            const clipb = (e.originalEvent || e).clipboardData;

            if (clipb === undefined || clipb === null) {
                inText = window.clipboardData.getData("text") || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxlen);
                    inText = inText.substring(0, maxlen - currLen);

                    if (window.getSelection) {
                        const newNode = document.createElement("span");

                        newNode.innerHTML = inText;
                        window.getSelection().getRangeAt(0).insertNode(newNode);
                    } else {
                        document.selection.createRange().pasteHTML(inText);
                    }
                }
            } else {
                inText = clipb.getData('text/plain') || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxlen - currLen);
                    document.execCommand('insertText', false, inText);
                }
            }
        });
    }
});

$(document).ready(function(){

    $('#guest').click(()=> $('.no-have-acc-container').toggle());
});

PqrUserSelectionModule = (function () {
    const defaults = {
        "selectors": {
            "value": ".pqr-value-input",
            "recaptcha": ".recaptcha-field",
            "recaptchaButton": ".btn-custom-begin",
            "pqrUserSelectionButton": ".btn-custom-begin",
        },
        "classes": {},
        "attributes": {
            "pattern": "pattern",
            "minlength": "minlength",
            "maxlength": "maxlength",
            "separator": "-",
            "checked": "checked"
        },
        "events": {
            "keyPress": "keypress",
            "input": "input",
            "click": "click"
        },
        "phoneTypes": {
            "mobile": 'mobile',
            "landline": 'landline'
        }
    };

    return class {
        constructor(id, options, editMode) {
            this.id = id;
            this.component = $('#' + this.id);
            this.editMode = editMode;
            this.eventEmitter = new rxjs.Subject();
            this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER;

            this.value = options.value;
            this.urlComenzar = options.urlComenzar;
            this.recaptchaEnabled = options.recaptchaEnabled;
            this.initComponent();
        }

        initComponent() {
            const el = this;

            this.$value = this.component.find(defaults.selectors.value);
            this.$recaptcha = this.component.find(defaults.selectors.recaptcha);
            this.$recaptchaButton = this.component.find(defaults.selectors.recaptchaButton);
            this.$pqrUserSelectionButton = this.component.find(defaults.selectors.pqrUserSelectionButton);

            this.$value.inputComponent({ errorMessage: '' });

            if(this.editMode){
                $('.no-have-acc-container').show()
            }
            this.component.submit(function(e){
                if (el.$recaptcha.val() !== 'true') e.preventDefault();
            });
        }


        updateValidStateOfButton(isValid) {

            if (isValid && this.recaptchaEnabled && siteKey && this.$recaptcha.val() === 'false') {
                this.$recaptcha.addClass('validation-missing');
            }

            if (isValid && ((this.recaptchaEnabled && this.$recaptcha.val() === 'true') || !this.recaptchaEnabled || !siteKey)) {
                this.$pqrUserSelectionButton.addClass('btn-primary');
                this.$pqrUserSelectionButton.removeAttr('disabled', 'disabled');
                this.$recaptcha.removeClass('validation-missing');
            } else {
                this.$pqrUserSelectionButton.removeClass('btn-primary');
                this.$pqrUserSelectionButton.attr('disabled', 'disabled');
            }
        }

        isValid() {
            return false;
        }
    };
})();

const pqrUserSelectioncomponents = $('.formPQR');
pqrUserSelectioncomponents.each((_index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const editMode = component.data('editmode');
    const options = {
        recaptchaEnabled:component.data('recaptchaenabled'),
        urlComenzar:component.data('urlComenzar'),
    };

    GeneralComponentContainer.setComponent(new PqrUserSelectionModule(id, options, editMode), id);
});
PopUpComponent = (function () {
    const defaults = {
        "selectors": {
            "modalClose": ".new-modal-header-icon",
            "valid": ":valid"
        },
        "classes": {
            "open": "open",
            "close": "close",
            "hide": "hide",
            "show": "show",

        },
        "attributes": {},
        "events": {}
   
    };
    

    return class {
        constructor(id, idCierre) {
            this.id = id;
            this.idCierre = idCierre
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
            this.component.removeClass(defaults.classes.close);
            this.component.addClass(defaults.classes.open);
        }

        initComponent() {
            const popUp = this.component.find(defaults.selectors.modalClose);
            if (this.idCierre){
                popUp.addClass(defaults.classes.show);  
                popUp.removeClass(defaults.classes.hide);
                popUp.click(() => {
                    this.component.removeClass(defaults.classes.open);
                    this.component.addClass(defaults.classes.close);
                });             
            } else {
                popUp.addClass(defaults.classes.hide);
                popUp.removeClass(defaults.classes.show);
                runListener(this.id, this.component);
                
            }
        }

    };
})();
    
$('.new-modal-widget').each(function () {
    const id = $(this).data('idgen');
    const idCierre = $(this).data('idclose');
    const options = {
    };
    GeneralComponentContainer.setComponent(new PopUpComponent(id, idCierre), id);
    $(window).load(function () {
        this.loadPopUp(id);
        this.closePopUp(id);
    
    });
    
   
});

    function loadPopUp (id){
        $("[data-popup]").each(function (){
            const element = $(this);
            element.click(function(){
                const popUpComponent = $('#' + id);
                popUpComponent.removeClass('close');
                popUpComponent.addClass('open');
            });
        });
    }

    function closePopUp (id){
        $("[data-closepopup]").each(function (){
            const element = $(this);
            element.click(function(){
            const popUpComponent = $('#' + id);
            popUpComponent.removeClass('open');
            popUpComponent.addClass('close');
            });
        });
    }


function runListener (id, component){
    document.addEventListener('click', function (event) {
        const box = document.getElementById(id);
        const clase = event.target.classList.contains('new-base-modal-wrapper');
      
        if (clase) {
            component.removeClass('open');
            component.addClass('close');
        } 
      });
}
class PhoneNumbersPDPComponent {
    constructor(id, country, language) {
        this.helper = new Helpers();
        this.component = $('#' + id);
        this.country = country;
        this.language = language;
        this.getData();
    }

    getData() {
        const source = this.helper.getCookie('lp_utm_source');
        requestCachedData.getAjax({
            "endpoint" : DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ALLMEDIA,
            "selectors" : [this.country, this.language],
            "suffixes" : [ (source === "" ? `/DIRECTV-${this.country.toUpperCase()}` : source) ]
        }).then((data) => {
            if (data) {
                this.setPhones(data);
            }
        }, (err) => {
            console.log('Hubo un error en la peticin');
        });
    }

    setPhones(data) {
        this.component.find('.phone-banner-phones').html(['phone1', 'phone2'].map((phoneKey) =>
            data[phoneKey] && data[phoneKey].length > 2 ?
                this.helper.isMobile() ?
                    `<a href="tel:${data[phoneKey]}" class="ant-link ant-action">${data[phoneKey]}</a>` :
                    `<span>${data[phoneKey]}</span>`
                : ''
        ).filter((v) => v ? true : false).join(' | '));
    }
}

const phonebannercomponents = $('.phone-banner-pdp');
phonebannercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const language =  component.data('language');
    const country  =component.data('country');

    new PhoneNumbersPDPComponent(id, country, language);
});
PackOfferLaneComponent = (function() {
    return class {
        constructor(component) {
            this.component = component;
            this.totalPlans = 0;
        }

        fillData(bundle) {
            const postpaid = !!bundle.postref.infoPacks[0];
            const prepaid = !!bundle.preref.infoPacks[0];

            if (postpaid) {
                this.setOffer(bundle.postref.infoPacks[0]);
            }

            if (prepaid) {
                this.setOffer(bundle.preref.infoPacks[0]);
            }
        }

        setOffer(pack) {
            if (pack.offerlong) {
                this.totalPlans++;

                if (!this.component.hasClass('plan')) {
                    this.component.addClass('plan');
                }

                if (this.totalPlans > 1) {
                    this.component.addClass('multiplan');
                }

                this.component.append(
                    `<div class="offer-item">
                        <img src="${pack.badgetDark}" alt="alt">
                        <div>${ pack.offerlong}<div>
                    </div>
                    `
                );
            }
        }
    };
})();

const packofferlanecomponents = $('.packofferlane-container');
packofferlanecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new PackOfferLaneComponent($('#' + id)), id);
});
(function(){
    const OttFeaturedProducts = (function () {
        return class {
            constructor(element) {
                this.element = element;
                this.initComponent();
            }

            initComponent() {
                const fullimage = this.element[0].getAttribute('fullimage') === 'true';
                this.resizeImage(fullimage, '.ottfeaturedproducts');
                // on resize
                window.onresize = () =>{
                    if(fullimage){
                        this.resizeImage(fullimage, '.ottfeaturedproducts');
                    }
                }
            }

            resizeImage(active, parent){
                let targetImg =  $(parent).children().children('.dtv-ott-featured-product-background').children().children('img');

                if(active){
                    $(targetImg).css('height', $(parent).height());
                } else {
                    $(targetImg).removeAttr('style');
                }
                
            }

        };
    })();

    const components = $('.dtv-ott-featured-product');
    components.each((index, element) => {
        const component = $(element);
        const id = component.attr('id');
        GeneralComponentContainer.setComponent(new OttFeaturedProducts(component), id);
    });
})()
let resumeObject = {
    decosNoCost: {},
    decosCost: {},
    resume: {}
};

class OrderResumeComponent {
    constructor(path, id) {
        this.id = id;
        this.component = $('#' + this.id);
        this.initComponent(path);
    }

    initComponent(path) {
        if (typeof productDeatailsLandingComponent !== 'undefined') {
            const those = this;
            const observable = productDeatailsLandingComponent.setObservable();

            if (observable) {
                observable.subscribe((result) => {
                    const plan = result.plan;

                    if (plan && plan && plan.length > 0) {
                        those.fillOrderResume(plan);
                    }
                });
            }
        } else {
            this.getOrderResume(path);
        }

        $('#' + this.id).scroll(() => {
            const resumecroll = $('#' + this.id).scrollTop();

            if (resumecroll >= 10) {
                $('.orderresume-close').css('box-shadow', '0 4px 8px 0 rgba(0, 0, 0, 0.1)');
            } else {
                $('.orderresume-close').removeAttr('style');
            }
        });

        $(document).off('click', '.orderresume-close').on('click', '.orderresume-close', function () {
            $('.orderresume-wrapper').removeAttr('style');
            $('#wizard-order-resume').removeAttr('style');
            $('.orderresume-wrapper').hide();
            $('#wizard-order-resume').hide();
        });
    }

    getOrderResume(path) {
        if (path) {
            GlobalData.getData(
                { path: path }
            ).subscribe(
                (data) => {
                    this.fillData(data[0]);
                }
            );
        }
    }

    addDecosNoCost(value) {
        const obj = resumeObject.decosNoCost;
        const decos = [];

        let resumeText = 'Decodificadores incluidos sin costo adicional: ';

        obj[value.node] === undefined ? obj[value.node] = { "name": value.name, "cant": 1 } : obj[value.node].cant++;

        for (const key in obj) {
            if (Object.prototype.hasOwnProperty.call(obj, key)) {
                decos.push(obj.hasOwnProperty(key) && `\x20(${obj[key].cant})\x20${obj[key].name}`);
            }
        }
        resumeText += decos.join(',');
        resumeObject.resume['nocost'] =
            {
                'value': resumeText,
                'order': 1
            };
    }

    addDecoUpgrade(original, upgrade) {
        resumeObject.resume[`up${original.node}${upgrade.node}`] =
            {
                'value': `Mejora de decodificador ${original.name} a ${upgrade.name} por $${upgrade.price}`,
                'order': 2
            };
    }

    addDecosCost(value) {
        const obj = resumeObject.decosCost;
        const decos = [];
        let resumeText = 'Decodificadores con costo adicional: ';

        obj[value.node] === undefined ? obj[value.node] = { "name": value.name, "cant": 1 } : obj[value.node].cant++;

        for (const key in obj) {
            if (Object.prototype.hasOwnProperty.call(obj, key)) {
                decos.push(obj.hasOwnProperty(key) && ` (${obj[key].cant}) ${obj[key].name}`);
            }
        }
        resumeText += decos.join(',');

        resumeObject.resume['cost'] =
            {
                'value': resumeText,
                'order': 3
            };
    }

    addNexus(value) {
        resumeObject.resume['nexus'] =
            {
                'value': `Tecnologa Nexus por ${value}`,
                'order': 4
            };
    }

    addPremiumPackage(value) {
        resumeObject.resume[`pack${value.node}`] =
            {
                'value': `Paquete Premium ${value.name} por ${value.price}`,
                'order': 5
            };
    }

    removeNexus() {
        delete resumeObject.resume['nexus'];
    }

    fillOrderResume(OrderResumeInfo) {
        const orderResume = $('#' + this.id);

        orderResume.find('.orderresume-title').html(OrderResumeInfo.title);
    }

    removeItems() {
        resumeObject = {
            decosNoCost: {},
            decosCost: {},
            resume: {}
        };
    }

    refreshItems() {
        const objResume = resumeObject.resume;
        const sortedData = [];

        for (let i = 1; i < 6; i++) {
            for (const key in objResume) {
                if (objResume[key].order == i) {
                    sortedData.push(objResume[key]);
                }
            }
        }

        $('#' + this.id).find('.orderresume-body').find('ul').find('li:not(.orderresume-footer)').remove();
        for (const key in sortedData) {
            if (Object.prototype.hasOwnProperty.call(sortedData, key)) {
                $('#' + this.id).find('.orderresume-body').find('.orderresume-footer').before(
                    $('<li>').append(`
                <div class="orderresume-checkmark"></div>
                <div class="orderresume-label">${sortedData[key].value}</div>
            `)
                );
            }
        }
    }
}

const orderresumecomponents = $('.orderresume-wrapper');
orderresumecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const path = component.data('path');
    GeneralComponentContainer.setComponent(new OrderResumeComponent(path, id), id);
});
const OffersPdpHeroV2 = (function () {
    const defaults = {
        "selectors": {
            "phone": ".oph2-phone-text",
            "phoneLink": ".oph2-phone",
            "oph2Cont": ".oph2_container",
            "chatLink": ".oph2-chat",
            "header": "header",
            "offerLine": ".offer_line_pdp_hero",
            "spacer": ".offer_line_spacer"
        },
        "classes": {
            "voidCalling": "void_calling",
            "sticky": "sticky_phone"
        },
        "events": {
            "click": "click",
            "scroll": "scroll",
            "resize": "resize"
        },
        "endPoints": {
            "allMedia": "/bin/public-sites/mock/allmedia"
        }
    };

    return class {
        constructor(options) {
            this.id = options.id;
            this.component = document.getElementById(this.id);
            this.phoneState = options.phoneState;
            this.phoneSticky = options.phoneSticky;
            this.country = options.country;
            this.language = options.language;
            this.bgImages = options.images;
            this.chaturl = options.chaturl ? options.chaturl : '/prev-chat.html';
            this.elements = {
                "phone": document.querySelector(defaults.selectors.phone),
                "phoneLink": document.querySelector(defaults.selectors.phoneLink),
                "spacer": document.querySelector(defaults.selectors.spacer),
                "offerLine": document.querySelector(defaults.selectors.offerLine),
                "chatLink": document.querySelector(defaults.selectors.chatLink),
                "oph2Cont": document.querySelector(defaults.selectors.oph2Cont),
            };
            this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector(defaults.selectors.header).getAttribute("id"));
            this.helpers = new HeaderHelpers();
            this.isMobile = this.helpers.isMobile();
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initEventListeners() {
            this.elements.phone.addEventListener(defaults.events.click, (evt) => {
                if (this.elements.phone.classList.contains(defaults.classes.voidCalling)) {
                    evt.preventDefault();
                }
            });

            window.addEventListener(defaults.events.resize, (evt) => {
                this.onResize();
            });

            document.addEventListener(defaults.events.scroll, (evt) => {
                this.onScroll();
            });
        }

        onScroll() {
            if (
                this.isMobile &&
                this.phoneSticky &&
                window.innerWidth < 768) {
                const st = window.pageYOffset || document.documentElement.scrollTop;
                const phoneHeight = this.elements.phone.offsetHeight;

                if (this.elements.phoneLink.offsetTop - st <= 8) {
                    this.elements.phoneLink.classList.add(defaults.classes.sticky);
                    
                    if(this.elements.oph2Cont){
                        this.elements.oph2Cont.classList.add('fix-overflow');
                    }

                    this.elements.phoneLink.style.height = `${phoneHeight}px`;
                    this.elements.chatLink.style.marginLeft = 'auto';
                    this.elements.chatLink.style.marginRight = 'auto';
                } else {
                    this.removeStickyExperience();
                }
            } else if (this.elements.phone.classList.contains(defaults.classes.sticky)) {
                this.removeStickyExperience();
            }
        }

        onResize() {
            if (this.elements.offerLine) {
                const offerLineHeight = this.elements.offerLine.offsetHeight;
                this.elements.spacer.style.height = `${offerLineHeight / 2 + 16}px`;
            }
        }

        removeStickyExperience() {
            this.elements.phoneLink.classList.remove(defaults.classes.sticky);

            if(this.elements.oph2Cont){
                this.elements.oph2Cont.classList.remove('fix-overflow');
            }

            this.elements.phoneLink.removeAttribute('style');
            this.elements.chatLink.removeAttribute('style');
        }

        async getPhone() {
            this.headerComponent.eventEmitter.subscribe((action) => {
                action.event == 'phoneUpdated' && this.renderPhone(window.localStorage.getItem('defaultPhone'));
            });
        }

        renderPhone(thePhone) {
            this.elements.phoneLink.setAttribute('href', `tel: ${thePhone}`);
            const phone = this.elements.phone.childNodes;

            phone[phone.length - 1].nodeValue = thePhone;
            this.initEventListeners();
        }

        renderChat(event) {
            event.preventDefault();
            const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
            let chatpath = this.chaturl + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
            window.open(chatpath, "Chat", "width=450,height=450");
        }

        initComponent() {
            this.elements.chatLink.onclick = this.renderChat.bind(this);
            this.getPhone();
            this.onResize();

            this.setBackgroundImage();
            this.setResizedBackgroundImage();
        }

        setResizedBackgroundImage() {
            $(window).resize(() => {
                this.setBackgroundImage();
            });
        }
        setBackgroundImage() {
            const width = $(window).width();

            if (width < 769) {
                $(this.component).find('.bg_image').css('background-image', 'url(' + this.bgImages.mobile + ')')
            } else {
                $(this.component).find('.bg_image').css('background-image', 'url(' + this.bgImages.desktop + ')')
            }
        }
    };
})();

const offerpdpcomponents = $('.oph2');
offerpdpcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const country =  component.data('country');
    const language =component.data('language');
    const phoneState = component.data('phonestate');
    const phoneSticky = component.data('phonestickymob') === "yes";
    const mode = component.data('mode');
    const chaturl = component.data('chaturl');
    const images = {
        desktop: component.data('desktop'),
        mobile: component.data('mobile')
    }
    GeneralComponentContainer.setComponent(new OffersPdpHeroV2({ id, mode, phoneState, phoneSticky, country, language, images, chaturl }), id);
});
const OffersPdpHero = (function () {
    const defaults = {
        "selectors": {
            "phone": ".oph_phone_anchor .phone-text .phone",
            "phoneLink": ".oph_phone_anchor",
            "ophCont": ".oph_container",
            "phoneContainer": ".oph_phones--phone",
            "header": "header",
            "offerLine": ".offer_line_pdp_hero",
            "spacer": ".offer_line_spacer"
        },
        "classes": {
            "voidCalling": "void_calling",
            "sticky": "sticky_phone"
        },
        "events": {
            "click": "click",
            "scroll": "scroll",
            "resize": "resize"
        },
        "endPoints": {
            "allMedia": "/bin/public-sites/mock/allmedia"
        }
    };

    return class {
        constructor(options) {
            this.id = options.id;
            this.component = document.getElementById(this.id);
            this.phoneState = options.phoneState;
            this.country = options.country;
            this.language = options.language;
            this.showPhone = options.showPhone;
            this.phoneSticky = options.phoneSticky;
            this.bgImages = options.images
            this.elements = {
                "phoneContainer": document.querySelector(defaults.selectors.phoneContainer),
                "phone": document.querySelector(defaults.selectors.phone),
                "phoneLink": document.querySelector(defaults.selectors.phoneLink),
                "spacer": document.querySelector(defaults.selectors.spacer),
                "offerLine": document.querySelector(defaults.selectors.offerLine),
                "ophCont": document.querySelector(defaults.selectors.ophCont)
            };
            this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector(defaults.selectors.header).getAttribute("id"));
            this.helpers = new HeaderHelpers();
            this.isMobile = this.helpers.isMobile();
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initEventListeners() {
            this.elements.phone.addEventListener(defaults.events.click, (evt) => {
                if (this.elements.phone.classList.contains(defaults.classes.voidCalling)) {
                    evt.preventDefault();
                }
            });

            document.addEventListener(defaults.events.scroll, (evt) => {
                this.onScroll();
            });

            window.addEventListener(defaults.events.resize, (evt) => {
                this.onResize();
            });
        }

        onScroll() {
            if (
                this.isMobile &&
                this.phoneSticky &&
                window.innerWidth < 768) {
                const st = window.pageYOffset || document.documentElement.scrollTop;
                const phoneHeight = this.elements.phone.offsetHeight;

                if (this.elements.phoneContainer.offsetTop - st <= 8) {
                    this.elements.phoneLink.classList.add(defaults.classes.sticky);
                    if(this.elements.ophCont){
                        this.elements.ophCont.classList.add('fix-overflow');
                    }                    
                    this.elements.phoneContainer.style.height = `${phoneHeight}px`;
                } else {
                    this.removeStickyExperience();
                }
            } else if (this.elements.phone.classList.contains(defaults.classes.sticky)) {
                this.removeStickyExperience();
            }
        }

        onResize() {
            if (this.elements.offerLine) {
                const offerLineHeight = this.elements.offerLine.offsetHeight;
                this.elements.spacer.style.height = `${offerLineHeight / 2 + 16}px`;
            }
        }

        removeStickyExperience() {
            this.elements.phone.classList.remove(defaults.classes.sticky);

            if(this.elements.ophCont){
                this.elements.ophCont.classList.remove('fix-overflow');
            }

            this.elements.phoneContainer.removeAttribute('style');
        }

        async getPhone() {
            this.headerComponent.eventEmitter.subscribe((action) => {
                action.event == 'phoneUpdated' && this.renderPhone(window.localStorage.getItem('defaultPhone'));
            });
        }

        renderPhone(thePhone) {
            this.elements.phoneLink.setAttribute('href', `tel: ${thePhone}`);
            const phone = this.elements.phone.childNodes;

            phone[phone.length - 1].nodeValue = thePhone;
            this.initEventListeners();
        }

        initComponent() {
            this.showPhone && this.getPhone();
            this.onResize();

            this.setBackgroundImage();
            this.setResizedBackgroundImage();
        }

        setResizedBackgroundImage() {
            $(window).resize(() => {
                this.setBackgroundImage();
            });
        }
        setBackgroundImage() {
            const width = $(window).width();

            if (width < 769) {
                $(this.component).find('.bg_image').css('background-image', 'url(' + this.bgImages.mobile + ')')
            } else {
                $(this.component).find('.bg_image').css('background-image', 'url(' + this.bgImages.desktop + ')')
            }
        }
    };
})();

const oph2components = $('.oph');
oph2components.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const country =  component.data('country');
    const language =component.data('language');
    const showPhone = component.data('showphone') === "yes";
    const phoneSticky = component.data('phonesticky') === "yes";
    const phoneState = component.data('phonestate');
    const mode = component.data('mode');
    const images = {
        desktop: component.data('desktop'),
        mobile: component.data('mobile')
    }
    GeneralComponentContainer.setComponent(new OffersPdpHero({ id, mode, phoneState, country, language, showPhone, phoneSticky, images }), id);
});
$('.offer-card-offer').on('click', function() {
    console.log(this.dataset.href);
    if (this.dataset.href.indexOf('prev-chat') > -1) {
        const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
        const chat_url = this.dataset.href + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
        window.open(chat_url, "Chat", "width=450,height=450");
    } else {
        window.open(this.dataset.href);
    }
});
;(function(factory) {
  'use strict';

  if (typeof define === 'function' && define.amd) {
    define(['jquery'], factory);
  } else {
    factory(jQuery);
  }
})(function($){
  'use strict';

  var instances = [],
      matchers  = [],
      defaultOptions  = {
        precision: 100,
        elapse: false,
        defer: false
      };
  matchers.push(/^[0-9]*$/.source);
  matchers.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/
    .source);

  matchers.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/
    .source);
    
  matchers = new RegExp(matchers.join('|'));
  
  function parseDateString(dateString) {
      
    if(dateString instanceof Date) {
      return dateString;
    }
    
    if(String(dateString).match(matchers)) {
        
      if(String(dateString).match(/^[0-9]*$/)) {
        dateString = Number(dateString);
      }
      
      if(String(dateString).match(/\-/)) {
        dateString = String(dateString).replace(/\-/g, '/');
      }
      return new Date(dateString);
    } else {
      throw new Error('Couldn\'t cast `' + dateString +
        '` to a date object.');
    }
  }
  
  var DIRECTIVE_KEY_MAP = {
    'Y': 'years',
    'm': 'months',
    'n': 'daysToMonth',
    'd': 'daysToWeek',
    'w': 'weeks',
    'W': 'weeksToMonth',
    'H': 'hours',
    'M': 'minutes',
    'S': 'seconds',
    'D': 'totalDays',
    'I': 'totalHours',
    'N': 'totalMinutes',
    'T': 'totalSeconds'
  };
  
  function escapedRegExp(str) {
    var sanitize = str.toString().replace(/([.?*+^$[\]\\(){}|-])/g, '\\$1');
    return new RegExp(sanitize);
  }
  
  function strftime(offsetObject) {
    return function(format) {
      var directives = format.match(/%(-|!)?[A-Z]{1}(:[^;]+;)?/gi);
      if(directives) {
        for(var i = 0, len = directives.length; i < len; ++i) {
          var directive   = directives[i]
              .match(/%(-|!)?([a-zA-Z]{1})(:[^;]+;)?/),
            regexp    = escapedRegExp(directive[0]),
            modifier  = directive[1] || '',
            plural    = directive[3] || '',
            value     = null;
            
            directive = directive[2];
            
          if(DIRECTIVE_KEY_MAP.hasOwnProperty(directive)) {
            value = DIRECTIVE_KEY_MAP[directive];
            value = Number(offsetObject[value]);
          }
          if(value !== null) {
              
            if(modifier === '!') {
              value = pluralize(plural, value);
            }
            
            if(modifier === '') {
              if(value < 10) {
                value = '0' + value.toString();
              }
            }
            
            format = format.replace(regexp, value.toString());
          }
        }
      }
      format = format.replace(/%%/, '%');
      return format;
    };
  }
  
  function pluralize(format, count) {
    var plural = 's', singular = '';
    if(format) {
      format = format.replace(/(:|;|\s)/gi, '').split(/\,/);
      if(format.length === 1) {
        plural = format[0];
      } else {
        singular = format[0];
        plural = format[1];
      }
    }
    
    if(Math.abs(count) > 1) {
      return plural;
    } else {
      return singular;
    }
  }
  
  var Countdown = function(el, finalDate, options) {
    this.el       = el;
    this.$el      = $(el);
    this.interval = null;
    this.offset   = {};
    this.options  = $.extend({}, defaultOptions);
    
    this.firstTick = true;
    
    this.instanceNumber = instances.length;
    instances.push(this);
    
    this.$el.data('countdown-instance', this.instanceNumber);
    
    if (options) {
        
      if(typeof options === 'function') {
        this.$el.on('update.countdown', options);
        this.$el.on('stoped.countdown', options);
        this.$el.on('finish.countdown', options);
      } else {
        this.options = $.extend({}, defaultOptions, options);
      }
    }
    
    this.setFinalDate(finalDate);
    
    if (this.options.defer === false) {
      this.start();
    }
  };
  $.extend(Countdown.prototype, {
    start: function() {
      if(this.interval !== null) {
        clearInterval(this.interval);
      }
      var self = this;
      this.update();
      this.interval = setInterval(function() {
        self.update.call(self);
      }, this.options.precision);
    },
    stop: function() {
      clearInterval(this.interval);
      this.interval = null;
      this.dispatchEvent('stoped');
    },
    toggle: function() {
      if (this.interval) {
        this.stop();
      } else {
        this.start();
      }
    },
    pause: function() {
      this.stop();
    },
    resume: function() {
      this.start();
    },
    remove: function() {
      this.stop.call(this);
      instances[this.instanceNumber] = null;
      
      delete this.$el.data().countdownInstance;
    },
    setFinalDate: function(value) {
      this.finalDate = parseDateString(value);
    },
    update: function() {
      if(this.$el.closest('html').length === 0) {
        this.remove();
        return;
      }
      var now = new Date(),
          newTotalSecsLeft;
          
      newTotalSecsLeft = this.finalDate.getTime() - now.getTime();
      
      newTotalSecsLeft = Math.ceil(newTotalSecsLeft / 1000);
      
      newTotalSecsLeft = !this.options.elapse && newTotalSecsLeft < 0 ? 0 :
        Math.abs(newTotalSecsLeft);
        
      if (this.totalSecsLeft === newTotalSecsLeft || this.firstTick) {
        this.firstTick = false;
        return;
      } else {
        this.totalSecsLeft = newTotalSecsLeft;
      }
      
      this.elapsed = (now >= this.finalDate);
      
      this.offset = {
        seconds     : this.totalSecsLeft % 60,
        minutes     : Math.floor(this.totalSecsLeft / 60) % 60,
        hours       : Math.floor(this.totalSecsLeft / 60 / 60) % 24,
        days        : Math.floor(this.totalSecsLeft / 60 / 60 / 24) % 7,
        daysToWeek  : Math.floor(this.totalSecsLeft / 60 / 60 / 24) % 7,
        daysToMonth : Math.floor(this.totalSecsLeft / 60 / 60 / 24 % 30.4368),
        weeks       : Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 7),
        weeksToMonth: Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 7) % 4,
        months      : Math.floor(this.totalSecsLeft / 60 / 60 / 24 / 30.4368),
        years       : Math.abs(this.finalDate.getFullYear()-now.getFullYear()),
        totalDays   : Math.floor(this.totalSecsLeft / 60 / 60 / 24),
        totalHours  : Math.floor(this.totalSecsLeft / 60 / 60),
        totalMinutes: Math.floor(this.totalSecsLeft / 60),
        totalSeconds: this.totalSecsLeft
      };
      
      if(!this.options.elapse && this.totalSecsLeft === 0) {
        this.stop();
        this.dispatchEvent('finish');
      } else {
        this.dispatchEvent('update');
      }
    },
    dispatchEvent: function(eventName) {
      var event = $.Event(eventName + '.countdown');
      event.finalDate     = this.finalDate;
      event.elapsed       = this.elapsed;
      event.offset        = $.extend({}, this.offset);
      event.strftime      = strftime(this.offset);
      this.$el.trigger(event);
    }
  });
  
  $.fn.countdown = function() {
    var argumentsArray = Array.prototype.slice.call(arguments, 0);
    return this.each(function() {
        
      var instanceNumber = $(this).data('countdown-instance');
      
      if (instanceNumber !== undefined) {
        var instance = instances[instanceNumber],
          method = argumentsArray[0];
          
        if(Countdown.prototype.hasOwnProperty(method)) {
          instance[method].apply(instance, argumentsArray.slice(1));
          
        } else if(String(method).match(/^[$A-Z_][0-9A-Z_$]*$/i) === null) {
          instance.setFinalDate.call(instance, method);
          
          instance.start();
        } else {
          $.error('Method %s does not exist on jQuery.countdown'
            .replace(/\%s/gi, method));
        }
      } else {
        new Countdown(this, argumentsArray[0], argumentsArray[1]);
      }
    });
  };
});
OfferTimerComponent = (function () {
    const defaults = {
        "selectors": {
            "day": ".counter-item-value.day",
            "hrs" : ".counter-item-value.hrs",
            "min": ".counter-item-value.min",
            "sec" : ".counter-item-value.sec",
        }
    };

    return class {
        constructor(id, date) {
            this.id = id;
            this.date = date;
            this.component = $('#' + this.id);

            this.initComponent();
        }

        initComponent() {
            this.$day = this.component.find(defaults.selectors.day);
            this.$hour = this.component.find(defaults.selectors.hrs);
            this.$minute = this.component.find(defaults.selectors.min);
            this.$second = this.component.find(defaults.selectors.sec);

            this.countdown();
        }

        countdown() {
            this.component.countdown(this.date, (e) => {
                this.$day.text(e.strftime('%D'));
                this.$hour.text(e.strftime('%H'));
                this.$minute.text(e.strftime('%M'));
                this.$second.text(e.strftime('%S'));
            });
        }
    };
})();

const offertimercomponents = $('.offer-timer-wrapper');
offertimercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const date = component.data('date');
    GeneralComponentContainer.setComponent(new OfferTimerComponent(id, date), id);
});
const OfferCardsFilterComponent =(function() {
    const defaults = {
        "selectors": {
            "btnFilter": ".btn-filter",
            "prepaidClient": ".btn-prepaid-client",
            "postClient": ".btn-postpaid-client",
            "nonClient": ".btn-non-client"
        },
        "events": {
            "click": "click"
        }
    };

    //Agrego active al btn seleccionado
    /*$('.btn-filter-internet:first').addClass('active');
    $( ".btn-filter-internet" ).on( "click", function() {
        $('.btn-filter-internet').removeClass('active');
        console.log($(this));
        $(this).addClass("active");
    });*/
    
    return class {
        constructor(element, path) {
            this.path = path;
            this.element = element;
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initComponent() {
            this.btnFilter = $(defaults.selectors.btnFilter, this.element);
            this.radioButtons = [];
            $(defaults.selectors.btnFilter).each((index, button) => {
                const $button = $(button);

                this.radioButtons.push(
                    {
                        type: $button.data('type'),
                        button: $button
                    }
                );
            });
            this.bindEvents();
        }

        bindEvents() {
            this.btnFilter.on(defaults.events.click, (buttonEvent)=> {
                this.setFilter($(buttonEvent.currentTarget).data('type'));
            });
        }

        setFilter(filtertype) {
            const button = this.radioButtons.find((button) => {
                return button.type === filtertype;
            });

            this.radioButtons.forEach((radiobutton) => {
                if (radiobutton === button) {
                    radiobutton.button.addClass('active');
                } else {
                    radiobutton.button.removeClass('active');
                }
            });
            this.executeFilter(filtertype);
        }

        setButtonText(filterType, text) {
            const btnFilter = this.radioButtons.find((button) => {
                return button.type === filterType;
            });

            if (btnFilter.button.text() === "") {
                btnFilter.button.text(text);
            }
        }

        executeFilter(filterType) {
            this.eventEmitter.next({
                event: 'offer-cards-filter',
                data: filterType
            });
        }
    };
})();

const offercardsfiltercomponents = $('.offer-cards-filter-container');
offercardsfiltercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new OfferCardsFilterComponent($('#' + id)), id);
});
NewsAccordionComponent = (function () {
    const defaults = {
        "selectors": {
            'actionBtn': "> .title-container",
            'layout': "> .layout-cont-hide",
            'icon': '.icon',
            'isOpen': '.is-open',
            'isClose': '.is-close',
            'base': '.newsAccordion',
            'queryKey': 'new'
        },
        'slideConfig': {
            duration: 200
        }
    };

    return class {
        constructor(id, queryString) {
            this.id = id;
            this.component = $('#' + this.id);
            const actionBtn = this.component.find(defaults.selectors.actionBtn);
            const layout = this.component.find(defaults.selectors.layout);
            const params = new URLSearchParams(location.search);
            const anotherAccordions = this.component.closest('.news-accordion').siblings('.news-accordion').find('> .newsAccordion');

            if (queryString == params.get(defaults.selectors.queryKey)) {
                this.openNewsAcc(anotherAccordions, layout, actionBtn);
            }

            actionBtn.on('click',
                (event) => {
                    event.stopPropagation();
                    this.openNewsAcc(anotherAccordions, layout, actionBtn)

                    if (actionBtn) {
                        if (actionBtn.find(defaults.selectors.icon).hasClass('rotate')) {
                            params.set(defaults.selectors.queryKey, queryString);
                            window.history.replaceState({}, '', `${location.pathname}?${params}`);
                        } else {
                            params.delete(defaults.selectors.queryKey);
                            window.history.replaceState({}, '', `${location.pathname}?${params}`);
                        }
                    }
                }
            );
        }

        openNewsAcc(anotherAccordions, layout, actionBtn) {
            anotherAccordions.find(defaults.selectors.layout).slideUp();
            const anotherActionButtons = anotherAccordions.find(defaults.selectors.actionBtn);

            anotherActionButtons.find(defaults.selectors.icon).removeClass('rotate');
            anotherActionButtons.find(defaults.selectors.isOpen).hide();
            anotherActionButtons.find(defaults.selectors.isClose).show();

            layout.slideToggle();

            actionBtn.find(defaults.selectors.icon).toggleClass('rotate');
            actionBtn.find(defaults.selectors.isOpen).toggle();
            actionBtn.find(defaults.selectors.isClose).toggle();
        }
    };
})();

const newsaccordeoncomponents = $('.newsAccordion');
newsaccordeoncomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const query = component.data('query');
    GeneralComponentContainer.setComponent(new NewsAccordionComponent(id,query), id);
});
var calculator_cost_per_day;
var calculator_total_days;
var calculator_daily_cost_plan;
var calculator_recharge_cost;
var calculator_oneshot_plan;
var calculator_oneshot;
var calculator_basedecimal;
var calculator_recharge_max;
var calculator_balance;
var calculator_planType;
var calculator_resultDays;
var calculator_rechDays;
var baseResponsePlans;
var baseResponsePremium;
var dinamic_planType;
var storedPacks;
var storedDefault;
var storedESbPacks;
var offerPlans;
var fullPricePacks;
var offerPricePacks;
var base_cost_per_day;
var full_cost_per_day;
var planOfferActive;
var userActivePlan;
var userActivePack;
var vartodoslosobjetos;
var getAllPackages;
var orderArray = [];
var arrayOfAmounts = [];
var amountToRecharge = 0;
var initDays = 0;
var montoIngresado = 0;
var diasIngresados = 0;
var calculator_osDays;

function newCalculator() {
    this.tabsMenu = document.querySelectorAll('.tab-menu ul li');
    this.calcInput = document.querySelectorAll('.calculator-content input');
    this.calcZone = document.getElementById('smart-card-plans');
    this.planselected = document.getElementById('cal-plan-selected');
    this.premium_packs = document.getElementById('cal-premium-packs');
    this.sd_channels = document.getElementById('cal-sd-channels');
    this.hd_channels = document.getElementById('cal-hd-channels');
    this.cal_fulldate = document.getElementById('calculator-fulldate');
    this.loaderesb = document.getElementById('spinner-cal');
    this.scBasePlan = document.getElementById('smart-card-plans');
    this.scForm = document.getElementById('smart-card-form');
    this.screenshot = document.querySelector('.calculator-overlay-resume .wrapper');
    this.canvasImg = document.querySelector('.image-canvas-container');
    this.scSaveBtn = document.querySelector(".save-btn");
    this.scPlans = document.querySelector('.plans-container-cards');
    this.tabPlansCta = document.querySelector('.tab-menu ul li:nth-child(1)');
    this.tabAddCta = document.querySelector('.tab-menu ul li:nth-child(2)');
    this.tabCalCta = document.querySelector('.tab-menu ul li:nth-child(3)');
    this.scAdd = document.querySelector('.plans-container-aditionals');
    this.scCal = document.querySelector('.plans-container-calculator');
    this.scAddIntro = document.querySelector('.sc-add-intro');
    this.scPlanIntro = document.querySelector('.sc-plan-intro');
    this.scCalIntro = document.querySelector('.sc-cal-intro');
    this.scCurrentPlan = document.querySelector('#smart-card-plans .current-plan');
    this.scCostPerDay = document.querySelector('#smart-card-plans .cost_per_day');
    this.scPremiumPlan = document.querySelector('.calc-heading-top .premium-list');
    this.scPlansInfo = document.querySelector('.calculator-overlay');
    this.scResumeCal = document.querySelector('.calculator-overlay-resume');
    this.sctaDowload = document.querySelector('.calculator-overlay-resume .cta-download');
    this.sctaShare = document.querySelector('.calculator-overlay-resume .go-share');
    this.scScreenShot = document.querySelector('.calculator-overlay-resume .innerW');
    this.scSaveCalculo = document.querySelector('.plans-container-calculator .save-btn');
    this.clientDeudaSup = document.querySelector('.client-deuda');
    this.clientDeudaP = document.querySelector('.client-deuda-p');
    this.clientDeuda = document.querySelector('.client-deuda span');
    this.one_shot_val = document.querySelector('.one-shop-value-2');
    this.ctaRecharge = document.querySelector('.cta-group .go-recharge');
    this.scInputDays = document.querySelector(".calculator-days");
    this.scInputValue = document.querySelector(".calculator-value");
    this.scDaysError = document.querySelector(".days-error");
    this.scCalError = document.querySelector(".cal-error"),
    this.viewportMobile = window.matchMedia("(max-width: 768px)").matches;
    this.packCost = "";
    this.fullPackCost = "";
    this.oneshotCost = "";
    this.premiumData = "";
    this.defaultData = "";
    this.userOnData = "";
    this.planSel = "";
    this.planList = [];
    this.defaultList = [];
    this.defEsbPacks = [];
    this.premiumList = [];
    this.oneshotList = [];
    this.basePremData = [];
    this.allplans = [];
    this.allPacks = [];
    this.buttonContinuePlan = document.querySelector(".button-cotinue");
    this.buttonContratarPlan = document.querySelector(".button-contratarPlan");
    this.buttonContinuePremium = document.querySelector(".button-cotinuePaquete")
    this.buttonContratarPremium = document.querySelector(".button-contratarPaquete");
    this.buttonsPlans = document.querySelector(".buttons-cotinue-plan");
    this.buttonsPremium = document.querySelector(".buttons-cotinue-paquetes");
}

newCalculator.prototype.setAppend = function(elm, att) {
    for (var key in att) {
        elm.appendChild(att[key]);
    }
};

newCalculator.prototype.clearAppend = function(elm) {
    while (elm.firstChild) {
            elm.removeChild(elm.lastChild);
    }
};

newCalculator.prototype.handleClick = function(target, elements, grid = false) {
    elements.forEach(element => {
        element.style.display = 'none';
        element.classList.remove('sc-fadein');
    });
    !grid ? target.style.display = 'block' : target.style.display = 'grid';
    target.classList.add('sc-fadein');
};

newCalculator.prototype.setNumber = function(number) {
    let cost = Number(number.replace('$', ''));
    return cost;
};

newCalculator.prototype.makeDecimal = function(Number) {
    Number = Number + ""
    Number = Number.split('').reverse().join('');
    var Result = "";
    for (i = 0; i <= Number.length; i += 3) {
        Result = Result + Number.substring(i, i + 3) + ".";
    }
    Result = Result.split('').reverse().join('');
    if (!isFinite(Result.substring(0, 1))) Result = Result.substring(1, Result.length);
    if (!isFinite(Result.substring(0, 1))) Result = Result.substring(1, Result.length);
    return Result;

};

newCalculator.prototype.filterPlan = function(data, param) {
    return data.filter(data => data.name === param);
};

newCalculator.prototype.popUpBehavior = function(element, target = false) {
    var closecta;
    if (this.viewportMobile) { this.screenshot.scroll(0, 0); }
    window.scrollTo(0, 0);

    if (!target) {
        closecta = document.querySelectorAll('.close-button-overlay');
        element.style.display = 'block';
        closecta.forEach(elem => elem.onclick = () => element.style.display = 'none');
    } else {
        element.style.display = 'flex';
        closecta = element.querySelectorAll('.close-button-overlay');
        closecta.forEach(elem => elem.onclick = () => {
            element.style.display = 'none';
            this.calcZone.style.display = 'block';
            if (this.viewportMobile) {
                window.scroll(0, 0);
            }
            window.scrollTo(0, 0);
        });
    }

};

newCalculator.prototype.setLinkTabs = function(element) {
    this.tabsMenu.forEach(link => link.classList.remove('active'));
    element.classList.add('active');
};

newCalculator.prototype.selectedPlan = function(element, setting = false) {
    setting ? element.classList.add('selected') : element.classList.remove('selected');
};

newCalculator.prototype.fillPremiumPacks = function(e) {
    this.planList = JSON.parse(sessionStorage.getItem('premiumChanels'));

    if (e.target.checked) {
        this.planList.push(e.target.value);
    } else {
        for (var i = 0; i < this.planList.length; i++) {
            (this.planList[i] === e.target.value) && this.planList.splice(i, 1);
        }
    }
    sessionStorage.setItem('premiumChanels', JSON.stringify(this.planList));
    storedPacks = this.planList;
    return this.planList;
};

newCalculator.prototype.sumCostPremium = function(e, cost, array, storage) {
    array = JSON.parse(sessionStorage.getItem(`${storage}`));

    if (e.target.checked) {
        array.push(cost);
    } else {
        for (var i = 0; i < array.length; i++) {
            (array[i] === cost) && array.splice(i, 1);
        }
    }
    sessionStorage.setItem(`${storage}`, JSON.stringify(array));
    const operation = (total, num) => total + num;

    return parseFloat(array.reduce(operation, 0).toFixed(2));
};

newCalculator.prototype.getDecimal = function(planCost, premiumCost) {
    let numero = parseFloat(planCost + premiumCost);
    let base = Math.pow(10, 2);
    let entero = Math.round(numero * base);
    return entero / base;
};

newCalculator.prototype.showDetailPlan = function(contexto, data, selector) {
    let param = contexto.title;
    let selectedPlan = this.filterPlan(data, param);
    this.clearAppend(selector);
    selector.insertAdjacentHTML('afterbegin', this.detailTemplate(selectedPlan[0]));
    this.popUpBehavior(selector);
};

newCalculator.prototype.resetPlans = function() {
    sessionStorage.setItem('premiumChanels', JSON.stringify([]));
    sessionStorage.setItem('cost_per_day', JSON.stringify([]));
    sessionStorage.setItem('baseCostPerDay', JSON.stringify([]));
    sessionStorage.setItem('oneshot', JSON.stringify([]));
    sessionStorage.setItem('defaultPlans', JSON.stringify([]));
};

newCalculator.prototype.toFixedNumber = function(numero) {
    let parseValue = parseFloat(numero);
    let validate = parseValue - Math.floor(parseValue) == 0;
    if (validate) {
        return parseValue;
    } else {
        return parseValue.toFixed(2);
    }
};

newCalculator.prototype.addSeparatorsNF = function(nStr, inD, outD, sep) {
    nStr += '';
    var dpos = nStr.indexOf(inD);
    var nStrEnd = '';
    if (dpos != -1) {
        nStrEnd = outD + nStr.substring(dpos + 1, nStr.length);
        nStr = nStr.substring(0, dpos);
    }
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(nStr)) {
        nStr = nStr.replace(rgx, '$1' + sep + '$2');
    }
    return nStr + nStrEnd;
};

newCalculator.prototype.costPerDay = function(data, template = false) {
    let parseCost = parseFloat(this.checkDueDateDC(data));
    if (template) {
        return `${parseCost !== "" ? (parseCost - Math.floor(parseCost) == 0) ? '$' + ' ' + parseCost + ' / da' : '$' + ' ' + this.addSeparatorsNF(this.checkDueDateDC(data), '.', ',', '.') + ' / da' : ''}`;
    } else {
        return `${parseCost !== "" ? (parseCost - Math.floor(parseCost) == 0) ? '<li class="bold-format">$' + parseCost + ' / da</li>' : '<li class="bold-format">$' + ' ' + this.addSeparatorsNF(this.checkDueDateDC(data), '.', ',', '.') + ' / da</li>' : ''}`;
    }
};

newCalculator.prototype.downloadImage = function(e, selector) {
    e.preventDefault(e);
    const $this = this;
    const $timeout = 2000;
    if (this.viewportMobile) { this.screenshot.scroll(0, 0); }
    window.scrollTo(0, 0);

    return new Promise((resolve, reject) => {
        selector.style.backgroundColor = '#ffffff';
        html2canvas(selector, {
            onrendered: function(canvas) {
                let sataUrl = canvas.toDataURL('image/png', 1.0);
                let today = new Date().toISOString().slice(0, 10);
                $this.iosImagePolify(sataUrl, today);
                canvas.toBlob(function(blob) {
                    setTimeout(() => {
                        (blob.size > 0) ? resolve("image saved successfully"): reject(new Error("Image was not saved!"));
                    }, $timeout);
                });
            },
            imageTimeout: $timeout,
            scrollX: 0,
            scrollY: -window.scrollY
        });
    });
};

newCalculator.prototype.iosImagePolify = function(imageURL, date) {
    var anchor;
    /*Set Image*/
    this.canvasImg.crossOrigin = "Anonymous";
    this.canvasImg.id = "getshot";
    this.canvasImg.src = imageURL;
    document.body.appendChild(this.canvasImg);
    /*Download it*/
    anchor = document.createElement("a");
    anchor.href = getshot.src;
    anchor.download = `tucalculo-${date}.png`;
    anchor.click();
    document.body.removeChild(this.canvasImg);
};

newCalculator.prototype.donwloadAndSaveImg = function(e, selector, whsText) {
    let saveImage = this.downloadImage(e, selector);
    let wspUrl = `https://api.whatsapp.com/send?text=${whsText}`;

    saveImage
        .then((result) => result && window.open(wspUrl, "_self"))
        .catch((err) => new Error(err));
};

newCalculator.prototype.cleanInputCalculo = function(items) {
    const { scInputDays, scDaysError, scInputValue, scCalError } = this;

    items.forEach(item => item.value = '');
    this.scSaveBtn.classList.remove("btn-primary");
    this.scSaveBtn.classList.add("btn-block");
    this.scSaveBtn.disabled = true;
    // Clean error Validations
    scInputDays.classList.remove("input-error");
    scDaysError.classList.add("hide");
    scInputValue.classList.remove("input-error");
    scCalError.classList.add("hide");
};

newCalculator.prototype.setCurrentDay = function() {
    var objDate = new Date();
    return ("0" + objDate.getDate()).slice(-2) + '/' + ("0" + (objDate.getMonth() + 1)).slice(-2) + '/' + objDate.getFullYear();
};

newCalculator.prototype.inputValidations = function(element, pattern, maxchar) {
    const checkMaxchar = () => (element.value.length < maxchar) ? false : true;
    const reducer = (acc, current) => acc + current;
    let regex = new RegExp(pattern);

    let validator = [
        checkMaxchar(),
        regex.test(element.value),
        (element.value.length > 0) && !element.value === false
    ];
    let result = validator.reduce(reducer, 0);

    if (result === 3) {
        return true;
    } else {
        return false;
    }
};

newCalculator.prototype.getEsbData = function(params, path) {
    let xhr = new XMLHttpRequest();
    return new Promise((resolve, reject) => {

        xhr.withCredentials = true;
        xhr.onload = function(e) {
            let result = JSON.parse(xhr.response);
            if (xhr.readyState === 4 && xhr.status === 200) {
                (!result.success) ? reject(`${result.errorType}`): resolve(result);
            } else {
                reject(`${result.errorType}`);
            }
        };

        xhr.open("POST", `${path}`);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send(params);
    });
};

/* only for mock data

newCalculator.prototype.getEsbDataFake = function(params, path) {
    let xhr = new XMLHttpRequest();
    return new Promise((resolve, reject) => {
        xhr.withCredentials = true;
        xhr.onload = function(e) {
            let result = JSON.parse(xhr.response);
            if (xhr.readyState === 4 && xhr.status === 200) {
                (!result.success) ? reject(`${result.errorType}`): resolve(result);
            } else {
                reject(`${result.errorType}`);
            }
        };
        xhr.open("GET", `${path}`);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.send();
    });
}*/


newCalculator.prototype.tabEvents = function() {
    const $this = this;
    const { tabPlansCta, tabAddCta, tabCalCta, scPlans, scAdd, scCal, scPlanIntro, scAddIntro, scCalIntro, buttonContinuePremium, buttonContratarPremium, buttonContinuePlan, buttonContratarPlan, buttonsPlans, buttonsPremium } = this;

    tabPlansCta.onclick = function() {
        $this.setLinkTabs(this);
        $this.handleClick(scPlans, [scAdd, scCal], true);
        $this.handleClick(scPlanIntro, [scAddIntro, scCalIntro]);
        if(window.matchMedia("(max-width:767px)").matches){
            buttonsPlans.style.display = "block";
         }else{
            buttonsPlans.style.display = "flex";
         }
       
        buttonsPremium.style.display = "none";
        if(document.querySelector(".twoCards")){
            document.querySelector(".twoCards").style.display = "flex";
        }
    }
    tabAddCta.onclick = function() {
        $this.setLinkTabs(this);
        $this.handleClick(scAdd, [scPlans, scCal], true);
        $this.handleClick(scAddIntro, [scPlanIntro, scCalIntro]);
        if(window.matchMedia("(max-width:767px)").matches){
            buttonsPremium.style.display = "block";
        }else{
            buttonsPremium.style.display = "flex";
        }
        buttonsPlans.style.display = "none";
    }
    tabCalCta.onclick = function() {
        $this.setLinkTabs(this);
        $this.handleClick(scCal, [scPlans, scAdd]);
        $this.handleClick(scCalIntro, [scPlanIntro, scAddIntro]);
        buttonsPremium.style.display = "none";
        buttonsPlans.style.display = "none";
    }
    buttonContinuePlan.onclick = function() {
        $this.setLinkTabs(this);
        $this.handleClick(scAdd, [scPlans, scCal], true);
        $this.handleClick(scAddIntro, [scPlanIntro, scCalIntro]);
        if(window.matchMedia("(max-width:767px)").matches){
            buttonsPremium.style.display = "block";
        }else{
            buttonsPremium.style.display = "flex";
        }
        buttonsPlans.style.display = "none";
        tabAddCta.classList.add('active')

    }
    buttonContinuePremium.onclick = function() {
        $this.setLinkTabs(this);
        $this.handleClick(scCal, [scPlans, scAdd]);
        $this.handleClick(scCalIntro, [scPlanIntro, scAddIntro]);
        buttonsPremium.style.display = "none"
        buttonsPlans.style.display = "none"
        tabCalCta.classList.add('active')
    }

};

newCalculator.prototype.fillResumeCalculo = function(data, plan) {
    let chanels = this.filterPlan(data, plan);
    // Clean    
    this.clearAppend(this.sd_channels);
    this.clearAppend(this.hd_channels);
    // Fill
    this.setAppend(this.sd_channels, { sdchannels: document.createTextNode(chanels[0].SDcount) });
    this.setAppend(this.hd_channels, { hdchannels: document.createTextNode(chanels[0].HDcount) });
};

newCalculator.prototype.changePremiumPlans = function(event, offertext) {
    let planType = event.querySelector('.hide-plantype').value;
    let premiumpacks = this.premiumPacksFilter(this.basePremData, planType);
    this.fillPremiumCards(this.scAdd, premiumpacks, offertext);
    this.getDailyCost(this.basePremData);
};

newCalculator.prototype.getDailyCost = function(data) {
    let $this = this;
    let scMobileChanel = document.querySelectorAll('.xs-premium-info a');

    const handlefncmobile = function(e) {
        e.preventDefault();
        $this.showDetailPlan(this, data, $this.scPlansInfo);
    }

    scMobileChanel.forEach(elem => elem.addEventListener("click", handlefncmobile, false));
};

newCalculator.prototype.onChangePlan = function(event, data) {
    const { scCurrentPlan, scCostPerDay, scPremiumPlan, planselected, premium_packs, calcInput } = this;

    let planSel = event.querySelector('.radio__label').textContent;
    let daily_cost = this.setNumber(event.querySelector('.hide-cost').value);
    let oneShot = this.setNumber(event.querySelector('.hide-cost-oneshot').value);
    let withcomma = this.addSeparatorsNF(this.toFixedNumber(!daily_cost ? 0 : daily_cost), '.', ',', '.');
    let perDayVal = document.createTextNode(`$${withcomma}`);
    let full_daily_cost = this.setNumber(event.querySelector('.hide-full-cost').value);

    // Clean
    this.clearAppend(scCurrentPlan);
    this.clearAppend(scCostPerDay);
    this.clearAppend(scPremiumPlan);
    this.clearAppend(planselected);
    this.clearAppend(premium_packs);
    this.selectedPlan(scCurrentPlan);

    // Set
    this.setAppend(scCurrentPlan, { name: document.createTextNode(planSel) });
    this.setAppend(planselected, { name: document.createTextNode(planSel) });
    this.setAppend(scCostPerDay, { perDayVal });

    // Set Active plans
    this.selectedPlan(scCurrentPlan, true);
    this.fillResumeCalculo(data, planSel);
    calculator_daily_cost_plan = daily_cost;
    base_cost_per_day = full_daily_cost;
    calculator_oneshot_plan = oneShot;
    calculator_oneshot = oneShot;
    this.showOneShot();

    // Clean Array premium
    this.resetPlans();
    this.cleanInputCalculo(calcInput);

    // Active last package
    this.getPreviousPackages(event);

    // Filter Plans
    sessionStorage.setItem('offerDays', '');

    if ((planOfferActive !== undefined && planOfferActive !== null)) {
        this.getPlansOffer(planSel);
    } else {
        let planSelected = this.allplans.filter(item => (item.name === planSel));
        sessionStorage.setItem('planSelected', JSON.stringify(planSelected[0]));
    }
};

newCalculator.prototype.onChangePremium = function(e, elem) {
    const { scCostPerDay, scPremiumPlan, premium_packs, calcInput, premiumList, oneshotList } = this;
    var inputValue;
    var oneshotVal;
    var finalCost;
    var fixedSum;
    var sum;
    var fullSum;
    let data = this.fillPremiumPacks(e);
    let getPrice = elem.parentElement;
    let eachPlan = document.querySelector(`input[value="${elem.value}"]`);

    // Clear Calculo
    this.clearAppend(scCostPerDay);
    this.clearAppend(scPremiumPlan);
    this.clearAppend(premium_packs);

    scPremiumPlan.insertAdjacentHTML('afterbegin', this.premiumItem(data));
    premium_packs.insertAdjacentHTML('afterbegin', this.premiumItemResume(data));

    // Save default Premium Pack
    if (eachPlan.classList.contains('isdefault')) {
        this.storeDefaultPacks(e);
    }

    inputValue = this.setNumber(getPrice.querySelector('.hide-cost').value);
    inputFullValue = this.setNumber(getPrice.querySelector('.hide-full-cost').value);
    oneshotVal = this.setNumber(getPrice.querySelector('.hide-cost-oneshot').value);
    this.packCost = this.sumCostPremium(e, inputValue, premiumList, 'cost_per_day');
    this.oneshotCost = this.sumCostPremium(e, oneshotVal, oneshotList, 'oneshot');
    this.fullPackCost = this.sumCostPremium(e, inputFullValue, premiumList, 'baseCostPerDay');

    // Calculo
    sum = this.getDecimal(calculator_daily_cost_plan, this.packCost);
    fullSum = this.getDecimal(base_cost_per_day, this.fullPackCost);
    sumOneshot = this.getDecimal(calculator_oneshot_plan, this.oneshotCost);
    calculator_oneshot = sumOneshot;
    fixedSum = this.addSeparatorsNF(this.toFixedNumber(sum), '.', ',', '.');
    finalCost = document.createTextNode(`$${fixedSum}`);

    this.setAppend(scCostPerDay, { finalCost });
    this.showOneShot();

    // Set Daily cost
    calculator_cost_per_day = this.toFixedNumber(sum);
    full_cost_per_day = this.toFixedNumber(fullSum);
    this.cleanInputCalculo(calcInput);

    // Filter Plans
    sessionStorage.setItem('offerDays', '');

    if ((planOfferActive !== undefined && planOfferActive !== null)) {
        this.getPackOffer(e, elem.value);
    }
};

newCalculator.prototype.showOneShot = function() {
    var oneShotDots;
    this.clearAppend(this.one_shot_val);
    oneShotDots = this.toFixedNumber(calculator_oneshot);
    this.setAppend(this.one_shot_val, { oneShotCost: document.createTextNode(`$${this.addSeparatorsNF(oneShotDots, '.', ',', '.')}`) });
};

newCalculator.prototype.setBalance = function(data) {
    let balance = this.toFixedNumber(data.balance);
    calculator_balance = balance;

    if (balance > 0) {
        this.clientDeuda.classList.add('removeline');
        this.clientDeudaSup.classList.remove('hide');
        this.clientDeudaP.classList.remove('hide');
        this.clearAppend(this.clientDeuda);
        this.setAppend(this.clientDeuda, { balance: document.createTextNode(this.addSeparatorsNF(balance, '.', ',', '.')) });
    } else {
        this.clearAppend(this.clientDeuda);
        this.clientDeuda.classList.remove('removeline');
        this.clientDeudaSup.classList.add('hide');
        this.clientDeudaP.classList.add('hide');
    }
};

newCalculator.prototype.checkBalance = function(recharge) {
    let oprecharge = parseFloat(recharge);
    let opcalculator_balance = parseFloat(calculator_balance);

    if (opcalculator_balance > 0) {
        return this.toFixedNumber(oprecharge + opcalculator_balance);
    } else {
        return this.toFixedNumber(oprecharge);
    }
};

newCalculator.prototype.setCalculatorResume = function(props) {
    const { scResumeCal, sctaDowload, sctaShare, cal_fulldate, scScreenShot, scSaveCalculo } = this;
    const downloadImage = (e) => this.downloadImage(e, scScreenShot);
    const downloadSave = (e) => this.donwloadAndSaveImg(e, scScreenShot, props.sharetext);
    let getFullData = document.createTextNode(this.setCurrentDay());

    sctaDowload.addEventListener('click', downloadImage);
    sctaShare.addEventListener('click', downloadSave);

    // Show pop up
    scSaveCalculo.addEventListener('click', () => {
        document.getElementById('smart-card-plans').style.display = 'none';
        this.popUpBehavior(scResumeCal, true);
    });

    /* show the current data */
    this.clearAppend(cal_fulldate);
    this.setAppend(cal_fulldate, { getFullData });

};

newCalculator.prototype.selectUserPlans = function(elements) {
    (elements.length > 0) ? elements.forEach(elem => elem.click()): true;
};

newCalculator.prototype.checkActivePlans = function(data) {
    let result = data.filter(elem => elem.activePlan === true);
    if (result.length >= 1) { return true; } else { return false; }
};

newCalculator.prototype.autofillPlans = function(data) {
    var oneshotdots;
    if (this.checkActivePlans(data) === false) {
        calculator_daily_cost_plan = parseFloat(data[0].cost_per_day);
        base_cost_per_day = parseFloat(data[0].baseCostPerDay);
        calculator_oneshot_plan = parseFloat(data[0].oneShot);
        calculator_oneshot = parseFloat(data[0].oneShot);
        oneshotdots = this.toFixedNumber(calculator_oneshot_plan);
        this.setAppend(this.one_shot_val, { initoneshot: document.createTextNode(`$${this.addSeparatorsNF(oneshotdots, '.', ',', '.')}`) });
    }
};

newCalculator.prototype.setLoaderEsb = function(checker) {
    (checker === true) ? this.loaderesb.style.display = 'flex': this.loaderesb.style.display = 'none';
};

newCalculator.prototype.checkPromises = function(context) {
    var promisesList;
    if (context) {
        promisesList = [context.responseLogin];
    } else {
        promisesList = [baseResponsePlans];
    }
    // Not Support by Safay 12.1 -> https://caniuse.com/?search=allSettled
    Promise.allSettled(promisesList).then((results) => {
        let complete = results.filter(elem => (elem.status === 'fulfilled' && elem.value !== "") && !elem.reason);
        let rejected = results.filter(elem => (elem.status === 'rejected' && (elem.reason && elem.reason !== "")));

        if (rejected.length >= 1) {
            this.setLoaderEsb(false);
        }
        if (complete.length === promisesList.length) {
            this.handleClick(this.scBasePlan, [this.scForm]);
            this.setLoaderEsb(false);
        }
    });
};

newCalculator.prototype.checkOsAttepts = function(recharge, osdays) {
    let totalos = parseInt(recharge / calculator_oneshot);
    return totalos * osdays;
};

newCalculator.prototype.numberWithDots = function(num) {
    let number = num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    return number;
};

newCalculator.prototype.enableButton = function(cta) {
    cta.classList.add('btn-primary');
    cta.removeAttribute('disabled');
};

newCalculator.prototype.disableButton = function(cta) {
    cta.classList.remove('btn-primary');
    cta.setAttribute('disabled', 'disabled');
};

newCalculator.prototype.checkOnlyNumber = function(e, flag = false) {
    const pattern = new RegExp('^[0-9]\d*$');
    let res = pattern.test(e.key);
    let allow;

    if (!flag) {
        allow = (e.key == "." || e.key == "," || e.key == "Delete" || e.key == "Backspace");
    } else {
        allow = (e.key == "Delete" || e.key == "Backspace");
    }

    if (!res) {
        if (allow) {
            return true;
        } else {
            this.stopPropagation(e);
        }
    }
};

newCalculator.prototype.stopPropagation = function(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    return false;
};

newCalculator.prototype.checkDotsComma = function(elem, recharge, maxrecharge) {
    let setMaxAmount = parseFloat(recharge) > parseFloat(maxrecharge);

    elem.value = elem.value.replace(/[^0-9,.]+/g, '');
    if (elem.value < 0) elem.value = '';

    (elem.value.replace(/[^.]/g, "").length > 1 || elem.value.replace(/[^,]/g, "").length > 1) ? elem.value = calculator_basedecimal: calculator_basedecimal = elem.value;

    (elem.value.indexOf(".") >= 0) ? elem.value = (calculator_basedecimal.substr(0, calculator_basedecimal.indexOf(".")) + calculator_basedecimal.substr(calculator_basedecimal.indexOf("."), 3)): calculator_basedecimal = elem.value;

    (elem.value.indexOf(",") >= 0) ? elem.value = (calculator_basedecimal.substr(0, calculator_basedecimal.indexOf(",")) + calculator_basedecimal.substr(calculator_basedecimal.indexOf(","), 3)): calculator_basedecimal = elem.value;

    if (setMaxAmount) {
        if (elem.value.indexOf(".") >= 0) {
            elem.value = (calculator_recharge_max.substr(0, calculator_recharge_max.indexOf(".")) + calculator_recharge_max.substr(calculator_recharge_max.indexOf("."), 3))
        } else if (elem.value.indexOf(",") >= 0) {
            elem.value = (calculator_recharge_max.substr(0, calculator_recharge_max.indexOf(",")) + calculator_recharge_max.substr(calculator_recharge_max.indexOf(","), 3))
        } else {
            elem.value = calculator_recharge_max;
        }
    } else {
        calculator_recharge_max = elem.value;
    }

};

newCalculator.prototype.transformRecharge = function(num) {
    let rec = 0;
    if ((num).indexOf(',') > -1) {
        rec = (parseFloat((num).replace(',', '.'))).toFixed(2);
    } else {
        rec = parseFloat(num).toFixed(2);
    }
    return rec;
};

newCalculator.prototype.premiumPacksFilter = function(data, criteria) {
    // Clear
    this.basePremData = data;
    this.premiumData = [];
    this.defaultData = [];
    this.userOnData = [];
    // Set
    this.defaultData = data.filter(item => item.packType === 'default');
    this.premiumData = data.filter(item => item.packType === criteria);
    this.userOnData = data.filter(item => item.activePackage);

    this.defaultData.forEach(element => this.premiumData.push(element));

    if (this.userOnData.length > 0) {

        this.userOnData.forEach(element => {
            let index = this.premiumData.findIndex(x => x.name == element.name);

            if (index > -1) {
                if (this.premiumData[index].activePackage) {
                    this.premiumData.splice(index, 1);
                    this.premiumData.splice(0, 0, element);
                }
            } else {
                if (element.activePackage) {
                    this.premiumData.splice(0, 0, element);
                }
            }
        });

    }
    return this.premiumData;
};

newCalculator.prototype.refreshPlanValues = function(copyoffer) {
    let planName;
    let planDom;
    let allPlans = document.querySelectorAll('.plan-card');
    allPlans.forEach(elem => {
        if (elem.querySelector('input[type="radio"]')) {
            if (elem.querySelector('input[type="radio"]').checked) {
                planName = elem.querySelector('input[type="radio"]').value;
                planDom = elem.querySelector('input[type="radio"]');
            }
        }
    });
    let planActive = planOfferActive.filter(elem => (elem.name == planName));
    if (planActive.length > 0) {
        let parentActivePlan = planDom.parentNode.parentNode.parentNode;
        let checkActivePlan = planActive[0].has_offer;
        parentActivePlan.querySelector('.hide-cost').value = planActive[0].cost_per_day;
        parentActivePlan.querySelector('.hide-full-cost').value = planActive[0].baseCostPerDay;
        parentActivePlan.querySelector('.hide-cost-oneshot').value = planActive[0].oneShot;
        parentActivePlan.querySelector('.hide-plantype').value = planActive[0].planType;
        this.clearAppend(parentActivePlan.querySelector('.xs-price'));
        parentActivePlan.querySelector('.xs-price').insertAdjacentHTML('afterbegin', `${checkActivePlan ? '<p>'+copyoffer+'</p>' : ''}`);
        parentActivePlan.querySelector('.xs-price').insertAdjacentHTML('beforeend', `$${planActive[0].cost_per_day} / da`);
        calculator_daily_cost_plan = parseFloat(planActive[0].cost_per_day);
    }
}

newCalculator.prototype.fillPremiumCards = function(container, premiumpacks, offertext) {
    let $this = this;
    this.clearAppend(container);
    container.insertAdjacentHTML('afterbegin', this.premiumTemplate(premiumpacks, offertext));

    let checkboxItems = document.querySelectorAll('.checkbox-field input[type="checkbox"]');
    const setPlan = function(e) {
        if (offertext !== null) {
            $this.refreshPlanValues(offertext);
        }
        $this.onChangePremium(e, this);
    }
    checkboxItems.forEach(element => element.addEventListener('change', setPlan, false));
};

newCalculator.prototype.checkMaxAmount = function(field, e, maxvalue, flag = false) {
    var recharge;
    const { scInputDays, scInputValue } = this;
    let validKey = (e.key == "Delete" || e.key == "Backspace");

    if (!flag) {
        recharge = this.transformRecharge(field.value + e.key);
    } else {
        recharge = (field.value + e.key);
    }

    if (parseFloat(recharge) > parseFloat(maxvalue)) {
        // Days Allow
        if (flag && scInputDays.classList.contains('active')) {
            if (parseFloat(scInputDays.value) < parseFloat(maxvalue)) {
                this.stopPropagation(e);
            } else {
                if (validKey) {
                    return true;
                } else {
                    this.stopPropagation(e);
                }
            }
        }
        // Recharge Allow
        if (!flag && scInputValue.classList.contains('active')) {
            if (parseFloat(scInputValue.value) < parseFloat(maxvalue)) {
                this.stopPropagation(e);
            } else {
                if (validKey) {
                    return true;
                } else {
                    this.stopPropagation(e);
                }
            }
        }
        this.stopPropagation(e);
    } else {
        return true;
    }
};

newCalculator.prototype.checkPlanType = function(newplan) {
    if (dinamic_planType == null) {
        dinamic_planType = calculator_planType;
    }
    if (newplan === dinamic_planType) {
        return true;
    } else {
        dinamic_planType = newplan;
        return false;
    }
};

newCalculator.prototype.getPreviousPackages = function(elm) {
    let checkPlan = this.checkPlanType(elm.querySelector('.hide-plantype').value);

    if ((storedPacks && storedPacks.length > 0) && checkPlan === true) {
        storedPacks.forEach(item => {
            let plan = document.querySelector(`.checkbox-field input[value="${item}"]`);
            if (typeof(plan) != 'undefined' && plan != null) {
                plan.click();
            }
        });
    }

    if (storedDefault && storedDefault.length > 0) {
        storedDefault.forEach(item => {
            if (storedPacks.includes(item) === false || checkPlan === false) {
                let dftPlans = document.querySelector(`.checkbox-field input[value="${item}"]`);
                if (typeof(dftPlans) != 'undefined' && dftPlans != null) {
                    dftPlans.click();
                }
            }
        });
    }

    if (storedESbPacks && storedESbPacks.length > 0) {
        storedESbPacks.forEach(item => {
            if (storedPacks.includes(item) === false || checkPlan === false) {
                let esbPacks = document.querySelector(`.checkbox-field input[value="${item}"]`);
                if (typeof(esbPacks) != 'undefined' && esbPacks != null) {
                    esbPacks.click();
                }
            }
        });
    }

};

newCalculator.prototype.storeDefaultPacks = function(e) {
    this.defaultList = JSON.parse(sessionStorage.getItem('defaultPlans'));

    if (e.target.checked) {
        this.defaultList.push(e.target.value);
    } else {
        for (var i = 0; i < this.defaultList.length; i++) {
            (this.defaultList[i] === e.target.value) && this.defaultList.splice(i, 1);
        }
    }
    sessionStorage.setItem('defaultPlans', JSON.stringify(this.defaultList));
    storedDefault = this.defaultList;
};

newCalculator.prototype.storeEsbPacks = function(e) {
    this.defEsbPacks = JSON.parse(sessionStorage.getItem('defaultEsbPacks'));

    if (e.checked) {
        this.defEsbPacks.push(e.value);
    }
    sessionStorage.setItem('defaultEsbPacks', JSON.stringify(this.defEsbPacks));
    storedESbPacks = this.defEsbPacks;
};

newCalculator.prototype.offerLeftDays = function(offerdate, formatdate) {
    var monthDays = [];
    var nextYearDays = [];
    let objDate = new Date();
    let rechargeDay = parseFloat(("0" + objDate.getDate()).slice(-2));
    let offerDay = parseFloat(("0" + offerdate.getDate()).slice(-2));
    const lastday = function(y, m) {
        return new Date(y, m + 1, 0).getDate();
    }
    const getNewMonth = function(d, flag = false) {
        flag ? d.setMonth(d.getMonth() - 1, 1) : d.setMonth(d.getMonth() + 1, 1);
        return new Date(d);
    }

    const operation = (total, num) => total + num;

    if (offerdate.getMonth() === objDate.getMonth()) {
        monthDays.push((offerDay === rechargeDay) ? 1 : offerDay - (rechargeDay - 1));
    } else {
        var next;
        var prev;
        let monthList = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
        let isSameYear = (offerdate.getFullYear() === objDate.getFullYear());

        for (const value of monthList) {
            if (value === offerdate.getMonth()) {
                isSameYear ? monthDays.push(offerDay) : nextYearDays.push(offerDay);
            }

            if (value === objDate.getMonth()) {
                let prevMonthLastDay = lastday(objDate.getFullYear(), objDate.getMonth());
                let prevDays = (rechargeDay === prevMonthLastDay) ? 1 : (prevMonthLastDay - (rechargeDay - 1));
                monthDays.push(prevDays);
            }

            if (value > objDate.getMonth() && value < offerdate.getMonth() && isSameYear || value > objDate.getMonth() && !isSameYear) {
                next = (next) ? next : new Date();
                next = getNewMonth(next);
                monthDays.push(new Date(next.getFullYear(), next.getMonth() + 1, 0).getDate());
            }

            if (value < offerdate.getMonth() && !isSameYear) {
                prev = (prev) ? prev : new Date(`${formatdate}`);
                prev = getNewMonth(prev, true);
                nextYearDays.push(new Date(prev.getFullYear(), prev.getMonth() + 1, 0).getDate());
            }
        }
    }

    if (nextYearDays.length > 0) {
        return monthDays.reduce(operation, 0) + nextYearDays.reduce(operation, 0);
    } else {
        return monthDays.reduce(operation, 0);
    }
};


newCalculator.prototype.getPackOffer = function(e, selectedItem) {
    let checkOfferPack = this.allPacks.filter(item => (item.name === selectedItem && (item.activePackage && item.has_offer === true)));
    // find and replace item pack
    if (e.target.checked && checkOfferPack.length === 1) {
        userActivePack = selectedItem;
        this.replaceArrayItems(selectedItem, checkOfferPack);
    }
    // find and remove item pack
    if (!e.target.checked && checkOfferPack.length === 1) {
        this.removeArrayItems(userActivePack);
    }
};

newCalculator.prototype.getPlansOffer = function(selectedItem) {
    let checkOfferPlan = this.allplans.filter(item => (item.name === selectedItem && (item.activePlan && item.has_offer === true)));
    let planSelected = this.allplans.filter(item => (item.name === selectedItem));
    // find and replace item plan
    if (checkOfferPlan.length === 1) {
        userActivePlan = selectedItem;
        this.replaceArrayItems(selectedItem, checkOfferPlan);

    }
    if (checkOfferPlan.length !== 1) {
        this.removeArrayItems(userActivePlan);
    }

    // Save object plan selected in Session storage
    sessionStorage.setItem('planSelected', JSON.stringify(planSelected[0]));
};

newCalculator.prototype.removeArrayItems = function(property) {
    const index = planOfferActive.findIndex(x => x['name'] == property);
    if (index > -1) {
        planOfferActive.splice(index, 1);
    }
};

newCalculator.prototype.replaceArrayItems = function(property, item) {
    const index = planOfferActive.findIndex(x => x['name'] == property);
    if (index > -1) {
        planOfferActive[index] = item[0];
    } else {
        planOfferActive.push(item[0]);
    }
};

newCalculator.prototype.getMinDateDays = function(maxdays, data) {
    let acc = this.offerLeftDays(new Date(`${maxdays.expiration_date}`), maxdays.expiration_date);
    let optionSele = [];
    for (let i = 0; i < data.length; i++) {
        let newdate = this.offerLeftDays(new Date(`${data[i].expiration_date}`), data[i].expiration_date);
        if (newdate < acc) {
            acc = newdate;
            optionSele = [];
            optionSele.push(data[i]);
        }
    }
    return optionSele;
};

newCalculator.prototype.getMaxDateDays = function(data) {
    let acc = 0;
    let optionSele = [];
    for (let i = 0; i < data.length; i++) {
        let newdate = this.offerLeftDays(new Date(`${data[i].expiration_date}`), data[i].expiration_date);
        if (newdate > acc) {
            acc = newdate;
            optionSele = [];
            optionSele.push(data[i]);
        }
    }
    return optionSele;
};

newCalculator.prototype.savePlansData = function(plans) {
    this.allplans = plans;
};

newCalculator.prototype.savePacksData = function(packs) {
    planOfferActive = [];
    this.allPacks = packs;
    let actPlans = this.allplans.filter(item => (item.activePlan && item.has_offer === true));
    let actPacks = this.allPacks.filter(item => (item.activePackage && item.has_offer === true));
    planOfferActive = actPlans.concat(actPacks);
    getAllPackages = packs;
};

newCalculator.prototype.checkDueDateOs = function(item) {
    let ifExpireDate = (item.expiration_date !== "") ? this.offerLeftDays(new Date(`${item.expiration_date}`), item.expiration_date) : 0;
    if (ifExpireDate >= 1 && item.has_offer) {
        return item.oneShot;
    } else {
        return item.baseOneShot;
    }
};


newCalculator.prototype.checkDueDateDC = function(item) {
    let ifExpireDate = (item.expiration_date !== "") ? this.offerLeftDays(new Date(`${item.expiration_date}`), item.expiration_date) : 0;
    if (ifExpireDate >= 1 && item.has_offer) {
        return item.cost_per_day;
    } else {
        return item.baseCostPerDay;
    }
};


newCalculator.prototype.calculateWithNoOffer = function(monto) {
    if (monto > 0) {
        orderArray.forEach(elem => {
            monto = monto - elem['baseCostPerDay'];
        });
    }
    if (monto == 0) {
        initDays++;
        return;
    } else if (monto < 0) {
        return;
    } else {
        initDays++;
        this.calculateWithNoOffer(monto);
    }
};



newCalculator.prototype.calculateWithDays = function() {
    for (let i = 0; i < arrayOfAmounts.length; i++) {
        if (montoIngresado >= arrayOfAmounts[i]) {
            montoIngresado = parseFloat(montoIngresado.toFixed(2)) - arrayOfAmounts[i]
            initDays++;
        } else {
            break;
        }
    }
    if (montoIngresado > 0) {
        this.calculateWithNoOffer(montoIngresado);
    }
}


newCalculator.prototype.fullfillArrayOfAmounts = function() {
    const $this = this;
    for (let i = 0; i < orderArray[0]['daysLeft']; i++) {
        orderArray.forEach(obj => {
            if (obj['daysLeft'] > i) {
                if (arrayOfAmounts[i] >= 0) {
                    arrayOfAmounts[i] += parseFloat(obj['cost_per_day']);
                } else {
                    arrayOfAmounts[i] = 0 + parseFloat(obj['cost_per_day']);
                }
            } else {
                if (arrayOfAmounts[i] >= 0) {
                    arrayOfAmounts[i] += parseFloat(obj['baseCostPerDay']);
                } else {
                    arrayOfAmounts[i] = 0 + parseFloat(obj['baseCostPerDay']);
                }
            }
        });
    }
    if (montoIngresado !== 0) {
        if (montoIngresado > calculator_oneshot) {
            montoIngresado = montoIngresado - calculator_oneshot;
            initDays = calculator_osDays;
            this.calculateWithDays();
        } else if (montoIngresado == calculator_oneshot) {
            initDays = calculator_osDays;
        } else {
            this.calculateWithDays();
        }
    }
    if (diasIngresados !== 0) {
        if (diasIngresados > calculator_osDays) {
            diasIngresados = diasIngresados - calculator_osDays;
            amountToRecharge = calculator_oneshot;
            $this.calculateWithAmout();
        } else if (diasIngresados == calculator_osDays) {
            amountToRecharge = calculator_oneshot;
        } else {
            $this.calculateWithAmout();
        }
    }

}

newCalculator.prototype.calculateWithAmout = function() {
    for (let i = 0; i < arrayOfAmounts.length; i++) {
        if (diasIngresados > 0) {
            diasIngresados--;
            amountToRecharge = amountToRecharge + arrayOfAmounts[i];
        } else {
            break;
        }
    }

    if (diasIngresados > 0) {
        this.calculateExtraDays();
    }
}

newCalculator.prototype.calculateExtraDays = function() {
    let costWithNoOffer = 0;
    orderArray.forEach(obj => {
        costWithNoOffer += parseFloat(obj['baseCostPerDay']);
    });
    amountToRecharge = amountToRecharge + (costWithNoOffer * diasIngresados);
}

newCalculator.prototype.addDaysToObject = function() {
    vartodoslosobjetos.forEach(element => {
        let daysLeft = (element.expiration_date !== "") ? this.offerLeftDays(new Date(`${element.expiration_date}`), element.expiration_date) : 0;
        element.daysLeft = daysLeft;
    });

    orderArray = vartodoslosobjetos.sort((a, b) => (a['daysLeft'] > b['daysLeft']) ? -1 : 1);

    this.fullfillArrayOfAmounts();
}

newCalculator.prototype.addObjectsToArray = function() {
    const { scInputDays, scInputValue } = this;
    vartodoslosobjetos = [];
    initDays = 0;
    amountToRecharge = 0;
    arrayOfAmounts = [];
    orderArray = [];

    montoIngresado = parseFloat(scInputValue.value.replace(/,/g, '.')) || 0;
    diasIngresados = parseInt(scInputDays.value) || 0;

    vartodoslosobjetos.push(JSON.parse(sessionStorage.getItem('planSelected')));
    let arrayOfNames = JSON.parse(sessionStorage.getItem('premiumChanels'));
    arrayOfNames.forEach(name => {
        let index = getAllPackages.findIndex(obj => obj.name == name);
        if (index > -1) {
            vartodoslosobjetos.push(getAllPackages[index])
        }
    });
    this.addDaysToObject();
}

newCalculator.prototype.plansTemplate = function(data, copyoffer) {
        return `${data.map((item, index) =>
    `<div class="plan-card">        
        <div class="card-title" style="${'border-bottom: 5px solid ' + item.bgcolor}">
            <label class="radio">
                <span class="radio__input">
                <input type="radio" name="cardplans" value="${item.name}" ${(index === 0 && this.checkActivePlans(data) === false) ? '' : ''} class="${item.activePlan === true ? 'activeuser' : 'generaluser'}">
                <span class="radio__control"></span>
                <span class="check_mark"></span>
                </span>
                <span class="radio__label">${item.name}</span>
                <input type="hidden" class="hide-cost" value="$${this.checkDueDateDC(item)}"/>
                <input type="hidden" class="hide-full-cost" value="$${item.baseCostPerDay}"/>
                <input type="hidden" class="hide-cost-oneshot" value="$${this.checkDueDateOs(item)}"/>
                <input type="hidden" class="hide-plantype" value="${item.planType}"/>
            </label>
            <span class="xs-price">
                ${item.has_offer ? '<p>'+copyoffer+'</p>' : ''}
                ${this.costPerDay(item, true)}
            </span>
        </div>
        <div class="card-content">
            ${item.textCalculator ? item.textCalculator : 
            `<div class="xs-plan-info">
                <a href="#" title="${item.name}" class="open-popup-detail">${item.SDcount + ' Canales '}${item.HDcount > 0 ? '+' + ' ' + item.HDcount + ' Canales HD ' : ''}</a>
            </div>`
            }
        </div>
    </div>`
    ).join('')}`;
};

newCalculator.prototype.detailTemplate = function(data) {
    return `
        <div class="inner-content">
            <div class="wrapper">
                <div class="head align-x">
                    <span>Prepago</span>
                    <button type="button" class="close-button-overlay"><span class="dtv-public-icon-close"></span></button>
                </div>
                <div class="subhead align-x">
                    <div class="plan-title">${data.name}</div>
                    <div class="plan-cost">
                        ${this.costPerDay(data, true)}
                    </div>
                </div>
                <div class="totalchanels align-x">
                    <div class="ch-sd">${data.SDcount > 0 ? data.SDcount + ' Canales SD' : ''}</div>
                    <div class="ch-hd">${data.HDcount > 0 ? data.HDcount + ' Canales HD' : ''}</div>
                </div>       
                ${data.categories.map(item => `
                    <div class="category-card">
                        <div class="heading align-x ${item.cat_name === 'Audio' ? 'clean-head' : ''}">
                            <div class="count-sd">${item.SDcount > 0 ? item.SDcount + 'SD' : ''}</div>
                            <div class="title">${item.cat_name}</div>
                            <div class="count-hd">${item.HDcount > 0 ? item.HDcount + 'HD' : ''}</div>
                        </div>
                        <div class="content align-x">
                            <ul class="list-sd">
                                ${item.SD_chanels.map(channel => `
                                    <li>- ${channel}</li>
                                `).join('')}
                            </ul>
                            <ul class="list-hd">
                                ${item.HD_chanels.map(channel => `
                                    <li>- ${channel}</li>
                                `).join('')}
                            </ul>                            
                        </div>
                    </div>                        
                `).join('')}
            </div>
        </div>`
};

newCalculator.prototype.premiumTemplate = function(data, copyoffer){
    return `${data.map(item =>
    `<div class="plan-card">        
        <div class="card-title">
            <label class="checkbox-field">${item.name}
                <input type="checkbox" name="premiumplans" value="${item.name}" class="${item.activePackage === true ? 'activeuserpremium' : 'generaluser'} ${item.packType === 'default' ? 'isdefault' : ''}">
                <span class="checkmark"></span>
                <input type="hidden" class="hide-cost" value="$${this.checkDueDateDC(item)}"/>
                <input type="hidden" class="hide-full-cost" value="$${item.baseCostPerDay}"/>
                <input type="hidden" class="hide-cost-oneshot" value="$${this.checkDueDateOs(item)}"/>
            </label>
            <span class="xs-price">
                ${item.has_offer ? '<p>'+copyoffer+'</p>' : ''}
                ${this.costPerDay(item, true)}
            </span>
        </div>
        <div class="card-content">
            ${item.textCalculator ? item.textCalculator :
            `<div class="xs-premium-info"><a href="#" title="${item.name}" class="open-popup-detail premium">${item.channelCount > 0 ? item.channelCount + ' Canales ': ''}</a>
            <p>${item.description ? '<span>' + item.channelCount + '</span> ' + item.description : ''}</p></div>`
            }
        </div>
    </div>`
    ).join('')}`;
};

newCalculator.prototype.premiumItem = function (data) {

    if(data.length == 0){
        data = ['Ninguno']
        return `${data.map(item => `<li class="selected">${item}</li>`).join('')}`;
    }else{
        return `${data.map(item => `<li class="selected">${item}</li>`).join('')}`;
    }
    
};

newCalculator.prototype.premiumItemResume = function (data) {
    return `${data.length > 0 ? '<li>ms</li>' : ''}${data.map(item => `<li class="selected">${item}</li>`).join('')}`;
};



(function() {
    const newCalculatorNotSC = (function () {
        return class {
            constructor(element, properties) {
                this.element        = element;
                this.properties     = properties;
                this.currenpage     = properties.currentPage;
                this.esbApi         = `${DIRECTV_PUBLIC_SITES_CONSTANTS.CALCULATOR.ESBAPI}/${properties.country}/${properties.language}`;
                //this.esbApi         = `http://localhost:3000/data/`;      
                this.calculator     = new newCalculator();
                this.selectors      = {
                    scForm:         document.getElementById('smart-card-form'),
                    scBasePlan:     document.getElementById('smart-card-plans'),
                    ctaNoClient:    document.getElementById('cta-login-noclient'),
                    ctaClient:      document.getElementById('cta-login-client'),
                    formLogin:      document.getElementById('calcprepaidform'),
                    scCurrentPlan:  document.querySelector('#smart-card-plans .current-plan'),
                    scCostPerDay:   document.querySelector('#smart-card-plans .cost_per_day'),
                    scPlans:        document.querySelector('.plans-container-cards'),
                    scPlansInfo:    document.querySelector('.calculator-overlay'),
                    ctaLogin:       document.querySelector('.calc-input-help-text'), 
                    inputRef:       document.querySelector('.calc-input-smart-card'),
                    scPlanIntro:    document.querySelector('.sc-plan-intro'),
                    scAddIntro:     document.querySelector('.sc-add-intro'),
                    scCalIntro:     document.querySelector('.sc-cal-intro'),
                    tabAddCta:      document.querySelector('.tab-menu ul li:nth-child(2)'),                     
                    tabCalCta:      document.querySelector('.tab-menu ul li:nth-child(3)'),
                    scAdd:          document.querySelector('.plans-container-aditionals'),
                    scCal:          document.querySelector('.plans-container-calculator'),
                    scPremiumPlan:  document.querySelector('.calc-heading-top .premium-list'),
                    btnContinuePlan: document.querySelector(".button-cotinue"),
                    areYouClientLink: document.querySelector(".urlClient"),
                    smartCardsPlans: document.querySelector("#smart-card-plans"),
                    smartCardsForms: document.querySelector("#smart-card-form"),
                    areClientComponent: document.querySelector(".areClient"), 

                    calculofinal:   {
                        planselected:   document.getElementById('cal-plan-selected')
                    }
                };
                this.packCost        = '';
                this.responsePlans   = '';
                this.responsePremium = '';            
                this.initComponent();                             
            }

            initComponent() {
                const { ctaLogin } = this.selectors; 

                ctaLogin.addEventListener('click', () => {
                    this.calculator.setLoaderEsb(true);
                    this.fetchPlans(this.esbApi);
                    //this.styleCardsforNumber();
                }, false);

                // Set Array Plans
                sessionStorage.setItem('premiumChanels', JSON.stringify([]));
                sessionStorage.setItem('oneshot', JSON.stringify([]));
                sessionStorage.setItem('cost_per_day', JSON.stringify([]));
                sessionStorage.setItem('baseCostPerDay', JSON.stringify([]));
                sessionStorage.setItem('defaultPlans', JSON.stringify([]));
                sessionStorage.setItem('defaultEsbPacks', JSON.stringify([]));
                sessionStorage.setItem('offerDays', '');
                this.ctaLoginBehavior();

                // Premium packs
                this.calculator.setCalculatorResume(this.properties);
            }

            // PREMIUM
            setPremium(data){
                let premiumpacks = this.calculator.premiumPacksFilter(data, calculator_planType);
                this.calculator.fillPremiumCards(this.selectors.scAdd, premiumpacks, null);
            }      
            
            fetchDataPremium(packresponse){
                this.setPremium(packresponse.packsList);
                this.calculator.getDailyCost(packresponse.packsList);
            }   

            // PLANS
            setDefaultPlan(data){
                const { scCurrentPlan, scCostPerDay, calculofinal} = this.selectors;
                let tofixed = "";
                let cost    = document.createTextNode(this.calculator.addSeparatorsNF(tofixed, '.', ',', '.'));        
                
                this.calculator.setAppend(scCurrentPlan, {  name: document.createTextNode('Ninguno') });                
                this.calculator.setAppend(calculofinal.planselected, {  name: document.createTextNode(data[0].name) });
                this.calculator.setAppend(scCostPerDay, { cost });
                this.calculator.tabEvents();  
                // Fill Calculator Resume
                this.calculator.autofillPlans(data);
                this.calculator.fillResumeCalculo(data, data[0].name);
                calculator_planType = data[0].planType;
                // Set default plan
                sessionStorage.setItem('planSelected', JSON.stringify(data[0]));
            }
            
            setPlans(data){
                if(data.legth < 3){
                    this.selectors.scPlans.classList.add('twoCards');
                }if(data.legth < 2){
                    this.selectors.scPlans.classList.add('oneCard');
                }     

                this.selectors.scPlans.insertAdjacentHTML('afterbegin', this.calculator.plansTemplate(data));
                var plans;
                const $this = this;
                const scMobilePlan = document.querySelectorAll('.xs-plan-info a');
                const scRadioPlan  = document.querySelectorAll('.card-title .radio');
    
                scRadioPlan.forEach(elm => {
                    elm.classList.remove('radio');
                    elm.classList.add('noclient-radio');
                });
                plans = document.querySelectorAll('.noclient-radio .generaluser');                

                // Handle
                const handlefncmobile = function(e){
                    e.preventDefault();
                    $this.calculator.showDetailPlan(this, data, $this.selectors.scPlansInfo);
                }  

                const handlefnc = function () {
                  
                    // elem.parentNode replace this
                    let elem = this.parentNode;
                    const ul = document.querySelector(".premium-list")
                    const li = document.createElement("li");
                    $this.calculator.changePremiumPlans(elem.parentNode);
                    $this.calculator.onChangePlan(elem.parentNode, data);
                    $this.selectors.btnContinuePlan.style.cursor = 'pointer';
                    $this.selectors.btnContinuePlan.disabled = false;
                    $this.selectors.btnContinuePlan.style.backgroundColor = "#0073ae";
                    $this.selectors.btnContinuePlan.style.border = "0.5px solid #0073ae";
                    if(ul.innerText == ""){
                        li.appendChild(document.createTextNode("Ninguno"));
                        ul.appendChild(li);  
                    }
                }

                // Events
                scMobilePlan.forEach(elem => elem.addEventListener("click", handlefncmobile, false));
                plans.forEach(elem => elem.addEventListener("click", handlefnc, false));        
            }

            fetchPlans(path){
                let params = `configurationHome=${this.currenpage}`;
                this.responsePlans = this.calculator.getEsbData(params, path);
                //this.responsePlans = this.calculator.getEsbDataFake(params, path);
                this.responsePlans
                .then((res) => {
                    let plansData   = res.plans.plansList.filter((p)=>!p.legacy);
                    let premiumData = res.packs;
                    this.setDefaultPlan(plansData);
                    this.setPlans(plansData);
                    this.calculator.savePlansData(plansData);
                    this.calculator.setBalance(res);
                    this.fetchDataPremium(premiumData);
                    this.calculator.savePacksData(premiumData.packsList);

                })
                .catch( err => new Error(`Error fetching data: ${err}`));
                baseResponsePlans = this.responsePlans;
                this.calculator.checkPromises();
            }
            
            ctaLoginBehavior(){
                const { ctaNoClient, ctaClient, ctaLogin, formLogin, inputRef, btnContinuePlan, areYouClientLink, scCostPerDay, smartCardsPlans, smartCardsForms, areClientComponent, scPlans, scCurrentPlan, scAdd} = this.selectors;
                this.calculator.disableButton(ctaLogin);

                ctaNoClient.onclick = () => {
                    this.calculator.enableButton(ctaLogin);
                    formLogin.style.display = 'none';
                    ctaLogin.style.display  = 'block';
                    areClientComponent.style.display = "flex"
                    ctaNoClient.classList.add('selected');
                    ctaClient.classList.remove('selected');
                    inputRef.blur();
                    btnContinuePlan.style.cursor = 'not-allowed';
                    btnContinuePlan.disabled = true;
                    btnContinuePlan.style.backgroundColor = "#cccccc";
                    btnContinuePlan.style.border = "0.5px solid #cccccc";
                    scCostPerDay.innerText = "-"; 
                    scAdd.style.display = "none";
             
                }

                ctaClient.onclick = () => {
                    document.querySelector(".areClient").style.display = "none"
                    this.calculator.disableButton(ctaLogin);
                    formLogin.style.display = 'block';
                    ctaLogin.style.display  = 'none';
                    ctaClient.classList.add('selected');
                    ctaNoClient.classList.remove('selected'); 
                    inputRef.focus();
                    scAdd.style.display = "none";                   
                }

                areYouClientLink.onclick = () => {
                    areClientComponent.style.display = "none"
                    smartCardsPlans.style.display = "none";
                    smartCardsForms.style.display = "block"
                    scPlans.innerHTML = "";
                    scCurrentPlan.innerHTML = "";
                    this.calculator.disableButton(ctaLogin);
                    formLogin.style.display = 'block';
                    ctaLogin.style.display  = 'none';
                    ctaClient.classList.add('selected');
                    ctaNoClient.classList.remove('selected'); 
                    inputRef.focus();
                    btnContinuePlan.style.cursor = 'pointer';
                    btnContinuePlan.disabled = false;
                    btnContinuePlan.style.backgroundColor = "#0073ae";
                    btnContinuePlan.style.border = "0.5px solid #0073ae";
      
                }
            }
/*
            styleCardsforNumber(){
                    setTimeout(function(){
                        
                        let cardsContainerPlans = document.querySelector(".plans-container-cards")
                        let allPlansCalc = document.querySelectorAll(".plans-container-cards .plan-card");
                        let cardDisabled = document.querySelectorAll(".plans-container-cards .plan-card[style='display: none;']") 

                        for (let i = 0; i < allPlansCalc.length; i++) {
                            }if((screen.width >= 1024) && cardDisabled.length == 4 || allPlansCalc.length == 2){
                                cardsContainerPlans.style.width="55%";
                                cardsContainerPlans.style.margin="0 340px"
                          } 
                    },2000)
            }
                */
        };

    })();

    const components = $('.new-prepaid-calculator');
    components.each((index, element) => {
        const component = $(element);
        const id = component.attr('id');
        const properties = {
            previewMode:    component.data('previewmode'),
            editMode:       component.data('editmode'),
            country:        component.data('country'),
            language:       component.data('language'),
            sharetext:      component.data('sharetext'),
            currentPage:    component.data('currentpage')
        };
        GeneralComponentContainer.setComponent(new newCalculatorNotSC(component, properties), id);
    });
})();



(function () {
  const newCalculatorCalcula = (function () {    
    return class {
      constructor(element, properties) {
        this.context     = this;
        this.element     = element;
        this.calculator  = new newCalculator();
        this.daysPromo   = properties.oneshotdays ? properties.oneshotdays : 30;
        this.maxrecharge = properties.maxrecharge;
        this.maxdays     = properties.maxdays;
        this.selectors   = {
          scInputValue: document.querySelector(".calculator-value"),
          scInputDays: document.querySelector(".calculator-days"),
          scCalError: document.querySelector(".cal-error"),
          scDaysError: document.querySelector(".days-error"),
          scSaveBtn: document.querySelector(".save-btn"),
          cal_total_days: document.getElementById("cal-total-days"),
          total_cost: document.querySelector('.total-cost span'),
          client_calculo: document.querySelector('.client-calculo span'),
          sctaCalculo: document.querySelector('.go-calculo-cta button')
        };
        this.initComponent();
      }

      initComponent() {
        const { scInputValue, scInputDays } = this.selectors; 
        scInputValue.addEventListener("keyup", this.handlecalculo.bind(this));
        scInputValue.addEventListener("keydown", this.handleInput.bind(this));
        scInputValue.addEventListener("input", this.handleValueInput.bind(this));
        scInputValue.addEventListener('paste', e => e.preventDefault());
        scInputValue.addEventListener('drop', e => e.preventDefault());

        scInputDays.addEventListener("keyup", this.handlecalculoDays.bind(this));
        scInputDays.addEventListener("keydown", this.handleInputDays.bind(this));   
        scInputDays.addEventListener("input", this.handleValueInputDays.bind(this));
        scInputDays.addEventListener('paste', e => e.preventDefault());     
        scInputDays.addEventListener('drop', e => e.preventDefault());
      }

      resumeCalculator(){
        const { scInputDays, cal_total_days, total_cost, client_calculo } = this.selectors;
        let checkBalance = this.calculator.checkBalance(calculator_recharge_cost);
        calculator_total_days = scInputDays.value ? scInputDays.value : 0;
        // Clean Days
        this.calculator.clearAppend(total_cost);
        this.calculator.clearAppend(client_calculo);
        this.calculator.clearAppend(cal_total_days);
        // Set Days
        this.calculator.setAppend(cal_total_days, { days: document.createTextNode(calculator_total_days) });
        this.calculator.setAppend(total_cost, { recharge: document.createTextNode(this.calculator.addSeparatorsNF(checkBalance, '.', ',', '.')) });  
        this.calculator.setAppend(client_calculo, { recharge: document.createTextNode(this.calculator.addSeparatorsNF(this.calculator.toFixedNumber(calculator_recharge_cost), '.', ',', '.')) });   
      }      

      calculatorResume(){
        const { scInputValue, scInputDays, sctaCalculo, scSaveBtn } = this.selectors;         

        sctaCalculo.addEventListener('click', () => {

          if(scInputDays.value.length > 0 && scInputValue.value.length === 0){
            let checkRecharge = sessionStorage.getItem('offerDays');
            scInputDays.classList.remove('active');
            scInputValue.classList.add('active');

            if(checkRecharge !== "false"){
              scInputValue.value = checkRecharge;
            } else {
              scInputValue.value = calculator_rechDays;
            }       
            
          } 

          if(scInputValue.value.length > 0 && scInputDays.value.length === 0){ 
            let checkOfferDays = sessionStorage.getItem('offerDays');
            scInputValue.classList.remove('active');
            scInputDays.classList.add('active');     
            
            if(checkOfferDays !== "false"){
              scInputDays.value = checkOfferDays;
            } else {
              scInputDays.value = calculator_resultDays;
            }            

          }
          
          calculator_recharge_cost = parseFloat(scInputValue.value.replace(/,/g, '.'));
          this.resumeCalculator();
          scSaveBtn.classList.remove("btn-block");
          scSaveBtn.classList.add("btn-primary");
          scSaveBtn.disabled = false;     
        });    
      }

      // DAYS FIELD FUNCTIONS

      resultDays(value, dailyCost){
        let baseOperation;
        let rechargeDays = parseFloat(value);
        let daysOneshot  = parseFloat(this.daysPromo);
        if(rechargeDays > daysOneshot){
            rechargeDays = rechargeDays - daysOneshot;
        }        
        baseOperation = parseFloat(rechargeDays) * parseFloat(dailyCost);
        return baseOperation;        
      }

      setInvalidDays(){        
        const {scInputValue, scDaysError, scSaveBtn, scInputDays, sctaCalculo} = this.selectors;
        scInputDays.classList.add("input-error");
        scDaysError.classList.remove("hide");
        
        scSaveBtn.classList.remove("btn-primary");
        scSaveBtn.classList.add("btn-block");
        scSaveBtn.disabled = true;
        sctaCalculo.classList.remove("btn-primary");
        sctaCalculo.classList.add("btn-block");        
        sctaCalculo.disabled = true;
        
        scInputValue.value = "";        
        calculator_recharge_cost = 0;
      }

      setValidDays(day, result){     
        const {scInputValue, scDaysError, sctaCalculo, scInputDays} = this.selectors;      

        this.calculator.clearAppend(scInputValue); 
        scInputDays.classList.remove("input-error");
        scDaysError.classList.add("hide");
        sctaCalculo.classList.remove("btn-block");
        sctaCalculo.classList.add("btn-primary");
        sctaCalculo.disabled = false;

        this.calculatorResume();

      }

      handlecalculoDays(e){
        const { scInputDays } = this.selectors;
        let dailyCost = parseFloat(!calculator_cost_per_day ? calculator_daily_cost_plan : calculator_cost_per_day);
        let daynumber = parseFloat(scInputDays.value);        
        let result    = this.context.resultDays(daynumber, dailyCost);
        let currentDay = scInputDays.value.toString();

        if(/Android/i.test(navigator.userAgent)){
          var noPoint;          
          // Prevent dots
          if(currentDay.indexOf('.') > -1 || currentDay.indexOf(',') > -1 ){
            if(currentDay.indexOf('.') > -1){
              noPoint = currentDay.split('.')[0];
            }
            if(currentDay.indexOf(',') > -1){
              noPoint = currentDay.split(',')[0];
            }            
            scInputDays.value = parseInt(noPoint);
          }
          // Prevent max value
          if(parseFloat(scInputDays.value) > parseFloat(this.maxdays)){
            scInputDays.value = Math.floor(scInputDays.value / 10);
          }
        }
        
        if (parseInt(dailyCost) > 0) {    
          if (Number.isNaN(result)){return;}
          if(daynumber <= 0){
            this.context.setInvalidDays();
          }
          if(daynumber >= 1){
            this.context.setValidDays(daynumber, result);
            calculator_osDays = this.daysPromo;
            this.calculator.addObjectsToArray();
            sessionStorage.setItem('offerDays', `${parseFloat(this.calculator.toFixedNumber(amountToRecharge))}`); 
          }        
        }
        e.preventDefault();        

      }      

      handleInputDays(e){
        const { scInputDays, scInputValue, scCalError } = this.selectors;
        
        // Clean Recharge value
        scInputValue.value = "";
        scInputValue.classList.remove("input-error");
        scInputValue.classList.remove('active');
        scCalError.classList.add("hide");        

        this.calculator.checkOnlyNumber(e, true);
        this.calculator.checkMaxAmount(scInputDays, e, this.maxdays, true);               
      }

      handleValueInputDays(){
        const {scInputValue, scInputDays} = this.selectors;
        if(this.context.checkInputValue(scInputValue, scInputDays)){
          this.context.setInvalidDays();
        }
      }      

      // RECHARGE FIELD FUNCTIONS

      resultOperation(value, dailyCost){
        let recharge = parseFloat(value);
        if(recharge > calculator_oneshot){
            recharge = recharge - calculator_oneshot;
        }
        let baseOperation = parseFloat(recharge) / parseFloat(dailyCost); 
        
        return baseOperation;        
      }    

      setInvalid(){        
        const {scInputValue, scCalError, scSaveBtn, scInputDays, sctaCalculo} = this.selectors;
        scInputValue.classList.add("input-error");
        scCalError.classList.remove("hide");

        scSaveBtn.classList.remove("btn-primary");
        scSaveBtn.classList.add("btn-block");
        scSaveBtn.disabled = true;
        sctaCalculo.classList.remove("btn-primary");
        sctaCalculo.classList.add("btn-block");        
        sctaCalculo.disabled = true;

        scInputDays.value = "";        
        calculator_recharge_cost = 0;
      }

      setValid(val, result){
        const {scInputValue, scCalError, scInputDays, sctaCalculo} = this.selectors;
        this.calculator.clearAppend(scInputDays);
  
        scInputValue.classList.remove("input-error");
        scCalError.classList.add("hide");
        sctaCalculo.classList.remove("btn-block");
        sctaCalculo.classList.add("btn-primary");
        sctaCalculo.disabled = false;

        this.calculatorResume();

      }    

      handlecalculo(e){
        const { scInputValue } = this.selectors;
        let dailyCost = parseFloat(!calculator_cost_per_day ? calculator_daily_cost_plan : calculator_cost_per_day);
        let value     = parseFloat(scInputValue.value.replace(/,/g, '.'));              
        let result    = this.context.resultOperation(value, dailyCost);

        if (parseInt(dailyCost) > 0) {      
          if (Number.isNaN(result)){return;}

          if(value < dailyCost){
            this.context.setInvalid();
          } else{
            this.context.setValid(value, result);
            calculator_osDays = this.daysPromo;
            this.calculator.addObjectsToArray();
            sessionStorage.setItem('offerDays', `${parseInt(initDays)}`);
          }
        }  
        e.preventDefault();
      }

      handleInput(e){
        const { scInputValue, scInputDays, scDaysError } = this.selectors;

        // Clean Days value
        scInputDays.value = "";
        scInputDays.classList.remove("input-error");
        scInputDays.classList.remove('active');
        scDaysError.classList.add("hide");        
        
        this.calculator.checkOnlyNumber(e);
        this.calculator.checkMaxAmount(scInputValue, e, this.maxrecharge);       
      }
      
      handleValueInput(e){
        const {scInputValue, scInputDays} = this.selectors;
        let recharge = this.calculator.transformRecharge(e.target.value + e.key);
        this.calculator.checkDotsComma(e.target, recharge, this.maxrecharge);
        if(this.context.checkInputValue(scInputValue, scInputDays)){
          this.context.setInvalid();
        }
      }
 
      checkInputValue(val, days){
        if(val.value === "" && days.value === ""){
          return true;
        } else{
          return false;
        }
      }


    };
  })();

  const components = $(".new-prepaid-calculator");
  components.each((index, element) => {
    const component = $(element);
    const id = component.attr("id");
    const properties = {
      oneshotdays: component.data('oneshotdays'),
      maxrecharge: component.data('maxrecharge'),
      maxdays:     component.data('maxdays')
    };    
    GeneralComponentContainer.setComponent(
      new newCalculatorCalcula(component, properties), id);
  });
})();
(function () {
    const newCalculatorEsb = (function () {
      return class {
        constructor(data) {
          this.data = data;
          this.currenpage     = data.currentPage;
          this.loaderCol      = data.loadercolor;
          this.offertext      = data.offertext;
          this.component      = document.getElementById(data.id);     
          this.calculator     = new newCalculator();       
          this.inputRef       = this.component.querySelector('.calc-input-smart-card');
          this.recaptcha      = this.component.querySelector('.recaptcha-field');
          this.btnRef         = this.component.querySelector('.send-button-sc');
          this.errInput       = this.component.querySelector('.err-cal-generic');    
          this.allError       = this.component.querySelectorAll('.directv-input-error');          
          this.inputminc      = this.inputRef.dataset.minchar;
          this.inputmaxc      = this.inputRef.dataset.maxchar;
          this.pattern        = `^[0-9]{${this.inputminc},${this.inputmaxc}}$`;
          this.esbApi         = `${DIRECTV_PUBLIC_SITES_CONSTANTS.CALCULATOR.ESBAPI}/${data.country}/${data.language}`;
          //this.esbApi         = `http://localhost:3000/data/`;
          this.scCurrentPlan  = document.querySelector('#smart-card-plans .current-plan');
          this.scCostPerDay   = document.querySelector('#smart-card-plans .cost_per_day');
          this.scPlans        = document.querySelector('.plans-container-cards');
          this.scPlansInfo    = document.querySelector('.calculator-overlay');
          this.scAdd          = document.querySelector('.plans-container-aditionals');
          this.loadercircle   = document.querySelector('#spinner-cal .loader');
          this.planselected   = document.getElementById('cal-plan-selected');          
          this.responseLogin  = '';
          this.responsePlans  = '';
          this.responsePremium = '';
          this.initComponent();
          this.updateValidState();
        }
  
        initComponent() {  
            const pattern = new RegExp('^[0-9]\d*$');
            this.loadercircle.style.borderLeftColor = this.loaderCol;
            this.inputRef.addEventListener('paste', e => e.preventDefault());  
            this.inputRef.addEventListener('drop', e => e.preventDefault());  
            this.inputRef.addEventListener('keyup', () => this.updateValidState(true) );
            this.inputRef.addEventListener('keydown', (e) => {
                let res = pattern.test(e.key);
                if(!res){
                  if(e.key == "Backspace" || e.key == "Delete"){    
                    this.updateValidState(true);                
                    return true;
                  } else {
                    e.stopPropagation();
                    e.preventDefault();
                    return false;
                  }
                } else { this.updateValidState(true); }
            });

            this.handleData(); 
        }

        updateValidState(settings = false) {
            const { calculator, pattern, inputRef, data, recaptcha, inputmaxc, errInput, allError, btnRef } = this;
            let validInput = calculator.inputValidations(inputRef, pattern, inputmaxc); 

            if(!validInput && settings){
                allError.forEach(item => item.style.display = 'none');
                errInput.style.display = 'block';
                inputRef.classList.add('invalid');
            }
            if(validInput && settings){
                allError.forEach(item => item.style.display = 'none');
                errInput.style.display = 'none';
                inputRef.classList.remove('invalid');
            }

            (validInput === true && data.recaptchaEnabled && siteKey && recaptcha.value === 'false') && recaptcha.classList.add('validation-missing');
            (validInput === true && ((data.recaptchaEnabled && recaptcha.value === 'true') || !data.recaptchaEnabled || !siteKey)) ? this.calculator.enableButton(btnRef) : this.calculator.disableButton(btnRef);
        }   

        handleData(){
            this.btnRef.addEventListener('click', (e) => {
                const {inputRef, esbApi} = this;
                let params = `smartCardNumber=${inputRef.value}&configurationHome=${this.currenpage}`;
                this.calculator.setLoaderEsb(true);
                this.responseLogin = this.calculator.getEsbData(params, esbApi);
                //this.responseLogin = this.calculator.getEsbDataFake(params, esbApi);
                this.responseLogin
                .then(res => {                  
                  this.setEsbPlans(res);
                  this.calculator.checkPromises(this);
                })
                .catch(err => this.handleErrors(err));                
            });   
        }

        fillDefaultPlans(data){
          const { scCurrentPlan, scCostPerDay, planselected} = this;                   
          let tofixed = this.calculator.toFixedNumber(!data[0].cost_per_day ? '0' : data[0].cost_per_day);
          let cost    = document.createTextNode(this.calculator.addSeparatorsNF(tofixed, '.', ',', '.'));                
          this.calculator.setAppend(scCurrentPlan, {  name: document.createTextNode(data[0].name) });                
          this.calculator.setAppend(planselected, {  name: document.createTextNode(data[0].name) });
          this.calculator.setAppend(scCostPerDay, { cost });
          this.calculator.tabEvents();  
          // Fill Calculator Resume
          this.calculator.autofillPlans(data);    
          this.calculator.fillResumeCalculo(data, data[0].name);     

          let getActivePlan = data.filter(item => item.activePlan === true);
          calculator_planType = (getActivePlan.length > 0) ? getActivePlan[0].planType : data[0].planType;
        }

        setPlans(data){               
          this.scPlans.insertAdjacentHTML('afterbegin', this.calculator.plansTemplate(data, this.offertext));
          const $this = this;
          const scMobilePlan = document.querySelectorAll('.xs-plan-info a');
          const scRadioPlan  = document.querySelectorAll('.card-title .radio');  
          let selectPlans    = document.querySelectorAll('input.activeuser');

          const handlefncmobile = function(e){
              e.preventDefault();
              $this.calculator.showDetailPlan(this, data, $this.scPlansInfo);
          }  
          
          const handlefnc = function () {
            $this.calculator.changePremiumPlans(this, $this.offertext);            
            $this.calculator.onChangePlan(this, data);
          }

          // Events
          scMobilePlan.forEach(elem => elem.addEventListener("click", handlefncmobile, false));
          scRadioPlan.forEach(elem => elem.addEventListener("click", handlefnc, false));
          this.calculator.selectUserPlans(selectPlans);

        }       
        
        setPremium(data){

          let premiumpacks = this.calculator.premiumPacksFilter(data, calculator_planType);
          this.calculator.fillPremiumCards(this.scAdd, premiumpacks, this.offertext);
          // Select user premium/plans by default
          let selectPlans = document.querySelectorAll('input.activeuserpremium');
          this.calculator.selectUserPlans(selectPlans);
          selectPlans.forEach(elm => this.calculator.storeEsbPacks(elm));
        }   

        setEsbPlans(res){
          let plansData   = res.plans.plansList;
          let premiumData = res.packs;
          this.calculator.savePlansData(plansData);
          this.setEsbPremium(plansData, premiumData, res);                
        }

        setEsbPremium(dataplans, datapacks, fullres){
          this.calculator.savePacksData(datapacks.packsList);
          // Plans
          this.fillDefaultPlans(dataplans);
          this.setPlans(dataplans);              
          this.calculator.setBalance(fullres);
          // Premium
          this.setPremium(datapacks.packsList);
          this.calculator.getDailyCost(datapacks.packsList);        
        }        

        handleErrors(err){
          this.calculator.checkPromises(this);
          let errResponse = err.replace(/['"]+/g, '');
          this.inputRef.value = '';
          this.updateValidState(true);
          // show message
          this.allError.forEach(item => item.style.display = 'none');
          let errcontainer = document.querySelector(`.directv-input-error-${errResponse}`);
          errcontainer.style.display = 'block';
        }
        
      };
    })();
  
    const components = $(".new-prepaid-calculator");
    components.each((index, element) => {
      const component = $(element);
      const data = {
        id: component.attr('id'),  
        recaptchaEnabled: component.data('recaptchaenabled'),
        currentPage: component.data('currentpage'),
        country:     component.data('country'),
        language:    component.data('language'),
        loadercolor: component.data('loadercolor'),
        targetResum: component.data('resumectatarget'),
        offertext:   component.data('offertext')       
      };      
      GeneralComponentContainer.setComponent( new newCalculatorEsb(data) );
    });
  })();
(function () {
    const url = '/bin/public-sites/acquisition'
    $(document).ready(function () {
        $('.new-form-banner input').focus(function () {
            $(this).parents('.field').addClass('focused');
        });

        $('.new-form-banner input').blur(function () {
            let inputValue = $(this).val();
            if (inputValue == "") {
                $(this).parents('.field').removeClass('focused');
            }
        });

        $('.new-form-banner input').each(function () {
            let inputValue = $(this).val();
            if (inputValue !== "") {
                $(this).parents('.field').addClass('focused');
            }
        });
        let regexP
        let cityTemp = $('html').data('country-ps');
        if (cityTemp === 'cl') {
            regexP = /^[9][0-9]+/i
        } else {
            regexP = /^[0-9]+/i
        }
        console.log(regexP)

        //formulario
        class NewLoadForm {
            fields = {
                '.name': {
                    regex: /[^A-Za-z----'~` ]/i,
                },
                '.dni': {
                    regex: /[^\d]/i,
                },
                '.rut': {
                    regex: /[^\dKk-]/i,
                    blur: /^\d{7,8}[-]{1}[Kk\d]{1}$/i,
                },
                '.phoneIndicative': {
                    regex: /[^\d]/i,
                    blur: /^[0-9]+/i,
                },
                '.phoneNumber': {
                    regex: /[^\d]/i,
                    blur: regexP,
                },
                '.email': {
                    blur: /\b[\w\.-]+@[\w\.-]+\.\w{2,4}\b/i,
                },
                '.client': {
                    regex: /[^\d]/i,
                }
            }
            constructor(elmForm) {
                this.elmForm = elmForm
                let el = this
                let isClient = 0
                let cityTemp = $('header').data('country');

                //envia el formulario
                elmForm.submit(function (e) {
                    e.preventDefault();
                    let error = el.isError()
                    let comments = ''
                    if (elmForm.find('.dni')) {
                        comments = `DNI: ${elmForm.find('.dni').val()}`
                    }
                    if (elmForm.find('.rut')) {
                        comments = `RUT: ${elmForm.find('.rut').val()}`
                    }

                    let data = {
                        identification: elmForm.find('.client').val(),
                        fullname: elmForm.find('.name').val(),
                        email: elmForm.find('.email').val(),
                        phone: '' + (elmForm.find('.phoneIndicative') ? elmForm.find('.phoneIndicative').val() : '') + elmForm.find('.phoneNumber').val(),
                        isClient: isClient,
                        idClientInput: 1, //el id del cliente va en la identificacion
                        comments: comments,
                        country: cityTemp,
                        reason: 13, //razn del formulario que se desea remplazar
                        isPhone: 1, //lleva phone
                        withEmail: 1, //lleva email obligado
                    }

                    if (error) return false;

                    try {
                        $.ajax({
                            type: 'POST',
                            url: url,
                            data: data,
                            success: (r) => {
                                window.open(`${elmForm.find('.thankYouPage').val()}?message`, '_self');
                            },
                            error: (r) => {
                                window.open(`${elmForm.find('.errorPage').val()}?message=error`, '_self');
                            }

                        });
                    } catch (err) {
                        window.open(`${elmForm.find('.errorPage').val()}?message=error`, '_self');
                    }
                });
                elmForm.on('check', function (e) {
                    el.isError()
                });
                //delimita los campos
                for (const field in this.fields) {
                    if (Object.hasOwnProperty.call(this.fields, field)) {
                        const pro = this.fields[field];
                        const element = elmForm.find(field)
                        if (pro.regex) {
                            element.on('input', function (e) {
                                $(this).val(function (i, v) {
                                    return v.replace(pro.regex, '');
                                });
                            });
                        }
                        if (pro.max) {
                            element.attr('maxlength', pro.max)
                        }
                        //require
                        element.on('blur', function (e) {
                            let parent = $(this).parents('.new-form-group');
                            let required = parent.hasClass('required');
                            let xval = $(this).val().trim();

                            if (required && !xval) {
                                parent.addClass('error')
                            } else {
                                parent.removeClass('error')
                            }
                            //tipo como email

                            if (pro.blur && xval) {
                                let c = pro.blur.test(xval)
                                if (!c) {
                                    parent.addClass('error')
                                } else {
                                    parent.removeClass('error')
                                }
                            }
                            el.checkFields()
                        });
                    }
                }
                //radio
                elmForm.find("input[name=client]").click(function () {
                    if ($(this).val() === "si") {
                        elmForm.find(".client-parent").removeClass('hide')
                        isClient = 1
                    } else {
                        elmForm.find(".client-parent").addClass('hide')
                        isClient = 0
                    }
                    el.checkFields()
                });
                //textos 
                elmForm.find(".text-call-to-action").html($("header .text-call-to-action").html());
                elmForm.find(".link-call-to-action").html($("header .link-call-to-action").html());
                elmForm.find(".link-call-to-action").attr('href', $("header .link-call-to-action").attr('href'));
            }
            checkFields() {
                let error = false;
                for (const field in this.fields) {
                    if (Object.hasOwnProperty.call(this.fields, field)) {
                        const element = this.elmForm.find(field)
                        if (element.length) {
                            let parent = element.parents('.new-form-group');
                            if (parent.hasClass('error') && !parent.hasClass('hide')) error = true;
                            if (!element.val() && !parent.hasClass('hide')) error = true;
                        }
                    }
                }

                let rc = $("#" + this.elmForm.find('.id-form').val() + "-g-recaptcha-response").val()
                if (!(rc === 'true')) error = true
                if (error) {
                    this.elmForm.find('.submit').attr('disabled', true)
                } else {
                    this.elmForm.find('.submit').attr('disabled', false)
                }
            }
            isError() {
                let error = false;
                for (const field in this.fields) {
                    if (Object.hasOwnProperty.call(this.fields, field)) {
                        const element = this.elmForm.find(field)
                        element.trigger('blur');
                        let parent = element.parents('.new-form-group');
                        if (parent.hasClass('error') && !parent.hasClass('hide')) error = true;
                    }
                }
                let rc = $("#" + this.elmForm.find('.id-form').val() + "-g-recaptcha-response").val()
                if (!(rc === 'true')) error = true
                if (error) {
                    this.elmForm.find('.submit').attr('disabled', true)
                } else {
                    this.elmForm.find('.submit').attr('disabled', false)
                }

                return error
            }

        }

        $(".formBanner").each(() => {
            new NewLoadForm($(this))
        })
    });
})();
(function () {
    let message = getParameterByName('message') || '';
    $( document ).ready(function() {        
        $('#met-msg-' + message).addClass('show');
        const $btnBacks = $('.btn-back');         
        $btnBacks.each(function(index){
            $(this).click(function(e){
                e.preventDefault();              
                history.back();
            })
        })
    });
})();
(function () {
    let message = getParameterByName('message') || '';

    $( document ).ready(function() {
        $('#mei-msg-' + message).addClass('show')
    });
})();
// Init Video Frame
(function() {
    const ModuleVideoIframe = (function () {
        return class {
            constructor(properties, id) {
                this.properties    = properties;
                this.uniqueid      = id;
                this.iframecontent = document.querySelector(`.iframe-indicator-${this.uniqueid}`);
                this.initComponent();
            }

            initComponent() {
                const {activeapi, idvideo, editMode, previewMode} = this.properties;
                if (activeapi && idvideo && !editMode && !previewMode) {
                    let setframe = document.createElement('iframe');
                    this.iframeCreator(idvideo, setframe);
                }
            }


            iframeCreator(idvideo, element){
                element.setAttribute('src', `https://www.youtube.com/embed/${idvideo}?enablejsapi=0&origin=${window.location.protocol}//${window.location.host}`);

                element.setAttribute('allowfullscreen', `allowfullscreen`);

                this.iframecontent.appendChild(element);
            }            

        };
    })();

    const components = $('.video-module-frame');
    components.each((index, element) => {
        const component = $(element);
        const id = component.attr('id');
        const properties = {
            idvideo: component.data('idvideo'),
            editMode: component.data('editmode'),
            activeapi: component.data('activeapi'),
            previewMode: component.data('previewmode'),
        };
        new ModuleVideoIframe(properties, id);
    });

})();
// End Video Frame
class modalEventLocations {
    constructor(options){
        this.country          = options.country;
        this.buttoncolor      = options.buttoncolor;
        this.evMatchSel       = document.getElementById('evMatchSel');
        this.evLocationSel    = document.getElementById('evLocationSel');
        this.evButtoms        = document.getElementById('evButtoms');
        this.evQueryMatch     = $('#evMatchSel');
        this.evQueryLocation  = $('#evLocationSel');
        // Init functions
        this.evFetchSegments();      
    }


    evFetchSegments(){        
        const _self = this;
        const getSegment = _self.evDefineEndpoints("internet-segments");
        return (async () =>{
            try{
                let getData = await fetch(getSegment);
                if(getData.status === 200){
                    let dataSeg = await getData.json();   
                    let revBody = dataSeg.body;
                    for(let i in revBody){         
                        _self.evBtnCreator(revBody[i], _self.evButtoms, i);
                    }
                    // Set initial vars
                    const setev0 =  document.getElementById('ev0');
                    const setev1 =  document.getElementById('ev1');
                    const setev2 =  document.getElementById('ev2');
                    // Set initial province
                    document.getElementById('tt-province').innerHTML = `${revBody[0].name}`;
                    _self.evSetAtt(setev0, {"style": `background: ${_self.buttoncolor}; color: #ffffff;`});
                    
                    // call segment
                    _self.evFetchData(null, setev0.value);

                    _self.evClickItems(setev0);
                    _self.evClickItems(setev1);
                    _self.evClickItems(setev2);   
    
                } else{ throw new Error('Fallo al solicitar Segmento') }   
            } catch(err){ console.log(err) }   
        })();

    }

    evFetchData(e, load){
        var saveVal;
        var targetLocation;
        if(load !== ''){
            saveVal = load;            
        } else { 
            saveVal = e.target.value;
            document.getElementById('tt-province').innerHTML = `${e.target.innerText}`;
        }
        const _self = this;
        const getSegment = _self.evDefineEndpoints("internet-segments") + `/${saveVal}`;

        return (async () =>{
            try{
                let getData = await fetch(getSegment);
                if(getData.status === 200){
                    let dataSeg = await getData.json();     
                    _self.evQueryMatch.find('li').remove();
                    _self.evQueryLocation.find('li').remove();
                    for(let i of dataSeg.body){
                        for (let a of i.events){            
                            _self.evTagCreator(a, _self.evMatchSel);
                        }
                    }
                    // Load Function Locations
                    _self.evChangeItem(_self.evMatchSel);

                    //add class item
                    targetLocation = $("ul.targetv li").first().attr('id');
                    if(targetLocation){
                        // Init first Locations
                        $("ul.targetv li").first().addClass('active');
                        _self.evGetFirstLocation(targetLocation);
                    }


                } else{ throw new Error('Fallo al solicitar Segmento') }   
            } catch(err){ console.log(err) } 

        })();
    }

    evDefineEndpoints(reqType){
        const _self = this;
        let isEventType = Object.is(reqType, "events");
        switch(this.country) {
            case "ar":
              return (isEventType) ? `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTS}`
                                   : `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHES}`;
              break;
            case "cl":
              return (isEventType) ? `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTSCL}`
                                   : `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHESCL}`;
              break;
            default:
              return (isEventType) ? `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.EVENTS}`
                                   : `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.MATCHES}`;;

       }
    }

    evChangeItem(selector){
        const _self = this;

        function getEventTarget(e) {            
            e = e || window.event;
            return e.target; 
        }

        // Active Toogle Links Matches
        $('#evMatchSel li').click(function(){
            $('#evMatchSel li.active').removeClass('active');
            $(this).addClass('active');
        });

        selector.onclick = async function (event) {
            let setMatch = getEventTarget(event).id;
            if(setMatch !== undefined){
                const getEvents = _self.evDefineEndpoints("events") + `/${setMatch}`;
                try{
                    let getDataC = await fetch(getEvents);

                    if(getDataC.status === 200){                        
                        let dataLoc = await getDataC.json();      
                        _self.evQueryLocation.find('li').remove();
                        for(let i of dataLoc.body){
                            for (let a of i.locations){     
                                _self.evTagCreator(a, _self.evLocationSel);
                            }
                        }   
                        
                        // Transform Options
                        _self.evTextLocation(); 

                    } else{ throw new Error('Error en la peticion') }            
                } catch(err){console.log(err)} 
            } else {
                console.log('Error en la peticion');
            }

        }
    }

    evGetFirstLocation(val){
        const _self = this;
        return (async () => {
            const getEvents = _self.evDefineEndpoints("events") + `/${val}`;
            try{
                let getDataC = await fetch(getEvents);
                if(getDataC.status === 200){                        
                    let dataLoc = await getDataC.json();
                    for(let i of dataLoc.body){
                        for (let a of i.locations){     
                            _self.evTagCreator(a, _self.evLocationSel);
                        }
                    }
                    // Transform Options
                    _self.evTextLocation();

                } else{ throw new Error('Error en la peticion') }            
            } catch(err){console.log(err)}
        })();
    }

    evClickItems(selector){        
        const _self = this;
        const ev0 = document.getElementById('ev0');
        const ev1 = document.getElementById('ev1');
        const ev2 = document.getElementById('ev2');
        selector.onclick = function(e){
            switch(this.id){
                case 'ev0':
                    _self.evSetAtt(ev0, {"style": `background: ${_self.buttoncolor}; color: #ffffff`});
                    _self.evSetAtt(ev1, {"style": "color: inherit;"});
                    _self.evSetAtt(ev2, {"style": "color: inherit;"});
                break;
                case 'ev1':
                    _self.evSetAtt(ev1, {"style": `background: ${_self.buttoncolor}; color: #ffffff`});
                    _self.evSetAtt(ev0, {"style": "color: inherit;"});
                    _self.evSetAtt(ev2, {"style": "color: inherit;"});
                break;     
                case 'ev2':
                    _self.evSetAtt(ev2, {"style": `background: ${_self.buttoncolor}; color: #ffffff`});
                    _self.evSetAtt(ev1, {"style": "color: inherit;"});
                    _self.evSetAtt(ev0, {"style": "color: inherit;"});
                break;                                
                default:
                break;
            }
            _self.evFetchData(e, '');
        }      
    }

    evTagCreator(data, selector){
        if(data !== null){
            const { evSetAtt, evSetAppend } = this;
            let btn   = document.createElement('li');
            let value = document.createTextNode([data.name]);
            evSetAtt(btn, { "id": [data.id] });
            evSetAppend(btn, {value});
            evSetAppend(selector, {btn});
        }
    }    

    evBtnCreator(data, selector, index){
        if(data !== null){
            const { evSetAtt, evSetAppend } = this;
            let btn     = document.createElement('button');
            let btnVal  = document.createTextNode([data.name]);
            evSetAtt(btn, {"type": "button", "value": [data.id], "id": `ev${index}`});
            evSetAppend(btn, { btnVal });
            evSetAppend(selector, { btn }); 
        }     
    }

    evSetAtt(el, attrs){
        for(var key in attrs) {
            el.setAttribute(key, attrs[key]);
        }
    }

    evSetAppend(elm, att){
        for(var key in att) {
            elm.appendChild(att[key]);
        }
    }

    evTextLocation() {
        $("#evLocationSel li").each(function() {
            $(this).text($(this).text().charAt(0) + $(this).text().slice(1));
        });            
    }
}

const componentsModalEventLocations = $('.module-modal-event-locations');
componentsModalEventLocations.each((index, element) => {
    const component = $(element);
    const options = {
        buttoncolor: component.data('buttoncolor'),
        country: component.data('country')
    };

    new modalEventLocations(options);
})
const MiDirecTv = (function () {
    const defaults = {
        "selectors": {
            "login": "dtv-btn-midtv-login",
            "signup": "dtv-btn-midtv-signup"
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };

    return class {
        constructor(id, country, language) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        getLinks() {
            requestCachedData.getAjax({
                "endpoint" : DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.SETTINGS,
                "suffixes" : [countryPS, languagePS]
            }).then((data) => {
                let section = data.body.filter(item => item.type === "postpaid")[0];
                this.setLinks(section.midtvLogin, section.midtvSignup)
            }, (err) => {
                console.log('Hubo un error en la peticin');
            });
        }

        setLinks(login, signup) {
            document.getElementById(defaults.selectors.login).setAttribute('href', login);
            document.getElementById(defaults.selectors.signup).setAttribute('href', signup);
        }

        setPath(newPath) {
            this.path = newPath;
        }

        initComponent() {
            this.getLinks();
        }
    };
})();

const midtvcomponents = $('.dtv-midtv-section');
midtvcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const country = component.data('country');
    const language = component.data('language');
    GeneralComponentContainer.setComponent(new MiDirecTv(id, country, language), id);
});
LocalNavigationComponent = (function () {
    const defaults = {
        "selectors": {
            "viewMore": ".local-navigation-view-m.view-more",
            "options" : ".options",
            "inMobile": ".local-navigation-view-m .view-more",
            "chevron" : ".chevron",
        },
        "events": {
            "click": "click",
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);

            this.initComponent();
        }

        initComponent() {
            this.$viewMore = this.component.find(defaults.selectors.viewMore);
            this.$options = this.component.find(defaults.selectors.options);
            this.$chevron = this.component.find(defaults.selectors.chevron);

            if(this.$viewMore.css('display') !== 'none') {
                this.$options.slideUp('fast'); 
            }

            this.bindEvents();
        }

        bindEvents() {
            this.$viewMore.on(defaults.events.click, this.onViewMoreHandler.bind(this));
        }

        onViewMoreHandler(event) {
            this.$options.slideToggle("slow");
            this.$chevron.toggleClass("down up");
        }
    };
})();

const localnavigationcomponents = $('.local-navigation-wrapper');
localnavigationcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new LocalNavigationComponent(id), id);
});
const LargeEventsCardComponent = (function() {
    const defaults = {
        selectors: {

        },
        events: {
            click: "click"
        }
    };

    return class {
        constructor(element) {
            this.element = element;
            this.initComponent();
        }

        initComponent() {
            this.bindEvents();
        }

        bindEvents() {
            this.element.on(defaults.events.click, (element) => {
                window.open($(element.currentTarget).data('link'), $(element.currentTarget).data('target'));
            });
        }
    }
})();

const largeeventscomponents = $('.large-events-card-container');
largeeventscomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new LargeEventsCardComponent($('#' + id)));
});
class InternetContainerComponent{
    constructor(component, componentData){
		this.component = component;
        this.componentData = componentData;
        this.styleTypeValue = this.component[0].dataset.styletype ? this.component[0].dataset.styletype : 'old';
        this.styleTypeNew = this.styleTypeValue === 'new';
        this.cardsContainer = this.component.find(`.internet-cards-${this.styleTypeValue}-container`);
        this.headerLoginData = HeaderLoginData;
		this.btnFilter = this.component.find('.btn-filter-internet');
		this.setFilterActive();
        this.firstFilter = this.component.find('.btn-filter-internet.ant-action.ant-button.active');
        this.cardContainerItem = this.styleTypeNew ? '.internet-card-new-container' : '.internet-card-container';
		this.bindEvents();
        this.getComponents();            
    }

    setFilterActive () {
        const hashToFilter = window.location.hash;
        if (hashToFilter) {
            const btnFiltered = this.btnFilter.filter((index, btn) => btn.innerHTML.replace(/\s/g, '').toLowerCase() === hashToFilter.replace('#', '').toLowerCase());
            btnFiltered.length > 0 ? btnFiltered.addClass('active') : $(this.btnFilter[0]).addClass('active');
        } else {
            $(this.btnFilter[0]).addClass('active');
        }
    }
    
    bindEvents() {
        this.btnFilter.on("click", (buttonEvent)=> {
            const parentElement = $(buttonEvent.currentTarget.parentElement);
            parentElement.find('.btn-filter-internet.ant-action.ant-button.active').removeClass('active');
			$(buttonEvent.currentTarget).addClass('active');        	        
            var budget = $(buttonEvent.currentTarget).data('filterbudget');
            var cardType = $(buttonEvent.currentTarget).data('filtertype');
            var client = $(buttonEvent.currentTarget).data('filterclient');          
            
			this.filterBy(budget, cardType, client);
        });
    }

    getComponents(){		
        this.cardsContainer.addClass(this.componentData.layouttype);
        this.getData();						        
    }

	setFirstFilter(){
		if (this.componentData.filtersinitial === 'staticFilters') {
			this.filterBy(this.componentData.filterbudget, this.componentData.filtertype, this.componentData.filterclient);			
		} else {
			if (this.componentData.filtersinitial === 'customFilters') {
				this.filterBy(this.firstFilter.data('filterbudget'), this.firstFilter.data('filtertype'), this.firstFilter.data('filterclient'));
			}
		}
	}

    getData() {
        const path = `${DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH}internet.html/${this.componentData.country}/${this.componentData.language}`;

        this.cardsContainer.html('');        
        
        GlobalData.getData({ path: path })
            .subscribe((response) => {
                this.setInternetCards(response);
                this.setFirstFilter();
            });
    }
    
    filterBy(budget, type, client){
        this.styleTypeNew ? this.cardsContainer.addClass('cards-new') : this.cardsContainer.addClass('internet-cards-container');
		this.cardsContainer.find(this.cardContainerItem)
        .css('display', 'none');				
		
		var cards = this.cardsContainer.find(this.cardContainerItem);
		if(budget !== undefined){
			cards = cards.filter('[filter-budget=' + budget + ']');	
		}
		if(type !== undefined){
			cards = cards.filter('[filter-type=' + type + ']');
		}
		if(client !== undefined){
			cards = cards.filter('[filter-client=' + client + ']');
		}
		
		cards.css('display', '');							
	}       

    setInternetCards(data) {
        data.map((cardData) => {
            const iCard = this.styleTypeNew ? new InternetCardNewComponent($(`<article class="internet-card-new-container plan" filter-type="${cardData.cardtype}" filter-budget="${cardData.badget}" filter-client="${cardData.clienttype}"></article>`), null) : new InternetCardComponent($(`<div class="internet-card-container plan" filter-type="${cardData.cardtype}" filter-budget="${cardData.badget}" filter-client="${cardData.clienttype}"></div>`), null);
            iCard.singleInternetCardFillData(cardData);
            this.cardsContainer.append(iCard.component);
        });
    }
}

const internetfiltercomponents = $('.internetfilter-widget');
internetfiltercomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const componentData = {
        language: component.data('language'),
        country: component.data('country'),        
        layouttype: component.data('layouttype'),
        filtertype: component.data('filtertype'),
		filterbudget: component.data('filterbudget'),
		filterclient: component.data('filterclient'),
		filtersinitial: component.data('filtersinitial')
    };

    GeneralComponentContainer.setComponent(new InternetContainerComponent($('#' + id), componentData), id);
});
class InternetCardNewComponent {
    constructor(component, componentData) {
        this.component = component;
        this.componentData = componentData;

        if (componentData !== null) {
            this.getDataSingleCard();
        }
    }

    getDataSingleCard() {
        let path = this.componentData.path;
        if (path) {
            GlobalData.getMultipleData([
                { path: path }
            ]).subscribe(
                (result) => {
                    try {
                        const cardData = result[0][0];
                        if (cardData) {
                            this.singleInternetCardFillData(cardData);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                },
                (error) => {
                    console.log(error);
                }
            );
        }
    }

    savePlanNam(planName) {
        console.log(planName);
        const planField = document.getElementById("cta-plan-name");
        planField.setAttribute("value", planName);
    }

    singleInternetCardFillData(data) {
        const {cardstyle, name, offercolor, bordercolor, cardctalabelcolor, priceLabel: period, description: periodlegal, price, priceList, oldPrice, linethrough, formattedPrice, featuresbullet, internetFeaturesV2: features, tvbullet: featuresTvbullet, televisionFeaturesV2: featuresTv, highlight, cardoptions: cardLinks, streamingPlatforms: platforms} = data;
        const currency = GlobalSettings.general?.currency;
        const highlightText = highlight ? highlight : data.textpromo;
        let featuresData = features ? features : data.features;
        const descriptionText = periodlegal ? periodlegal : data.priceLegal;
        const platformsData = platforms ? platforms : data.logosFeatures;
        this.component.addClass('ant-container');
        this.component.addClass('ant-level1');
        this.component.attr("product-type", data.type);
        this.component.attr("product-clienttype", data.type);
        this.component.attr("dane", data.dane || "00000")
        if (data.type === 'postpaid') this.component.addClass('pospago');
        if (data.type === 'prepaid') {
            this.component.attr("duracion", "30 das");
        }
        this.component.attr("titulo", data.title || "TV + Internet")
        if(typeof data.estrato === 'object') this.component.attr("estrato", (data.estrato.map((i)=>i.id)).join(',') || "")
        else this.component.attr("estrato", "")
        this.component.attr("valor-numerico", data.valorNumerico || "0")

        let listOfLinks = '';
        $.each(cardLinks, function(index, link) {
            listOfLinks += `
                <a href="${link.optiontypev2 === 'ghost' ? 'tel:' : ''}${link.optionlink}" target="${link.optiontarget}" class="card-button-${link.optiontypev2 ? link.optiontypev2 : 'link'}${link.optionlabel.toLowerCase().includes('whatsapp') ? ' whatsapp' : ''}">${link.optionicon ? `<img src="${link.optionicon}">` : ''}${link.optionlabel}</a>
            `
        });
        let listOfFeatures = '';
        $.each(featuresData, function(index, feature) {
            listOfFeatures += `
                <li${feature.offer ? ' class="with-link"' : ''}>
                    ${feature.offer ? '<div>' : ''}
                        <img src="/content/dam/public-sites/icons/dropdown-icons/Check.png">
                        ${feature.description}
                    ${feature.offer ? '</div>' : ''}
                    ${feature.offerLink ? `<a href="${feature.offerLink}">${feature.offerLinkText}</a>` : ''}
                </li$>
            `;
        });
        let listOfFeaturesTv = '';
        $.each(featuresTv, function(index, feature) {
            listOfFeaturesTv += `
                <li class="${feature.linkAssociated ? 'with-link' : ''}${feature.offer ? ' with-offer' : ''}">
                    <img src="/content/dam/public-sites/icons/dropdown-icons/Check.png">
                    ${feature.description}
                    ${feature.offerLink ? `<a href="${feature.offerLink}">${feature.offerLinkText}</a>` : ''}
                </li>
            `;
        });
        let listOfChannels = '';
        $.each(platformsData, function(index, platform) {
            listOfChannels += `
                <figure>
                    <div class="card-image-container">
                        <img src="${platform.imagePath ? platform.imagePath : platform.logoiconchannel}" alt="${platform.name ? platform.name : platform.logotitlechannel} logo" />
                    </div>
                    <figcaption>${platform.name ? platform.name : platform.logotitlechannel}</figcaption>
                </figure>
            `
        });
        const template = `
            <article class="card-internet ${cardstyle ? cardstyle.toLowerCase() : ''}${bordercolor ? ' highlighter' : ''}"${bordercolor ? ` style="border: 2px solid ${bordercolor}"` : ''}>
                <section class="card-header">
                    <div class="card-promo">
                        ${highlightText ? `<span style="background-color: ${offercolor ? offercolor : data.cardhighlightcolor}">${highlightText}</span>` : ''}
                    </div>
                    <h4 class="card-title">
                        <span${cardctalabelcolor && ` style="background-color: ${cardctalabelcolor}"`}></span>
                        ${name}
                    </h4>
                </section>
                <section class="card-prices">
                    <h3 class="card-price">${this.component.hasClass('single-plan-card-container') ? currency : ''}${formattedPrice || price}</h3>
                    ${period ? `<span class="card-price-month">${period}</span>`: ''}
                    <p class="card-price-old">${priceList} <span${linethrough ? ' style="text-decoration: line-through"' : ''}>${oldPrice}</span></p>              
                    <p class="card-price-help">${descriptionText}</p>
                </section>
                <section class="card-buttons">
                    ${listOfLinks}
                </section>
                <section class="card-list internet">
                    <h6 class="card-list-title"${cardstyle !== 'card-bundle' ? ' style="display: none;"' : ''}>${featuresbullet}</h6>
                    <ul>
                        ${listOfFeatures}
                    </ul>
                </section>
                <section class="card-list product"${cardstyle !== 'card-bundle' ? ' style="display: none;"' : ''}>
                    <h6 class="card-list-title">${featuresTvbullet}</h6>
                    <ul>
                        ${listOfFeaturesTv}
                    </ul>
                </section>
                <section class="card-channels">
                    ${listOfChannels}
                </section>
            </article>
        `;

        this.component.html(Handlebars.compile(template)(data));

        data.landing = false;
        data.level = 2;
        data.type = data.clienttype;

        new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data, this.loadCTA(data));

        this.component.find('.footer\x20.btn-select').on('click', (e) => {
            this.savePlanNam(data.name);
        });
    }

    loadCTA(data) {
        const mainContactPhone = (window.localStorage && window.localStorage.getItem('defaultPhone')) || '';
        const phoneNumber = mainContactPhone;

        return {
            cmn: () => {
                this.eventEmitter.next({
                    event: 'make-call',
                    data: data.name,
                    phone: phoneNumber
                });
            }
        };
    }
}

const internetcardnewcomponents = $('.internet-card-new-container');

internetcardnewcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const componentData = {
        path: component.data('path')
    };

    new InternetCardNewComponent($('#' + id), componentData);
});
class InternetCardComponent {
    constructor(component, componentData) {
        this.component = component;
        this.componentData = componentData;

        if (componentData !== null) {
            this.getDataSingleCard();
        }
    }

    getDataSingleCard() {
        let path = this.componentData.path;
        if (path) {
            GlobalData.getMultipleData([
                { path: path }
            ]).subscribe(
                (result) => {
                    try {
                        const cardData = result[0][0];
                        if (cardData) {
                            this.singleInternetCardFillData(cardData);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                },
                (error) => {
                    console.log(error);
                }
            );
        }
    }

    savePlanNam(planName) {
        console.log(planName);
        const planField = document.getElementById("cta-plan-name");
        planField.setAttribute("value", planName);
    }

    singleInternetCardFillData(data) {
        this.component.addClass('ant-container');
        this.component.addClass('ant-level1');
        this.component.attr("product-cardtype", data.cardtype);
        this.component.attr("product-clienttype", data.clienttype);
        //Valor agregado para colmbia por regulacion
        //Validar valor DMM-16983
        this.component.attr("dane", data.dane || "00000")
        if (data.clienttype === 'postpaid') this.component.addClass('pospago');
        if (data.clienttype === 'prepaid') {
            this.component.attr("duracion", "30 das");
        }
        this.component.attr("titulo", data.title || "TV + Internet")
        if(typeof data.estrato === 'object') this.component.attr("estrato", (data.estrato.map((i)=>i.id)).join(',') || "")
        else this.component.attr("estrato", "")
        this.component.attr("valor-numerico", data.valorNumerico || "0")

        const featsBulletArray = data.featuresbullet.split('--');
        const descriptionArray = data.description.split('--');

        let featsBullet = '<ul class="internet-list">';
        let description = '<ul class="internet-list">';

        $.each(featsBulletArray, function(i, v) {
            featsBullet = `${featsBullet}<li class="truncate">${v}</li>`;
        });
        featsBullet = `${featsBullet}</ul>`;

        $.each(descriptionArray, function(i, v) {
            description = `${description}<li class="truncate">${v}</li>`;
        });
        description = `${description}</ul>`;

        const template = `
			<div class="highlight">
				{{#ifCond highlight '!=' ""}}
					<div class="shape"></div>
				{{/ifCond}}
				<p {{#ifCond highlight '==' ""}}style="background-color:transparent"{{/ifCond}}>{{highlight}}</p>
			</div>
			<div class="internet-card-wrapper {{theme}} internet" tecnologia="114">
				<div class="card-content">
					<div {{#ifCond highlight '!=' ""}}style="border-top-right-radius: 0"{{/ifCond}} class="header">
						<div class="title ant-value">
							{{name}}                            
							<div class="velocidad-bajada hide">
                                {{#ifCond velBajada '!=' ''}}
                                    {{velBajada}}
                                {{else}}
                                    #####
                                {{/ifCond}}
                            </div>
							<div class="velocidad-subida hide">
                            {{#ifCond velSubida '!=' ''}}
                                {{velSubida}}
                            {{else}}
                                #####
                            {{/ifCond}}
                            </div>
							<div class="badget">{{badget}}</div>
						</div>
						<img src="{{icon}}" alt="{{name}}">
                        <div class="titulo" style="display:none">{{#ternary data.title data.title 'TV + internet'}}{{/ternary}}</div>
					</div>
					<div class="body">
						<div class="body-top">
							{{#ifCond subtitle '!=' ""}}
								<div class="subtitle">{{subtitle}}</div>
							{{/ifCond}}
							${description}
						</div>
						<div style="background-color:{{separatorcolor}};" class="separator"></div>
						<div class="body-bottom">
							${featsBullet}
							<ul class="features">
								{{#each features}}
									<li {{#ternary offer 'style="color:${data.offercolor}"' ''}}{{/ternary}} class="truncate{{#ternary offer ' offer ant-offer-container' ''}}{{/ternary}}">{{description}}</li>
								{{/each}}
							</ul>
						</div>
					</div>
				</div>
				<div class="footer {{theme}}">
					<div class="acquisition-dropdown-container"></div>
				</div>
			</div>
		`;
        this.component.html(Handlebars.compile(template)(data));

        data.landing = false;
        data.level = 2;
        data.type = data.clienttype;

        new AcquisitionDropdown(this.component.find('.acquisition-dropdown-container'), data, this.loadCTA(data));

        this.component.find('.footer\x20.btn-select').on('click', (e) => {
            this.savePlanNam(data.name);
        });
    }

    loadCTA(data) {
        const mainContactPhone = (window.localStorage && window.localStorage.getItem('defaultPhone')) || '';
        const phoneNumber = mainContactPhone;

        return {
            cmn: () => {
                this.eventEmitter.next({
                    event: 'make-call',
                    data: data.name,
                    phone: phoneNumber
                });
            }
        };
    }
}

const internetcardcomponents = $('.internet-card-container');
internetcardcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const componentData = {
        path: component.data('path')
    };

    new InternetCardComponent($('#' + id), componentData);
});
class GenericTabsComponent {
    constructor(idgen, idComponent) {
        if (idComponent !== null) {
            this.id = idComponent;
            this.bodyComponent = $('#tabbar-body-' + this.id);
            this.extern = true;
        } else {
            this.id = idgen;
            this.extern = false;
        }
        $('#tabbar').attr('id', 'tabbar-' + this.id);
        this.component = $('#tabbar-' + this.id);

        this.eventsComponent();
    }

    eventsComponent() {
        this.component.find('.generictabs-nav ul li').on('click', (e) => {
            let tabId = e.target.id;

            this.component.find('#' + tabId).addClass('active').siblings().removeClass('active');
            this.bodyComponent.find('.tabbar-body').hide();
            this.bodyComponent.find('#' + tabId + '-content').fadeIn(1000);

            let tabSel = [].slice.call(document.querySelectorAll(this.component.find('.generictabs-nav ul li').selector), 0).indexOf(e.target);
            let size = $('#' + tabId).width();

            let scroll = tabSel * size;

            this.component.find('.generictabs-nav').animate({
                scrollLeft: scroll - (size / 4)
            }, 'slow');
        });
    }
}
const InstallAndActivateTabsComponent = (function () {
    const defaults = {};

    return class {
        constructor(options) {
            this.id = options.id;
            this.component = document.getElementById(this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent(this.endPoint);
        }

        initComponent() {

        }
    };
})();

const iaatcomponents = $('.iaat');
iaatcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const mode = component.data('mode');
    GeneralComponentContainer.setComponent(new GenericTabsComponent(null, id),id);
    GeneralComponentContainer.setComponent(new InstallAndActivateTabsComponent({id, mode}), id);
});
const InformationLinks = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };
    
    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
        }
    };
})();

$('.information-links').each(function () {
    let idgen = $(this).data('idgen');
    
    GeneralComponentContainer.setComponent(new InformationLinks(idgen), idgen);
});
CollapsibleComponent = (function () {
    const defaults = {
        "selectors": {
            "collapsible": ".collapsible"
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {
            const coll = this.component.find(defaults.selectors.collapsible);

            for (let i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", (element) => {
                    element.currentTarget.classList.toggle("active");
                    const content = element.currentTarget.nextElementSibling;

                    if (content.style.display === "block") {
                        content.style.display = "none";
                    } else {
                        content.style.display = "block";
                    }
                });
            }
        }
    };
})();

const HowToRechargeTable = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initComponent() {

        }
    };
})();

const howtorechargecomponents = $('.howtorecharge');
howtorechargecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    GeneralComponentContainer.setComponent(new CollapsibleComponent(id), id);
    GeneralComponentContainer.setComponent(new HowToRechargeTable(id), id);
});

let cardClient = document.querySelectorAll(".recharge-third-column");
for (let i=0; i<cardClient.length; i++) {
    console.log(cardClient[i].innerText)
    if(cardClient[i].innerText.length === 0){
        $(".recharge_container-row-columns").width('50%');
        $(cardClient[i]).remove();
    }
}
const HomeOttFeaturedProduct = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initComponent() {

        }
    };
})();

const hofpcomponents = $('.dtv-hofp-section');
hofpcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const options = {};
    GeneralComponentContainer.setComponent(new HomeOttFeaturedProduct(id, options), id);
});
const HomeOfferLaneNew = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };
    
    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
        }
    };
})();

$('.dtv-holnew').each(function () {
    let idgen = $(this).data('idgen');
    
    GeneralComponentContainer.setComponent(new HomeOfferLaneNew(idgen), idgen);
});
const HomeOfferLane = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {},
        "attributes": {},
        "events": {}
    };
    
    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
        }
    };
})();

$('.dtv-hol').each(function () {
    let idgen = $(this).data('idgen');
    
    GeneralComponentContainer.setComponent(new HomeOfferLane(idgen), idgen);
});
/* eslint-disable no-unused-vars */

/* Sliders transitions definition file */
const transitionEntry = {
    initialState: [
    {
        class: '.subtitle',
        styles: { 'transform': 'translateX(-27%)', 'opacity': 0 }
    },
    {
        class: '.title',
        styles: { 'transform': 'translateX(-36%)', 'opacity': 0 }
    },
    {
        class: '.description',
        styles: { 'transform': 'translateX(-46%)', 'opacity': 0 }
    },
    {
        class: '.icons',
        styles: { 'transform': 'translateX(-57%)', 'opacity': 0 }
    },
    // icons individually
    {
        class: '.icons img:first-child',
        styles: { 'transform': 'translateX(-228%)' }
    },
    {
        class: '.icons img:nth-child(2)',
        styles: { 'transform': 'translateX(-240%)' }
    },
    {
        class: '.icons img:nth-child(3)',
        styles: { 'transform': 'translateX(-252%)' }
    },
    {
        class: '.icons img:nth-child(4)',
        styles: { 'transform': 'translateX(-263%)' }
    },
    // Divider
    {
        class: '.content-divider-container',
        styles: { 'opacity': 0 }
    },
    // right side
    {
        class: '.promotion-tag',
        styles: { 'transform': 'translateX(62%)', 'opacity': 0 }
    },
    {
        class: '.price-container',
        styles: { 'transform': 'translateX(57%)', 'opacity': 0 }
    },
    {
        class: '.buttons',
        styles: { 'transform': 'translateX(40%)', 'opacity': 0 }
    },
    {
        class: '.disclaimer',
        styles: { 'transform': 'translateX(57%)', 'opacity': 0 }
    }],
    finalState: [
    {
        class: '.subtitle',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 80
    },
    {
        class: '.title',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 80
    },
    {
        class: '.description',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 100
    },
    {
        class: '.icons',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 170
    },
    // icons individually
    {
        class: '.icons img:first-child',
        styles: { 'transform': 'translateX(0%)' },
        speed: 400
    },
    {
        class: '.icons img:nth-child(2)',
        styles: { 'transform': 'translateX(0%)' },
        speed: 500
    },
    {
        class: '.icons img:nth-child(3)',
        styles: { 'transform': 'translateX(0%)' },
        speed: 600
    },
    {
        class: '.icons img:nth-child(4)',
        styles: { 'transform': 'translateX(0%)' },
        speed: 800
    },
    // Divider
    {
        class: '.content-divider-container',
        styles: { 'opacity': 1 },
        speed: 1000
    },
    // right side
    {
        class: '.promotion-tag',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 80
    },
    {
        class: '.price-container',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 80
    },
    {
        class: '.buttons',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 100
    },
    {
        class: '.disclaimer',
        styles: { 'transform': 'translateX(0%)', 'opacity': 1 },
        speed: 800,
        delay: 170
    }]};

const transitionExit = {
    finalState: [
        {
            class: '.subtitle',
            styles: { 'transform': 'translateX(62%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic',
            delay: 200
        },
        {
            class: '.title',
            styles: { 'transform': 'translateX(57%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic',
            delay: 150
        },
        {
            class: '.description',
            styles: { 'transform': 'translateX(60%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic',
            delay: 100
        },
        {
            class: '.icons',
            styles: { 'transform': 'translateX(57%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic',
            delay: 100
        },
        // Divider
        {
            class: '.content-divider-container',
            styles: { 'opacity': 0 }
        },
        // right side
        {
            class: '.promotion-tag',
            styles: { 'transform': 'translateX(62%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic'
        },
        {
            class: '.price-container',
            styles: { 'transform': 'translateX(57%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic'
        },
        {
            class: '.buttons',
            styles: { 'transform': 'translateX(40%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic'
        },
        {
            class: '.disclaimer',
            styles: { 'transform': 'translateX(57%)', 'opacity': 0 },
            speed: 300,
            easing: 'easeInCubic'
        }
    ]
};

/* eslint-disable no-undef */
/* eslint-disable no-unused-vars */

/* Sliders texts animation management */

const textContainerClassNamev2='.text-container.section-slide-';
const mobileContainerv2 = $('.hero-multimedia-content-v2 .text-container, .hero-multimedia-content-v2 .blur-container');
const slider$v2 = $('.hero-multimedia-content-v2 .mySlider');
let mouseXv2 = null;
let mouseInitialXv2 = null;

function throwError() {
    throw new Error('Missing animation parameters');
}

function textTransitionAnimationv2(animation, currentSlideIndex, animsFinishedv2) {
    let animsFinishedv2Counter=0;
    const textContainer = `${textContainerClassNamev2}${currentSlideIndex}`;

    function finishAnimationv2() {
        animsFinishedv2Counter += 1;

        if ((animsFinishedv2Counter == animation.finalState.length) && (typeof animsFinishedv2 !== 'undefined')) {
            animsFinishedv2(currentSlideIndex);
        }
    }

    $(textContainer).css({ display: 'flex' });
    $(textContainer).addClass('active');    

    if (animation.initialState) {
        animation.initialState.forEach((element) => {
            $(`${textContainer} ${element.class}`).css(element.styles);
        });
    }

    let animationElement$;

    animation.finalState.forEach((anim) => {
        animationElement$ = $(`${textContainer} ${anim.class}`);

        if (animationElement$.length == 0) {
            finishAnimationv2();
        } 
        else if (anim.delay) {
            setTimeout(()=>{
                $(`${textContainer} ${anim.class}`).css('transform', anim.styles['transform']);
                $(`${textContainer} ${anim.class}`).css('opacity', anim.styles['opacity']);
                finishAnimationv2();
            }, anim.delay);
        } 
        else {
            $(`${textContainer} ${anim.class}`).css('transform', anim.styles['transform']);
            $(`${textContainer} ${anim.class}`).css('opacity', anim.styles['opacity']);
            finishAnimationv2();
        }
    });    
}

function textsTransitionEntryv2(currentSlideIndex, finished) {
    textTransitionAnimationv2(transitionEntry, currentSlideIndex, function() {
        if (finished) {
            finished();
        }
    });
}

function textsTransitionExitv2(currentSlideIndex, finished) {
    textTransitionAnimationv2(transitionExit, currentSlideIndex, function(slideIndex) {
        $(textContainerClassNamev2 + slideIndex).css({ display: 'none' });
        $(textContainerClassNamev2 + slideIndex).removeClass('active');

        if (finished) {
            finished();
        }
    });    
}

/* Manage the sliders change for mobile */
mobileContainerv2.on('touchstart', function(event) {
    updateTouchEventv2('touchstart', event.originalEvent.touches[0].clientX);
}).on('touchmove', function(event) {
    updateTouchEventv2('touchmove', event.originalEvent.touches[0].clientX);
}).on('touchend', function(event) {
    updateTouchEventv2('touchend');
});

function updateTouchEventv2(eventName, mousePos) {
    const lastPosition = mouseInitialXv2 - mouseXv2;

    switch (eventName) {
        case 'touchstart':
            mouseXv2 = mousePos;
            mouseInitialXv2 = mousePos;
            break;
        case 'touchmove':
            mouseXv2 = mousePos;
            break;
        case 'touchend':
            if (Math.abs(lastPosition) > 15) {
                if (lastPosition < 0) {
                    slider$v2.slick('slickNext');
                } else {
                    slider$v2.slick('slickPrev');
                }
            }

            break;
        default:
            break;
    }
}

const finalButtonPositionjs = '50px';
const slidesSpeedjs         = '400ms';
const $heroArea             = $('.hero-multimedia-content-v2');
const $textArea             = $('.hero-multimedia-content-v2 .text-container');
const $sliderElm            = $('.mySlider');
let viewportMobile          = window.matchMedia("(max-width: 480px)").matches;
let checkDots               = ($sliderElm.length > 0 ? ($sliderElm[0].getAttribute('bullets') === 'true') : false);
let buttonActiveContainer;
let buttonActive;

function startVideov2(slideIndex) {
    const vid = $('div[data-slick-index=' + slideIndex + '] video');
    const vidEmbed = $('div[data-slick-index=' + slideIndex + '] embed');

    if (vid.length && vid.length > 0) {
        for (let index = 0; index < vid.length; index++) {
            const element = vid[index];

            element.pause();
            element.currentTime = 0;
            element.load();
        }
    }
}

function addTransitionSliderDotv2() {
    if (buttonActiveContainer) {
        buttonActiveContainer.removeChild(buttonActive);
        buttonActive = null;
        buttonActiveContainer = null;
    }

    buttonActiveContainer = document.querySelector('.hero-multimedia-content-v2\x20.mySlider\x20.slick-dots\x20.slick-active');
    buttonActiveContainer = document.querySelector('.hero-multimedia-content-v2\x20.slider-container\x20.slick-dots\x20.slick-active');

    if (buttonActiveContainer) {
        buttonActive = document.createElement("BUTTON");
        buttonActive.id = "buttonTransition";
        buttonActive.classList.add('active-button');
        buttonActiveContainer.appendChild(buttonActive);
    }
}

function transitionDotv2(leftToRight) {
    const pagerWidth = parseInt(finalButtonPositionjs);
    const $activeButton = $(".hero-multimedia-content-v2\x20.mySlider\x20.slick-dots\x20.active-button");

    if (leftToRight == true) {
        $activeButton.animate({
            left: "+=" + 5,
            width: 20 + "px"
        }, 20);

        setTimeout(function () {
            $activeButton.animate({
                width: "40px"
            }, {
                queue: false,
                duration: parseInt(slidesSpeedjs) + 200,
                easing: 'easeInCubic'
            });
            $activeButton.animate({
                left: "+=" + 35
            }, {
                queue: false,
                duration: parseInt(slidesSpeedjs) + 600
            });            
        }, 50);
    } else {
        $activeButton.animate({
            left: "+=" + 5,
            width: 20 + "px"
        }, 20);

        setTimeout(function () {
            $activeButton.animate({
                width: "40px"
            }, {
                queue: false,
                duration: parseInt(slidesSpeedjs) + 200,
                easing: 'easeInCubic'
            });
            $activeButton.animate({
                left: "-=" + 45
            }, {
                queue: false,
                duration: parseInt(slidesSpeedjs) + 600
            });
        }, 50);
    }
}


function setDotsHero() {
    
    let dotsSelector   = $('.hero-multimedia-content-v2 .slick-dots');    
    if(viewportMobile){
        !checkDots ? dotsSelector.show() : dotsSelector.hide();
    }
}

$('.request').click(function () {
    window.open($(this).data("actionUrl"), $(this).data("actionTarget") ? $(this).data("actionTarget") : "_self");
});

$('.knowmore').click(function () {
    window.open($(this).data("actionUrl"), $(this).data("actionTarget") ? $(this).data("actionTarget") : "_self");
});

if ($('.mySlider').length) {
    
    $('.mySlider').on('init', function (slick) {
        addTransitionSliderDotv2();
        textsTransitionEntryv2(0);
        startVideov2(0); 
        setDotsHero();
    });


    $('.mySlider').each((index, element) => {
        var slider = $(element);
        var autoplay = element.getAttribute('autoplay') === 'true';

        slider.slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            centermode: true,
            centerPadding: '60px',
            autoplay: autoplay,
            infinite: true,
            autoPlaySpeed: 4000, // Speed before start every slide
            speed: parseInt(slidesSpeedjs, 10), // Speed of transition on every slide
            fade: true,
            useCustomTransition: true,
            arrows: true,
            dots: true
            // responsive: [
            //     {
            //         breakpoint: 481,
            //         settings: {
            //             appendDots: '.slider-container .slider-container--dotsContainer'
            //         }
            //     }
            // ]
        });
    });    

    $('.mySlider').on('beforeChange', function (event, slick, currentSlide, nextSlide) {
        startVideov2(nextSlide);
        $('.hero-multimedia-content-v2 .mySlider .slick-dots button').attr("disabled", "disabled");

        textsTransitionExitv2(currentSlide, function () {
            setTimeout(function () {
                textsTransitionEntryv2(nextSlide, function () {
                    $('.hero-multimedia-content-v2 .mySlider .slick-dots button').removeAttr("disabled");
                });
            });
        });


        const ltr = nextSlide > currentSlide;

        if (nextSlide == currentSlide + 1 || nextSlide == currentSlide - 1) {
            transitionDotv2(ltr);
        } else {
            setTimeout(function () {
                addTransitionSliderDotv2();
            }, 1);
        }
    });

    function setHeightArea() {
        let currentHeight = (39 * 450) / 100;
        let contentH = $('.hero-multimedia-content-v2 .text-container.active').height();
        let arrowsH = 40;
        let bulletsH = !checkDots ? 19 : 0;
        let totalH = (currentHeight + contentH + arrowsH + bulletsH);
        checkDots && $textArea.css('padding-bottom', '0px');
        $heroArea.css('height', `${Math.round(totalH)}px`);
        
    }

    // call init slider
    viewportMobile && setHeightArea();

    $('.mySlider').on('afterChange', () => {
        if(viewportMobile){
            $heroArea.removeAttr("style");
            setHeightArea();
        }
    });


    $('.hero-multimedia-content-v2 .arrows-container .prev-arrow').click(() => {
        $('.mySlider').slick('slickPrev');
    });

    $('.hero-multimedia-content-v2 .arrows-container .next-arrow').click(() => {
        $('.mySlider').slick('slickNext');
    });

}


const TEXTCONTAINERCLASSNAME='.textContainer.section-slide-';

function throwError() {
    throw new Error('Missing animation parameters');
}

function textTransitionAnimation(options = throwError(), currentSlideIndex, animsFinished) {
    const style = options.style;
    const speed = options.speed;
    const subtitleDelay = options.subtitleDelay;
    const descriptionDelay = options.descriptionDelay;
    const buttonsDelay = options.buttonsDelay;
    const easing = options.easing || 'easeOutCubic';
    let animsFinishedCounter=0;

    const animations=[{ class: '.subtitle' }, { class: '.title', delay: subtitleDelay }, { class: '.description', delay: descriptionDelay }, { class: '.buttons', delay: buttonsDelay }];

    const textContainer = `${TEXTCONTAINERCLASSNAME}${currentSlideIndex}`;

    function finishAnimation() {
        animsFinishedCounter += 1;

        if ((animsFinishedCounter == 4) && (typeof animsFinished !== 'undefined')) {
            animsFinished(currentSlideIndex);
        }
    }

    $(textContainer).css({ display: 'flex' });
    animations.forEach((animation) =>{
        if (animation.delay) {
            setTimeout(()=>{
                $(`${textContainer}\x20${animation.class}`).animate(style, {
                    duration: speed,
                    easing: easing,
                    complete: finishAnimation
                });
            }, animation.delay);
        } else {
            $(`${textContainer}\x20${animation.class}`).animate(style, {
                duration: speed,
                easing: easing,
                complete: finishAnimation
            });
        }
    });
}

function textsTransitionEntry(currentSlideIndex, finished) {
    textTransitionAnimation( {
        style: { "opacity": "1", "left": "0" },
        speed: 1000,
        subtitleDelay: 80,
        descriptionDelay: 100,
        buttonsDelay: 170,
        easing: 'easeOutCubic'
    }, currentSlideIndex, function() {
        if (finished) finished();
    });
}

function textsTransitionExit(currentSlideIndex, finished) {
    textTransitionAnimation({
        style: { "left": "200%" },
        speed: 240,
        subtitleDelay: 80,
        descriptionDelay: 100,
        buttonsDelay: 170,
        easing: 'easeInCubic'
    }, currentSlideIndex,
    function(slideIndex) {
        $(TEXTCONTAINERCLASSNAME + slideIndex).css({ display: 'none' });

        if (finished) {
            finished();
        }
    });
}
(function() {

    function openChat(val) {
        const request = $(val).data("actionUrl");
        setChat(request);
    }

    function setChat(val) {
        const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
        const chat_url = '/prev-chat.html' + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
        window.open(chat_url, "Chat", "width=450,height=450");
    }

    function callWatson(e) {
        e.preventDefault();
        if ($('.watson-container').length > 0) {
            $('.watson-container').removeClass('hidden');
            $('.watson-container .chat .card').removeClass('no-display');
        }
    }


    // Events Buttoms
    $('.request-hero').click(function(e) {
        if ($(this).hasClass('request-watson-btn')) {
            callWatson(e);
        } else {
            if ($(this).hasClass('request-chat-btn')) {
                e.preventDefault();
                openChat(this)
            } else {
                window.open($(this).data("actionUrl"), $(this).data("actionTarget") ? $(this).data("actionTarget") : "_self");
            }
        }
    });

    $('.request-knowmore').click(function(e) {
        if ($(this).hasClass('knowmore-watson-btn')) {
            callWatson(e);
        } else {
            if ($(this).hasClass('knowmore-chat-btn')) {
                e.preventDefault();
                openChat(this)
            } else {
                window.open($(this).data("actionUrl"), $(this).data("actionTarget") ? $(this).data("actionTarget") : "_self");
            }
        }
    });

})();

const HeroMultimediaContent = (function() {
    const defaults = {
        "selectors": {
            "phone": ".oph_phone_anchor .phone-text .phone",
            "heroDiv": ".hero-multimedia-content .sliderContainer",
            "dootsDiv": ".hero-multimedia-content .heroSlider",
            "phoneLink": ".oph_phone_anchor",
            "ophCont": ".oph_container",
            "phoneContainer": ".oph_phones--phone",
            "header": "header"
        },
        "classes": {
            "voidCalling": "void_calling",
            "sticky": "sticky_phone"
        },
        "events": {
            "click": "click",
            "scroll": "scroll",
            "resize": "resize"
        },
        "endPoints": {
            "allMedia": "/bin/public-sites/mock/allmedia"
        }
    };

    return class {
        constructor(options) {
            this.id = options.id;
            this.component = document.getElementById(this.id);
            this.phoneState = options.phoneState;
            this.country = options.country;
            this.language = options.language;
            this.showPhone = options.showPhone;
            this.phoneSticky = options.phoneSticky;
            this.elements = {
                "phoneContainer": document.querySelector(defaults.selectors.phoneContainer),
                "phone": document.querySelector(defaults.selectors.phone),
                "phoneLink": document.querySelector(defaults.selectors.phoneLink),
                "ophCont": document.querySelector(defaults.selectors.ophCont)
            };
            this.heroSelector = document.querySelector(defaults.selectors.heroDiv);
            this.isdots = $(defaults.selectors.dootsDiv);
            this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector(defaults.selectors.header).getAttribute("id"));
            this.helpers = new HeaderHelpers();
            this.isMobile = this.helpers.isMobile();
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initEventListeners() {
            this.elements.phone.addEventListener(defaults.events.click, (evt) => {
                if (this.elements.phone.classList.contains(defaults.classes.voidCalling)) {
                    evt.preventDefault();
                }
            });
        }

        async getPhone() {
            this.headerComponent.eventEmitter.subscribe((action) => {
                action.event == 'phoneUpdated' && this.renderPhone(window.localStorage.getItem('defaultPhone'));
            });
        }

        renderPhone(thePhone) {
            $('.oph_phone_anchor').each(function() {
                $(this).attr('href', 'tel: ' + thePhone);
                $(this).children('.phone-text').children('.phone').html(thePhone);
            });

            document.addEventListener(defaults.events.scroll, (evt) => {
                this.onScroll();
            });

            this.initEventListeners();
        }

        onScroll() {
            if (
                this.isMobile &&
                this.phoneSticky &&
                window.innerWidth < 768) {
                const st = window.pageYOffset || document.documentElement.scrollTop;
                const phoneHeight = this.elements.phone.offsetHeight;
                var $this = this;

                $('.oph_phones--phone').each(function() {
                    var x = $(this).offset();
                    if ($(this).is(":visible")) {
                        $(this).offset({ top: 300, left: x.left });
                        if (this.offsetTop - st <= 8) {
                            if (!$(this).children('a').hasClass(defaults.classes.sticky)) {
                                $(this).children('a').addClass(defaults.classes.sticky);
                            }
                            $(this).css('height', phoneHeight);
                        } else {
                            $(this).offset({ top: x.top, left: x.left });
                            $(this).children('a').removeClass(defaults.classes.sticky);
                            $(this).css('height', '');
                        }
                    }
                })
            }
        }

        setDots() {
            let viewportMobile = window.matchMedia("(max-width: 480px)").matches;
            let checkDots = (this.isdots.length > 0 ? (this.isdots[0].getAttribute('bullets') === 'true') : false);
            let dotsSelector = $('.dots-container');

            if (viewportMobile) {
                !checkDots ? dotsSelector.show() : dotsSelector.hide();
            }
        }

        initComponent() {
            this.setDots();
            this.showPhone && this.getPhone();
        }
    };
})();

const oph2componentes = $('.oph');
oph2componentes.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const country = component.data('country');
    const language = component.data('language');
    const showPhone = component.data('showphone') === "yes";
    const phoneSticky = component.data('phonesticky') === "yes";
    const phoneState = component.data('phonestate');
    const mode = component.data('mode');
    GeneralComponentContainer.setComponent(new HeroMultimediaContent({ id, mode, phoneState, country, language, showPhone, phoneSticky }), id);
});
$(document).ready(function() {
    const finalButtonPositionjs = '50px';
    const slidesSpeedjs = '400ms';
    const dotsSizejs = '10px';
    const $dotsContent = $('.dots-content');
    let $slickArrows;
    let $slickButtons;
    const limitDots = 5;

    let buttonActiveContainer;
    let buttonActive;
    let monoSlider = false;
    let $dotsContainer;
    let minLimit = 0;    
    const maxLimit = limitDots - 1;

    function startVideo(slideIndex) {
        const vid = $('div[data-slick-index=' + slideIndex+ '] video');
        const vidEmbed = $('div[data-slick-index=' + slideIndex + '] embed');

        if (vid.length && vid.length > 0) {
            for (let index = 0; index < vid.length; index++) {
                const element = vid[index];

                element.pause();
                element.currentTime = 0;
                element.load();
            }
        }
    }

    function addTransitionSliderDot() {
        if (buttonActiveContainer) {
            buttonActiveContainer.removeChild(buttonActive);
            buttonActive = null;
            buttonActiveContainer = null;
        }

        buttonActiveContainer = document.querySelector('.hero-multimedia-content\x20.slick-dots\x20.slick-active');
        buttonActive = document.createElement("BUTTON");
        buttonActive.id ="buttonTransition";
        buttonActive.classList.add('active-button');
        buttonActiveContainer.appendChild(buttonActive);
        
    }

    function transitionDot(leftToRight) {
        const pagerWidth = parseInt(finalButtonPositionjs);

        if (leftToRight==true) {
            $(".active-button").animate({
                left: "+=" + 5,
                width: 20 + "px"
            }, 20);

            setTimeout(function() {
                $(".active-button").animate({
                    width: "40px" // pagerWidth
                }, {
                    queue: false,
                    duration: parseInt(slidesSpeedjs)+200,
                    easing: 'easeInCubic'
                });
                $(".active-button").animate({
                    left: "+=" + 35
                }, {
                    queue: false,
                    duration: parseInt(slidesSpeedjs) + 600
                });
            }, 50);
        } else {
            $(".active-button").animate({
                left: "+=" + 5,
                width: 20 + "px"
            }, 20);

            setTimeout(function() {
                $(".active-button").animate({
                    width: "40px" // pagerWidth
                }, {
                    queue: false,
                    duration: parseInt(slidesSpeedjs)+200,
                    easing: 'easeInCubic'
                });
                $(".active-button").animate({
                    left: "-=" + 45
                }, {
                    queue: false,
                    duration: parseInt(slidesSpeedjs) + 600
                });
            }, 50);
        }
    }

    function transitionDotsContainer(ltr, currentSlide, nextSlide, calcPos) {
        if (nextSlide === 0) {
            $dotsContainer.animate({
                translate: 0
            }, 600);
        } else if (ltr) {
            if (nextSlide > maxLimit) {
                minLimit = nextSlide - maxLimit;
                $dotsContainer.animate({
                    translate: (nextSlide - maxLimit) * (-40)
                }, 600);
            }
        } else if (nextSlide < minLimit) {
            $dotsContainer.animate({
                translate: (nextSlide) * (-40)
            }, 600);
        }
    }


    $('.hero-multimedia-content .heroSlider').on('init', function(event, slick) {

        monoSlider = slick.slideCount === 1;
        textsTransitionEntry(0);
        startVideo(0);

        if (monoSlider) {
            slick.slickSetOption('arrows', false);
            slick.slickSetOption('dots', false);
        } else {
            addTransitionSliderDot();
            $dotsContainer = $('.dots-container .dots-content .slick-dots');
            $dotsContent.css({ width: limitDots * 40 });
            $slickArrows = $('.hero-multimedia-content .heroSlider .slick-arrow');
            $slickButtons = $('.hero-multimedia-content .slick-dots button');
        }
    });

    const $heroSlider = $('.hero-multimedia-content .heroSlider');
    var autoplay = $heroSlider.length > 0 ? $heroSlider[0].getAttribute('autoplay') === 'true' : false;

        $heroSlider.slick({
        dots: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        centermode: true,
        centerPadding: '60px',
        autoplay: autoplay,
        infinite: true,
        autoPlaySpeed: 4000, // Speed before start every slide
        speed: parseInt(slidesSpeedjs, 10), // Speed of transition on every slide
        fade: true,
        useCustomTransition: true,
        prevArrow: '<div class="PrevArrow"><div class="oval"><div class="arrow"><</div></div></div>',
        nextArrow: '<div class="NextArrow"><div class="oval"><div class="arrow">></div></div></div>',
        appendDots: '.dots-content'
    });
    
    $heroSlider.on('beforeChange', function(event, slick, currentSlide, nextSlide) {
        startVideo(nextSlide);

        if (!monoSlider) {
            $slickArrows.css("visibility", "hidden");
            $slickButtons.attr("disabled", "diabled");
        }

        textsTransitionExit(currentSlide, function() {
            setTimeout(function() {
                textsTransitionEntry(nextSlide, function() {
                    if (!monoSlider) {
                        $slickArrows.css("visibility", "visible");
                        $slickButtons.removeAttr("disabled");
                    }
                });
            });
        });

        if (!monoSlider) {
            const ltr= nextSlide > currentSlide;

            if (nextSlide == currentSlide + 1 || nextSlide == currentSlide - 1) {
                transitionDot(ltr);
                transitionDotsContainer(ltr, currentSlide, nextSlide, false);
            } else {
                setTimeout(function() {
                    addTransitionSliderDot();
                    transitionDotsContainer(ltr, currentSlide, nextSlide, false);
                }, 1);
            }
        }
    });
});

$('.hero-banner-container .hero-banner-cards .slider')
    .slick({
        centerMode: false,
        slidesToShow: 3,
        draggable: false,
        arrows: false,
        infinite: false,
        responsive: [
            {
                breakpoint: 1024,
                settings: {
                    slidesToShow: 1,
                    draggable: true,
                    dots: true
                }
            }
        ]
    });
const greysform = (function() {

    const messages = {
        'EMAIL'     : 'Escriba su email para poder notificarle si gana la trivia',
        'TERMINOS'  : 'Debe aceptar las bases y condiciones',
        'CAPTCHA' 	: 'Cdigo de validacin incorrecto'
    }

    return class {

        constructor(element, socialmediapage, thankyoupage, data) {
            this.data = data;

            this.element = element;
            
            this.country = countryPS;

            this.questions = [];

            this.form = [];

            this.socialmediapage = socialmediapage;

            this.thankyoupage = thankyoupage;

            this.sendingForm = true;

            this.emailfield = document.querySelector('.greys-container .emailuser');

            this.showMediaButtons = true;

            this.recaptcha  = this.element.querySelector('.recaptcha-field');

            this.initComponent();
        }

        initComponent() {
            let $this = this;

            this.questions = [{
                    country: 'AR',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                },
                {
                    country: 'UY',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                },
                {
                    country: 'CL',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                },
                {
                    country: 'EC',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                },
                {
                    country: 'CO',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                },
                {
                    country: 'PE',
                    questions: [{
                            id: 1,
                            text: "Qu temtica trata la nueva temporada de Greys Anatomy?",
                            type: "multiple_choice",
                            answers: ["Crisis Poltica", "Pandemia", "Crisis amorosa", "Crisis econmica"]
                        },
                        {
                            id: 2,
                            text: "Construye una historia para el final ideal de la temporada 17 de Greys Anatomy. <br><br>Debes tener en cuenta las siguientes cartactersticas:",
                            type: "text",
                            answers: ["Involucrar mnimo 2 personajes y mximo 3 de la temporada # 17.", "Contar la historia de manera coherente en un mnimo de 300 caracteres y  no superar los 400 caracteres.", "Involucrar las palabras HOSPITAL, DOCTOR y AMOR con un mximo de una (1) vez, de manera coherente en la historia contada.", "Publicar tu respuesta en redes sociales (Facebook o Twitter) con el hashtag #GREYSANATOMYENSONY."]
                        }
                    ]
                }

            ];

            this.emailfield.addEventListener('keyup', function() {
                $this.validate(this);
            });

            this.displayQuestions();
        }

        displayQuestions() {
            let form = this.element.getElementsByClassName("questions-container")[0];
            this.questions.forEach(question => {
                if (question.country.toLowerCase() == this.country.toLowerCase()) {
                    question.questions.forEach(item => {

                        let q = document.createElement("div");
                        q.innerHTML = item.text;
                        q.classList.add("question-trivia");
                        form.appendChild(q);

                        let a = document.createElement("div");
                        a.classList.add("answer-for-trivia");
                        form.appendChild(a);

                        this.createOptions(item, a);
                    })
                }
            })
        }

        createOptions(q, parent) {
            var $this = this;
            if (q.type === 'text') {
                let ul = document.createElement("ul");
                ul.classList.add("question-hints");
                parent.appendChild(ul);

                let textarea = document.createElement("textarea");
                textarea.classList.add('question-textarea');
                parent.appendChild(textarea);

                let twitterMessage = document.createElement('div');
                twitterMessage.classList.add('question-textarea-twtmesage');
                parent.appendChild(twitterMessage);

                let facebookMessage = document.createElement('div');
                facebookMessage.classList.add('question-textarea-facemesage');
                parent.appendChild(facebookMessage);                

                let counter = document.createElement('p');
                counter.classList.add('question-textarea-counter');
                parent.appendChild(counter);

                $('.question-textarea-twtmesage').html(`*Para Twitter acorta tu historia a ${200} caracteres.`);

                $('.question-textarea-facemesage').html(`*Para publicar en Facebook debes copiar y pegar tu respuesta.`);
                
                $('.question-textarea-counter').html("Caracteres restantes " + 400);

                $('.question-textarea').attr('name', q.id);

                $('.question-textarea').on('keyup', function() {
                    $this.checkAndReplace(event);
                });
            }
            q.answers.forEach(answer => {

                if (q.type === 'text') {
                    let li = '<li>' + answer + '</li>';
                    $('ul.question-hints').append(li);
                } else {

                    let input = '<div class="special-div-trivia"><input class="trivia-radio-button" type="radio" name="' + q.id + '" value="' + answer + '">' +
                        '<label for="answer">' + answer + '</label></div>';
                    $(parent).append(input);
                }
            });

            $('input[type="radio"].trivia-radio-button').change(function(event) {
                $this.checkAndReplace(event);
            });
        }

        checkAndReplace(e) {
            let id = e.currentTarget['name'];
            let val = e.currentTarget['value'];
            const $this = this;
            const index = this.form.findIndex(x => x['questionNumber'] == parseInt(id));

            if (e.currentTarget == document.getElementsByClassName('question-textarea')[0]) {
                $('.question-textarea-counter').html("Caracteres restantes " + (400 - $('.question-textarea').val().length));
            }


            if (index > -1) {
                this.form.splice(index, 1);
            }
            let question = {
                'questionNumber': parseInt(id),
                'answer': val
            }
            $this.form.push(question);
            let twitterContainer = $('#tw-share-button');
            let fbookContainer = $('#fb-share-button');
            if ($this.form.length == $('.question-trivia').length && $('.question-textarea').val().length >= 200 && $('.question-textarea').val().length <= 400) {
                $('.trivia-button button').prop('disabled', false);
                $('.trivia-button button').removeClass('disabled');

                if ((twitterContainer && twitterContainer != null) && (fbookContainer && fbookContainer != null)) {
                    $this.displayButtons(twitterContainer, fbookContainer)
                }

                document.getElementById('triviaButton-' + $this.element.id).addEventListener('click', function() {
                    $this.sendForm();
                });
            } else {
                $('.trivia-button button').prop('disabled', true);
                $('.trivia-button button').addClass('disabled');
                if (twitterContainer && twitterContainer != null) {
                    $(twitterContainer).empty();
                }
                if (fbookContainer && fbookContainer != null) {
                    $(fbookContainer).empty();
                }
                this.showMediaButtons = true;
            }
        }

        getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        validateEmail(email) {
            const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        }

        validate(str) {
            $('.fieldset .error').remove();
            const email = str.value;

            if (!this.validateEmail(email)) {
                $('.fieldset').append(`<p class="error error-email" style="color:red;font-size: 14px;">${messages.EMAIL}</p>`);
            }
        }

		validateToken(){
			$('.error-recaptcha').remove();
			if(!this.validateRecaptcha()) {
				$('.captcha-wrapper').append(`<p class="error error-recaptcha">${messages.CAPTCHA}</p>`);
			} 	
		}
        
		validateRecaptcha(){
			if(this.data.recaptchaEnabled && siteKey && this.recaptcha.value === 'false'){
				this.recaptcha.classList.add('validation-missing');
			}
			return ((this.data.recaptchaEnabled && this.recaptcha.value === 'true') || !this.data.recaptchaEnabled || !siteKey);
		}        

        sendForm() {
			var captchaRes;
			$('.error').remove();
			this.validateToken();

            if (!$('.input-for-byc-trivia input').prop('checked')) {
                $('.input-for-byc-trivia label').append(`<p class="error" style="color:red;font-size: 14px;">${messages.TERMINOS}</p>`);
                this.validate(this.emailfield);
            } else {
                if (!this.validateEmail(this.emailfield.value)) {
                    $('.fieldset').append(`<p class="error error-email" style="color:red;font-size: 14px;">${messages.EMAIL}</p>`);
                } else {
					if(!this.validateRecaptcha()) {
						this.validateToken();
					} 
                    else {
						if(this.data.recaptchaEnabled){
							captchaRes = sessionStorage.getItem('captchaRes');
						} else {
							captchaRes = sessionStorage.setItem('captchaRes', "");
							captchaRes = '';
						}

                        if (this.sendingForm) {
                            this.sendingForm = false;
                            $('button.disabled').prop('disabled', true);
                            $('button.disabled').addClass('disabled');
                            let trivianatomy = {
                                "triviaId": parseInt(this.element.id),
                                "accountNumber": this.getCookie('SSONumber'),
                                "internetUserName": this.emailfield.value,
                                "answers": this.form,
								"captcha": this.data.recaptchaEnabled,
								"token": captchaRes,
								"pagePath": this.data.currentpage                                
                            }
                            return new Promise(() => {
                                try {
                                    $.ajax({
                                        type: 'POST',
                                        url: '/bin/public-sites/mock/trivia',
                                        contentType: "application/json",
                                        data: JSON.stringify(trivianatomy),
                                        success: (r) => {
                                            if (r.exito) {
                                                this.sendingForm = true;
                                                $('button.disabled').prop('disabled', true);
                                                $('button.disabled').removeClass('disabled');
                                                window.open(this.thankyoupage, '_self');
                                            } else {
                                                this.sendingForm = true;
                                                $('button.disabled').prop('disabled', false);
                                                $('button.disabled').removeClass('disabled');
                                                this.showAlert(r);
                                            }
                                        },
                                        error: (r) => {
                                            //										console.error("ERROR en invocacion", r);
                                            this.sendingForm = true;
                                            $('button.disabled').prop('disabled', false);
                                            $('button.disabled').removeClass('disabled');
                                            this.showAlert(r);
                                        }
    
                                    });
                                } catch (err) {
                                    this.sendingForm = true;
                                    $('button.disabled').prop('disabled', false);
                                    $('button.disabled').removeClass('disabled');
                                    console.error("error al ejecutar AJAX", err);
                                }
                            });
                        }
                    }                    
                }
            }
        }

        showAlert(er) {
            let errorMessage = "";
            if (er.cod == 500) {
                errorMessage = "Hubo un error del servidor. Intente nuevamente."
            } else if (er.cod == 400) {
                errorMessage = "No se pudo realizar el envo. Intente ms tarde."
            } else {
                errorMessage = er.msg;
            }
            $('.actions').append('<p class="error" style="color:red;font-size: 14px;">' + errorMessage + '</p>');
        }

        displayButtons(twitterContainer, fbookContainer) {
            const $this = this;
            if (this.showMediaButtons) {
                let twitterButton = '<a href="https://twitter.com/intent/tweet?button_hashtag=GREYSANATOMYENSONY&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-text="' + $('.question-textarea').val() + '" data-url="' + $this.socialmediapage + '" data-lang="es" data-show-count="false" target="_blank">Tweet #GREYSANATOMYENSONY</a>' +
                    '<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>';
                $(twitterContainer).append(twitterButton);

                let fbookButton = '<a style="width: 25px;height: 25px;" rel="noopener noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=' + $this.socialmediapage + '" target="_blank">' +
                    '<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="23" height="23" viewBox="0 0 21 21" style="fill: #395EA4;">' +
                    '<path d="M17,3H7C4.791,3,3,4.791,3,7v10c0,2.209,1.791,4,4,4h5.621v-6.961h-2.343v-2.725h2.343V9.309 c0-2.324,1.421-3.591,3.495-3.591c0.699-0.002,1.397,0.034,2.092,0.105v2.43h-1.428c-1.13,0-1.35,0.534-1.35,1.322v1.735h2.7 l-0.351,2.725h-2.365V21H17c2.209,0,4-1.791,4-4V7C21,4.791,19.209,3,17,3z"></path>' + '</svg>' +
                    '</a>';
                $(fbookContainer).append(fbookButton);
                this.showMediaButtons = false;
            }

        }
    }

})();

$('.greys-container').each(function() {
    const id = $(this).attr('data-id');
    const element = document.getElementById(id);
    const socialmediapage = $(this).attr('data-socialmediapage');
    const thankyoupage = $(this).attr('data-thankyoupage');
	const data = {
		recaptchaEnabled: $(this).data('recaptchaenabled'),
		currentpage: $(this).data('currentpage')
	}    
    const component = new greysform(element, socialmediapage, thankyoupage, data);
});
const ProductOfferCardComponent = (function () {
    const defaults = {
        types: {
            pre: 'prepaid',
            post: 'postpaid',
            noCli: 'non-client'
        },
        cardHtml:
            `<div class="title ant-value">{{title}}</div>
        {{#ifCond type '==' "prepaid"}}
            <img class="badge-image" src="{{imagePre}}" alt="prepaid badge">
        {{/ifCond}}
        {{#ifCond type '==' "postpaid"}}
            <img class="badge-image" src="{{imagePost}}" alt="postpaid badge">
        {{/ifCond}}
        <img class="image" src="{{image}}" alt="offer">
        <div class="subtitle">{{subtitle}}</div>
        <div class="label">{{generallabel}}</div>
        <div class="offer ant-price">{{offer}}</div>
        <a href="{{link}}" target="{{linktarget}}"
            class="btn-select directv-ui-button ant-button ant-action ant-{{type}} ant-offer {{#ifCond linkcolor '!==' ""}}ant-color-on{{/ifCond}}"
            {{#ifCond linkcolor '!==' ""}} style="background-color:{{linkcolor}} {{/ifCond}}">
            <span>{{linklabel}}</span>
            {{#ifCond target '==' "_blank"}}
                <i class="dtv-public-icon-external-link external-link ant-button ant-action ant-{{type}} ant-offer ant-external"></i>
            {{/ifCond}}
        </a>
        `
    };

    return class {
        constructor(component, carData) {
            this.carData = carData;
            this.component = component;
            this.createComponent();
        }

        createComponent() {
            this.component.html(Handlebars.compile(defaults.cardHtml)(this.carData));
            this.component.find('.image').css('cursor', 'pointer');
            this.component.find('.image')
                .on('click', (event) => window.open(this.carData.link, this.carData.linktarget));
            this.component.addClass('generic-product-offer-card-container ant-container');
        }
    };
})();

const genericproductoffercardcomponents = $('.generic-product-offer-card');
genericproductoffercardcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const cardData = {
        type: component.data('type'),
        imagePost:component.data('imagepost'),
        imagePre:component.data('imagepost'),
        title:component.data('title'),
        image:component.data('image'),
        subtitle:component.data('subtitle'),
        generallabel:component.data('generallabel'),
        offer:component.data('offer'),
        link:component.data('link'),
        linklabel:component.data('linklabel'),
        linktarget:component.data('linktarget'),
        linkcolor:component.data('linkcolor'),
    }
    GeneralComponentContainer.setComponent(
        new ProductOfferCardComponent($('#' + id), cardData), id
    );
});
$('.genericexpandedresume-widget').each(function () {
    const id = $(this).data('idgen');
    const path = $(this).data('path');
});
$(document).ready(function () {
    const $parent = $('.disney-optin'),
        $formContainer = $parent.find('.container-disney-optin.form'),
        $validateOkContainer = $parent.find('.container-disney-optin.validate-ok'),
        errorUrl = $parent.data('error-page'),
        userInvalidUrl = $parent.data('error-notmatch'),
        noPromoUrl = $parent.data('error-notfound');

    let numDoc = $formContainer.find('input').val();
    if (!numDoc) {
        $formContainer.find('.button-wrapper > button').attr('disabled', true);
    }

    $formContainer.find('a').click(() => {
        numDoc = $formContainer.find('input').val();
        let cid = getParameterByName('cid');
        if (numDoc && cid) {
            const req = {
                customerId: cid,
                country: $parent.data('country'),
                userNumDoc: numDoc,
                loyaltyType: 'fl'
            };

            const data = b64EncodeUnicode(JSON.stringify(req));
            $formContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateOptinData(data, errorUrl, validateResponse);
        }
    });

    $formContainer.find('.form-optin-disney').submit((e) => {
        e.preventDefault();
        $formContainer.find('a').click();
    });



    function validateResponse(res) {
        if (!res || res.result === 'NOK2') {
            window.location.href = errorUrl;
        }

        if (res.result === 'NOK1') {
            window.location.href = userInvalidUrl;
        }

        if (res.result === 'NOK3') {
            window.location.href = noPromoUrl;
        }

        if (res.result === 'OK' && res && res.data && res.data.node) {
            const disneyOptinOk = new DisneyOptinOk($parent, res.data.node, (res.data.email || ''));

            if (res.data.dynamicMessage) {
                disneyOptinOk.updateText(res.data.dynamicMessage);
            }

            $formContainer.hide();
            $validateOkContainer.show();
            return;
        }

        window.location.href = errorUrl;
    }
});

/**
* Generate url to redirect activation.
* @param {String} data Chiper data sended to validate activation.
* @returns Promise to execute.
*/
function validateOptinData(data, errorUrl, successFn) {
    return new Promise(() => {
        try {
            $.ajax({
                type: "POST",
                url: '/bin/public-sites/loyalty',
                data: JSON.stringify({ 'data': data }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: res => successFn(res),
                error: () => window.location.href = errorUrl
            });
        } catch (err) {
            window.location.href = errorUrl;
        }
    });
}
class DisneyOptinOk {
    constructor(parent, node, email) {
        this.$parent = parent;
        this.node = node;
        this.email = email;
        this.planType = String.empty;
        const dynamicMsgId = this.$parent.data('dynamic-msg') || '';
        this.$components = {
            dynamicText: dynamicMsgId ? this.$parent.find(`#${dynamicMsgId}`) : null,
            validateOkContainer: this.$parent.find('.container-disney-optin.validate-ok'),
            validateSuccessContainer: this.$parent.find('.container-disney-optin.success'),
            inputCid: this.$parent.find('.container-disney-optin.form input'),
        };

        this.errorUrl = this.$parent.data('error-page');
        this.$components.validateOkBtnWrap = this.$components.validateOkContainer.find('a.button-wrapper');
        this.actionButtonEvent = this.actionButtonEvent.bind(this);
        this.validateResponse = this.validateResponse.bind(this);
        this.$components.validateOkBtnWrap.click(this.actionButtonEvent);
        this.plans = [
            'ORO Plus HD Combo+',
            'ORO HD Combo+',
            'PLATA HD Combo+',
            'Oro 4k Combo+',
            'Access HD Combo+'
        ];
    }

    updateText(newText) {
        if (!this.$components.dynamicText || !newText) return;

        let exists = true,
            count = 0,
            dynamicMsg = this.$components.dynamicText;

        while (exists) {
            const dynamicMsgNext = dynamicMsg.children();
            if (dynamicMsgNext.length === 0 || count > 8) {
                dynamicMsg.text(newText);
                exists = false;
            }

            dynamicMsg = dynamicMsgNext;
            count++;
        }

        this.planType = this.getPlanFromDynamicMsg(newText);
    }

    actionButtonEvent(e) {
        const numDoc = this.$components.inputCid.val(),
            cid = getParameterByName('cid');

        if (numDoc && cid) {
            const req = {
                customerId: cid,
                country: this.$parent.data('country'),
                userNumDoc: numDoc,
                loyaltyType: 'al',
                node: this.node
            };

            const data = b64EncodeUnicode(JSON.stringify(req));

            this.$components.validateOkContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateOptinData(data, this.errorUrl, this.validateResponse);
        }
    }

    validateResponse(res) {
        if (!res || res.result !== 'OK') {
            window.location.href = this.errorUrl;
        }

        const optinSuccess = new DisneyOptinSuccess(this.$parent, this.planType, this.email);
        this.$components.validateOkContainer.hide();
        this.$components.validateSuccessContainer.show();
        return;
    }

    getPlanFromDynamicMsg(dynamicMsg){
        for (let i = 0; i < this.plans.length; i++) {
            const plan = this.plans[i];
            if(dynamicMsg.toLowerCase().includes(plan.toLowerCase())){
                return plan;
            }
        }

        return String.empty;
    }
}
class DisneyOptinSuccess {
    constructor(parent, planType, email) {
        this.$parent = parent;
        this.$components = {
            validateSuccessContainer: this.$parent.find('.container-disney-optin.success'),
            inputCid: this.$parent.find('.container-disney-optin.form input')
        };

        this.replaceDynamicText(planType, email);
        this.errorUrl = this.$parent.data('error-page');
        this.$components.validateOkBtnWrap = this.$components.validateSuccessContainer.find('a.button-wrapper');
        this.actionButtonEvent = this.actionButtonEvent.bind(this);
        this.$components.validateOkBtnWrap.click(this.actionButtonEvent);
    }

    actionButtonEvent(e) {
        const numDoc = this.$components.inputCid.val(),
            cid = getParameterByName('cid');

        if (numDoc && cid) {
            const country = this.$parent.data('country'),
                data = b64EncodeUnicode(`${country}%${cid}%${numDoc}`);

            this.$components.validateSuccessContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateRedirect(data, this.errorUrl);
        }
    }

    replaceDynamicText(planType, email) {
        let containerHtml = this.$components.validateSuccessContainer.html();
        containerHtml = containerHtml.replace(/%%PLAN%%/g, planType);
        containerHtml = containerHtml.replace(/%%EMAIL%%/g, email);
        containerHtml = containerHtml.replace(/%%CID%%/g, getParameterByName('cid'));
        this.$components.validateSuccessContainer.html(containerHtml);
    }

}
$(document).ready(function () {
    let numDoc = $('.disney-activation input').val();
    if (!numDoc) {
        $('.disney-activation .button-wrapper > button').attr('disabled', true);
    }

    $('.disney-activation a').click(() => {
        numDoc = $('.disney-activation input').val();
        let cid = getParameterByName('cid');
        if (numDoc && cid) {
            const country = $('.disney-activation').data('country');
            const data = b64EncodeUnicode(`${country}%${cid}%${numDoc}`);
            $('.data-val').val(data);
            $('.disney-activation .button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateRedirect(data);
        }
    });

    $('.form-activation-disney').submit((e) => {
        e.preventDefault();
        $('.disney-activation a').click();
    });
});

/**
 * Gets value from querystring parameter.
 * @param {String} name Name to search in queryString.
 * @param {String} url ***(Optional)*** Url where it searches name. Default URL is actual HREF.
 * @returns Value of name searched.
 */
function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

/**
 * Encode text to Base64.
 * @param {String} str Text to Base64 encode.
 * @returns Text encoded.
 */
function b64EncodeUnicode(str) {
    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {
        return String.fromCharCode('0x' + p1);
    }));
}

/**
 * Generate url to redirect activation.
 * @param {String} data Chiper data sended to validate activation.
 * @returns Promise to execute.
 */
function validateRedirect(data, errorUrl) {
     errorUrl = errorUrl ? errorUrl : $('.disney-activation').data('error-page');
    return new Promise(() => {
        try {
            $.ajax({
                type: "POST",
                url: '/bin/public-sites/disney-activate',
                data: JSON.stringify({ 'data': data }),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: (res) => {
                    if (res && res.status == 200) {
                        window.location.href = res.redirect;
                    } else {
                        window.location.href = errorUrl;
                    }

                },
                error: () => window.location.href = errorUrl
            });
        } catch (err) {
            window.location.href = errorUrl;
        }
    });
}

$(document).ready(function () {
    const $parent = $('.activation-reactivation'),
        $formContainer = $parent.find('.container-activation-reactivation.form'),
        $validateOkContainer = $parent.find('.container-activation-reactivation.validate-ok'),
        errorUrl = $parent.data('error-page'),
        userInvalidUrl = $parent.data('error-notmatch'),
        noPromoUrl = $parent.data('error-notfound');
        servletURL = $parent.data('urlservlet');

    const $paramountContainer = $('.activation-reactivation.paramount');
    const $paramountContainerErrors = $('.paramount-errors');

    ($paramountContainer.length > 0 || $paramountContainerErrors.length > 0) && $('body').addClass('paramount');

    let numDoc = $formContainer.find('input').val();
    if (!numDoc) {
        $formContainer.find('.button-wrapper > button').attr('disabled', true);
    }

    $formContainer.find('a').click(() => {
        numDoc = $formContainer.find('input').val();
		cid = getParameterByName('cid');
		if (numDoc && cid) {
            const req = {
				customerId: cid,
                country: $parent.data('country'),
                userNumDoc: numDoc,
                loyaltyType: 'fl',
                loyaltyInstancia: $parent.data('loyalty-instance')
            };

            const data = b64EncodeUnicode(JSON.stringify(req));
            $formContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateActReactData(data, errorUrl, validateResponse, servletURL);
        }
    });

    $formContainer.find('.form-activation-reactivation').submit((e) => {
        e.preventDefault();
        $formContainer.find('a').click();
    });

    function validateResponse(res) {
        if (!res || res.result === 'NOK2') {
            window.location.href = errorUrl;
        }

        if (res.result === 'NOK1') {            
            window.location.href = userInvalidUrl;
        }

        if (res.result === 'NOK3') {
            window.location.href = noPromoUrl;
        }

        if (res.result === 'OK' && res && res.data && res.data.node) {
            const activationReactivationOk = new ActivationReactivationOk($parent, res.data.node, (res.data.email || ''));

            if (res.data.dynamicMessage) {
                activationReactivationOk.updateText(res.data.dynamicMessage);
            }

            $formContainer.hide();
            $validateOkContainer.show();
            return;
        }

    }
});

/**
* Generate url to redirect activation.
* @param {String} data Chiper data sended to validate activation.
* @returns Promise to execute.
*/
function validateActReactData(data, errorUrl, successFn, servletURL) {
    return new Promise(() => {
		$.ajax({
			type: "POST",
			async: true,
			url: servletURL,
			data: JSON.stringify({ 'data': data }),
			dataType: "json",
			contentType: "application/json;charset=utf-8",
			success: res => successFn(res)
		});
    });
}
class ActivationReactivationOk {
    constructor(parent, node, email) {
        this.$parent = parent;
        this.node = node;
        this.email = email;
        this.planType = String.empty;
        const dynamicMsgId = this.$parent.data('dynamic-msg') || '';
        this.$components = {
            dynamicText: dynamicMsgId ? this.$parent.find(`#${dynamicMsgId}`) : null,
            validateOkContainer: this.$parent.find('.container-activation-reactivation.validate-ok'),
            validateSuccessContainer: this.$parent.find('.container-activation-reactivation.success'),
            inputCid: this.$parent.find('.container-activation-reactivation.form input'),
        };

        this.errorUrl = this.$parent.data('error-page');
        this.$components.validateOkBtnWrap = this.$components.validateOkContainer.find('a.button-wrapper');
        this.actionButtonEvent = this.actionButtonEvent.bind(this);
        this.validateResponse = this.validateResponse.bind(this);
        this.$components.validateOkBtnWrap.click(this.actionButtonEvent);
        this.plans = [
            'ORO Plus HD Combo+',
            'ORO HD Combo+',
            'PLATA HD Combo+',
            'Oro 4k Combo+',
            'Access HD Combo+'
        ];
    }

    updateText(newText) {
        if (!this.$components.dynamicText || !newText) return;

        let exists = true,
            count = 0,
            dynamicMsg = this.$components.dynamicText;

        while (exists) {
            const dynamicMsgNext = dynamicMsg.children();
            if (dynamicMsgNext.length === 0 || count > 8) {
                dynamicMsg.text(newText);
                exists = false;
            }

            dynamicMsg = dynamicMsgNext;
            count++;
        }

        this.planType = this.getPlanFromDynamicMsg(newText);
    }

    actionButtonEvent(e) {		
        const numDoc = this.$components.inputCid.val(),
            cid = getParameterByName('cid'),
            servletURL = this.$parent.data('urlservlet');
        if (numDoc && cid) {		
            const req = {
                customerId: cid,
                country: this.$parent.data('country'),
                userNumDoc: numDoc,
                loyaltyType: 'al',
                node: this.node,
                loyaltyInstancia: this.$parent.data('loyalty-instance')
            };

            const data = b64EncodeUnicode(JSON.stringify(req));

            this.$components.validateOkContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            this.$components.validateOkContainer.hide();

            validateActReactData(data, this.errorUrl, this.validateResponse, servletURL);

        }
    }

    validateResponse(res) {
        if (!res || res.result !== 'OK') {
            window.location.href = this.errorUrl;
        }

        const activationReactivationSuccess = new ActivationReactivationSuccess(this.$parent, this.planType, this.email);
        this.$components.validateOkContainer.hide();
        this.$components.validateSuccessContainer.show();
        return;
    }

    getPlanFromDynamicMsg(dynamicMsg){
        for (let i = 0; i < this.plans.length; i++) {
            const plan = this.plans[i];
            if(dynamicMsg.toLowerCase().includes(plan.toLowerCase())){
                return plan;
            }
        }

        return String.empty;
    }
}
class ActivationReactivationSuccess {
    constructor(parent, planType, email) {
        this.$parent = parent;
        this.$components = {
            validateSuccessContainer: this.$parent.find('.container-activation-reactivation.success'),
            inputCid: this.$parent.find('.container-activation-reactivation.form input')
        };

        this.replaceDynamicText(planType, email);
        this.errorUrl = this.$parent.data('error-page');
        /*this.$components.validateOkBtnWrap = this.$components.validateSuccessContainer.find('a.button-wrapper');
        this.actionButtonEvent = this.actionButtonEvent.bind(this);
        this.$components.validateOkBtnWrap.click(this.actionButtonEvent);*/
    }

    /*actionButtonEvent(e) {
        const numDoc = this.$components.inputCid.val(),
            cid = getParameterByName('cid');

        if (numDoc && cid) {
            const country = this.$parent.data('country'),
                data = b64EncodeUnicode(`${country}%${cid}%${numDoc}`);

            this.$components.validateSuccessContainer.find('.button-wrapper > button')
                .attr('disabled', true)
                .addClass('skeleton-box');

            validateRedirect(data, this.errorUrl);
        }
    }*/

    replaceDynamicText(planType, email) {
        let containerHtml = this.$components.validateSuccessContainer.html();
        containerHtml = containerHtml.replace(/%%PLAN%%/g, planType);
        containerHtml = containerHtml.replace(/%%EMAIL%%/g, email);
        containerHtml = containerHtml.replace(/%%CID%%/g, getParameterByName('cid'));
        this.$components.validateSuccessContainer.html(containerHtml);
    }

}
$(document).ready(function(){   
   
    $('#tipo-contrato').keypress(function (tecla) {
        if (tecla.charCode == 160 || tecla.charCode == 161 || tecla.charCode == 162|| tecla.charCode == 163 || tecla.charCode > 130) return false;  
    });

    //Filtro por nombre/plan tarifario    
    var $rows = $('.link-container:visible');
    $('input[type="text"]#tipo-contrato').keyup(function() {           
        var val = '^(?=.*\\b' + $.trim($(this).val()).split(/\s+/).join('\\b)(?=.*\\b') + ').*$',
            reg = RegExp(val, 'i'),
            text;    
        $rows.show().filter(function() {           
            text = $(this).text().replace(/\s+/g, ' ');
            filter = accentFold(text);
            return !reg.test(filter);    
        }).hide();
    });

    //Filtro por idioma
    $('#idioma').change(function(){    
        if ($(this).val() == 'Aimara'){            
            $(".link-filtro a").addClass('hide');             
            $(".link-filtro a:contains('(ai)')").addClass('show');
            $(".link-filtro a:contains('(ai)')").removeClass('hide');           
        }        
        if ($(this).val() == 'Quechua'){            
            $(".link-filtro a").addClass('hide');
            $(".link-filtro a:contains('(que)')").addClass('show');
            $(".link-filtro a:contains('(que)')").removeClass('hide');        
        }
        if ($(this).val() == 'Ashinika'){
            $(".link-filtro a").addClass('hide');
            $(".link-filtro a:contains('(as)')").addClass('show');
            $(".link-filtro a:contains('(as)')").removeClass('hide');            
        }
        if ($(this).val() == 'Shipibo Konibo'){
            $(".link-filtro a").addClass('hide');           
            $(".link-filtro a:contains('(sh)')").addClass('show');
            $(".link-filtro a:contains('(sh)')").removeClass('hide');
        }
        if ($(this).val() == 'Espaol'){
            $(".link-filtro a").addClass('hide');   
            $(".link-filtro a:contains('(es)')").addClass('show');
            $(".link-filtro a:contains('(es)')").removeClass('hide');
        }
        if ($(this).val() == 'Todos'){
            $(".link-filtro a").addClass('show');   
            $(".link-filtro a").removeClass('hide');             
        }
    });
    //Agrego clase a titulo y links (fuera de filtro-component)
    $(".filtrocomponent").siblings(".link").addClass("link-filtro");
    $(".filtrocomponent+.link").siblings(".title").addClass("title-filtro");
});
const componentsAfterProductDetailsPage = $('.product-details-page-container');
componentsAfterProductDetailsPage.each((index, element) => {
    const page = $(element);
    const previewMode = page.data('previewmode');
    const editMode = page.data('editmode');
    const path = page.data('path');
    const country = page.data('country');
    const language = page.data('language');
    const locale = country + '/' + language;

    productDeatailsLandingComponent.setProperties(path, locale, previewMode || editMode, country);
});
const featuredEventComponent = {
    path: '',
    id: '',

    setProperties(id, path, editmode) {
        this.path = path;
        this.id = id;
        this.editmode = editmode;
        this.initComponent();
    },

    initComponent() {
        if (typeof productDeatailsLandingComponent !== 'undefined') {
            const observable = productDeatailsLandingComponent.setObservable();

            if (observable) {
                observable.subscribe((result) => {
                    this.fillData(result.plan);
                });
            }
        } else {
            this.getData();
        }
    },

    getData() {
        if (this.path) {
            GlobalData.getData(
                { path: this.path }
            ).subscribe(
                (data) => {
                    this.fillData(data[0]);
                }
            );
        }
    },

    fillData(data) {
        try {
            const component = $('#featured-event-container-' + this.id);

            if (data && data.featuredEvents && data.featuredEvents.length) {
                const eventData = data.featuredEvents.find((item) => item.currentEvent);

                this.setBackgroundImage(eventData, component);
                this.setResizedBackgroundImage(eventData, component);
                component.find('.header\x20.title').text(eventData.title);
                component.find('.header\x20.subtitle').text(eventData.subtitle);
                component.find('.footer\x20.title-separator')
                    .html(`<div class="divider left"></div>
                                <div class="separator">${eventData.titleSeparator}</div>
                        <div class="divider right"></div>`);
                component.find('.event-icons').html();
                component.find('.event-icons').empty();
                eventData.icons.forEach(function (icon) {
                    component.find('.event-icons').append(`<div class="event-icon"><img src="${icon}" alt=""></div>`);
                });
            } else if (!this.editmode) {
                component.css('display', 'none');
            }
        } catch (error) {
            console.log(error);
        }
    },

    setResizedBackgroundImage(eventData, component) {
        $(window).resize(() => {
            this.setBackgroundImage(eventData, component);
        });
    },
    setBackgroundImage(eventData, component) {
        const width = $(window).width();

        if (width < 481) {
            component.css('background-image', `url('${eventData.urlBackgroundImageMobile}')`);
        } else if (width < 769) {
            component.css('background-image', `url('${eventData.urlBackgroundImageTablet}')`);
        } else {
            component.css('background-image', `url('${eventData.urlBackgroundImage}')`);
        }
    }
};

$('.featuredevent-widget').each(function () {
    const path = $(this).data('path');
    const id = $(this).data('idgen');
    const editMode = $(this).data('editmode');
    featuredEventComponent.setProperties(id, path, editMode);
});
const FeaturedContentCardComponent = (function() {
    const defaults = {
        selectors: {
            sliderContainer: '.cards-slides-container'
        },
        events: {
            resize: 'resize'
        },
        constants: {
            screenPhone: 768
        }
    };

    return class {
        constructor(element, properties) {
            this.element = element;
            this.properties = properties;
            this.initComponent();
            this.bindEvents();
        }

        initComponent() {
            this.slickInitialized = false;
            this.genericSliderDot = new GenericSlidersDotManager(this.element);
            this.initSlider();
        }

        bindEvents() {
            const el = this;

            // Reslick only if it's not slick()
            $(window).on('resize', function() {
                if (el.$SliderContainer && !el.$SliderContainer.hasClass('slick-initialized')) {
                    return el.$SliderContainer.slick(el.sliderSettings);
                }
            });
        }

        initSlider() {
            if (!this.properties.editMode && !this.properties.previewMode) {
                this.slickInitialized = true;
                this.$SliderContainer = $(defaults.selectors.sliderContainer, this.element);
                this.sliderSettings = {
                    slidesToShow: 4,
                    slidesToScroll: 1,
                    dots: false,
                    arrows: false,
                    centerMode: true,
                    centerPadding: '16px',
                    infinite: true,
                    responsive: [
                        {
                            breakpoint: 770,
                            settings: {
                                slidesToShow: 2,
                                dots: true
                            }
                        },
                        {
                            breakpoint: defaults.constants.screenPhone,
                            settings: {
                                slidesToShow: 1,
                                dots: true
                            }
                        },
                        {
                            breakpoint: 2024,
                            settings: "unslick"
                        }
                    ]
                };

                this.$SliderContainer.slick(this.sliderSettings);
            }

            this.genericSliderDot.setTheme('dark');
        }
    };
})();

$('.featuredcontent-widget').each(function () {
    const id = $(this).data('idgen');
    const name = $(this).data('name');
    const properties = {
        previewMode: $(this).data('previewmode'),
        editMode: $(this).data('editmode')
    };
    let component = new FeaturedContentCardComponent($('#' + id), properties);
    GeneralComponentContainer.setComponent(component);
});
EntertainmentCardsComponentClass = (function () {
    const defaults = {
        templates: {
            "card": "#card-template"
        }
    };

    return class {
        constructor(pathsList, textList, id, i18nData, colorTheme) {
            this.component = $('#' + id);
            this.cardTemplate = $(defaults.templates.card).html();
            this.i18nData = i18nData;
            this.textList = textList;
            this.colorTheme = colorTheme;
            this.getData(pathsList);
        }

        getData(pathsList) {
            rxjs.combineLatest(
                pathsList.map(
                    (path) =>
                        ajax2Observable(
                            $.ajax({
                                url: path
                            })
                        )
                )
            ).pipe(
                rxjs.operators.map((item) => item.map((pk) => pk.body[0]))
            ).subscribe(
                (response) => {
                    response.forEach((card, index) => {
                        this.setCard(card, this.textList[index]);
                    });
                },
                (error) => {
                    console.error(error);
                }
            );
        }

        setCard(cardInfo, linkText) {

            const selectedChannels = [
                ...cardInfo.channelsHighlighted,
                ...cardInfo.channels.filter((ch) =>
                    cardInfo.channelsHighlighted.find((chhi) => chhi.id === ch.id) ? false : true
                )
            ];

            this.component.find('.entertainment-cards-container').append(
                Handlebars.compile(this.cardTemplate)(
                    Object.assign(
                        {},
                        cardInfo,
                        {
                            i18nData: this.i18nData,
                            linkText: linkText,
                            otherChannels: selectedChannels.length - 3,
                            selectedChannels: selectedChannels.slice(0, 3),
                            colorTheme: this.colorTheme,
                            isDark: this.colorTheme == 'dark-gradient'
                        }
                    )
                )
            );
            this.component.find('.entertainment-cards-container\x20.entertainment-card:last-child').on('click', () => {
                window.open(cardInfo.link, '_self');
            });
        }
    };
})();

$('.entertainmentcards-widget').each(function () {
    const id = $(this).data('idgen');
    const pathsList = [
        $(this).data('premiumpackagefirst'),
        $(this).data('premiumpackagesecond'),
        $(this).data('premiumpackagethird')
    ];

    const textList = [
        $(this).data('learnmoretextfirst'),
        $(this).data('learnmoretextsecond'),
        $(this).data('learnmoretextthird')
    ];

    const translateData = {
        channels: $(this).data("plancardchannels")
    }

    const colorTheme = $(this).data('colortheme');

    new EntertainmentCardsComponentClass(pathsList, textList, id, translateData, colorTheme);
});
const DynamicTabsComponent = (function () {
    const defaults = {
        '__preIcon': '/content/dam/public-sites/plans/images/prepago-light.png',
        '__posIcon': '/content/dam/public-sites/plans/images/pospago-light.svg',
        '_generalContainerClass': 'dynamictabs_container',
        '_tabsContainer': '.dynamictabs_tabs',
        '_tabItemClass': 'dynamictabs_tabs--item',
        '_tabActiveClass': 'dynamictabs_active',
        '_tabBodyActiveClass': 'dynamictabs_body--active',
        '_tabBodyClass': 'dynamictabs_body'
    };

    return class {
        constructor(options) {
            this.id = options.id;
            this.endPoint = options.path;
            this.mode = options.mode || false;
            this.singleChannelTabs = options.singleChannelTabs === undefined ? false : options.singleChannelTabs;
            this.tabData = {};
            this.tabState = {};
            this.versions = [];
            this.component = document.getElementById(this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent(this.endPoint);
        }

        switchTabBody(tab) {
            document.querySelectorAll(`.${defaults._tabBodyClass}`).forEach((v) => {
                v.classList.remove(defaults._tabBodyActiveClass);
            });
            document.getElementById(tab).classList.add(defaults._tabBodyActiveClass);
        }

        registerEventListeners() {
            document.querySelector(`.${defaults._generalContainerClass}`).addEventListener('click', (e) => {
                const clickedTab = e.target.closest(`.${defaults._tabItemClass}`);

                if (clickedTab !== null && this.tabState !== clickedTab) {
                    this.isScrollable(clickedTab);
                    this.tabState = clickedTab;
                    document.querySelectorAll(`.${defaults._tabItemClass}`).forEach((v) => {
                        v.classList.remove(defaults._tabActiveClass);
                    });
                    this.navigate(clickedTab);
                }
            });
        }

        navigate(tab) {
            tab.classList.add(defaults._tabActiveClass);
            const tabBody = tab.dataset.tab;

            this.switchTabBody(tabBody);
        }

        hideComponent() {
            this.component.style.display = 'none';
        }

        getData(query) {
            return new Promise((resolve, reject) => {
                try {
                    $.ajax({
                        type: 'GET',
                        url: query,
                        complete: (r) => {
                            r.status === 200 ? resolve(r.responseJSON) : reject(`Resource status ${r.status}`);
                        }
                    });
                } catch (err) {
                    reject(err);
                }
            });
        }

        setData(data, notMonoChannel) {
            this.singleChannelTabs = notMonoChannel;
            this.tabData = data;
            this.makeTabs();
        }

        initComponent(endPoint) {
            try {
                if (endPoint !== "") {
                    this.getData(endPoint).then((result) => this.handleResults(result));
                }
            } catch (err) {
                console.error(err);
            }
        }

        handleResults(data) {
            this.tabData = data.body[0];
            this.makeTabs();
        }

        makeTabs() {
            if (this.singleChannelTabs === false) {
                this.tabData.packs = this.tabData.packs.filter((tab) => tab.totalChannels > 1);
            }

            if (this.tabData.packs.length > 0) {
                if (this.tabData.packs.length > 1) {
                    const tabs = this.tabData.packs.reduce((ac, cv, ci) => {
                        if (ci === 1) {
                            ac = this.tabTemplate(ac.name, ac.id, defaults._tabActiveClass, ac.infoPacks);
                        }

                        return ac + this.tabTemplate(cv.name, cv.id, '', cv.infoPacks);
                    });

                    document.querySelector(`.${defaults._generalContainerClass}`).innerHTML = this.tabNavTemplate(tabs);
                }

                this.makeChannels();
            } else {
                this.hideComponent();
            }
        }

        isScrollable(selectedTabJs) {
            const scrollComponent = $(defaults._tabsContainer);

            if (scrollComponent.get(0).scrollWidth > scrollComponent.width()) {
                scrollComponent.get(0).scrollLeft = selectedTabJs.offsetLeft;
            }
        }

        tabNavTemplate(tabs) {
            return `<nav class="dynamictabs_header"><ul class="dynamictabs_tabs" >${tabs}</ul></nav>`;
        }

        tabTemplate(name, id, active, pack) {
            return `<li class="dynamictabs_tabs--item ${active} ant-action ant-button" data-tab='${id}'>
                        <span class="dynamictabs_tabs--title">${name}</span>
                        ${this.tabBadgesTemplate(pack)}
                    </li>`;
        }

        tabBadgesTemplate(pack) {
            let badget = '';

            pack.forEach((v) => {
                badget += `<figure class="dynamictabs_tabs--badges_pos"><img src="${v.badgetLight}"></figure>`;
            });

            return `<span class="dynamictabs_tabs--badges">
                        ${badget}
                    </span>`;
        }

        makeChannels() {
            this.tabData.packs.forEach((v, i) => {
                document.querySelector(`.${defaults._generalContainerClass}`).insertAdjacentHTML('beforeend', this.tabBodyTemplate(v.id, i === 0 ? defaults._tabBodyActiveClass : '', v.channels));
            });
            this.registerEventListeners();
        }

        tabBodyTemplate(id, active, channels) {
            const sections = [channels.filter((ch) => ch.type !== 'HD'), channels.filter((ch) => ch.type === 'HD')];

            return `<div class="dynamictabs_body ${active}" id="${id}">${this.tabBodySectionsTemplate(sections.filter((sec) => sec.length > 0)).join('')}</div>`;
        }

        tabBodySectionsTemplate(sections) {
            return sections.map((sect) =>
                `<section class="dynamictabs_section">
                    <h6 class="dynamictabs_section--title">${sect.length} canal${sect.length > 1 ? 'es' : ''} en ${sect[0] !== undefined ? (sect[0].type !== 'HD' ? 'SD' : 'HD') : 'No definido'}</h6>
                    <section class="dynamictabs_channels">
                        ${sect.map((ch) => this.channelCardTemplate(ch.name, ch.logo, ch.number, ch.alt)).join('')}
                    </section>
                </section>`);
        }

        channelCardTemplate(channelName, channelLogo, channelNumber, channelAlt) {
            return `<article class="dynamictabs_channels--channel">
                <ul class="dynamictabs_channels--channel_data">
                    <li class="dynamictabs_channels--channel_icon">
                        <figure>
                            <img src="${channelLogo}" alt="${channelName} ${channelAlt}">
                        </figure>
                    </li>
                    <li class="dynamictabs_channels--channel_name">
                       <span>${channelName}</span>
                    </li>
                    <li class="dynamictabs_channels--channel_number">
                        <span>${channelNumber}</span>
                    </li>
                </ul>
            </article>`;
        }
    };
})();

$('.dynamictabs-widget').each(function () {
    const id = $(this).data('idgen');
    const path = $(this).data('packpath') ? '' : $(this).data('path');
    const mode = $(this).data('mode');

    GeneralComponentContainer.setComponent(new DynamicTabsComponent({id, path, mode}), id);
});
const DynamicDistributedContent = (function () {
    const defaults = {
        "selectors": {
        },
        "classes": {
        },
        "events": {
            "click": "click",
            "scroll": "scroll",
            "resize": "resize"
        }
    };

    return class {
        constructor(options) {
            this.id = options.id;
            this.component = document.getElementById(this.id);
            this.country = options.country;
            this.language = options.language;
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initEventListeners() { 
        }

        initComponent() {
        }
    };
})();

$('.dynamic-distributed-content').each(function () {
    const id = $(this).data('idgen');
    const country = $(this).data('country');
    const language = $(this).data('language');
    const mode = $(this).data('mode');
    GeneralComponentContainer.setComponent(new DynamicDistributedContent({id, mode, country, language}), id);
});
DocumentFilterComponent = (function () {
    const defaults = {
        conditions: '/bin/public-sites/mock/conditions.html/'
    };

    return class {
        constructor(id, linkText, hideMonths) {
            this.linkText = linkText;
            this.id = id;
            this.hideMonths = hideMonths;
            this.component = $('#' + this.id);
            this.getYearsMonths();
            this.yearId = 0;
            this.monthId = 0;

            this.resizeBehavior();
            $(window).on('resize', () => {
                this.resizeBehavior();
            });

        }

        getYearsMonths() {
            $.ajax(defaults.conditions + countryPS + '/' + languagePS).done((data) => {
                this.configDropdown(data.body);
            });
        }

        resizeBehavior() {
            const componentWidth = this.component.outerWidth();
            console.log(componentWidth);
            componentWidth < 768 ? this.component.addClass('mobile') : this.component.removeClass('mobile');
        }

        getDocuments(yearId, monthId) {
            var url = defaults.conditions + countryPS + '/' + languagePS + '/' + yearId;

            if (!this.hideMonths) {
                url += '/' + monthId;
            }

            $.ajax(url).done((data) => {
                this.component.find('.documents').html(data.body.map(
                    (document) =>
                        `<div class="document">
                            <div class="name">${document.name}</div>
                            <a href="${document.docUrl}" target="_blank"class="link">
                                <span class="text">${this.linkText}</span>
                                <span class="dtv-public-icon-chevron-left"></span>
                            </a>
                        </div>`).join(''));
            });
        }

        configDropdown(years) {
            const yearsDrop = this.component.find('#years-drop');
            const monthsDrop = this.component.find('#month-drop');
            this.setInitialConfig(yearsDrop, monthsDrop, years);

            this.fillOptions(yearsDrop, years);

            this.setOpenCloseListener(yearsDrop);

            if (!this.hideMonths) {
                this.setOpenCloseListener(monthsDrop);
            }

            yearsDrop.find('.drop-options .option').on('click', (event) => {
                yearsDrop.removeClass('open');
                const year = years.find((year) => year.id === $(event.currentTarget).attr('option'));
                if (year) {
                    this.fillSelectText(yearsDrop, year.name);

                    if (!this.hideMonths) {
                        this.fillOptions(monthsDrop, year.months);
                        this.monthsOptionsListener(monthsDrop, year.id);
                        const monthText = monthsDrop.find('.drop-select .text').text();
                        let monthSelected = year.months.find(month => month.name == monthText);

                        if (!monthSelected) {
                            monthSelected = year.months[year.months.length - 1];
                        }

                        if (monthSelected) {
                            this.fillSelectText(monthsDrop, monthSelected.name);
                            this.getDocuments(year.id, monthSelected.id);
                        }
                    } else {
                        this.getDocuments(year.id, null);
                    }
                }
            });

            $(document).mouseup((e) => {
                yearsDrop.removeClass('open');
                monthsDrop.removeClass('open');
            });
        }

        setInitialConfig(yearsDrop, monthsDrop, years) {
            const actualYear = years.find(year => year.actual);
            if (actualYear) {
                this.fillSelectText(yearsDrop, actualYear.name);
                const actualMonth = actualYear.months.find(month => month.actual);

                if (!this.hideMonths) {
                    this.fillOptions(monthsDrop, actualYear.months);
                    this.monthsOptionsListener(monthsDrop, actualYear.id);
                    this.fillSelectText(monthsDrop, actualMonth.name);
                }

                this.getDocuments(actualYear.id, actualMonth ? actualMonth.id : null);
            }
        }

        monthsOptionsListener(monthsDrop, yearId) {
            if (!this.hideMonths) {
                monthsDrop.find('.drop-options .option').off().on('click', (event) => {
                    const optionRef = $(event.currentTarget);
                    this.fillSelectText(monthsDrop, optionRef.text());
                    this.getDocuments(yearId, optionRef.attr('option'));
                });
            }
        }

        fillSelectText(elementRef, text) {
            elementRef.find('.drop-select .text').text(text);
        }

        fillOptions(elementRef, data) {
            elementRef.find('.drop-options').html(data.map(
                (item) =>
                    `<div option="${item.id}" class="option text">${item.name}</div>`).join(''));
        }

        setOpenCloseListener(elementRef) {
            elementRef.find('.drop-select').on('click', () => {
                if (elementRef.hasClass('open')) {
                    elementRef.removeClass('open');
                }
                else {
                    elementRef.addClass('open');
                }
            });
        }
    };
})();

$('.documentfilter-widget').each(function () {
    const id = $(this).data('idgen');
    const linkText = $(this).data('linktext');
    const hideMonths = $(this).data('hidemonths');
    GeneralComponentContainer.setComponent(new DocumentFilterComponent(id, linkText, hideMonths), id);
});
class DirecTvGoCardComponent {
    constructor(element, properties) {
        this.element = element;
        this.link = properties.optionLink;
        this.offerBadgeText = properties.offerBadgeText;
        this.initComponent();
    }

    initComponent() {
        this.getData();
    }

    getData() {
        GlobalData.getData(Object.assign(GlobalData.defaults.requestData.PLANS, { params: { type: 'dtvgo' }}))
            .subscribe((data) => {
                this.fillData(data);
            });
    }

    fillData(directvGoData) {
        const template =
        `<li>
            <a class="ant-link ant-action ant-value ant-level2  {{#ternary optionoffer 'ant-offer' ''}}{{/ternary}} target="_self" href="{{optionlink}}">
                {{optiontitle}}
                <i class="chevron"></i>
                {{#ifCond optionoffer '!==' ''}}
                    <div class="badge">{{offerBadgeText}}</div>
                {{/ifCond}}
            </a>
        </li>`;
        const $linksContainer = this.element.find('.links');
        const templateCompiled = Handlebars.compile(template);

        directvGoData.forEach((plan) => {
            $linksContainer.append( templateCompiled({
                optionoffer: plan.offer,
                optionlink: plan.link,
                optiontitle: plan.name,
                offerBadgeText: this.offerBadgeText
            }) );
        });
    }
}

$('.dtvgo-widget').each(function () {
    let id = $(this).data('idgen');
    properties = {
        offerBadgeText: $(this).data("offerbadge")
    };
    new DirecTvGoCardComponent($("#" + id), properties);
});
class ValidateAndDoRetractoRequest {
    constructor() {
        this.patterns = {
            email: /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i,
        };
        this.createRetractoUrl = "/bin/public-sites/retracto";
        this.thankyouPage = $("#retracto-form").attr("data-retracto-thankyou");
        this.validInputCount = $("#cod-area").val() ? 5 : 4;
        this.requestBody = {
            retracto_full_name: "",
            retracto_email: "",
            retracto_phone: "",
            retracto_document: "",
            retracto_phone_number_input: "",
            retracto_phone_code: $("#cod-area").val() ? $("#cod-area").val() : "",
        };
        this.internalErrorMsg = $("#retracto-form").attr(
            "data-internal-error"
        );
        this.successMsg = $("#retracto-form").attr("data-success-message");

        $(".rut-input, .name-input, .email-input, #num-tel").on("blur", (event) => {
            this.validateInputFields(event.target);
        });
    }

    /**
     * 
     * @param {String} type
     * @param {String} value
     * @param {String} name
     * @description Get type, value and name of each inputs for their own validation
     * @returns void
     */
    validateInputFields({ type, value, name }) {
        switch (type) {
            case "email":
                if (this.patterns.email.test(value)) {
                    $(`#${name}_error`).hide();
                    $(`.${name}_check`).removeClass("d-none");
                    $(`[name=${name}]`).removeClass("error");
                    this.requestBody[name] = value;
                } else {
                    this.requestBody[name] = "";
                    $(`.${name}_check`).addClass("d-none");
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "text":
                this.inputTextValidation(name, value);
                break;
        }

        // Block or unblock success button
        this.showSuccessBtn();
    }

    /**
     * @description Show success button
     * @returns void
     */
    showSuccessBtn() {
        if (this.isReadyToSubmit()) {
            $("#retracto-btn-send").prop("disabled", false);
            $("#retracto-btn-send").removeClass("disabled");
        } else {
            $("#retracto-btn-send").prop("disabled", true);
            $("#retracto-btn-send").addClass("disabled");
        }
    }

    /**
     * @description handle change for each oninput event
     * @returns void
     */
    handleChange(e, phoneId=null, phoneValue=null) {
        if (e) {
            const { target } = e;
            this.validateInputFields(target);
        }
        if (e == null && phoneId && phoneValue) {
            this.inputPhoneValidate(phoneId, phoneValue)
        }
    }

    /**
     * 
     * @description Create and send request body with ajax
     * @returns void
     */
    createRetracto() {
        // Set phone number
        this.requestBody["retracto_phone"] = this.requestBody.retracto_phone_number_input;
        if (this.requestBody.retracto_phone_code) {
            let phoneNumber = `${this.requestBody["retracto_phone_code"]}-${this.requestBody["retracto_phone_number_input"]}`;
            this.requestBody["retracto_phone"] = phoneNumber;
        }
        return new Promise(() => {
            try {
                $.ajax({
                    type: "POST",
                    url: this.createRetractoUrl,
                    data: JSON.stringify(this.requestBody),
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: () => (window.location.href = this.thankyouPage),
                    error: () => this.showAlert("error", this.internalErrorMsg),
                });
            } catch (err) {
                this.showAlert("error", this.internalErrorMsg);
            }
        });
    }

    /**
     * 
     * @param {String} type
     * @param {String} msg
     * @description Show alert with corresponding message
     * @returns void
     */
    showAlert(type, msg) {
        const $alertComponent =
            GeneralComponentContainer.getComponentByName("Alert");

        if ($alertComponent) {
            switch (type) {
                case "error":
                    $alertComponent.setTitle("Error");
                    $alertComponent.setDescription(msg);
                    break;
                case "success":
                    $alertComponent.setTitle("Exto");
                    $alertComponent.setDescription(msg);
                    break;
            }

            $alertComponent.setStatus(type);
            $alertComponent.showAlert();
        }
    }

    /**
     * @description Validate if form is ready to be submited
     * @returns Boolean
     */
    isReadyToSubmit() {
        let isReady = false;
        const inputCount = Object.values(this.requestBody).filter(
            (body) => body !== "" && body !== 0
        ).length;

        if (inputCount >= this.validInputCount) {
            isReady = true;
        }
        if (inputCount === this.validInputCount && !this.requestBody.retracto_phone_code && !this.requestBody.retracto_phone_number_input) {
            isReady = false
        }
        return isReady;
    }

    /**
     * 
     * @param {String} name
     * @param {String} value
     * @description Validate input text value
     * @returns void
     */
    inputTextValidation(name, value) {
        switch (name) {
            case "retracto_full_name":
                if (value.length <= 50) {
                    this.requestBody[name] = value;
                    $(`#${name}_error`).hide();
                    $(`.${name}_check`).removeClass("d-none");

                    $(`[name=${name}]`).removeClass("error");
                } 
                if(value.length === 0) {
                    this.requestBody[name] = "";
                    $(`.${name}_check`).addClass("d-none");
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
            case "retracto_document":
                let rutValue = this.setDashInInput(value, name)
                if (this.validateRut(rutValue)) {
                    this.requestBody[name] = rutValue;

                    $(`#${name}_error`).hide();
                    $(`.${name}_check`).removeClass("d-none");
                    $(`[name=${name}]`).removeClass("error");
                } else {
                    this.requestBody[name] = 0;

                    $(`.${name}_check`).addClass("d-none");
                    $(`#${name}_error`).show();
                    $(`[name=${name}]`).addClass("error");
                }
                break;
        }
    }

    /**
     * 
     * @param {String} name
     * @param {String} value
     * @description Validate input phone value
     * @returns void
     */
    inputPhoneValidate(id, value) {
        switch (id) {
            case "cod-area":
                if (String(value).length !== 0) {
                    this.requestBody["retracto_phone_code"] = value;

                    $(`#${id}`).removeClass("error");
                    $(`#retracto_phone_code_error`).hide();
                } else {
                    this.requestBody["retracto_phone_code"] = 0;

                    $(`#${id}`).addClass("error");
                    $(`#retracto_phone_code_error`).show();
                }
                break;

            case "num-tel":
                if (String(value).length >= 8 && String(value).length <= 12) {
                    this.requestBody["retracto_phone_number_input"] = value;

                    $(`#${id}`).removeClass("error");
                    $(`#retracto_phone_number_input_error`).hide();
                    $(".retracto_phone_check").removeClass("d-none");
                } else {
                    this.requestBody["retracto_phone_number_input"] = 0;

                    $(`#${id}`).addClass("error");
                    $(".retracto_phone_check").addClass("d-none");
                    $(`#retracto_phone_number_input_error`).show();
                }
                break;
        }

        // Block or unblock success button
        this.showSuccessBtn();
    }

    /**
     * 
     * @param {String} rutCompleto 
     * @description Validate RUT
     * @returns boolean
     */
    validateRut(rutCompleto) {
		if (!/^[0-9]+[-|]{1}[0-9kK]{1}$/.test(rutCompleto)) return false;
		let inputRut = rutCompleto.split('-');
		let digv = inputRut[1].toLowerCase(); 
		var rut = inputRut[0];
		return (this.rutNumberValidation(rut) == digv );
	}

    /**
     * 
     * @param {String} rutNumber 
     * @description Validate a correct rut number
     * @returns Number | String
     */
	rutNumberValidation(rutNumber){
		let M=0,S=1;
		for(;rutNumber; rutNumber=Math.floor(rutNumber/10))
			S=(S+rutNumber%10*(9-M++%6))%11;
		return S ? S-1 : 'k';
	}

    /**
     * 
     * @param {String} rut
     * @description Verify if i should add - in rut input
     * @returns string 
     */
    setDashInInput(rut, name) {
        let inputRutValue = rut.split("-").join("");
        if (inputRutValue.length > 0) {
            inputRutValue = inputRutValue.replace(/[^0-9kK]/g, '').replace(/^(\d{1,2})(\d{3})(\d{3})(\w{1})$/, '$1$2$3-$4');
        }
        $(`[name=${name}]`).val(inputRutValue)
        return inputRutValue
    }
}

// Instance of controller to validate and do request
const RetractoController = new ValidateAndDoRetractoRequest();

// Do request and create retracto
$("#retracto-btn-send").on("click", (event) => {
    let recaptchaErrorMsg = $("#retracto-form").attr(
        "data-recaptcha-error"
    );
    let errorMsg = $("#retracto-form").attr("data-error-message");

    const isValid = RetractoController.isReadyToSubmit();

    if (isValid) {
        // check if recaptcha is ok
        if (grecaptcha.getResponse().length !== 0) {
            // Dispatch create retracto method
            $("#retracto-btn-send").addClass('cursor-progress')
            RetractoController.createRetracto();
        } else {
            RetractoController.showAlert("error", recaptchaErrorMsg);
        }
    } else {
        RetractoController.showAlert("error", errorMsg);
    }
});

$("#cod-area").on("change", (event) => {
    const { target } = event;
    RetractoController.handleChange(null, target.id, target.value);
});

// Handle oninput of phone number
$("#num-tel").on("input", (event) => {
    const { target } = event;
    RetractoController.handleChange(null, target.id, target.value);
});

// Handle onblur of phone number
$("#num-tel").on("blur", (event) => {
    const { target } = event;
    RetractoController.inputPhoneValidate(target.id, target.value);
});

// Validate each required input before submit
function handleChange(e) {
    RetractoController.handleChange(e);
}

DecoSliderComponent = (function () {
    return class {
        constructor(component, data, i18nData) {
            this.data = data.decopath ? data.decopath : {};
            this.showButton = data.showButton;
            this.component = component;
            this.i18nData = i18nData;
            this.initComponent();
        }

        initComponent() {
            if (typeof productDeatailsLandingComponent !== 'undefined') {
                const observable = productDeatailsLandingComponent.setObservable();

                if (observable) {
                    observable.subscribe((result) => {
                        const plan = result.plan;

                        if (plan && plan.decos && plan.decos.length) {
                            this.data = plan.decos[0];
                            this.fillData();
                        }
                    });
                }
            } else {
                this.fillData();
            }
        }

        fillData() {
            const templateButton = !this.showButton ? '' :
                `<a target="${this.data.target}" href="${this.data.link}" class="btn-deco directv-ui-button ant-action ant-button">${this.i18nData.btnMsg}</a>`;

            try {
                this.component.find('.info-container').html('').append(`
                    <img class="deco-image" src="" alt="${this.data.name}">
                    ${templateButton}
                `);
                this.setBackgroundImage();
                this.setResizedBackgroundImage();
            } catch (error) {
                console.log(error);
            }
        }

        setResizedBackgroundImage() {
            $(window).resize(() => {
                this.setBackgroundImage();
            });
        }
        setBackgroundImage() {
            const width = $(window).width();

            if (width > 769) {
                this.component.find('.info-container .deco-image').attr('src', `${this.data.imageSlider}`);
            } else {
                this.component.find('.info-container .deco-image').attr('src', `${this.data.imageSlider}`);
            }
        }
    };
})();

$('.decoslider-widget').each(function () {
    const data = {
        decopath: $(this).data('decopath'),
        showButton: $(this).data('showbutton')
    };
    const id = $(this).data('idgen');
    const translateData = {
        btnMsg: $(this).data("decobuttonmessage")
    }
    new DecoSliderComponent($('#' + id), data, translateData);
});
const ChatComponentContainer = {
    components: {},
    getComponent(id) {
        return this.components[id];
    },

    setComponent(component, id) {
        this.components[id] = component;
    }
};

const ChatButtonComponent = (function() {

    const defaults = {
        "selectors": {
            "buttonUrl": ".chat-button-message",
            "buttonChat": ".chat-button-button",

            "contactSection": ".new-contact",
            "openNewSection": ".open-contact-section",
            "newContact": ".new-contact"
        },
        "classes": {
            "opened": "opened",
            "hidden": "hidden",
            "show": "show"
        },
        "events": {
            "click": "click",
            "scroll": "scroll"
        },
        "values": {
            "chatArea": 150
        },
        "breakpoints": {
            "mobile": 969
        }
    };

    return class {
        constructor(element, chaturl, buttonId) {
            this.element = element;
            this.chatUrl = chaturl;
            this.buttonId = buttonId;
            this.initComponent();
        }

        initComponent() {
            const hasUTMSourceParams = new URLSearchParams(window.location.search).has('utm_source')
            this.buttonUrl = this.element.querySelector(defaults.selectors.buttonUrl);
            this.buttonChat = this.element.querySelector(defaults.selectors.buttonChat);
            
            this.openContactSection = this.element;
            
            this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector("header").getAttribute("id"));
            
            if (localStorage.getItem('contactSection')) {
                this.getData = JSON.parse(localStorage.getItem('contactSection'));
            }
            
            this.getChatPhone(hasUTMSourceParams);

            this.bindEvents();

            if (this.buttonId != "") {
                this.test(this.buttonId);
            } else {
                $('.chatbutton-widget').removeClass('disabled');
                $('.chat-button-section').removeClass('disabled');
            }


            if ($(defaults.selectors.newContact).children().length > 7) {
                this.maximiseButtons();
            } else {
                var listExtra = this.listExtra();
                for (var i = 0; i < listExtra.length; i++) {
                    $(defaults.selectors.newContact).prepend(listExtra[i]);
                }
            }

            $(window).resize(this.showPhoneWhenOrientationChanges.bind(this));
        }

        listExtra() {
            var listExtra = [];
            $('.new-contact .chat-button-section').each(function() {
                if (!$(this).hasClass('predefined')) {
                    listExtra.push(this);
                    (this).remove();
                }
            });
            return listExtra;
        }

        maximiseButtons() {
            var list = [];
            var listExtra = this.listExtra();
            listExtra.reverse();
            for (var i = 0; i < listExtra.length; i++) {
                list.push(listExtra[i]);
            }
            $('.new-contact .chat-button-section.predefined').each(function() {
                list.push(this);
                (this).remove();
            });

            list.reverse();
            for (var i = 0; i < 6; i++) {
                $(defaults.selectors.newContact).prepend(list[i]);
            }
        }

        async getChatPhone(hasUTMSourceParams) {
            this.headerComponent.eventEmitter.subscribe(({ event, data }) => {
                if (event === 'phoneUpdated') {
                    this.useChatPhone(window.localStorage.getItem('contactphone'))
                }
                if (hasUTMSourceParams) {
                    this.updateUrlWhatsApp(data)
                }
            });
        }

        updateUrlWhatsApp({ whatsappUrl }) {
            let el = $('.chat-button-whatsapp-vtas');
            let otherEl = $('.chat-button-whatsapp-vtas').parent().children('div').children('a');
            $(el).attr('href', whatsappUrl);
            $(otherEl).attr('href', whatsappUrl);
        }

        setClickOutside(el) {
            $(document).mouseup(function(e) {
                if ($(e.target).closest(".chat-button-section").length === 0) {
                    if ($(e.target).closest(".chat-button").length === 0) {
                        if ($(defaults.selectors.newContact).hasClass('show')) {
                            el.openSection(event);
                        }
                    }
                }
            });
        }

        showPhoneWhenOrientationChanges() {
            var phone = window.localStorage.getItem('contactphone');
            this.useChatPhone(phone);
        }

        useChatPhone(chatPhone) {
            let phones = chatPhone;
            this.phone = "";
            var ph = phones;
            var phone;
            if (ph != "" && ph != null) {
                this.phone = ph.split('>')[2].split('<')[0];
                phone = this.phone;
                var el = document.getElementsByClassName('phone-section');
                if (el.length > 0) {
                    $(el).each(function() {
                        if ($(this).hasClass('predefined')) {
                            if (window.innerWidth < 768 && window.innerHeight > window.innerWidth) {
                                if ($(this).children('div:nth-child(2)').text() == '') {
                                    if ($('.phone-message').text().split(' ')[1] == "") {
                                        $(this).children('div:nth-child(2)').text(phone);
                                    } else {
                                        $(this).children('div:nth-child(2)').text($('.phone-message').text().split(' ')[1]);
                                    }
                                }
                            } else {
                                if ($(this).children('div:first-child').text() == '') {
                                    if ($('.phone-message').text().split(' ')[1] == "") {
                                        $(this).children('div:first-child').text('Ventas: ' + phone);
                                    } else {
                                        $(this).children('div:first-child').text('Ventas: ' + $('.phone-message').text().split(' ')[1]);
                                    }
                                }
                            }
                        }
                    });
                }
            }

            if (window.location.pathname == "/") {
                this.setDefaults();
            } else {
                this.setData();
            }

            if (window.location.pathname == "/") {
                this.persistData();
            }
        }

        bindEvents() {
            if (this.buttonUrl) {
                this.buttonUrl.onclick = this.onUrlClicked.bind(this);
                this.element.onclick = this.onUrlClicked.bind(this);
            } else {
                var el = this;
                this.openContactSection.onclick = this.openSection.bind(this);
                var closeButton = document.querySelector('.chat-button-close');
                var chatButton = document.querySelectorAll('.chat-button-chat');
                var newPhone;
                $('.chat-button-phone').each(function() {
                        if ($(this).parent().hasClass('predefined')) {
                            //                        this.onclick = el.showNewPhone.bind(el);                            

                            $(this).on('click', function() {
                                $(this).attr('href', `tel:${el.phone}`);
                                //window.open('tel:' + el.phone);
                            });

                        }
                    })
                    //                var newPhone = document.querySelectorAll('.chat-button-phone');

                if (chatButton) {
                    chatButton.forEach(function(node) {
                        node.onclick = el.onUrlClicked.bind(el);
                    });
                }

                closeButton.onclick = this.openSection.bind(this);

                this.setClickOutside(this);

                //                if(newPhone){
                //                    newPhone.onclick = this.showNewPhone.bind(this);
                //                    newPhone.forEach(function(node){
                //                        node.onclick = el.showNewPhone.bind(el);
                //                    });
                //                }
            }

            this.listenScroll();
        }

        listenScroll() {
            window.addEventListener(defaults.events.scroll, (evt) => {
                if (window.pageYOffset >= defaults.values.chatArea && window.matchMedia(`(max-width: ${defaults.breakpoints.mobile}px)`).matches) {
                    this.openChatContainer();
                } else {
                    this.closeChatContainer();
                }
            });
        }

        openChatContainer() {
            this.element.classList.add(defaults.classes.opened);
        }

        closeChatContainer() {
            this.element.classList.remove(defaults.classes.opened);
        }

        onUrlClicked(event) {
            console.log(this);
            if (!$(event.currentTarget).parent().hasClass('chat-section') && !$(event.currentTarget).parent().hasClass('watson-button') && $(event.currentTarget).children('.magic-button').length <= 0) {
                if (!this.buttonId) {
                    event.preventDefault();

                    const utm_source = new HeaderHelpers().getCookie('lp_utm_source');

                    const chat_url = this.chatUrl + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");

                    window.open(chat_url, "Chat", "width=450,height=450");
                }



            } else if ($(event.currentTarget).parent().hasClass('watson-button')) {
                this.openSection(event);
                $('.watson-container').removeClass('hidden');
                $('.card').removeClass('no-display');
            }
        }

        noShowChat() {
            if ($('.card') && $('.card') != null) {
                $('.card').addClass('no-display');
            }

        }

        test(id) {
            var $this = this;
            var lpButton2 = id;

            function ensureInit(divId, callback) {
                let el = document.getElementById(divId);
                if (el && el !== null) {
                    useDiv(divId, callback);
                }
            }

            function useDiv(divId, callback) {
                let child = document.getElementById(divId).children.length;
                if (child < 1) {
                    setTimeout(function() {
                        ensureInit(divId, callback);

                    }, 50);
                } else {
                    document.getElementById(divId).parentNode.classList.remove('disabled');
                    document.getElementById(divId).classList.remove('disabled');
                    if (!document.getElementById(divId).parentNode.classList.contains('chatbutton-widget')) {
                        if ($('#' + divId).parent().hasClass('yes-no')) {
                            document.getElementById(divId).children[0].onclick = function() {
                                $this.noShowChat();
                            };
                        } else {
                            document.getElementById(divId).children[0].onclick = function() {
                                $this.openSection(event);
                            };
                        }

                    }

                    if (callback) {
                        callback();
                    }
                }
            }
            //            document.getElementById(lpButton2).style.display = "none";
            callEnsureInit(lpButton2);

            function callEnsureInit(divId) {
                ensureInit(divId, function() {
                    //                    document.getElementById(divId).style.display = "block";


                });


            }
        }

        openSection(event) {
            event.preventDefault();

            this.openContactSection.classList.toggle(defaults.classes.hidden);
            var newSection = document.querySelector('.new-contact');
            newSection.classList.toggle(defaults.classes.show);
        }

        showNewPhone(event) {
            event.preventDefault();
            if (window.innerWidth < 768) {
                var $this = this;
                //                var $this = $(event.target).closest('a.chat-button-phone');
                //                $this.phone = $this ? $this.attr('href').split(':')[1] : null;
                var newSection = document.querySelector('.new-contact');
                var newPhone = document.querySelector('.new-phone');
                var span = document.getElementsByClassName('phone-message');
                var ph = $('.chat-button-section.predefined a.chat-button-phone').attr('href').split(':');
                if (ph[1] == "") {
                    $(span).text('Llamar ' + $this.phone);
                    $('.new-phone button:first-child').on('click', function() {
                        window.open('tel:' + $this.phone);
                    });
                } else {
                    $('.new-phone button:first-child').on('click', function() {
                        window.open('tel:' + ph[1]);
                    });
                }

                newSection.classList.remove(defaults.classes.show);
                newPhone.classList.add(defaults.classes.show);

                $('.new-phone button:nth-child(2)').on('click', function() {
                    newSection.classList.add(defaults.classes.show);
                    newPhone.classList.remove(defaults.classes.show);
                });
            }
        }

        persistData() {
            var data = {
                helps: [],
                phones: [],
                whatsapps: [],
                chats: []
            };

            $('.chat-button-help').each(function(tmp) {
                let obj = {
                    helpLabel: "",
                    helpLink: ""
                };

                obj.helpLabel = $(tmp).parent().children('div').html();
                obj.helpLink = $(tmp).attr('href');

                data.helps.push(obj);
            });

            $('.phone-section').each(function(tmp) {
                let obj = {
                    phoneLabelDesktop: "",
                    phoneLabelMobile: ""
                };

                obj.phoneLabelDesktop = $(tmp).children('div:nth-child(1)').html();
                obj.phoneLabelMobile = $(tmp).children('div:nth-child(2)').html();

                data.phones.push(obj);
            });

            $('.chat-button-whatsapp').each(function(tmp) {
                let obj = {
                    whatsappLabel: "",
                    whatsappLink: ""
                };

                obj.whatsappLabel = $(tmp).parent().children('div').html();
                obj.whatsappLink = $(tmp).attr('href');

                data.whatsapps.push(obj);
            });

            $('.chat-button-chat').each(function(tmp) {
                let obj = {
                    chatLabel: ""
                };

                obj.chatLabel = $(tmp).parent().children('div:nth-child(1)').html();

                data.chats.push(obj);
            });

            localStorage.setItem('contactSection', JSON.stringify(data));
        }

        setData() {
            var localStorageContact = this.getData || {};

            $('.chat-button-help').each(function(index, obj) {
                let helpLabel = $(obj).parent().children('div');
                let helpLink = $(obj);
                let stored = localStorageContact.phones ? localStorageContact.phones[index] : null;

                if ($(helpLabel).length > 0) {
                    if ($(helpLabel).html() == ('')) {
                        if (stored && stored.helpLabel && stored.helpLabel != undefined && stored.helpLabel != '') {
                            $(helpLabel).html(stored.helpLabel)
                        } else {
                            $(helpLabel).html('Ayuda Clientes');
                        }
                    }
                }

                if ($(helpLink).length > 0) {
                    if ($(helpLink).attr('href') == ('') || $(helpLink).attr('href') == undefined) {
                        if (stored && stored.helpLink && stored.helpLink != undefined && stored.helpLink != '') {
                            $(helpLink).attr('href', stored.helpLink);
                        } else {
                            $(helpLink).attr('href', '/ayuda');
                        }
                    }
                }
            });

            $('.chat-button-whatsapp').each(function(index, obj) {
                let whatsappLabel = $(obj).parent().children('div');
                let whatsappLink = $(obj);
                let stored = localStorageContact.whatsapps ? localStorageContact.whatsapps[index] : null;

                if ($(whatsappLabel).length > 0) {
                    if ($(whatsappLabel).html() == ('')) {
                        if (stored && stored.whatsappLabel && stored.whatsappLabel != undefined && stored.whatsappLabel != '') {
                            $(whatsappLabel).html(stored.whatsappLabel)
                        } else {
                            $(whatsappLabel).html('Whatsapp Clientes');
                        }
                    }
                }


                if ($(whatsappLink).length > 0) {
                    if ($(whatsappLink).attr('href').length < 40) {
                        if (stored && stored.whatsappLink && stored.whatsappLink != undefined && stored.whatsappLink != '') {
                            $(whatsappLink).attr('href', stored.whatsappLink);
                        }
                    }
                }

            });

            $('.chat-button-chat').each(function(index, obj) {
                let chatLabel = $(obj).parent().children('div:nth-child(1)');
                let stored = localStorageContact.chats ? localStorageContact.chats[index] : null;

                if ($(chatLabel).length > 0) {
                    if ($(chatLabel).html() == ('')) {
                        if (stored && stored.chatLabel && stored.chatLabel != undefined && stored.chatLabel != '') {
                            $(chatLabel).html(stored.chatLabel)
                        } else {
                            $(chatLabel).html('Chat de ventas');
                        }
                    }
                }

                $('.chat-section').each(function() {
                    $(this).children('a').removeAttr('data-chaturl');
                });
            });
        }

        setDefaults() {
            if ($('.chat-button-help').parent().children('div').children('a').html() == ('')) {
                $('.chat-button-help').parent().children('div').children('a').html('Ayuda Clientes');
            }
            if ($('.chat-button-help').attr('href') == ('')) {
                $('.chat-button-help').attr('href', '/ayuda');
                $('.chat-button-help').parent().children('div').children('a').attr('href', '/ayuda');
            }
            if ($('.chat-button-whatsapp').parent().children('div').children('a').html() == ('')) {
                $('.chat-button-whatsapp').parent().children('div').children('a').html('Whatsapp Clientes');
            }
            if ($('.chat-button-chat:first-child').html() == ('')) { $('.chat-button-chat:first-child').html('Chat de ventas'); }

        }
    };
})();

$('.chatbutton-widget').each(function() {
    const id = "btnchat" + $(this).data('idgen');
    let buttonId = $(this).data('buttonid');
    let chatUrl = "";
    const chatpath = $(this).data('chaturl');
    if (buttonId && buttonId != "") {
        chatUrl = "";
    } else {
        chatUrl = chatpath ? chatpath : '/prev-chat.html';
        buttonId = "";
    }
    const element = document.getElementById(id);
    const component = new ChatButtonComponent(element, chatUrl, buttonId);
});
class ChannelSearchComponent {
    constructor(componentData, i18nData) {
        this.path = componentData.path;
        this.id = componentData.id;
        this.i18nData = i18nData;
        this.component = $('#' + this.id);
        this.locale = componentData.locale;
        this.hidefilter = componentData.hidefilter;
        this.category = componentData.category;
        this.selectChannels = componentData.channels;
        this.code = componentData.code;
        this.currentPlan = {};
        this.pagination = 1;
        this.currentWidth = 0;
        this.allChannels = [];
        this.categorydefault = componentData.categorydefault;
        this.currentChannels = [];
        this.options = [];
        this.plans = [];
        this.channelorder = componentData.channelorder;
        this.initComponent();
    }

    initComponent() {
        if (typeof productDeatailsLandingComponent !== 'undefined') {
            const observable = productDeatailsLandingComponent.setObservable();

            if (observable) {
                observable.subscribe((result) => {
                    if (!result.segmentUpdated) this.getDataQuestion(result.plan);
                });
            }
        } else if (this.path) this.getDataQuestion();
    }

    getDataQuestion(plan) {
        this.hidefilter ? this.getFilteredChannels() : this.getData(plan);
    }

    getFilteredChannels() {
        GlobalData.getData(
            Object.assign(GlobalData.defaults.requestData.ALLCHANNELS, { 
                params: { 
                    category: this.category ? this.category.split('/').pop() : "", 
                    currentPagePath: currentPagePath, 
                    component: this.selectChannels === undefined ? '' : 'chanelsearch',
                    code: this.code != undefined && this.code != null ? this.code : ''
                } 
            }))
            .subscribe(
                (channels) => {
					if(this.channelorder === 'name'){
						this.allChannels = channels
                        .filter(a => a ? true : false)
                        .map((ch) => Object.assign(ch, { enabled: true }))
                        .filter((ch) => ch.number < 99999)
                        .sort(this.sortChannelsByName);
                    	this.setChannels(this.allChannels, false);	
					}
					
					if(this.channelorder === 'number'){
						this.allChannels = channels
                        .filter(a => a ? true : false)
                        .map((ch) => Object.assign(ch, { enabled: true }))
                        .filter((ch) => ch.number < 99999)
                        .sort(this.sortChannelsByNumber);
                    	this.setChannels(this.allChannels, false);
					}                    
                }
            );
    }
    
    getData(planData) {
        GlobalData.getMultipleData([
            GlobalData.defaults.requestData.ALLCHANNELS,
            Object.assign(GlobalData.defaults.requestData.CATEGORIES, { params: { type: 'channel' } }),
            Object.assign(GlobalData.defaults.requestData.PLANS, { params: { type: 'postpaid' } }),
            Object.assign(GlobalData.defaults.requestData.PACKS, { params: { view: 'join' } }),
            planData ? null : { path: this.path }
        ].filter((it) => it ? true : false)
        ).subscribe(
            (res) => {
                this.fillData(res[0], res[1], res[2], res[3], planData || res[4][0]);
            }
        );
    }

    fillData(channels, categories, plans, packs, currentPlan) {
        try {
            this.currentPlan = currentPlan;
            this.categories = categories;
            this.plans = plans;
            this.packs = packs;
            this.allChannels = this.setChannelsArray(channels, true);
            this.currentChannels = this.allChannels.slice();

            this.setFilters();
            this.setResponsiveBehavior();
        } catch (error) {
            console.log(error);
        }
    }

    setChannelsArray(channels) {
		if(this.channelorder === 'name'){
			return channels.filter((ch) => ch.number < 99999)
	            .map((ch) => Object.assign({},
	                ch,
	                {
	                    enabled: this.currentPlan.channels.find((chpl) => chpl.id == ch.id) ? true : false
	                }
	            )).sort(
	                this.sortChannelsByName
	            );
		}
		
		if(this.channelorder === 'number'){
	        return channels.filter((ch) => ch.number < 99999)
	            .map((ch) => Object.assign({},
	                ch,
	                {
	                    enabled: this.currentPlan.channels.find((chpl) => chpl.id == ch.id) ? true : false
	                }
	            )).sort(
	                this.sortChannelsByNumber
	            );
        }
    }

	sortChannelsByNumber(a, b) {
		return a.number - b.number; 
	}

    sortChannelsByName(a, b) {
		const textA = a.name.toUpperCase();
        const textB = b.name.toUpperCase();

        return (textA < textB) ? -1 : (textA > textB) ? 1 : a.number - b.number;		
    }

    setFilters() {
        // Filter elements
        const selectContainer = this.component.find('.filter-container');
        const selectButton = selectContainer.find('.filter-select');
        const selectDrop = selectContainer.find('.filter-options');
        const inputFilter = selectContainer.find('.input-filter');
        const searchDecoration = selectContainer.find('.search');
        const cancelButton = selectContainer.find('.cancel');

        // Clean the dropdown options.
        selectDrop.html('');

        // add each element on the dropdown container
        this.categories.forEach((option) => {
            selectDrop.append(`
            <div data-category="${option.id}" class="option not-selected ant-action ant select">
                <img class="icon" src="${option.icon}" alt="">
                <div class="text">${option.name}</div>
            </div>
        `);
        });

        // Add the first option by defect in the select field on the dropdown
        const defaultId = this.categorydefault && this.categorydefault.split('/').pop();
        const defaultCategorie = defaultId ?
            this.categories.find(cat => cat.id === defaultId) :
            this.categories[0];
        const setDefaultItem = () => {
            if (this.categories.length) {
                selectButton.html(`
                    <div class="option">
                        <img class="icon" id="${defaultCategorie.value}" src="${defaultCategorie.icon}" alt="">
                        <div class="text">${defaultCategorie.name}</div>
                    </div>
                    <div class="dtv-public-icon-more dtv-public-icon-x2"></div>
                `);
                this.filterBySelect(defaultCategorie);
            }
        };

        // close and open dropdown functionality
        selectButton.on('click', () => {
            if (selectButton.hasClass('open')) {
                selectButton.removeClass('open');
                selectDrop.removeClass('open');
            } else {
                selectButton.addClass('open');
                selectDrop.addClass('open');
                inputFilter.val('');
                setTimeout(() => {
                    this.filterByInput('');
                }, 0);
            }
        });

        // Dropdown Select element listener.
        selectDrop.find('.option').on('click', (item) => {
            const id = $(item.currentTarget).attr('data-category');
            const option = this.categories.find((option) => option.id == id);

            selectButton.html(`
        <div class="option">
            <img class="icon" src="${option.icon}" alt="">
            <div class="text">${option.name}</div>
        </div>
        <div class="dtv-public-icon-more dtv-public-icon-x2"></div>`);
            this.filterBySelect(option);
            selectButton.removeClass('open');
            selectDrop.removeClass('open');
        });

        inputFilter.keypress(function (e) {
            if (e.which == 13) {
                inputFilter.blur();
            }
        });

        inputFilter.keyup(function (e) {
            if (inputFilter.val().length >= 3) {
                const customDimension = { 'advertContent': "", 'isPrepaid': "" };

                setInteraction("Search", "Channels Search", inputFilter.val(), 0, customDimension);
            }
        });

        // listener in the focus on the input
        inputFilter.on('focus', () => {
            selectButton.removeClass('open');
            selectDrop.removeClass('open');
            searchDecoration.addClass('input-focus');
            selectButton.addClass('input-focus');
            cancelButton.addClass('input-focus');
            this.filterByInput('');
            setDefaultItem();
        });

        // listener in the blur on the input
        inputFilter.on('blur', () => {
            if (inputFilter.val()) {
                this.filterByInput(inputFilter.val());
            } else {
                this.filterBySelect(this.categories[0]);
            }

            selectButton.removeClass('input-focus');
            searchDecoration.removeClass('input-focus');
            cancelButton.removeClass('input-focus');
        });

        $(document).mouseup((e) => {
            if ((!selectButton.is(e.target) && selectButton.has(e.target).length === 0)) {
                selectButton.removeClass('open');
                selectDrop.removeClass('open');
            }
        });
        // Filter by input-------------------------------------------------
        const inputListener$ = new rxjs.Subject();

        inputListener$.pipe(rxjs.operators.debounceTime(400)).subscribe((value) => {
            this.filterByInput(value);
        });
        inputFilter.on('input', () => {
            inputListener$.next(inputFilter.val());
        });
        // ------------------------------------------------------------------------
        cancelButton.on('click', () => {
            inputFilter.val('');
            this.filterBySelect(this.categories[0]);
        });

        setDefaultItem();
    }

    setTooltip() {
        const channelContainer = this.component.find('.channels');
        const promoTooltip = this.component.find('.promo-tooltip');
        let isTouch = false;
        const tooltipListener$ = new rxjs.Subject();

        tooltipListener$.pipe(rxjs.operators.debounceTime(200)).subscribe((value) => {
            if (value.status && value.event) {
                const percentX = (value.event.clientX / $(window).width()) * 100;
                const moreInfo = value.event.tooltipInfo.link;

                promoTooltip.html(`
                <div>${this.i18nData.availableOnly}</div>
                <a target="_self" class="ant-action ant-link" href="${moreInfo}">${value.event.tooltipInfo.name}</a>
            `);
                promoTooltip.css({
                    "display": "flex",
                    "top": value.event.clientY - 72,
                    "left": value.event.clientX + (percentX > 50 ? -155 : 0)
                }).hide().fadeIn('fast');
            } else if (!value.status) {
                promoTooltip.fadeOut('fast');
            }
        });

        channelContainer.find('.channel').mouseenter((event) => {
            const channelCard = $(event.currentTarget);

            if (channelCard.hasClass('disabled') && !isTouch) {
                const currentChannel = this.allChannels.find((ch) => ch.id === channelCard.attr('channel-id'));
                const toolInfo = this.extractInfoInTheTooltip(currentChannel);

                if (toolInfo) {
                    const info = { status: true, event: Object.assign({}, event, { tooltipInfo: toolInfo }) };

                    tooltipListener$.next(info);
                }
            } else {
                isTouch = false;
            }
        });

        $(document).on('mousewheel', function () {
            const info = { status: false, event: null };

            tooltipListener$.next(info);
        });

        channelContainer.find('.channel').mouseleave(function () {
            const info = { status: false, event: null };

            tooltipListener$.next(info);
        });

        channelContainer.find('.channel').on('touchstart', () => {
            isTouch = true;
        });

        promoTooltip.mouseenter(function () {
            const info = { status: true, event: null };

            tooltipListener$.next(info);
        });

        promoTooltip.mouseleave(function () {
            const info = { status: false, event: null };

            tooltipListener$.next(info);
        });
    }

    extractInfoInTheTooltip(currentChannel) {
        const currentPlan = this.plans.filter((pl) => pl.channels.find((ch) => ch.id === currentChannel.id) ? true : false)
            .map((item) => Object.assign({}, item, { diff: item.price - this.currentPlan.price }))
            .filter((item) => item.diff >= 0)
            .sort((pl1, pl2) => pl1.diff - pl2.diff);

        if (currentPlan.length) {
            return currentPlan[0];
        } else {
            return this.packs.filter((pk) => pk.channels.find((ch) => ch.id === currentChannel.id) ? true : false)[0];
        }
    }

    setChannels(channels, tooltip) {
        const channelContainer = this.component.find('.channels');

        channelContainer.html('');
        channels.forEach((channel) => {
            const chanJQ = $(`
                <div channel-id="${channel.id}" 
                    class="channel${!channel.enabled ? ' disabled' : ''}${!channel.link && this.hidefilter ? '' : ' pointer'}">
                    <img class="logo" src="${channel.logo}" alt="">
                    <div class="name">${channel.name}</div>
                    <div class="number">${channel.number}</div>
                </div>
            `);

            if (channel.link && this.hidefilter) {
                chanJQ.on('click', () => {
                    window.open(channel.link, /^((http:\/\/)|(https:\/\/)).*$/.test(channel.link) ? '_blank' : '_self');
                });
            }

            channelContainer.append(chanJQ);
        });

        if (tooltip) this.setTooltip();
    }

    setResponsiveBehavior() {
        this.viewMoreButtonConfig();
        $(window).resize(() => {
            if (this.currentWidth != $(window).width()) {
                this.setPaginator();
            }
        });
    }

    setPaginator() {
        const viewMoreButton = this.component.find('.see-more-button');

        this.currentWidth = $(window).width();
        this.pagination = 1;
        const channelsToShowNumber = this.channelsByRow() * 7;

        if (this.currentWidth < 769) {
            const channelsToShow = this.currentChannels.slice(0, channelsToShowNumber);

            this.setChannels(channelsToShow, true);

            if (channelsToShow.length < channelsToShowNumber) {
                viewMoreButton.css('display', 'none');
                this.component.addClass('finish-paginator');
            } else {
                this.component.removeClass('finish-paginator');
                viewMoreButton.css('display', 'flex');
            }
        } else {
            this.setChannels(this.currentChannels, true);
            viewMoreButton.css('display', 'none');
        }
    }

    channelsByRow() {
        let lastElementOffset = 0;
        let channelsByRow = 0;

        this.component.find('.channels\x20.channel').each((index, element) => {
            if (index) {
                if (lastElementOffset != $(element).offset().top) {
                    channelsByRow = index;

                    return false;
                }
            }

            lastElementOffset = $(element).offset().top;
        });

        return !channelsByRow ? 1 : channelsByRow;
    }

    viewMoreButtonConfig() {
        const viewMoreButton = this.component.find('.see-more-button');

        viewMoreButton.find('.button').off('click').on('click', () => {
            this.pagination += 1;
            const channelsByPage = this.channelsByRow() * 7;
            const channelsToShow = this.currentChannels.slice(0, (this.pagination) * channelsByPage);

            this.setChannels(channelsToShow, true);

            if (channelsToShow.length == this.currentChannels.length) {
                viewMoreButton.css('display', 'none');
                this.component.addClass('finish-paginator');
            } else {
                this.component.removeClass('finish-paginator');
            }
        });
    }

    filterBySelect(category) {
        this.currentChannels = this.allChannels.filter((channel) => channel.category.id == category.id);
        this.setChannels(this.currentChannels, true);
        this.setPaginator();
    }

    filterByInput(filterBy) {
        this.currentChannels = this.allChannels.filter((channel) => channel.name.toLowerCase().includes(filterBy.toLowerCase()))
            .map((ch) => {
                let relevance = 0;

                if (ch.name.toLowerCase() === filterBy.toLowerCase()) {
                    relevance = 1;
                } else if (ch.name.toLowerCase().startsWith(filterBy.toLowerCase())) {
                    relevance = 2;
                } else if (ch.name.toLowerCase().endsWith(filterBy.toLowerCase())) {
                    relevance = 4;
                } else {
                    relevance = 3;
                }

                return Object.assign({}, ch, { relevance });
            }).sort((ch1, ch2) => ch1.relevance - ch2.relevance);
        this.setChannels(this.currentChannels, true);
        this.setPaginator();
    }
}

const channelsearchcomponents = $('.chanel-search-component');
channelsearchcomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const i18nData = {
        availableOnly: component.data('availableonly')
    }
    const country = component.data('country')
    const language = component.data('language')
    const locale = country + '/' + language;

    const componentData = {
        id: id,
        path: component.data('path'),
        hidefilter: component.data('hidefilter'),
        category: component.data('category'),
        channels: component.data('channels'),
        code: component.data('code'),
        locale: locale,
        categorydefault: component.data('categorydefault'),
        channelorder: component.data('channelorder')
    }
    GeneralComponentContainer
        .setComponent(
            new ChannelSearchComponent(componentData, i18nData), componentData.id
        );
});
class cdsLearnMoreContainer {
    constructor(elementRef) {
        this.component = elementRef;
        this.slickInit();
    }

    slickInit() {
        this.component.find('.cds-slider-container').slick({
            dots: false,
            infinite: false,
            slidesToShow: 4,
            slidesToScroll: 1,
            prevArrow: '<div class="prev-arrow"><div class="dtv-public-icon-before dtv-public-icon-x3"></div></div>',
            nextArrow: '<div class="next-arrow"><div class="dtv-public-icon-next dtv-public-icon-x3"></div></div>',
            responsive: [
                {
                    breakpoint: 769,
                    settings: {
                        slidesToShow: 2
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        dots: true,
                        arrows: false
                    }
                }
            ]
        });
    }

    slickRefresh() {
        this.component.find('.cds-slider-container')[0].slick.refresh();
    }
}

$('.cdslearnmore-widget').each(function () {
    const id = $(this).data('idgen');
    GeneralComponentContainer.setComponent(new cdsLearnMoreContainer($('#' + id)), id);
});
$('.movie-card-box .slider').slick({
    centerMode: true,
    centerPadding: '28px',
    slidesToShow: 4,
    prevArrow: '<button type="button" class="slick-prev"> < </button>',
    nextArrow: '<button  type="button" class="slick-next"> > </button>',
    responsive: [
        {
            breakpoint: 1440,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '2%',
                slidesToShow: 4
            }
        },
        {
            breakpoint: 1320,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '2%',
                slidesToShow: 4
            }
        },
        {
            breakpoint: 1224,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '2%',
                slidesToShow: 4
            }
        },
        {
            breakpoint: 1140,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '2%',
                slidesToShow: 4
            }
        },
        {
            breakpoint: 1124,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '15%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 1024,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '12%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 970,
            settings: {
                centerMode: true,
                centerPadding: '10%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 843,
            settings: {
                centerMode: true,
                centerPadding: '6%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 768,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '5%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 736,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '3%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 714,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '16%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 667,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '12%',
                slidesToShow: 2
            }
        },

        {
            breakpoint: 600,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '10%',
                slidesToShow: 2
            }
        },

        {
            breakpoint: 555,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '7%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 525,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '4%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 480,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '24%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 440,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '22%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 420,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '20%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 400,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '18%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 376,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '16%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 321,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '14.5%',
                slidesToShow: 1
            }
        }
    ]
});

$('.movie-card-box .slider .slide').click((element) => {
    window.open($(element.currentTarget).data('cardUrl'), $(element.currentTarget).data('cardTarget'));
});

$('.feedback-card .slider').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    dots: true,
    arrows: true,
    centerPadding: '60px',
    responsive: [
        {
          breakpoint: 767,
          settings: {
            centerPadding: '0px'
          }
        }
    ]
  });

$('.feedback-card .arrows-container .prev-arrow').click(() => {
    $('.feedback-card .slider').slick('slickPrev');
});

$('.feedback-card .arrows-container .next-arrow').click(() => {
    $('.feedback-card .slider').slick('slickNext');
});

$('.movie-card .slider').slick({
    centerMode: true,
    centerPadding: '48px',
    slidesToShow: 6,
    prevArrow: '<button type="button" class="slick-prev"> < </button>',
    nextArrow: '<button  type="button" class="slick-next"> > </button>',
    responsive: [
        {
            breakpoint: 1440,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '9%',
                slidesToShow: 5
            }
        },
        {
            breakpoint: 1320,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '6%',
                slidesToShow: 5
            }
        },
        {
            breakpoint: 1224,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '3%',
                slidesToShow: 5
            }
        },
        {
            breakpoint: 1140,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '2%',
                slidesToShow: 5
            }
        },
        {
            breakpoint: 1124,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '15%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 1024,
            settings: {
                centerMode: true,
                arrows: true,
                centerPadding: '12%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 970,
            settings: {
                centerMode: true,
                centerPadding: '10%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 843,
            settings: {
                centerMode: true,
                centerPadding: '6%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 768,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '5%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 736,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '3%',
                slidesToShow: 3
            }
        },
        {
            breakpoint: 714,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '16%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 667,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '12%',
                slidesToShow: 2
            }
        },

        {
            breakpoint: 600,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '10%',
                slidesToShow: 2
            }
        },

        {
            breakpoint: 555,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '7%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 525,
            settings: {
                arrows: true,
                centerMode: true,
                centerPadding: '4%',
                slidesToShow: 2
            }
        },
        {
            breakpoint: 480,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '24%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 440,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '22%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 420,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '20%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 400,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '18%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 376,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '16%',
                slidesToShow: 1
            }
        },
        {
            breakpoint: 321,
            settings: {
                arrows: false,
                centerMode: true,
                centerPadding: '14.5%',
                slidesToShow: 1
            }
        }
    ]
});

$('.movie-card .slider .slide').click((element) => {
    window.open($(element.currentTarget).data('cardUrl'), $(element.currentTarget).data('cardTarget'));
});

$('.feedback-card .slider').slick({
    slidesToShow: 1,
    slidesToScroll: 1,
    dots: true,
    arrows: true,
    centerPadding: '60px',
    responsive: [
        {
          breakpoint: 767,
          settings: {
            centerPadding: '0px'
          }
        }
    ]
  });

$('.feedback-card .arrows-container .prev-arrow').click(() => {
    $('.feedback-card .slider').slick('slickPrev');
});

$('.feedback-card .arrows-container .next-arrow').click(() => {
    $('.feedback-card .slider').slick('slickNext');
});

class SolidFieldCardComponent {
    constructor(id, properties) {
        this.id = id;
        this.properties = properties;

        this.component = $('#solid-field-card-' + this.id);

        this.initComponent();
    }

    initComponent() {
        this.fillData();
    }

    fillData() {
        this.component.find('.icons-container').append(`<img src="${this.properties.icon}" alt="">`);
        this.component.find('.title').html(`<a target="_self" class="ant-action ant-link ant-value" href="${this.properties.link}">${this.properties.title}<i class="chevron"></i></a>`);
        this.component.find('.description').text(`${this.properties.description}`);
    }

    cleanComponent() {
        this.component.find('.icons-container').html("");
        this.component.find('.title').html("");
        this.component.find('.description').html("");
        this.component.find('.links').html("");
    }
}

$('.cardwithsolidfield-widget').each(function () {
    let id = $(this).data('idgen');
    const properties = {
        icon: $(this).data('icon'),
        title: $(this).data('title'),
        link: $(this).data('link'),
        description: $(this).data('description')
    }
    new SolidFieldCardComponent(id, properties);
});
const BeneficiosCardComponent = (function() {
    const defaults = {
        selectors: {
            sliderContainer: '.cards-slides-container'
        },
        events: {
            resize: 'resize'
        },
        constants: {
            screenPhone: 768
        }
    };

    return class {
        constructor(element, properties) {
            this.element = element;
            this.properties = properties;
            this.initComponent();
            this.bindEvents();
        }

        initComponent() {
            this.slickInitialized = false;
            this.genericSliderDot = new GenericSlidersDotManager(this.element);
            this.initSlider();
        }

        bindEvents() {
            const el = this;

            // Reslick only if it's not slick()
            $(window).on('resize', function() {
                if (el.$SliderContainer && !el.$SliderContainer.hasClass('slick-initialized')) {
                    return el.$SliderContainer.slick(el.sliderSettings);
                }
            });
        }

        initSlider() {
            if (!this.properties.editMode && !this.properties.previewMode) {
                this.slickInitialized = true;
                this.$SliderContainer = $(defaults.selectors.sliderContainer, this.element);
                this.sliderSettings = {
                    slidesToShow: 4,
                    slidesToScroll: 1,
                    dots: false,
                    arrows: false,
                    centerMode: true,
                    centerPadding: '16px',
                    infinite: true,
                    responsive: [
                        {
                            breakpoint: 770,
                            settings: {
                                slidesToShow: 2,
                                dots: true
                            }
                        },
                        {
                            breakpoint: defaults.constants.screenPhone,
                            settings: {
                                slidesToShow: 1,
                                dots: true
                            }
                        },
                        {
                            breakpoint: 2024,
                            settings: "unslick"
                        }
                    ]
                };

                this.$SliderContainer.slick(this.sliderSettings);
            }

            this.genericSliderDot.setTheme('dark');
        }
    };
})();

$('.cardcontent-widget').each(function () {
    const id = $(this).data('idgen');
    const name = $(this).data('name');
    const properties = {
        previewMode: $(this).data('previewmode'),
        editMode: $(this).data('editmode')
    };
    let component = new BeneficiosCardComponent($('#' + id), properties);
    GeneralComponentContainer.setComponent(component);
});
$('.offer-card-container.slider').slick({
    dots: false,
    infinite: false,
    slidesToShow: 3,
    slidesToScroll: 1,
    prevArrow: '<div class="PrevArrow"><div class="arrow dtv-public-icon-before"></div></div>',
    nextArrow: '<div class="NextArrow"><div class="arrow dtv-public-icon-next"></div></div>',
    responsive: [
        {
            breakpoint: 768,
            settings: {
                dots: false,
                slidesToShow: 1,
                slidesToScroll: 1
            }
        },
        {
            breakpoint: 480,
            settings: {
                dots: false,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                centerPadding: '16px'
            }
        }
    ]
});
class CallmeNowComponent {
    constructor(element, options, editMode) {
        this.element = element;
        this.editMode = editMode;
        this.errorMessage = options.phoneErrorMessage;
        this.phoneCodeErrorMessage = options.phoneCodeErrorMessage;
        this.successTitle = options.successTitle;
        this.successDescription = options.successDescription;
        this.errorTitle = options.errorTitle;
        this.errorDescription = options.errorDescription;
        this.eventEmitter = new rxjs.Subject();
        this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMENOW;
        this.initComponent();
    }

    initComponent() {
        this.$title = this.element.find('.callme-header--text');
        this.$button = this.element.find('.button');
        this.$buttonClose = this.element.find('.callme-header\x20.dtv-public-icon-close');
        this.$contactphone = this.element.find('.directv-phone-contact');
        this.$contactphone.inputComponent({ errorMessage: this.errorMessage });
        this.$contactphoneCode = this.element.find('.directv-phone-contact-code');
        this.$contactphoneCode.inputComponent({ errorMessage: this.phoneCodeErrorMessage });

        if (!this.editMode) {
            this.closeModal();
        }

        this.validateInput();
        this.$contactphone.on('input', () => {
            this.validateInput();
        });

        this.$contactphoneCode.on('input', () => {
            this.validateInput();
        });

        this.$buttonClose.click(() => {
            this.closeModal();
            this.eventEmitter.next({
                event: 'callmenow-close',
                data: this.$contactphone.is(':valid')
            });
        });

        this.$button.click(() => {
            const url = '/ofertas/DTVCallBackInterface.ashx';
            const phoneCode = $(".directv-phone-contact-code").val().replace(/\ /g, '');
            const phone = $(".directv-phone-contact").val().replace(/\ /g, '');

            return fetch(url, {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify({
                    "cod_area": phoneCode,
                    "nro": phone
                })
            }).then((response) => {
                if (response.ok) {
                    this.eventEmitter.next({
                        event: 'callmenow-submit',
                        data: this.$contactphone.is(':valid')
                    });
                } else {
                    this.eventEmitter.next({
                        event: 'callmenow-submit-error',
                        data: this.$contactphone.is(':valid')
                    });
                }
            })
                .catch((response) => {
                    console.log(response);
                    this.eventEmitter.next({
                        event: 'callmenow-submit-error',
                        data: this.$contactphone.is(':valid')
                    });
                });
        });
    }

    openModal() {
        this.element.addClass('open');
        this.element.removeClass('close');
    }

    closeModal() {
        this.element.addClass('close');
        this.element.removeClass('open');
    }

    validateInput() {
        if (this.$contactphone.is(':valid') && this.$contactphoneCode.is(':valid')) {
            this.$button.removeAttr('disabled');
        } else {
            this.$button.attr('disabled', 'true');
        }
    }

    formatInput() {
        const isValid = this.$contactphone.is(':valid');
        const maxLength = 9;
        const prevValue = this.$contactphone.attr('data-prev-value');
        let phoneContact = this.$contactphone.val().replace(' ', '').trim();

        if (prevValue && phoneContact.length > maxLength) {
            this.$contactphone.val(prevValue.replace(/(\d)(\d{4})(\d{4})/, '$1 $2 $3'));
        } else {
            phoneContact = phoneContact.replace(' ', '').trim();

            if (phoneContact.length === 9) {
                this.$contactphone.val(phoneContact.replace(/(\d)(\d{4})(\d{4})/, '$1 $2 $3').trim());
            } else if (phoneContact.length === 8) {
                this.$contactphone.val(phoneContact.replace(/(\d{4})(\d{4})/, '$1 $2').trim());
            }

            this.$contactphone.attr('data-prev-value', phoneContact);
        }
    }

    isValid() {
        return this.$contactphone.is(':valid');
    }
}

(function (document, $, ns) {
    "use strict";

    $(document).on("foundation-contentloaded", function () {
        const textAreaCallMeNow = $("input[name*='./boxText']");
        const rteDivCall = textAreaCallMeNow.siblings(".coral-RichText-editable");
        const maxLength = 130;
        const maxBreakLines = 3;
        const arrKeys = [8, 17, 35, 36, 37, 38, 39, 40, 46, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 144];

        rteDivCall.on("drop", function (e) {
            e.preventDefault();
            e.returnValue = false;
        });

        rteDivCall.on("keydown", function (e) {
            const currLen = rteDivCall.text().length;
            const currText = rteDivCall.text();
            const breakCount = rteDivCall[0].childElementCount;

            if (currLen > maxLength - 1) {
                if (jQuery.inArray(e.which, arrKeys) === -1) {
                    e.preventDefault();
                    e.returnValue = false;

                    return false;
                }
            }

            if ((e.which === 13 || e.which === 9) && breakCount > maxBreakLines - 1) {
                e.preventDefault();
                e.returnValue = false;

                return false;
            }
        });

        rteDivCall.on("paste", function (e) {
            const currLen = rteDivCall.text().length;

            e.preventDefault();
            let inText;
            const clipb = (e.originalEvent || e).clipboardData;

            if (clipb === undefined || clipb === null) {
                inText = window.clipboardData.getData("text") || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxLength);
                    inText = inText.substring(0, maxLength - currLen);

                    if (window.getSelection) {
                        const newNode = document.createElement("span");

                        newNode.innerHTML = inText;
                        window.getSelection().getRangeAt(0).insertNode(newNode);
                    } else {
                        document.selection.createRange().pasteHTML(inText);
                    }
                }
            } else {
                inText = clipb.getData('text/plain') || "";

                if (inText !== "") {
                    inText = inText.replace(/<[^>]*>/g, "");
                    inText = inText.replace(/\n/g, "");
                    inText = inText.substring(0, maxLength - currLen);
                    document.execCommand('insertText', false, inText);
                }
            }
        });

        function validationError(message) {
            ns.ui.helpers.prompt({
                title: Granite.I18n.get("Invalid Input"),
                message: message,
                actions: [{
                    id: "CANCEL",
                    text: "CANCEL",
                    className: "coral-Button"
                }],
                callback: function (actionId) {
                }
            });
        }
    });

    $('.callmenow-widget').each(function () {
        const id = $(this).data('idgen');
        let phoneErrorMessage = $(this).data("wizardownerdataerrormessage");
        let phoneCodeErrorMessage = $(this).data("codeareadataerrormessage");
    
        const editMode = $(this).data('editmode');
        const options = {
            phoneErrorMessage: phoneErrorMessage,
            phoneCodeErrorMessage: phoneCodeErrorMessage,
            successTitle: $(this).data('successtitle'),
            successDescription: $(this).data('successdescription'),
            errorTitle: $(this).data('errortitle'),
            errorDescription: $(this).data('errordescription')
        };
    
        const component = new CallmeNowComponent($('#' + id), options, editMode);
        GeneralComponentContainer.setComponent(component, id);
    });
})(document, Granite.$, Granite.author);

const buttonForTrivia = (function() {
    return class {

        constructor(element, href, triviahref, prepaid, postpaid) {
            this.element = element;
            this.country = countryPS;

            this.href = href;

            this.triviahref = triviahref;

            this.prepaid = prepaid;

            this.postpaid = postpaid

            this.initComponent();
        }

        initComponent() {
            const $this = this;
            this.button = $(this.element).find('button');
            this.button.on('click', function() {
                $this.checkBeforeSending();
            });
        }

        checkBeforeSending() {
            let cookies = document.cookie.split(';')
            let type = "";
            let logged = false;
            cookies.forEach(x => {
                if (x.indexOf('SSOType') > -1) {
                    type = x.split('=')[1];
                }

                if (x.indexOf('SSONumber') > -1) {
                    logged = true;
                }
            });

            this.checkAnyUser(type, logged);
        }

        checkAnyUser(type, logged) {
            if (this.prepaid == 'false' && this.postpaid == 'false') {
                window.location.href = this.triviahref;
            } else {
                this.checkUserLoggedIn(type, logged);
            }
        }

        checkUserLoggedIn(type, logged) {
            if (!logged) {
                alert('Esta trivia es solo para usuarios logueados en MiDIRECTV');
                window.location.href = this.href;
            } else {
                this.checkUserType(type);
            }
        }

        checkUserType(type) {
            if (type.toLowerCase().indexOf('pre') > -1 && this.prepaid == 'true' || type.toLowerCase().indexOf('pos') > -1 && this.postpaid == 'true') {
                window.location.href = this.triviahref;
            } else {
                alert('Lo sentimos. Esta trivia no es para su tipo de usuario.');
                window.location.href = "/";
            }
        }

    }
})();

$('.buttonfortrivia-container').each(function() {
    const id = $(this).attr('id');
    const element = document.getElementById(id);
    const href = $(this).attr('href');
    const triviahref = $(this).attr('data-triviahref');
    const prepaid = $(this).attr('data-prepaid');
    const postpaid = $(this).attr('data-postpaid');
    const component = new buttonForTrivia(element, href, triviahref, prepaid, postpaid);
});
function browserDetection ( addClass ) {
    var theBody = $('body'),
        userAgent = window.navigator.userAgent,
        msieIndex = userAgent.indexOf('MSIE '),
        currentBrowser,
        browserClass;
    if ( msieIndex !=-1 ) { // IE <= 10
        var ieVersion = userAgent.substring(msieIndex + 5, userAgent.indexOf('.', msieIndex)); // IE version
        currentBrowser = 'IE' + ieVersion;
        browserClass = 'IE ' + currentBrowser;
    } else if ( userAgent.indexOf('Trident/') !=-1 ) { // IE11
        currentBrowser = 'IE11';
        browserClass = 'IE IE11';
    } else if ( userAgent.indexOf('Chrome') != -1 ) {
        if ( userAgent.indexOf('OPR') != -1 ) { // Opera
            currentBrowser = browserClass = 'Opera';
        } else if ( userAgent.indexOf('Edge') != -1 ) { // Edge
        currentBrowser = browserClass = 'Edge';
        } else {
            currentBrowser = browserClass = 'Chrome'; // Chrome
        }
    } else if (userAgent.indexOf('Safari') != -1 && userAgent.indexOf('Chrome') == -1) { // Safari
        if ( userAgent.indexOf('CriOS') != -1 ) { // Chrome for iOS
            currentBrowser = browserClass = 'Chrome';
        } else {
            currentBrowser = browserClass = 'Safari';
        }
    } else if ( userAgent.indexOf('Firefox') != -1 ) { // Firefox
        currentBrowser = browserClass = 'Firefox';
    } else {
        currentBrowser = 'notDetected';
        browserClass = '';
    }
    if ( addClass ) { // add class
        theBody.addClass(browserClass);
    }
    return currentBrowser; // return value
}

$('.browser-compatible').each(function (index,element) {
    const id = $(element).attr('id');
    const editState = $(element).attr('editstate');
    if(!editState){
        var currentBrowser = browserDetection(true).toUpperCase();
        if(currentBrowser !== 'CHROME' && currentBrowser !== 'SAFARI')
            $(element).addClass('incompatible');
    }
    $(element).find('span.dtv-public-icon-close').click(function(event){
        $(element).removeClass('incompatible');
    });
});
//onChange sumar link a btn

$(document).ready(() => {
    const $controlContainer = $('.dropdown-control-container');
    const $selectBrand = $('#remotecontrol');
    const $btnGoToLanding = $('#btn-goto-landing');

    $controlContainer.addClass('disabled');
    $btnGoToLanding.addClass('disabled', true);
    $btnGoToLanding.on('click', (ev) => ev.preventDefault());
    $selectBrand.on('change', (ev) => {
        const urlLink = ev.target.value;
        if (urlLink) {
            $controlContainer.removeClass('disabled');
            $btnGoToLanding.unbind('click');
            $btnGoToLanding.attr('href', urlLink);
            $btnGoToLanding.removeClass('disabled', false);
        }
    });
});
(function () {
const BreadCrumb = (function () {
    const defaults = {
        "selectors": {
            "header": "header",
            "breadCrumb": ".cmp-breadcrumb",
            "breadCrumbContainer": ".breadcrumb",
            "backButton": ".cmp-breadcrumb__item-back",
            "subList": ".cmp-breadcrumb__sub-list"
        },
        "classes": {
            "show": "show",
            "backButton": "cmp-breadcrumb__item-back",
            "subLink": "cmp-breadcrumb__sub-link",
            "link": ".cmp-breadcrumb__item-link",
            "hide": "hide"
        },
        "events": {
            "click": "click",
            "touchstart": "touchstart",
            "totalHeaderSizeChange": "totalHeaderSizeChange",
            "isHeaderStickyChange": "isHeaderStickyChange"
        },
        "attributes": {
            "id": "id"
        },
        "replaces": {
            "footerPages": "/footer-pages"
        }
    };

    return class {
        constructor() {
            this.$component = $(defaults.selectors.breadCrumb);
            this.$componentContainer = $(defaults.selectors.breadCrumbContainer);
            this.initComponent();
        }

        initComponent() {
            const headerContainer = $(defaults.selectors.header);

            this.$backButton = this.$component.find(defaults.selectors.backButton);
            this.$subList = this.$component.find(defaults.selectors.subList);
            this.headerComponent = HeaderComponentContainer.getComponent(headerContainer.attr(defaults.attributes.id));
            this.replaceUrl(defaults.replaces.footerPages, '');
            this.bindEvents();

            if (this.headerComponent) {
                this.updatePosition(this.headerComponent.getTotalHeaderSize());
                this.updateVisibility(this.headerComponent.isHeaderSticky);
            }
        }

        bindEvents() {
            this.$backButton.on(defaults.events.click, this.handleButtonBackClick.bind(this));
            $(document).on(defaults.events.touchstart + ' ' + defaults.events.click, this.closeBreadCrumb.bind(this));

            this.headerComponent && this.headerComponent.eventEmitter.subscribe((action) => {
                switch (action.event) {
                    case defaults.events.totalHeaderSizeChange:
                        this.updatePosition(action.data);
                        break;
                    case defaults.events.isHeaderStickyChange:
                        this.updateVisibility(action.data);
                        break;
                }
            });
        }

        replaceUrl(oldUrl, newUrl) {
            setTimeout(function(){
                $(defaults.classes.link).each(function(){
                    var link = $(this);
                    var href = link.prop('href');
                    href = href.replace(oldUrl, newUrl);
                    link.prop('href', href);
                });
            }, 1000);
        }

        updatePosition(headerSize) {
            this.$componentContainer.css('top', headerSize || 0);
        }

        updateVisibility(isHeaderSticky) {
            this.$component.toggleClass(defaults.classes.hide, !!isHeaderSticky);
        }

        handleButtonBackClick() {
            this.$subList.toggleClass(defaults.classes.show);
        }

        closeBreadCrumb(event) {
            const $target = $(event.target);

            if (!$target.hasClass(defaults.classes.backButton)
                && !$target.hasClass(defaults.classes.subLink)
                && this.$subList.hasClass(defaults.classes.show)) {
                this.$subList.removeClass(defaults.classes.show);
            }
        }
    };
})();

new BreadCrumb();
})();

// Init Carrousel
(function() {
    const BaseVideoSliderComponent = (function () {
        return class {
            constructor(element, properties) {
                this.element = element;
                this.properties = properties;
                this.initComponent();
            }

            initComponent() {
                this.genericSliderDot = new GenericSlidersDotManager(this.element);
                this.initSlider();
                this.genericSliderDot.setTheme('dark');
            }

            initSlider() {
                if (!this.properties.editMode && !this.properties.previewMode) {
                    this.element.on('init', function (event, slick) {
                        const slidesToShow = slick.slideCount > 4 ? 4 : slick.slideCount;

                        slick.slickSetOption('slidesToShow', slidesToShow, true);
                    });

                    var autoplay = this.element[0].getAttribute('autoplay') === 'true';

                    this.element.slick({
                        slidesToScroll: 1,
                        dots: false,
                        arrows: true,
                        centerMode: false,
                        draggable: false,
                        autoplay: autoplay,
                        responsive: [
                            {
                                breakpoint: 480,
                                settings: {
                                    slidesToShow: 1,
                                    centerPadding: '10px',
                                    dots: true,
                                    arrows: true
                                }
                            },
                            {
                                breakpoint: 768,
                                settings: {
                                    slidesToShow: 2,
                                    centerPadding: '10px',
                                    dots: true,
                                    arrows: true
                                }
                            },
                            {
                                breakpoint: 1024,
                                settings: {
                                    slidesToShow: 3,
                                    dots: true,
                                    arrows: true
                                }
                            }
                        ]
                    });
                }
            }
        };
    })();

    const components = $('.base-video-slider-container');
    components.each((index, element) => {
        const component = $(element);
        const id = component.attr('id');
        const properties = {
            previewMode: component.data('previewmode'),
            editMode: component.data('editmode')
        };
        GeneralComponentContainer.setComponent(new BaseVideoSliderComponent(component, properties), id);
    });

})();
// End Carrousel
const elementsList = {
    bvsmodal:     document.querySelector('.base-modal-wrapper'),
    bvsBaseVideo: document.querySelector('.modal-base-video'),
    getIdAll:     $('.video-slider').find('.item-video')  
}

const { bvsmodal, bvsBaseVideo, getIdAll} = elementsList;

$('.video-card-slide').on('click', function(){
    var getId;
    var parent;
    var ifr;
    let getidFrame = this.querySelectorAll('span')[0].className;
    bvsmodal.classList.add('open');
    bvsBaseVideo.style.display = 'block';
    
    // active item
    getId = 0;
    $('.video-slider .item-video').each(() =>{
        getId = $(this).find(`#${getidFrame}`);
        $(this).children('iframe').remove();
    });

    parent = $(getId.selector).parent();

    // clear
    getIdAll.removeClass('setitem');
    $(getId.selector).parent().addClass('setitem');   

    if($(parent).children('iframe').length > 0){
        $(parent).children('iframe').remove();
    }

    ifr = '<iframe class="iframe-class" width="640" height="360" src="https://www.youtube.com/embed/'+$(`${getId.selector}`).val()+'?enablejsapi=0&origin='+window.location.protocol + '//' + window.location.host+'" frameborder="0" allowfullscreen></iframe>'
    $(parent).append(ifr);



    /// INIT OPERARIONS
    var slides  = $('.item-video'),
    numOfSlides = slides.length;

    var getVideo = $('.setitem input').attr('value');

    var listOfVideos = [];

    $(slides).each(function(){
        listOfVideos.push($(this).children('input').val());
    });

    var setPosition = listOfVideos.indexOf(getVideo);

    function nextSlide(e){
        e.preventDefault();
        if($(slides).children('iframe').length > 0){
            $(slides).children('iframe').remove();
        }
        setPosition++;
        if(setPosition >= numOfSlides){
            setPosition = 0;
        }
        var ifr = '<iframe width="640" height="360" src="https://www.youtube.com/embed/'+listOfVideos[setPosition]+'?enablejsapi=0&origin='+window.location.protocol + '//' + window.location.host+'" frameborder="0" allowfullscreen></iframe>';

        $(slides).append(ifr);
    }

    function previousSlide(e){
        e.preventDefault();
        if($(slides).children('iframe').length > 0){
            $(slides).children('iframe').remove();
        }

        setPosition--;        
        if(setPosition < 0){ 
            setPosition = numOfSlides-1;
        }
        var ifr = '<iframe width="640" height="360" src="https://www.youtube.com/embed/'+listOfVideos[setPosition]+'?enablejsapi=0&origin='+window.location.protocol + '//' + window.location.host+'" frameborder="0" allowfullscreen></iframe>';

        $(slides).append(ifr);
    }

    $('.left').on('click', previousSlide);
    $('.right').on('click', nextSlide);

});


/*Methods Videos*/
function stopVideo( element ) {
	var iframe = element.querySelector( 'iframe');
	if ( iframe ) {
		var iframeSrc = iframe.src;
		iframe.src = iframeSrc;
	}
};


$('.modal-base-video .modal-header-icon').on('click', function(e){
    e.preventDefault();
    var ifr = $('.iframe-class');
    $(ifr).remove();
    bvsmodal.classList.remove('open');
    bvsBaseVideo.style.display = 'none';
    getIdAll.removeClass('setitem');
    getIdAll.removeAttr("style");
    //Stop All Videos
    stopVideo(document.querySelector('.video-slider'));
});
StoresComponent = (function () {
    const defaults = {
        "selectors": {
            "storeTemplateDefault": "#stores-template",
            "compiledContent": ".compiled-content",
            "cards": ".imageText-container"
        },
        "events": {
            "click": "click"
        },
        "data": {
            "cardUrl": "compUrl",
            "cardTarget": "compTarget"
        }
    };

    return class {
        constructor(id, foreignId) {
            this.id = id;
            this.foreignId = foreignId;
            this.component = $('#' + this.id);
            this.type = "";
            this.dataSource = [];
            this.initComponent();
        }

        initComponent() {
        }

        getForeignId() {
            return this.foreignId;
        }

        setDataSource(data) {
            this.dataSource = data;
            this.bindDataSource();
            // this.bindEvents();
        }

        bindDataSource() {
            this.$defaultTemplate = this.component.find(defaults.selectors.storeTemplateDefault);

            if (this.$defaultTemplate.length > 0) {
                const template = Handlebars.compile(this.$defaultTemplate.html());
                const html = [];

                for (let i = 0; i < this.dataSource.length; i++) {
                    html.push(template(this.dataSource[i]));
                }

                this.$compiledContent = this.component.find(defaults.selectors.compiledContent);
                this.$compiledContent.html(html.join(""));
            }
        }

        // bindEvents() {
        //     $(defaults.selectors.cards).click((element) => {
        //         window.open($(element.currentTarget).data(defaults.data.cardUrl), $(element.currentTarget).data(defaults.data.cardTarget));
        //     });
        // }
    };
})();

$('.stores-widget').each(function () {
    const id = $(this).data('idgen');
    const foreignId = $(this).data('foreignid');

    GeneralComponentContainer.setComponent(new StoresComponent(id, foreignId), id);
});
const SocialNetworkContainerModule = (function () {
    const defaults = {
        "selectors": {
            "": ""
        },
        "states": {
            "": ""
        },
        "events": {
            "": ""
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {

        }
    };
})();

$('.social-widget').each(function () {
    const id = $(this).data('idgen');

    GeneralComponentContainer.setComponent(new SocialNetworkContainerModule(id), id);
});
const SocialNetworkModule = (function () {
    const defaults = {
        "selectors": {
            "": ""
        },
        "states": {
            "": ""
        },
        "events": {
            "click": "click"
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {
            this.bindEvents();
        }

        bindEvents() {
            console.log('bind componet');
            this.component.on(defaults.events.click, (element) => {
                window.open($(element.currentTarget).data('link'), $(element.currentTarget).data('target'));
            });
        }
    };
})();

$('.socialnet-widget').each(function () {
    const id = $(this).data('idgen');
    const socialComponent = new SocialNetworkModule(id);

    GeneralComponentContainer.setComponent(socialComponent, id);
});
TableComponent = (function () {
    const defaults = {
        "selectors": {
            "tableTemplateRecharge": "#table-template-recharge-points",
            "tableTemplateRechargeHead": "#table-template-recharge-points-head",
            "tableTemplateRechargeBody": "#table-template-recharge-points-body",
            "compiledContentHead": ".base-table-compiled-content .table-head .aem-Grid.aem-Grid--12.aem-Grid--default--12",
            "compiledContentBody": ".base-table-compiled-content .table-body .aem-Grid.aem-Grid--12.aem-Grid--default--12"            
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.options = options;
            this.component = $('#' + this.id);
            this.initComponent();
            this.dataSource = [];
        }

        initComponent() {

        }

        setDataSource(data, type) {
            switch (type) {
                case "rechargePoints":
                    this.dataSource = data;
                    this.bindRechargePoints();
                    break;
                default:
                    break;
            }
        }

        bindRechargePoints() {
            this.$defaultTemplateHead = this.component.find(defaults.selectors.tableTemplateRechargeHead);
            const templateHead = Handlebars.compile(this.$defaultTemplateHead.html());

            this.$compiledContent = this.component.find(defaults.selectors.compiledContentHead);
            this.$compiledContent.html('');
            this.$compiledContent.append(templateHead(this.options));

            this.$defaultTemplateBody = this.component.find(defaults.selectors.tableTemplateRechargeBody);
            const templateBody = Handlebars.compile(this.$defaultTemplateBody.html());
            const html = [];

            for (let i = 0; i < this.dataSource.length; i++) {
                html.push(templateBody(this.dataSource[i]));
            }
            this.$compiledContent = this.component.find(defaults.selectors.compiledContentBody);
            this.$compiledContent.html('');
            this.$compiledContent.append(html.join(""));

            this.$defaultTemplate = this.component.find(defaults.selectors.tableTemplateRecharge);
            this.$defaultTemplate.hide();
        }
    };
})();

$('.base-table').each(function () {
    const id = $(this).data('idgen');
    const dataSourceType = $(this).data('externaldatasource');
    const options = {};

    switch (dataSourceType) {
        case 'rechargePoints':
            options.paymentMethodTitle = $(this).data('paymentmethodtitle');
            options.storeTitle = $(this).data('storetitle');
            options.addressTitle = $(this).data('addresstitle');
            break;

        default:
            break;
    }

    GeneralComponentContainer.setComponent(new TableComponent(id, options), id);
});
RechargePointsComponent = (function () {
    const defaults = {
        "selectors": {
            "provinceComponent": ".recharge-points-province .directv-autocomplete",
            "locationComponent": ".recharge-points-location  .directv-autocomplete",
            "networkComponent": ".recharge-points-network  .directv-autocomplete",
            "tableComponent": ".recharge-points-table",
            "accordionComponent": ".recharge-points-accordion",

            "tablePaggingLeft": ".table-pagging  .table-pagging-left",
            "tablePaggingRight": ".table-pagging  .table-pagging-right",
            "tablePaggingNumber": ".table-pagging  .table-pagging-number",

            "paggingButton": ".base-accordeon-actions .base-accordeon-action .btn",
            "initialNoResultsPlaceholder": ".recharge-points-initial-no-results",
            "noResultsPlaceholder": ".recharge-points-no-results"

        },
        "endpoints": {
            "networks": `/bin/public-sites/mock/recharge-point.${countryPS}.json?operation=networks`,
            "provinces": `/bin/public-sites/mock/recharge-point.${countryPS}.json?operation=provinces`,
            "locations": `/bin/public-sites/mock/recharge-point.${countryPS}.json?operation=locations&province=`,
            "results": `/bin/public-sites/mock/recharge-point.${countryPS}.json?operation=recharge-points`

        },
        "events": {
            "comboboxselect": "comboboxselect"
        },
        "constants": {
            "all": "select",
            "description": "Selecciona",
            "empty": ""
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.provinces = [];
            this.locations = [];
            this.networks = [];
            this.results = {};
            
            this.provinceId = defaults.constants.all;
            
            this.locationId = defaults.constants.all;
            this.networkId = defaults.constants.all;
            this.pagging = { pageItems: 10, currentPage: 1 };
            this.initComponent();
        }

        initComponent() {
            this.getProvinceComponent();
            this.getLocationComponent();
            this.getNetworkComponent();
            this.getTableComponent();
            this.getAccordionComponent();

            this.getProvinceData();
            this.getNetworkData();

            this.getInitialNoResultPlaceholder();
            this.getNoResultPlaceholder();

            this.bindTablePagination();
            this.bindAccordionPagination();
        }

        getProvinceComponent() {
            const autoCompleteComponent = this.component.find(defaults.selectors.provinceComponent).get(0);

            this.provinceComponent = autoCompleteComponent && autoCompleteComponent.instance;
            this.provinceComponent.setOptions([{ id: defaults.constants.all, description: defaults.constants.description }]);
        }

        getLocationComponent() {
            const autoCompleteComponent = this.component.find(defaults.selectors.locationComponent).get(0);

            this.locationComponent = autoCompleteComponent && autoCompleteComponent.instance;
            this.locationComponent.setOptions([{ id: defaults.constants.all, description: defaults.constants.description }]);
        }

        getNetworkComponent() {
            const autoCompleteComponent = this.component.find(defaults.selectors.networkComponent).get(0);

            this.networkComponent = autoCompleteComponent && autoCompleteComponent.instance;
            this.networkComponent.setOptions([{ id: defaults.constants.all, description: defaults.constants.description }]);
        }

        getTableComponent() {
            this.tableContainer = this.component.find(defaults.selectors.tableComponent);
            this.tableComponent = GeneralComponentContainer.getComponent(this.component.find(defaults.selectors.tableComponent).children().attr('id'));
        }

        getAccordionComponent() {
            this.accordionContainer = this.component.find(defaults.selectors.accordionComponent);
            this.accordionComponent = GeneralComponentContainer.getComponent(this.component.find(defaults.selectors.accordionComponent).children().attr('id'));
        }

        getProvinceData() {
            fetch(defaults.endpoints.provinces)
                .then((respon) => respon.json())
                .then((data) => {
                    const _provinces = [];

                    _provinces.push({ id: "Selecciona", description: "Selecciona" });

                    this.provinces = [...data];
                    data.map((item) => {
                        _provinces.push({ id: item, description: item });
                    });

                    this.provinceComponent.setOptions(_provinces);
                    const $this = this;
                    const { get, set } = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
                    const input = document.querySelector('.recharge-points-province > div .custom-combobox input');
                    Object.defineProperty(input, 'value', {
                        get() {
                            return get.call(this);
                        },
                        set(newVal) {
                            console.log('New value assigned to input province: ' + newVal);
                            $this.provinceId = newVal;
                            $this.locationId = defaults.constants.all;
                            if($this.networkId !== defaults.constants.all){
                                $this.networkId = defaults.constants.all;
                            }
                            $this.pagging = { pageItems: 10, currentPage: 1 };
                            $this.getLocationData();
                            $this.bindLocationData();

                            document.querySelector('.recharge-points-location > div .custom-combobox input').setAttribute('value', defaults.constants.description);

                            document.querySelector('.recharge-points-network > div .custom-combobox input').setAttribute('value', defaults.constants.description);
                            $('.recharge-points-network > div .custom-combobox input').val(defaults.constants.description);

                            return set.call(this, newVal);
                        }
                    });

/*                    this.provinceComponent.component.on('change', (e) => {
                        this.provinceId = ui.item.value;
                        this.locationId = defaults.constants.all;
                        this.networkId = defaults.constants.all;
                        this.pagging = { pageItems: 10, currentPage: 1 };

                        this.getLocationData();
                        this.bindLocationData();
                        this.locationComponent.component.data().customCombobox.input[0].value = defaults.constants.description;
                        this.networkComponent.component.data().customCombobox.input[0].value = defaults.constants.description;
                    });
                    */
                })
                .catch(function () {

                });
        }

        getLocationData() {
            fetch(defaults.endpoints.locations + this.provinceId)
                .then((respon) => respon.json())
                .then((data) => {
                    const _locations = [];

                    this.locations = [];
                    this.locations = [...data];

                    _locations.push({ id: "Selecciona", description: "Selecciona" });

                    data.map((item) => {
                        _locations.push({ id: item, description: item });
                    });

                    this.locationComponent.setOptions(_locations);

                    const $this = this;
                    const { get, set } = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');
                    const input = document.querySelector('.recharge-points-location > div .custom-combobox input');
                    Object.defineProperty(input, 'value', {
                        get() {
                            return get.call(this);
                        },
                        set(newVal) {
                            console.log('New value assigned to input location: ' + newVal);
                            document.querySelector('.recharge-points-network > div .custom-combobox input').setAttribute('value', defaults.constants.description);
                            if($('.recharge-points-network > div .custom-combobox input').val() !== defaults.constants.description){
                                $('.recharge-points-network > div .custom-combobox input').val(defaults.constants.description);
                            }
                            if($this.networkId !== defaults.constants.all){
                                $this.networkId = defaults.constants.all;
                            }
                            $this.locationId = newVal;
                            $this.pagging = { pageItems: 10, currentPage: 1 };
                            $this.getResultData();
                            return set.call(this, newVal);
                        }
                    });


/*                    this.locationComponent.component.on(defaults.events.comboboxselect, (event, ui) => {
                        this.networkComponent.component.data().customCombobox.input[0].value = defaults.constants.description;
                        this.networkId = defaults.constants.all;
                        this.locationId = ui.item.value;
                        this.pagging = { pageItems: 10, currentPage: 1 };

                        this.getResultData();
                    });  */
                })
                .catch(function () {

                });
        }

        getNetworkData() {
            fetch(defaults.endpoints.networks)
                .then((respon) => respon.json())
                .then((data) => {
                    this.networks.push({ id: defaults.constants.all, description: defaults.constants.description });
                    data.map((item) => {
                        this.networks.push({ id: item, description: item });
                    });

                    this.networkComponent.setOptions(this.networks);

                    const $this = this;
                    const { get, set } = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, 'value');

                    const input = document.querySelector('.recharge-points-network > div .custom-combobox input');
                    Object.defineProperty(input, 'value', {
                        get() {
                            return get.call(this);
                        },
                        set(newVal) {
                            console.log('New value assigned to input network: ' + newVal);
                            $($this.networks).each(function(){
                                if(this.description.indexOf(newVal)>-1){
                                    $this.networkId = this.id;
                                }
                            })
                            
                            $this.getResultData();
                            return set.call(this, newVal);
                        }
                    });

/*
                    this.networkComponent.component.on(defaults.events.comboboxselect, (event, ui) => {
                        this.networkId = ui.item.value;
                        this.getResultData();
                    });*/
                })
                .catch(function () {

                });
        }

        getResultData() {
            const _province = `&province=${this.provinceId}`;
            const _location = `&location=${this.locationId}`;
            let network = this.networkId == defaults.constants.all ? '' : `&network=${this.networkId}`;
            if(network.indexOf("Selecciona")>-1){
                network = "";
            }
            const _network = network;
            const _pagging = `&page=${this.pagging.currentPage}&page-size=${this.pagging.pageItems}`;
            const _url = `${defaults.endpoints.results}${_province}${_location}${_network}${_pagging}`;

            fetch(_url)
                .then((respon) => respon.json())
                .then((results) => {
                    let _results = [];

                    this.results = results;
                    _results = results.data.filter((item) => {
                        if (this.provinceId === defaults.constants.all && this.locationId === defaults.constants.all && (this.networkId === defaults.constants.all || this.networkId === "Selecciona")) {
                            return true;
                        }

                        if (this.provinceId !== defaults.constants.all && this.locationId === defaults.constants.all && (this.networkId === defaults.constants.all || this.networkId === "Selecciona")) {
                            if (item.province == this.provinceId) {
                                return true;
                            }
                        }

                        if (this.provinceId !== defaults.constants.all && this.locationId !== defaults.constants.all && (this.networkId === defaults.constants.all || this.networkId === "Selecciona")) {
                            if (item.province == this.provinceId && item.location === this.locationId) {
                                return true;
                            }
                        }

                        if (this.provinceId !== defaults.constants.all && this.locationId !== defaults.constants.all && (this.networkId !== defaults.constants.all && this.networkId !== "Selecciona")) {
                            if (item.province == this.provinceId && item.location === this.locationId && item.network === this.networkId) {
                                return true;
                            }
                        }

                        if (this.provinceId !== defaults.constants.all && this.locationId == defaults.constants.all && (this.networkId !== defaults.constants.all && this.networkId !== "Selecciona")) {
                            if (item.province == this.provinceId && item.network === this.networkId) {
                                return true;
                            }
                        }

                        if (this.provinceId == defaults.constants.all && this.locationId == defaults.constants.all && (this.networkId !== defaults.constants.all && this.networkId !== "Selecciona")) {
                            if (item.network === this.networkId) {
                                return true;
                            }
                        }
                    });

                    console.log(_results);

                    if (_results.length > 0) {
                        this.tableContainer.show();
                        this.accordionContainer.show();
                        this.noResultPlaceholder.hide();
                        this.$tablePaggingNumber.html(this.pagging.currentPage);
                        console.log('show');
                    } else {
                        this.tableContainer.hide();
                        this.accordionContainer.hide();
                        this.noResultPlaceholder.show();
                        console.log('hide');
                    }


                    if (this.pagging.pageItems > this.results.totalRecords) {
                        this.$paggingAccordion.hide();
                    } else { 
                        this.$paggingAccordion.show();
                    }

                    this.initialNoResultPlaceholder.hide();
                    this.tableComponent.setDataSource(_results, "rechargePoints");
                    this.accordionComponent.setDataSource(_results, "rechargePoints");
                })
                .catch(function () {

                });
        }

        getInitialNoResultPlaceholder() {
            this.initialNoResultPlaceholder = this.component.find(defaults.selectors.initialNoResultsPlaceholder);
        }

        getNoResultPlaceholder() {
            this.noResultPlaceholder = this.component.find(defaults.selectors.noResultsPlaceholder);
        }

        bindLocationData() {
            const _select = this.component.find(".recharge-points-location select");

            _select.children().detach();
            _select.append($('<option>', {
                value: defaults.constants.all,
                text: defaults.constants.description
            }));

            this.locations.forEach((item) => {
                _select.append($('<option>', {
                    value: item.id,
                    text: item.name
                }));
            });
        }

        bindTablePagination() {
            this.$tablePaggingLeft = this.component.find(defaults.selectors.tablePaggingLeft);
            this.$tablePaggingRight = this.component.find(defaults.selectors.tablePaggingRight);
            this.$tablePaggingNumber = this.component.find(defaults.selectors.tablePaggingNumber);

            const that = this;

            this.$tablePaggingLeft.on('click', function () {
                that.pagging.currentPage = that.pagging.currentPage > 1 ? that.results.currentPage -= 1 : that.pagging.currentPage;
                that.$tablePaggingNumber.html('');
                that.$tablePaggingNumber.html(that.pagging.currentPage);
                that.getResultData();
            });
            this.$tablePaggingRight.on('click', function () {
                that.pagging.currentPage = that.pagging.currentPage < that.results.totalPages ? (that.pagging.currentPage += 1) : that.pagging.currentPage;
                that.$tablePaggingNumber.html('');
                that.$tablePaggingNumber.html(that.pagging.currentPage);
                that.getResultData();
            });
        }

        bindAccordionPagination() {
            const that = this;

            this.$paggingAccordion = this.component.find(defaults.selectors.paggingButton);
            this.$paggingAccordion.on('click', function () {
                that.pagging.currentPage = 1;
                that.pagging.pageItems = that.pagging.pageItems < that.results.totalRecords ? that.pagging.pageItems += that.pagging.pageItems : that.pagging.pageItems;
                that.getResultData();
            });
        }
    };
})();

$('.rechargepoints-widget').each(function () {
    const id = $(this).data('idgen');
    GeneralComponentContainer.setComponent(new RechargePointsComponent(id), id);
});
PrepaidRechargeComponent = (function () {
    return class {
        constructor(data) {
            const el = this;
            this.data = data;
            this.component = $('#' + data.id);
            this.countryselect = this.component.find('.countryselect');
            this.inputRef = this.component.find('.input-smart-card');
            this.dniRef = this.component.find('.dni-cancel-input');
            this.phoneRef = this.component.find('.phone-cancel-input');            
            this.noClientRef = this.component.find('.noclient-cancel-input');
            this.emailRef = this.component.find('.email-cancel-input');
            this.recaptcha = this.component.find('.recaptcha-field');
            this.btnRef = this.component.find('.btn-smart-card');
            this.iconRef = this.component.find('.tooltip-icon');
            this.titleContainer = this.component.find('.recharge-title-container');
            this.$isIdentificationDefault = this.component.find("input[name='identification']");
            this.$inputRefs = this.component.find("input[type='text']");
            this.$errCaptcha = this.component.find(".directv-input-error-captcha");
            this.typeform = data.formtype;
            this.attempts = data.attempts;

            let minc = this.inputRef.data('minchar');
            let maxc = this.inputRef.data('maxchar');

            this.pattern = `^[0-9]{${minc},${maxc}}$`;
            this.param = 'smartCard';
            this.mask = createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: maxc
            });


            // Default Form
            if(this.typeform === 'optionsset'){

                $('.prepaidrecharge-widget').attr('data-redirecturl', '');

                $('.input-smart-card').bind("cut copy paste",function(e) {
                    e.preventDefault();
                });          
                
                $("input[name='identification']").change(function() {
                    
                    if(this.value !== 'on'){
                        let placeholderText = $(`#identification-${this.value}`).data('placeholdertext');
                        let hintText = $(`#identification-${this.value}`).data('hinttext');
                        let minchar = $(`#identification-${this.value}`).data('minchar');
                        let maxchar = $(`#identification-${this.value}`).data('maxchar');
        
                        $('.helper-text').html(!hintText ? '' : hintText);
                        if (!$('.input-smart-card').hasClass('input-newux')) {
                            $('.input-smart-card').attr("placeholder", !placeholderText ? '' : placeholderText);
                        } else{
                            $('.label-smart-card').html(placeholderText ? placeholderText : '');
                        }

                        el.radioSelect = this.value !== 'on' ? `identification-${this.value}` : el.radioSelect;
        
                        if(this.value === 'dni'){
                            el.param = 'type=Identificacion&value';
                        } else if(this.value === 'smart-card'){
                            el.param = 'type=SmartCard&value';
                        } else {
                            el.param = 'type=Id&value';
                        }
        
                        el.pattern = `^[0-9]{${minchar},${maxchar}}$`;
                        el.mask = createNumberMask({
                            prefix: '',
                            includeThousandsSeparator: false,
                            allowLeadingZeroes: true,
                            integerLimit: maxchar
                        });
        
                        el.inputRef.focus();
                        el.fillConfigData();
                    }
                });

                $('input[type="text"].input-smart-card').on('keyup', function(){
                    el.updateValidState.bind(el);
                    $(`#${el.radioSelect}`).click();
                    el.fillConfigData();
                });

                if (this.$isIdentificationDefault.length > 0) {
                    this.$isIdentificationDefault[0].click();
                }                                

            }
            

            // Cancelation Form
            if(this.typeform === 'cancelform'){
                
                $('input.directv-input').keydown(function(e){
                    var key = e.keyCode || e.charCode;
                    if( key != 8 && key != 46 && key != 9){
                        if($(e.target).val().length >= parseInt($(e.target).attr('data-maxchar')) ){
                            e.preventDefault();
                        }
                    }
                });

                $('input.directv-input').keyup(function(){
                    el.validState.bind(el);
                    el.configData();
                    el.extracData();
                });

                el.cancelForm();          

            }

            // Init Values
            el.fillConfigData();            

            this.getError();

        }

        cancelForm(){
            this.inputValidator(
                this.dniRef.data('minchar'), 
                this.dniRef.data('maxchar'),
                '.dni-cancel-input',
                this.dniRef,
                '.custom-input-error.dni-message'
            );

            this.inputValidator(
                this.phoneRef.data('minchar'), 
                this.phoneRef.data('maxchar'),
                '.phone-cancel-input',
                this.phoneRef,
                '.custom-input-error.phone-message'
            );

            this.inputValidator(
                this.noClientRef.data('minchar'), 
                this.noClientRef.data('maxchar'),
                '.noclient-cancel-input',
                this.noClientRef,
                '.custom-input-error.noclient-message'
            );    
            
            this.inputValidator(
                1, 
                5,
                '.email-cancel-input',
                this.emailRef,
                '.custom-input-error.email-message'
            );
        }

        inputValidator(minc, maxc, selector, element, err){
            const $this = this;
            let pattern = `^[0-9]{${minc},${maxc}}$`;

            let mask = createNumberMask({
                prefix: '',
                includeThousandsSeparator: false,
                allowLeadingZeroes: true,
                integerLimit: maxc
            });           

            if(selector === '.email-cancel-input'){
                pattern = `^([A-Za-z0-9_\\-.])+@([A-Za-z0-9_\\-.])+\\.([A-Za-z]{2,4})$`;
                mask = '';      
            }
            
            $(selector).bind("cut copy paste",function(e) {
                e.preventDefault();
            });            

            $(`input[type="text"]${selector}`).on('keyup', function(){                            
                $this.validState.bind($this);        
                $this.configData(pattern, mask, element, selector);
            });   
            
            $(`input[type="text"]${selector}`).on('blur', function(){
                if($(selector).hasClass('invalid')){
                    $(err).show();
                }else{
                    $(err).hide();
                }
            });   

            this.configData(pattern, mask, element, selector);

        }


        getError() {
            const url = new URL(location.href);
            const errorcode = url.searchParams.get("errorcode");
            const status = url.searchParams.get("IsSmartCardValid");
            this.component.find(`.directv-input-error-code`).hide();
            this.component.find('.directv-input-error-2').hide();

            if(!errorcode){
                if(status==='False'){
                    this.component.find('.directv-input-error-2').show();
                }
            } else {
                this.component.find(`.directv-input-error-${errorcode}`).show();
            }
            this.setAttemps(errorcode);
        }

        setAttemps(code){
            if(this.typeform === 'cancelform'){
                let attemps     = parseInt(sessionStorage.getItem('attemps'));
                let initNumber  = 1;      
                const selectors = {
                    dtvInput: '.directv-input',
                    dtvCaptcha: '.g-recaptcha'
                }
                if(code || attemps){                    
                    !attemps ? sessionStorage.setItem('attemps', initNumber.toString()) : sessionStorage.setItem('attemps', (attemps+1).toString());
                    if(attemps >= (this.attempts - 1)){
                        $(selectors.dtvInput).attr('disabled', 'disabled');              
                        $(selectors.dtvInput).css('cursor', 'not-allowed');
                        $(selectors.dtvCaptcha).addClass("disabled-element");
                        this.component.find(`.directv-input-error-code`).hide();
                        this.component.find(`.directv-attemp-message`).show();
                        this.editInputData(false);
                    } else {
                        $(selectors.dtvInput).removeAttr('disabled', 'disabled');                                      
                        $(selectors.dtvCaptcha).removeClass("disabled-element");
                        $(selectors.dtvInput).css('cursor', '');
                        this.editInputData(true);
                    }
                }
            }

        }

        editInputData(action){
            let getUserdata = sessionStorage.getItem('userData');
            let useUserData = JSON.parse(getUserdata);
            const { dniRef, phoneRef, noClientRef, emailRef } = this;
            if(getUserdata && action){

                dniRef.val(useUserData.clientDni);
                phoneRef.val(useUserData.clientPhone);       
                noClientRef.val(useUserData.clientNoClient);
                emailRef.val(useUserData.clientEmail);

            } else if (getUserdata && !action){

                dniRef.val("");
                phoneRef.val("");       
                noClientRef.val("");
                emailRef.val("");

            } else{
                return
            }
        }

        updateValidState() {
            this.component.find('.directv-input-error-2').hide();
            this.component.find('.directv-input-error-captcha').hide();

            if (this.$documentValidator.value() && this.$documentValidator.isValid() && this.data.recaptchaEnabled && siteKey && this.recaptcha.val() === 'false') {
                this.recaptcha.addClass('validation-missing');
            }

            if (this.$documentValidator.value() && this.$documentValidator.isValid() && ((this.data.recaptchaEnabled && this.recaptcha.val() === 'true') || !this.data.recaptchaEnabled || !siteKey)) {
                this.enableButton();
            } else {
                this.disableButton();
            }
            let _el = $('.input-smart-card');
            setTimeout(function(){
                let parent = _el.parents('.new-form-group');

                if(_el.hasClass('invalid')){
                    parent.addClass('error')
                } else {
                    parent.removeClass('error')
                }
            }, 300)
        }
        
        validState() {
            this.component.find('.directv-input-error-2').hide();
            const {
                $inputDni,
                $inputPhone,
                $inputNoClient,
                $inputEmail,
                recaptcha
            } = this;
            
            const { recaptchaEnabled } = this.data;

            if ($inputDni.value() && $inputDni.isValid() && $inputPhone.value() && $inputPhone.isValid() && $inputNoClient.value() && $inputNoClient.isValid() && $inputEmail.value() && $inputEmail.isValid() && recaptchaEnabled && siteKey && recaptcha.val() === 'false') {
                recaptcha.addClass('validation-missing');
            }  

            if ($inputDni.value() && $inputDni.isValid() && $inputPhone.value() && $inputPhone.isValid() && $inputNoClient.value() && $inputNoClient.isValid() && $inputEmail.value() && $inputEmail.isValid() && ((recaptchaEnabled && recaptcha.val() === 'true') || !recaptchaEnabled || !siteKey)) {
                this.enableButton();
            } else {
                this.disableButton();
            }
        }            

        enableButton(){
            this.btnRef.addClass('btn-primary');
            this.btnRef.removeAttr('disabled');
        }

        disableButton(){
            this.btnRef.removeClass('btn-primary');
            this.btnRef.attr('disabled', 'disabled');
        }

        callButton(str) {     
            var captchaRes;
            const url = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTS.ADQUISITION;
            this.updateValidState();

            this.btnRef.off().on('click', () => {   

                if(this.data.recaptchaEnabled){
                    captchaRes = sessionStorage.getItem('captchaRes');
                } else {
                    captchaRes = sessionStorage.setItem('captchaRes', "");
                    captchaRes = '';
                }

                let validParams = `${url}?action=validatePrepaidRec&countryselect=${this.countryselect.val()}&${str}&sourceId=PublicSite&pagePath=${this.data.currentpage}&captcha=${this.data.recaptchaEnabled}&token=${captchaRes}`;
                this.validToServer(validParams, this.data);
            });
        }

        async validToServer(url, data){
            try{
                const request = await fetch(url);
                if(request.status === 200){                
                    let result = await request.json();
                    if(result.success){
                        window.open(`${result.redirectLink}`, data.redirectTarget);
                        this.$errCaptcha.hide();
                    } else {
                        this.$inputRefs.val("");                        
                        this.recaptcha.val(false);
                        this.$inputRefs.focus();
                        grecaptcha.reset();
                        // Init Values
                        this.inputRef.focus();
                        this.fillConfigData();   
                        this.$errCaptcha.show();  
                        this.$errCaptcha.append('');
                        this.$errCaptcha.html(result.errors[0]);
                    }
                } else {
                    throw new Error('Error fetching response');
                }

            } catch(err){
                console.log(err);
            }
        }

        cancelButton(str, data, tempData) {
            this.validState();
            this.btnRef.off().on('click', () => {
                sessionStorage.setItem('userData', JSON.stringify(tempData));
                window.open(`${data.redirectUrl}?${str}`, data.redirectTarget);             
            });
        }        

        fillConfigData(){
            this.generalConfig = {
                inputCall: this.updateValidState.bind(this),
                pattern: this.pattern,
                mask: this.mask
            };

            this.$documentValidator = new InputValidations(
                this.inputRef,
                this.generalConfig
            );
            
            let queryString = `${this.param}=${this.$documentValidator.value()}`;
            this.callButton(queryString);
            
        }

        
        configData(pattern, mask, element, selector){       
            let config;

            config = {
                inputCall: this.validState.bind(this),
                pattern: pattern,
                mask: mask
            };

            switch(selector) {
                case '.dni-cancel-input':
                    this.$inputDni = new InputValidations(
                        element,
                        config
                    );
                  break;
                case '.phone-cancel-input':
                    this.$inputPhone = new InputValidations(
                        element,
                        config
                    );                  
                  break;
                case '.noclient-cancel-input':
                    this.$inputNoClient = new InputValidations(
                        element,
                        config
                    );                  
                  break;
                case '.email-cancel-input':
                    this.$inputEmail = new InputValidations(
                        element,
                        config
                    );                  
                  break;                    
                default:
                break;
            }         
        }      

        extracData(){
            let queryString = `accnum=${this.$inputNoClient.value()}&source=PublicSite&dnino=${this.$inputDni.value()}&phno=${this.$inputPhone.value()}&emailid=${this.$inputEmail.value()}`;

            let temporalData = {
                clientDni:      this.$inputDni.value(),
                clientNoClient: this.$inputNoClient.value(),
                clientPhone:    this.$inputPhone.value(),
                clientEmail:    this.$inputEmail.value()
            }

            if(queryString){
                this.cancelButton(queryString, this.data, temporalData);
            }
        }


    };
})();

$('.prepaidrecharge-widget').each(function () {
    const data = {
        redirectUrl: $(this).data('redirecturl'),
        redirectTarget: $(this).data('redirecttarget'),
        recaptchaEnabled: $(this).data('recaptchaenabled'),
        currentpage: $(this).data('currentpage'),
        formtype: $(this).data('formtype'),
        attempts: $(this).data('attempts'),
        id: $(this).data('idgen')
    }
    GeneralComponentContainer.setComponent(
        new PrepaidRechargeComponent(data));
});

(function () {
    $(document).ready(function () {
        $('.prepaid-recharge-newux input').focus(function () {
            $(this).parents('.field').addClass('focused');
        });

        $('.prepaid-recharge-newux input').blur(function () {
            let inputValue = $(this).val();
            if (inputValue == "") {
                $(this).parents('.field').removeClass('focused');
            }
            let parent = $(this).parents('.new-form-group');
            if($(this).hasClass('invalid')){
                parent.addClass('error')
            } else {
                parent.removeClass('error')
            }
        });

        $('.prepaid-recharge-newux input').each(function () {
            let inputValue = $(this).val();
            if (inputValue !== "") {
                $(this).parents('.field').addClass('focused');
            }
        });
    });
})();
const OfferLineComponent = (function() {
    const defaults = {};

    return class {
        constructor(element, callmeData, overlapTopComponent) {
            this.element = element;
            this.callmeData = callmeData;
            this.initComponent();

            if (overlapTopComponent) {
                this.overlapTopComponentSetting();
            }
        }

        overlapTopComponentSetting() {
            this.overlapTopComponent();
            $(window).resize(() => {
                this.overlapTopComponent();
            });
        }

        overlapTopComponent() {
            const height = this.element.outerHeight();

            this.element.css('margin-top', -Math.round(height / 2) + 'px');
        }

        initComponent() {
            if (this.callmeData.callmelater === 'yes') {
                if (this.callmeData.callmelaterbutton === 'main') {
                    this.getMainBtn(this.openCallMeLater);
                } else {
                    this.getSecondBtn(this.openCallMeLater);
                }
            }

            if (this.callmeData.callmenow === 'yes') {
                if (this.callmeData.callmelaterbutton === 'main') {
                    this.getSecondBtn(this.openCallMeNow);
                } else {
                    this.getMainBtn(this.openCallMeNow);
                }
            }

            if (this.callmeData.showchat === 'yes') {

                this.getSecondBtn(this.openChat.bind(this));
            }
        }

        getMainBtn(call) {
            this.element.find('#main-btn a').on('click', () => {
                call();
            });
        }

        getSecondBtn(call) {
            this.element.find('#second-btn a').off('click').on('click', () => {
                call();
            });
        }

        openCallMeLater() {
            const $callmelaterModal = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER_MODAL);
            const $callmelater = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMELATER);
            const $alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

            if ($callmelaterModal) {
                $callmelaterModal.openModal();
                $callmelater.eventEmitter.subscribe((info) => {
                    if (info.event === 'callme-later-submit' && $alertComponent) {
                        $alertComponent.setTitle($callmelater.successTitle);
                        $alertComponent.setDescription($callmelater.successDescription);
                        $alertComponent.setStatus('success');
                        $alertComponent.showAlert();
                        $callmelaterModal.closeModal();
                    }

                    if (info.event === 'callme-later-submit-error' && $alertComponent) {
                        $alertComponent.setTitle($callmelater.errorTitle);
                        $alertComponent.setDescription($callmelater.errorDescription);
                        $alertComponent.setStatus('error');
                        $alertComponent.showAlert();
                    }
                });
            }
        }

        openCallMeNow() {
            const $callmenow = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.CALLMENOW);
            const $alertComponent = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT);

            if ($callmenow) {
                $callmenow.openModal();
                $callmenow.eventEmitter.subscribe((info) => {

                    if (info.event === 'callmenow-submit' && $alertComponent) {
                        $callmenow.closeModal();
                        $alertComponent.setTitle($callmenow.successTitle);
                        $alertComponent.setDescription($callmenow.successDescription);
                        $alertComponent.setStatus('success');
                        $alertComponent.showAlert();
                    }

                    if (info.event === 'callmenow-submit-error' && $alertComponent) {
                        $alertComponent.setTitle($callmenow.errorTitle);
                        $alertComponent.setDescription($callmenow.errorDescription);
                        $alertComponent.setStatus('error');
                        $alertComponent.showAlert();
                    }
                });
            }
        }

        openChat() {
            const chatUrl = this.callmeData.chaturl;
            const utm_source = new HeaderHelpers().getCookie('lp_utm_source');
            const chat_url = chatUrl + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");
            if ($('.open-watson-btn').length <= 0 && $('.watson-container').length <= 0) {
                console.log('chat viejo');
                window.open(chat_url, "Chat", "width=450,height=450");
            } else {
                console.log('chat nuevo');
            }
        }
    };
})();

$('.offerline-widget').each(function() {
    const id = $(this).data('idgen');

    const callmeData = {
        callmelater: $(this).data('callmelater'),
        callmenow: $(this).data('callmenow'),
        callmelaterbutton: $(this).data('callmelaterbutton'),
        showchat: $(this).data('showchat'),
        chaturl: $(this).data('chaturl')
    }
    const overlapTopComponent = $(this).data('overlaptopcomp') && $(this).data('isedit');
    const offerLine = new OfferLineComponent($('#' + id), callmeData, overlapTopComponent);
    GeneralComponentContainer.setComponent(offerLine, id);
});
const OfferFilterContainerComponent = (function () {
    const defaults = {
        types: {
            pre: 'prepaid',
            post: 'postpaid',
            noCli: 'non-client'
        },
        locationHash: {
            "prepaid": 'clientes-prepago',
            "postpaid": 'clientes-postpago',
            "non-client": 'clientes-nuevos'
        }
    };

    return class {
        constructor(component, properties, locale) {
            this.locale = locale;
            this.properties = properties;
            this.component = component;
            this.cardsContainer = this.component.find('.filter-cards-container');
            this.headerLoginData = HeaderLoginData;
            defaults.locationHash = DIRECTV_PUBLIC_SITES_CONSTANTS.OFFER_NAMES[properties.country]
            this.getComponents();
        }

        getComponents() {
            this.segmentsAutocomplete = GeneralComponentContainer.getComponentByName(DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.SEGMENTSAUTOCOMPLETE);
            this.filterControls = GeneralComponentContainer.getComponent(this.component.find("#filter-controls").children().attr('id'));
            this.filterControls.eventEmitter.subscribe((info) => {
                window.location.hash = defaults.locationHash[info.data];
            });

            if (this.segmentsAutocomplete) {
                this.segmentsAutocomplete.eventEmitter.subscribe((event) => {
                    if (event) {
                        this.getOffers(event.data);
                    }
                });
            } else {
                this.getOffers();
            }
        }

        getOffers(segment) {
            const path = `/content/admin/${this.locale}/offers-retail/_jcr_content.dtvoffer.valid${segment ? '.' + segment : ''}.json`;

            this.cardsContainer.html('');
            GlobalData.getData({ path: path })
                .subscribe((response) => {
                    this.setOfferCards(response.offers);
                    this.setFilterBy();
                    window.onhashchange = () => {
                        this.setFilterBy();
                    };
                });
        }

        filterByQueryString(hash) {
            if (hash.includes(defaults.locationHash["non-client"])) {
                return defaults.types.noCli;
            } else if (hash.includes(defaults.locationHash.prepaid)) {
                return defaults.types.pre;
            } else if (hash.includes(defaults.locationHash.postpaid)) {
                return defaults.types.post;
            } else {
                return false;
            }
        }

        setTypeOfUser() {
            if (this.headerLoginData.isPostPaid()) {
                return defaults.types.post;
            } else if (this.headerLoginData.isPrePaid()) {
                return defaults.types.pre;
            } else {
                return defaults.types.noCli;
            }
        }

        setFilterBy() {
            const filter = this.filterByQueryString(window.location.hash) || this.setTypeOfUser();

            this.filterBy(filter);
            this.filterControls.setFilter(filter);
        }

        filterBy(param) {
            this.cardsContainer.find('.card').filter('[filter-type!=' + param + ']').css('display', 'none');
            this.cardsContainer.find('.card').filter('[filter-type=' + param + ']').css('display', '');
        }

        setOfferCards(offerCards) {
            offerCards.map((card) => {
                this.cardsContainer.append(
                    new ProductOfferCardComponent($(`<div class="card" filter-type="${card.type}" ></div`),
                        Object.assign({}, card, this.properties)).component);
            });
        }
    };
})();

$('.offerfilter-widget').each(function () {
    const id = $(this).data('idgen');
    const country = $(this).data('country');
    const properties = {
        imagePost: $(this).data('imagepost'),
        imagePre: $(this).data('imagepre'),
        country:country
    }
    const language = $(this).data('language');
    const locale = country + '/' + language;
    GeneralComponentContainer.setComponent(
        new OfferFilterContainerComponent($('#' + id), properties,locale), id
    );
});
const offerBannerComponent = (function () {
    const defaults = {
        "classes": {
            "hidde": "hidde-offer-banner"
        }
    };

    return class {
        constructor(element, properties) {
            this.element = element;
            this.editMode = properties.editMode;
            this.initComponent();
        }

        initComponent() {
            this.onUserReturn();
        }

        onUserReturn() {
            !this.editMode && HeaderLoginData.getDataAccount().subscribe((data) => {
                if (data.in_session === true && data.type === "") {
                    this.element.addClass(defaults.classes.hidde);
                }
            });
        }
    };
})();

$('.offerbanner-widget').each(function () {
    const id = $(this).data('idgen');
    const properties = {
        "userReturn": $(this).data('userreturn'),
        "editMode": $(this).data('editmode')
    };
    const offerBanner = new offerBannerComponent($('#' + id), properties);
    GeneralComponentContainer.setComponent(offerBanner, id);
});
  class ImageCardsContainerComponent {
    constructor(component, id){
        this.id = id;
        this.component = component;
        this.slidesSpeedjs = '400ms';
        this.buttonActive = null;
        this.buttonActiveContainer = null;
        this.move = 0;
        
        this.initComponent();
    }
  
    initComponent() {
        this.bindEvents();
    }
  
    addTransitionSliderDot() {
        const that = this;
        const buttonId = `buttonTransition-${this.id}`;
        let dotsCount = this.component.find('.slick-dots > li').length;

        if (this.buttonActive) {
            this.move += 5;
            this.buttonActive.animate({
                left: "+=" + 5,
                width: 20 + "px"
            }, 20);
  
            setTimeout(function () {
                that.buttonActive.animate({
                    width: "40px"
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 200,
                    easing: 'easeInCubic'
                });
                that.buttonActive.animate({
                    left: (that.move * -1) - 15
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 600
                });
            }, 50);

            this.move = 0;
        }
        
        this.buttonActiveContainer = this.component.find('.slick-dots\x20.slick-active');
  
        if (this.buttonActive === null) {
            this.buttonActive = $(`<button id='${buttonId}' class='active-button' />`);
            this.buttonActiveContainer.append(this.buttonActive);
        }

        if(dotsCount < 2){
            this.component.find('.slick-dots').remove();
        }
    }
  
    transitionDot(leftToRight) {
        const $activeButton = this.component.find('.slick-dots\x20.active-button');
        const that = this;
  
        if (leftToRight == true) {
            that.move += 5;
            $activeButton.animate({
                left: "+=" + 5,
                width: 20 + "px"
            }, 20);
  
            setTimeout(function () {
                that.move += 5;
                $activeButton.animate({
                    width: "40px"
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 200,
                    easing: 'easeInCubic'
                });
                $activeButton.animate({
                    left: "+=" + 35
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 600
                });
            }, 50);
        } else {
            $activeButton.animate({
                left: "+=" + 5,
                width: 20 + "px"
            }, 20);
  
            setTimeout(function () {
                $activeButton.animate({
                    width: "40px"
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 200,
                    easing: 'easeInCubic'
                });
                $activeButton.animate({
                    left: "-=" + 45
                }, {
                    queue: false,
                    duration: parseInt(that.slidesSpeedjs) + 600
                });
            }, 50);
        }
    }
  
    bindEvents() {
        const that = this;
        let total = this.component.find('.slide-card').length;
        let highlight = this.component.find('.slide-highlight').length;
        let slideSize = 5;

        if(total + highlight > 4){
            slideSize = 2;
        }

        this.component.on('init', function (slick) {
            that.addTransitionSliderDot();
        });

        var autoplay = this.component[0].getAttribute('autoplay') === 'true';

        this.component.slick({
            /* 
            slidesToScroll: 1,
            useCustomTransition: true, */
            dots: true,
            arrows: false,
            infinite: true,
            autoplay: autoplay,
            variableWidth: true,
            useCustomTransition: true,
            autoPlaySpeed: 4000,
            speed: parseInt(that.slidesSpeedjs, 10),
            slidesToShow: slideSize,
            responsive: [
                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 1,
                        variableWidth: false
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        centerMode: true,
                        centerPadding: '0px',
                        variableWidth: false
                    }
                }
            ]
        });
    
        this.component.on('beforeChange', function (event, slick, currentSlide, nextSlide) {
            const ltr = nextSlide > currentSlide;
    
            if (nextSlide == currentSlide + 1 || nextSlide == currentSlide - 1) {
                that.transitionDot(ltr);
            } else {
                setTimeout(function () {
                    that.addTransitionSliderDot();
                }, 1);
            }
        });
    }
  }

const imagecomponents = $('.imagecards-widget');
imagecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');

    GeneralComponentContainer.setComponent(new ImageCardsContainerComponent($('#' + id), id), id);
});

let siCliente = document.querySelector('.si-cliente');
let noCliente = document.querySelector('.no-cliente');
let titlesComponents = document.querySelector('.titlesComponents');
let radioButtons = document.querySelector('.radioButtons');
let callmeLaterForm = document.querySelector('.callme-later');
let inputsNoClient = document.querySelectorAll('.no-cliente input');
let separatorForm = document.querySelector(".component-separator-class");
let textAreaNoClient = document.querySelector('.no-cliente textarea'),
    textRequiredElements = document.querySelector('.client-description.logged'),
    editmode = document.querySelector('#callme-later-with-login') ? document.querySelector('#callme-later-with-login').getAttribute('data-editmode') : false; 

if(textAreaNoClient != null){
    textAreaNoClient.disabled = true;
}

if(separatorForm != null){
    separatorForm.classList.remove('height-4x-unitsize');
}

isDisabledElements(true);
editmode = document.querySelector('#callme-later-with-login');

if(siCliente != null){
    document.querySelector('#isClient').addEventListener("click", function () { 
        noCliente.classList.add('hide');
        siCliente.classList.remove('hide');
        titlesComponents.classList.add('blur');
    });
}

if(noCliente != null){
    document.querySelector('#isNotClient').addEventListener("click", function () {  
        noCliente.classList.remove('hide');
        siCliente.classList.add('hide');
        noCliente.classList.remove('blur');
        titlesComponents.classList.remove('blur');
        textAreaNoClient.disabled = false;
        isDisabledElements(false);
    });
}


if (!editmode && HeaderLoginData.isLoggedIn()) {
    titlesComponents.classList.add('hide');
    radioButtons.classList.add('hide');
    textRequiredElements.classList.add('hide');
    noCliente.classList.add('hide');
    siCliente.classList.remove('hide');
    nullVerification()
}

function isDisabledElements(isDisabled) {
    for (var i = 0; i < inputsNoClient.length; i++) {
        inputsNoClient[i].disabled = isDisabled;
    }
}

BaseSliderComponent = (function () {
    const defaults = {
        "selectors": {

        },
        'slideConfig': {

        }
    };

    return class {
        constructor(id, isEditing) {
            this.id = id;
            this.component = $('#' + this.id);
            if (!isEditing) {
                this.setResources();
                this.slickInit();
            }
        }

        setResources() {
            this.component.find('.resource-container').each((index, target) => {
                const resourceUrl = $(target).attr('resource-link');
                if ((/\.(gif|jpg|jpeg|tiff|png)$/i).test(resourceUrl)) {
                    $(target).html(`<img src="${resourceUrl}" alt="">`);
                } else if ((/\.(mp4)$/i).test(resourceUrl)) {
                    $(target).html(
                        `<video class="slider-video" controls>
                            <source src="${resourceUrl}" type="video/mp4">
                        </video>`);
                } else if (/^(https?\:\/\/)?((www\.)?youtube\.com|youtu\.?be)\/.+$/.test(resourceUrl)) {
                    $(target).html(`<iframe 
                        class="youtube"
                        allowfullscreen
                        src="${resourceUrl}">`);
                }
            })
        }

        slickInit() {
            this.slider = this.component.find('.slider-container').slick({
                prevArrow: '<div class="PrevArrow"><div class="arrow dtv-public-icon-before"></div></div>',
                nextArrow: '<div class="NextArrow"><div class="arrow dtv-public-icon-next"></div></div>',
            });
            this.slickRefresh();
        }

        slickRefresh() {
            setTimeout(() => {
                if (!this.slider.find('.slick-track').width()) {
                    this.slider.slick('refresh')
                }
                this.slickRefresh();
            }, 800);
        }
    };
})();

$('.slider-widget').each(function () {
    const id = $(this).data('idgen');
    const isPreview = $(this).data('ispreview');
    const isEdit = $(this).data('isedit');

    GeneralComponentContainer.setComponent(new BaseSliderComponent(id, isPreview || isEdit), id);
});
ModalComponent = (function () {
    const defaults = {
        "selectors": {
            "modalClose": ".modal-header-icon",
            "valid": ":valid"
        },
        "classes": {
            "open": "open",
            "close": "close"
        },
        "attributes": {},
        "events": {}
    };

    return class {
        constructor(id, name) {
            this.id = id;
            this.name = name;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.initComponent();
        }

        initComponent() {
            this.$modalClose = this.component.find(defaults.selectors.modalClose);
            this.$modalClose.click(() => {
                this.component.removeClass(defaults.classes.open);
                $('.youtube').each(function () {
                    let reSrc = $(this).attr("src");
                    $(this).attr("src", reSrc);
                });
                $('.slider-video').each(function () {
                    this.pause();
                });
            });
        }

        showModal(isClosed) {
            this.component.toggleClass(defaults.classes.open, isClosed);
        }
    };
})();

$('.modal-widget').each(function () {
    const id = $(this).data('idgen');
    const name = $(this).data('name');
    const options = {
    };
    GeneralComponentContainer.setComponent(new ModalComponent(id, name), id);
});
BaseContainerSportsComponent = (function () {
    const defaults = {
        "selectors": {
            background: ".baseContainerSports-background",
            backgroundDesktop: ".baseContainerSports-background-desktop",
            backgroundMobile: ".baseContainerSports-background-mobile"
        },
        "events": {
            "load": "load"
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {
            this.$background = this.component.find(defaults.selectors.background);
            this.$backgroundDesktop = this.component.find(defaults.selectors.backgroundDesktop);
            this.$backgroundMobile = this.component.find(defaults.selectors.backgroundMobile);
            this.setupComponent();
        }

        setupComponent() {
            if (this.$backgroundDesktop.get(0) && this.$backgroundMobile.get(0)) {
                const minHeight = $(this.$backgroundDesktop).is(":visible") ? this.$backgroundDesktop.get(0).naturalHeight : this.$backgroundMobile.get(0).naturalHeight;

                if(minHeight){
                    this.component.css("min-height", minHeight);
                    this.$background.css("height", "100%");
                }
                else{
                    setTimeout(() => {
                        this.setupComponent();
                    }, 100);
                }
            } 
        }
    };
})();

$('.baseContainerSports').each(function () {
    const id = $(this).data('idgen');

    GeneralComponentContainer.setComponent(new BaseContainerSportsComponent(id), id);
});
const BaseContainerAnchorlinksComponent = (function () {
    const defaults = {
        "selectors": {
            "anchorLinks": ".dtv-anchor-links-content-list .anchor-link a",
            "root": ".root",
            "phonebar": ".header-phones",
            "header": "header"
        },
        "classes": {
            "phonesVisible": "phones-visible",
            "phonebarLock": "phonebar-locked"
        },
        "attributes": {
          
            "id": "id"
        },
        "events": {
            "click": "click"
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.options = options;
            this.initComponent();
        }

        initComponent() {
            this.$anchorLinks = this.component.find(defaults.selectors.anchorLinks);
            this.bindEvents();
        }

        bindEvents() {
            this.$anchorLinks.on(defaults.events.click, this.onAnchorElementClicked.bind(this));
        }

        onAnchorElementClicked(event) {
            event.preventDefault();
            $(defaults.selectors.root).removeClass(defaults.classes.phonesVisible);
            const $target = $(event.currentTarget);
            const idSectionToScroll = encodeURI($target.attr('href'));
            const headerHeight = $(defaults.selectors.header).innerHeight();
            const phonebarHeight = $(defaults.selectors.phonebar).hasClass(defaults.classes.phonebarLock) ? $(defaults.selectors.phonebar).innerHeight() : 0;
            const targetPosition = $(idSectionToScroll).offset().top - ( headerHeight + phonebarHeight );

            $('html, body').animate({
                "scrollTop": targetPosition,
                "easing": "easein"
            }, 350 * (this.$anchorLinks.index($target) + 1));

            location.hash = idSectionToScroll;
        }
    };
})();

$('.anchorlinks-widget').each(function () {
    const id = $(this).data('idgen');

    GeneralComponentContainer.setComponent(new BaseContainerAnchorlinksComponent(id), id);
});
BaseContainerComponent = (function () {
    const defaults = {
        "selectors": {
            backgroundDesktop: ".baseContainer-background-desktop",
            backgroundMobile: ".baseContainer-background-mobile"
        },
        "classes": {
            "userReturn": "userReturn"
        },
        "events": {
            "load": "load"
        }
    };

    return class {
        constructor(id, properties) {
            this.id = id;
            this.component = $('#' + this.id);
            this.userReturn = properties.userReturn;
            this.editMode = properties.editMode;
            this.initComponent();
        }

        initComponent() {
            this.$backgroundDesktop = this.component.find(defaults.selectors.backgroundDesktop);
            this.$backgroundMobile = this.component.find(defaults.selectors.backgroundMobile);
            this.iframe = $('.baseContainer-content iframe');
            
            this.setupComponent();
            this.setupIFrame();
            this.userReturn && this.onUserReturn();
            this.resizeIframe();
            $(window).resize(this.resizeIframe.bind(this));
        }

        setupComponent() {
            if (this.$backgroundDesktop.get(0) && this.$backgroundMobile.get(0)) {
                const minHeight = $(this.$backgroundDesktop).is(":visible") ? this.$backgroundDesktop.get(0).naturalHeight : this.$backgroundMobile.get(0).naturalHeight;

                this.component.css("min-height", minHeight);
            }
        }

        onUserReturn() {
            !this.editMode && HeaderLoginData.getDataAccount().subscribe((data) => {
                if (data.in_session === false && data.type !== "") {
                    this.component.removeClass(defaults.classes.userReturn);
                }
            });
        }

        setupIFrame() {
            if(this.iframe){
                this.iframe.prop('scrolling', 'auto');
                this.iframe.prop('frameborder', 0);
                this.iframe.prop('align', 'middle');
                this.iframe.prop('allowtransparency', 'true');
            }
        }

        resizeIframe() {
            var parent = this.iframe.closest('.external.parbase');
            
            if ($(window).width() < 960) { 
                parent.css('overflow-x', 'scroll');
                this.iframe.height(700);
            }else{
                parent.css('overflow-x', 'unset');
                this.iframe.height(900);
            }
        }
    };
})();

$('.dtvbase-widget').each(function () {
    const id = $(this).data('idgen');
    const properties = {
        "userReturn": $(this).data('userreturn'),
        "editMode": $(this).data('editmode')
    };
    GeneralComponentContainer.setComponent(new BaseContainerComponent(id, properties), id);
});
BaseAccordionComponent = (function () {
    const defaults = {
        "selectors": {
            'actionBtn': "> .title-container",
            'layout': "> .layout-cont",
            'icon': '.icon',
            'isOpen': '.is-open',
            'isClose': '.is-close',
            'base': '.baseAccordion'
        },
        'slideConfig': {
            duration: 200
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            const actionBtn = this.component.find(defaults.selectors.actionBtn);
            const layout = this.component.find(defaults.selectors.layout);

            const anotherAccordions = this.component.closest('.base-accordion').siblings('.base-accordion').find('> .baseAccordion');
            actionBtn.on('click',
                (event) => {
                    event.stopPropagation();
                    anotherAccordions.find(defaults.selectors.layout).slideUp();
                    const anotherActionButtons = anotherAccordions.find(defaults.selectors.actionBtn);

                    anotherActionButtons.find(defaults.selectors.icon).removeClass('rotate');
                    anotherActionButtons.find(defaults.selectors.isOpen).hide();
                    anotherActionButtons.find(defaults.selectors.isClose).show();

                    layout.slideToggle();

                    actionBtn.find(defaults.selectors.icon).toggleClass('rotate');
                    actionBtn.find(defaults.selectors.isOpen).toggle();
                    actionBtn.find(defaults.selectors.isClose).toggle();
                }
            );
        }
    };
})();

const accordeoncomponents = $('.baseAccordion');

accordeoncomponents.each((index, element) => {
    const id = $(element).attr('id');
    GeneralComponentContainer.setComponent(new BaseAccordionComponent(id), id);
});
function handleBaseInputChange(e) {
    let min = e.target.getAttribute('minlength')
    let max = e.target.getAttribute('maxlength')
    // Initial DNI input validate
    if (e.target.name.toLowerCase().includes('dni')) {
        if (String(e.target.value).length >= min && String(e.target.value).length <= max ) {
            $('.button-wrapper > button').attr('disabled', false)
            $(`[name=${e.target.name}]`).removeClass('error')
            $(`#${e.target.name}_error_message`).hide()
        } else {
            $('.button-wrapper > button').attr('disabled', true)
            $(`[name=${e.target.name}]`).addClass('error')
            $(`#${e.target.name}_error_message`).show()
        }
    }
    // Activate error style and message with this
    // $(`[name=${e.target.name}]`).addClass('error')
    // $(`#${e.target.name}_error_message`).show()
}
DropdownComponent = (function () {
    const defaults = {
        "selectors": {
            "": ""
        },
        "states": {
            "": ""
        },
        "events": {
            "": ""
        }
    };

    return class {
        constructor(id, foreignId) {
            this.id = id;
            this.foreignId = foreignId;
            this.component = $('#' + this.id);
            this.initComponent();
            this.dataSource = [];
        }

        initComponent() {
           
        }

        getForeignId() {
            return this.foreignId;
        }

        setDataSource(data) {
            this.dataSource = data;
            this.bindDataSource();
        }

        bindDataSource() {
           
        }
    };
})();

$('.base-dropdown').each(function () {
    const id = $(this).data('idgen');
    const foreignId = $(this).data('foreignid');

    GeneralComponentContainer.setComponent(new DropdownComponent(id, foreignId), id);
});
class simpleTableComponent {
    constructor() {
        this.table = document.querySelectorAll('.simple-table-container .table');
        this.init();
    }

    init() {
        let tHeadRow;
        let tHeadTh;
        
        this.table.forEach(function(el) {
            tHeadRow = el.querySelector('thead tr');
            tHeadTh  = tHeadRow.getElementsByTagName("th").length;
            (tHeadTh <= 1) ? el.classList.add('setwidth') : el.classList.remove('setwidth');
        });
    }
}

$('.simple-table-container').each(function () {
    new simpleTableComponent();
});
class PopupButtonComponent {
    constructor(element, url) {
        this.element = element;
        this.url = url;
        this.bindEvents();
    }

    bindEvents() {
        this.element.on('click', (event) => {
            event.preventDefault();
            window.open(this.url, "Chat", "width=450,height=450");
        });
    }
}

$('.base-popup-container').each(function () {
    const id = $(this).data('idgen');
    const chatUrl = $(this).data('linkurl');

    new PopupButtonComponent($('#' + id), chatUrl);
});
PanelComponent = (function () {
    const defaults = {
        "selectors": {
            "panelTextPhone": ".panel-text-phone p"
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.component = $('#' + this.id);
            this.$panelText = this.component.find(defaults.selectors.panelTextPhone);
            this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector('header').getAttribute('id'));

            this.headerComponent.eventEmitter.subscribe((action) => {
                action.event == 'phoneUpdated' && this.updateTexts(window.localStorage.getItem('contactphone'));
            });
        }

        updateTexts(contactPhone) {
            this.$panelText.html(`${this.$panelText.html()} <br/> ${contactPhone ? contactPhone : ''}`);
        }
    };
})();

$('.basePanel-content').each(function () {
    
    const id = $(this).data('idgen');
    const options = {
    };

    GeneralComponentContainer.setComponent(new PanelComponent(id, options), id);
});
$('.link-container-container').each(function () {
    const id = $(this).data('idgen');
    const idModal = $(this).data('idmodal');
    $('#' + id).on('click', (event) => {
        const modalComponent = GeneralComponentContainer.getComponentByName(idModal);
        modalComponent.showModal(true);
    });
});
$('.imageText-container').click((element) => {
    window.open($(element.currentTarget).data('compUrl'), $(element.currentTarget).data('compTarget'));
});
class DynamicPhoneComponent {
    constructor(component, componentData) {
        this.component = component;
        this.componentData = componentData;
        this.headerComponent = HeaderComponentContainer.getComponent(document.querySelector("header").getAttribute("id"));

        if (componentData !== null) {
            this.getPhone();
        }
    }

    async getPhone() {
        this.headerComponent.eventEmitter.subscribe((action) => {
            action.event == 'phoneUpdated' && this.renderPhone(window.localStorage.getItem('contactphone'));
        });
    }

    renderPhone(thePhone) {
        let phones = $(thePhone);

        this.component.addClass(this.componentData.size);
        this.component.addClass(this.componentData.alignment);

        phones.addClass(this.componentData.theme);
        phones.addClass('phones');
        phones.find('.phone-number').css("color", this.componentData.phonecolor);

        if (this.componentData.description) {
            let line = this.componentData.otherLine ? '<br/>' : '';
            let text = `<span class="${this.componentData.theme}">${this.componentData.description}</span> ${line}`;

            this.component.append(text);
        }

        this.component.append(phones);
    }
}

const dynamicphonecomponents = $('.dynamic-phone-container');
dynamicphonecomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const componentData = {
        description: component.data('description'),
        otherLine: component.data('otherline'),
        theme: component.data('theme'),
        phonecolor: component.data('phonecolor'),
        size: component.data('size'),
        alignment: component.data('alignment')
    };

    new DynamicPhoneComponent($('#' + id), componentData);
});
$(document).ready(function(){
  var sectionHeight = 0;
  $('.component-vertical-separator .side').each(function(){
    if($(this).height() > sectionHeight){
      sectionHeight = $(this).height();
    }
  });
  $('.component-vertical-separator .divider').css('height', sectionHeight);
});
const WatsonButtonComponent = (function () {

    const defaults = {
        selectors: {
            watsonButton: '.cta-watson',
            watsonChat: '.watson-chat-container',
            watsonPopup: '.card'
        },
        urls: {
            externalChat: '/chat'
        }
    };

    return class {
        constructor(props) {
            this.props = props;
            this.props.btnWatson = this.props.element.find(defaults.selectors.watsonButton);
            this.addEvents();
        }

        addEvents() {
            this.props.btnWatson.click($.proxy(this.watsonButtonClickEvt, this));
        }

        watsonButtonClickEvt() {
            if (this.props.isFullScreen) {
                const params = this.props.startchat ? `?word=${this.props.startchat}` : String.empty;
                window.open(`${defaults.urls.externalChat}${params}`, this.props.target);
            } else {
                let welcome = false;
                const buttonId = this.props.btnWatson.attr('id');
                if ($('.yes-no').length > 0) {
                    welcome = true;
                }
                const watsonChat = $(defaults.selectors.watsonChat);
                const component = new WatsonComponent(watsonChat[0], null, this.props.websocket, this.props.extraparam, this.props.apk, welcome, null, buttonId, this.props.startchat);
                watsonChat.parent().removeClass('hidden').find(defaults.selectors.watsonPopup).removeClass('no-display');
                this.props.btnWatson.attr('disabled', 'disabled');
                component.closeCallbackAdd(() => this.props.btnWatson.removeAttr('disabled'));
            }
        }
    }
})();

$('.watson-button-container').each(function () {
    const props = {
        id: $(this).attr('id'),
        websocket: $(this).data('ws'),
        extraparam: $(this).data('extraparam'),
        apk: $(this).data('desa'),
        image: $(this).data('watsonimage'),
        buttonId: $(this).data('buttonid'),
        isFullScreen: $(this).data('fullscreen') || false,
        target: $(this).data('target') || '_self',
        startchat: $(this).data('startchat'),
        element: $(this)
    };

    new WatsonButtonComponent(props);

});




$('.open-watson-btn').click(function () {
    if ($('.watson-container').length > 0) {
        $('.watson-container').removeClass('hidden');
        $('.watson-container .chat .card').removeClass('no-display');
    }
});

$('.open-watson-btn button').click(function () {
    if ($('.watson-container').length > 0) {
        $('.watson-container').removeClass('hidden');
        $('.watson-container .chat .card').removeClass('no-display');
    }
});

if ($('.prev-chat-button') && $('.prev-chat-button') != null) {
    let button = $('.prev-chat-button button');
    $(button).click(function () {
        const utm_source = new HeaderHelpers().getCookie('lp_utm_source');

        const chat_url = '/prev-chat.html' + ((utm_source !== null && utm_source !== "") ? "?utm_source=" + utm_source : "");

        window.open(chat_url, "Chat", "width=450,height=450");
    });
}



// $('.watson-button').click(function () {
//     const component = new WatsonComponent(element, chatUrl, websocket, extraparam, apk, welcome, image, buttonId);
//     //    console.log(element);
//     //    const component = new WatsonComponent(element)
// });
// function addSameDiv(divid) {
//     let child = document.getElementById(divid).children.length;
//     if (child < 1) {
//         setTimeout(function() {
//             addSameDiv(divid);

//         }, 50);
//     } else {
//         let parent = $('.sales-chat-button');
//         // const height = $(parent).height();
//         // const width = $(parent).width();
//         let children = $('#' + divid).children().attr('id');
//         // let clone = $(children).clone();
//         // $(clone).css('height', height);
//         // $(clone).css('width', width);
//         // $(clone).css('top', '-34px');
//         // $(clone).css('left', '-48px');
//         // $(clone).css('z-index', '9999');
//         // $('.sales-chat-button').append(clone);
//         // $('.sales-chat-button').css('height', height);
//         // $('.sales-chat-button').css('width', width);
//         $(parent).click(function($event) {
//             $event.preventDefault();
//             $('#' + children).click($event);
//         })

//     }
// }


// //add children of lpbutton
AnchorLinkComponent = (function () {
    const defaults = {
        "selectors": {
        },
        "states": {
        },
        "events": {
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {
            this.bindEvents();
        }

        bindEvents() {
        }
    };
})();

$('.base-anchor-link').each(function () {
    const id = $(this).data('idgen');

    GeneralComponentContainer.setComponent(new AnchorLinkComponent(id), id);
});
AlertComponent = (function () {
    const defaults = {
        "selectors": {
            "alertTitle": ".alert-title b",
            "alertDescription": ".alert-description",
            "alertClose": ".alert-icon"
        },
        "states": {
            "opened": "opened",
            "closed": "closed",
            "queued": "queued",
            "success": "success",
            "error": "error"
        },
        "events": {
            "click": "click",
            "mouseover": "mouseover",
            "mouseleave": "mouseleave"
        },
        "classes": {
            "success": "alert-success",
            "error": "alert-error"
        }
    };

    return class {
        constructor(id) {
            this.id = id;
            this.component = $('#' + this.id);
            this.initComponent();
            this.stacked = false;
            this.name = DIRECTV_PUBLIC_SITES_CONSTANTS.COMPONENTNAMES.ALERT;
        }

        initComponent() {
            this.$alertTitle = this.component.find(defaults.selectors.alertTitle);
            this.$alertDescription = this.component.find(defaults.selectors.alertDescription);
            this.$alertClose = this.component.find(defaults.selectors.alertClose);

            this.bindEvents();
        }

        bindEvents() {
            this.$alertClose.on(defaults.events.click, this.onAlertCloseHandler.bind(this));
            this.component.on(defaults.events.mouseover, this.onAlertMouseOverHandler.bind(this));
            this.component.on(defaults.events.mouseleave, this.onAlertMouseLeaveHandler.bind(this));
        }

        onAlertCloseHandler(event) {
            this.component.fadeOut("fast");
            this.stacked = false;
        }

        onAlertMouseOverHandler(event) {
            this.stacked = true;
            this.component.show();
        }

        onAlertMouseLeaveHandler(event) {
            setTimeout(() => {
                this.component.fadeOut("fast");
                this.stacked = false;
            }, 1500);
        }

        showAlert() {
            this.component.slideDown(250);

            setTimeout(() => {
                if (!this.stacked) {
                    this.component.fadeOut(250);
                    this.stacked = false;
                }
            }, 2000);
        }

        setTitle(text) {
            this.$alertTitle.text(text);
        }

        setDescription(text) {
            this.$alertDescription.text(text);
        }

        setStatus(status) {
            const target = this.component.find('.alert-content');

            target.removeClass().addClass('alert-content');

            switch (status) {
                case defaults.states.success:
                    target.addClass(defaults.classes.success); break;
                case defaults.states.error:
                    target.addClass(defaults.classes.error); break;
            }
        }
    };
})();

$('.alert-content').each(function () {
    const id = $(this).data('idgen');

    GeneralComponentContainer.setComponent(new AlertComponent(id), id);
});
const dropdowncomponents = $('.acquisition-dropdown-container');
dropdowncomponents.each((index, element) => {
    const component = $(element);
    const id = component.attr('id');
    const componentData = {
        path: component.data('path'),
        landing: component.data('landing')
    };

    new AcquisitionDropdown($('#' + id), componentData);
});
AccordeonComponent = (function () {
    const defaults = {
        "selectors": {
            "accordeonTemplateDefault": "#accordeon-template-recharge-points",
            "compiledContent": ".base-accordion-compiled-content",
            "rechargePoint": ".base-accordeon-container .base-accordeon-item"
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.options = options;
            this.component = $('#' + this.id);
            this.initComponent();
        }

        initComponent() {
            GeneralComponentContainer.setComponent(new CollapsibleComponent(this.id), this.id);
        }

        setDataSource(data, type) {
            this.initComponentDataSource();

            switch (type) {
                case "rechargePoints":
                    this.dataSource = data;
                    this.bindRechargePoints();
                    break;
                default:
                    break;
            }

            GeneralComponentContainer.setComponent(new CollapsibleComponent(this.id), this.id);
        }

        initComponentDataSource() {
            this.dataSource = [];
        }

        bindRechargePoints() {
            this.$defaultTemplate = this.component.find(defaults.selectors.accordeonTemplateDefault);
            const template = Handlebars.compile(this.$defaultTemplate.html());
            const html = [];

            for (let i = 0; i < this.dataSource.length; i++) {
                this.dataSource[i].paymentMethodTitle = this.options.paymentMethodTitle;
                this.dataSource[i].storeTitle = this.options.storeTitle;
                this.dataSource[i].addressTitle = this.options.addressTitle;
                html.push(template(this.dataSource[i]));
            }

            this.$compiledContent = this.component.find(defaults.selectors.compiledContent);
            this.$compiledContent.html('');
            this.$compiledContent.html(html.join(""));
        }
    };
})();

$('.base-accordeon-container').each(function () {

    const id = $(this).data('idgen');
    const dataSourceType = $(this).data('externaldatasource');
    const options = {};

    switch (dataSourceType) {
        case 'rechargePoints':
            options.paymentMethodTitle = $(this).data('paymentmethodtitle');
            options.storeTitle = $(this).data('storetitle');
            options.addressTitle = $(this).data('addresstitle');
            break;
        default:
            break;
    }

    GeneralComponentContainer.setComponent(new AccordeonComponent(id, options), id);
});
const AnchorLinks = (function () {
    const defaults = {
        "selectors": {
            "backgroundImage": ".dtv-anchor-links-background img",
            "anchorLinks": ".dtv-anchor-links-content-list .anchor-link a",
            "button": ".dtv-anchor-links-container .button.active",
            "header": "header",
            "phonebar": ".header-phones",
            "root": ".root"
        },
        "classes": {
            "loaded": "loaded",
            "phonesVisible": "phones-visible",
            "phonebarLock": "phonebar-locked"
        },
        "attributes": {
            "id": "id"
        },
        "events": {
            "click": "click",
            "load": "load"
        }
    };

    return class {
        constructor(id, options) {
            this.id = id;
            this.component = $('#' + this.id);
            this.eventEmitter = new rxjs.Subject();
            this.options = options;
            this.initComponent();
        }

        initComponent() {
            this.$featuredImage = this.component.find(defaults.selectors.backgroundImage);
            this.$anchorLinks = this.component.find(defaults.selectors.anchorLinks);
            this.$button = this.component.find(defaults.selectors.button);
            const genericFeaturedImage = new GenericImage(this.$featuredImage);

            this.bindEvents();
        }

        bindEvents() {
            this.$anchorLinks.on(defaults.events.click, this.onAnchorLinkClicked.bind(this));
            this.$button.on(defaults.events.click, { url: this.$button.data("actionUrl") }, this.onButtonClicked);
        }

        onAnchorLinkClicked(event) {
            event.preventDefault();
            $(defaults.selectors.root).removeClass(defaults.classes.phonesVisible);
            const $target = $(event.currentTarget);
            const idSectionToScroll = encodeURI($target.attr('href'));
            const headerHeight = $(defaults.selectors.header).innerHeight();
            const phonebarHeight = !window.matchMedia('(max-width: 969px)').matches ? $(defaults.selectors.phonebar).innerHeight() : 0;
            const targetPosition = $(idSectionToScroll).offset().top - ( headerHeight + phonebarHeight );

            $('html, body').animate({
                "scrollTop": targetPosition,
                "easing": "easein"
            }, 350 * (this.$anchorLinks.index($target) + 1));

            location.hash = idSectionToScroll;
        }

        onButtonClicked(event) {
            window.open(event.data.url, '_self');
        }
    };
})();

$('.dtv-anchor-links').each(function () {
    let idgen = $(this).data('idgen');
    
    GeneralComponentContainer.setComponent(new AnchorLinks(idgen, {}),idgen);
});
$('.activateplan-container').each(function () {
    let idgen = $(this).data('idgen');
    GeneralComponentContainer.setComponent(new GenericTabsComponent(null, idgen),idgen);
});
const BreadCrumb = (function () {
    const defaults = {
        "selectors": {
            "header": "header",
            "breadCrumb": ".cmp-breadcrumb",
            "breadCrumbContainer": ".breadcrumb",
            "backButton": ".cmp-breadcrumb__item-back",
            "subList": ".cmp-breadcrumb__sub-list"
        },
        "classes": {
            "show": "show",
            "backButton": "cmp-breadcrumb__item-back",
            "subLink": "cmp-breadcrumb__sub-link",
            "link": ".cmp-breadcrumb__item-link",
            "hide": "hide"
        },
        "events": {
            "click": "click",
            "touchstart": "touchstart",
            "totalHeaderSizeChange": "totalHeaderSizeChange",
            "isHeaderStickyChange": "isHeaderStickyChange"
        },
        "attributes": {
            "id": "id"
        },
        "replaces": {
            "footerPages": "/footer-pages"
        }
    };

    return class {
        constructor() {
            this.$component = $(defaults.selectors.breadCrumb);
            this.$componentContainer = $(defaults.selectors.breadCrumbContainer);
            this.initComponent();
        }

        initComponent() {
            const headerContainer = $(defaults.selectors.header);

            this.$backButton = this.$component.find(defaults.selectors.backButton);
            this.$subList = this.$component.find(defaults.selectors.subList);
            this.headerComponent = HeaderComponentContainer.getComponent(headerContainer.attr(defaults.attributes.id));
            this.replaceUrl(defaults.replaces.footerPages, '');
            this.bindEvents();

            if (this.headerComponent) {
                this.updatePosition(this.headerComponent.getTotalHeaderSize());
                this.updateVisibility(this.headerComponent.isHeaderSticky);
            }
        }

        bindEvents() {
            this.$backButton.on(defaults.events.click, this.handleButtonBackClick.bind(this));
            $(document).on(defaults.events.touchstart + ' ' + defaults.events.click, this.closeBreadCrumb.bind(this));

            this.headerComponent && this.headerComponent.eventEmitter.subscribe((action) => {
                switch (action.event) {
                    case defaults.events.totalHeaderSizeChange:
                        this.updatePosition(action.data);
                        break;
                    case defaults.events.isHeaderStickyChange:
                        this.updateVisibility(action.data);
                        break;
                }
            });
        }

        replaceUrl(oldUrl, newUrl) {
            setTimeout(function(){
                $(defaults.classes.link).each(function(){
                    var link = $(this);
                    var href = link.prop('href');
                    href = href.replace(oldUrl, newUrl);
                    link.prop('href', href);
                });
            }, 1000);
        }

        updatePosition(headerSize) {
            this.$componentContainer.css('top', headerSize || 0);
        }

        updateVisibility(isHeaderSticky) {
            this.$component.toggleClass(defaults.classes.hide, !!isHeaderSticky);
        }

        handleButtonBackClick() {
            this.$subList.toggleClass(defaults.classes.show);
        }

        closeBreadCrumb(event) {
            const $target = $(event.target);

            if (!$target.hasClass(defaults.classes.backButton)
                && !$target.hasClass(defaults.classes.subLink)
                && this.$subList.hasClass(defaults.classes.show)) {
                this.$subList.removeClass(defaults.classes.show);
            }
        }
    };
})();

new BreadCrumb();
class premiumPackLandingPageLogic {

    constructor(desktopImage, mobileImage, component) {
        this.desktopImage = desktopImage;
        this.mobileImage = mobileImage;
        this.component = component;
        this.setBackgroundImage();
        this.setResizedBackgroundImage();
    }

    setResizedBackgroundImage() {
        $(window).resize(() => {
            this.setBackgroundImage();
        });
    }

    setBackgroundImage() {
        const width = $(window).width();
        const landingContainer = this.component.find('.promotional-back-image');

        if (width < 481) {
            landingContainer.css('background-image', `url('${this.mobileImage}')`);
        } else {
            landingContainer.css('background-image', `url('${this.desktopImage}')`);
        }
    }
};

const componentsPremiumPackLanding = $('.premium-pack-landing-page-container');
componentsPremiumPackLanding.each((index, element) => {
    desktopImage = $(element).data('desktopimage');
    mobileImage = $(element).data('mobileimage');
    new premiumPackLandingPageLogic(desktopImage, mobileImage, $(element));
});
const PremiumPackageDetailComponentDynamic = (function () {
    const defaults = {
        "values": {
            "monochannel": "monochannel",
            "package": "package"
        },
        "classes": {
            "noMarginTop": "no_margin_top"
        }
    };

    const getPathFromParam = (param) => {
        const search = new URLSearchParams(location.search);
        const locale = search.get('locale');

        this.packagesUrl = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + 'bundles.html/';

        return param === '' && locale != null ? this.packagesUrl + search.get('locale') : param;
    };

    const channelOnlyPack = (data) => {
        return data.totalChannels === 1;
    };

    return class {
        constructor(path, translateData, pageType, locale) {
            this.path = getPathFromParam(path);
            this.pageType = pageType;
            this.locale = locale;
            this.translateData = translateData;
            this.component = $('.premium-package-detail-container-dynamic');
            this.getComponents();
            this.getData();
        }

        getComponents() {
            this.packFeaturedComponent = GeneralComponentContainer.getComponent(this.component.find("#premium-package-featured").children().attr('id'));
            this.packOffersLane = GeneralComponentContainer.getComponent(this.component.find("#pack-offers-lane").children().attr('id'));
            this.dynamicTabs = GeneralComponentContainer.getComponent(this.component.find(".tab_wrapper").attr('id'));
            this.wizardHeader = GeneralComponentContainer.getComponent(this.component.find(".wizard-header-content").parent().attr('id'));
            this.onlyChannel = GeneralComponentContainer.getComponent(this.component.find("#premium-pack-channel-only").children('.premiumpackchannelonly-container').attr('id'));
            this.ottFeaturedProducts = GeneralComponentContainer.getComponent(this.component.find("#ott-featured-products").children().attr('id'));
            this.getHeaderComponent();

            this.wizardHeader.eventEmitter.subscribe((info) => {
                if (this.$headerComponent && info.event === 'component-updated') {
                    this.$headerComponent.generalResize();
                }
            });
        }

        getHeaderComponent() {
            if (!this.editMode) {
                this.$headerComponent = this.component.find("header");

                if (this.$headerComponent) {
                    this.$headerComponent = HeaderComponentContainer.getComponent(this.$headerComponent.attr('id'));
                }
            }
        }

        getData() {
            if (this.path) {
                GlobalData.getMultipleData([{
                    path: this.path,
                    doAfter: (data) => data[0]
                },
                GlobalData.defaults.requestData.SETTINGS
                ]).subscribe(
                    (result) => {
                        try {
                            this.initConfiguration(
                                result[0],
                                result[1].general
                            );
                        } catch (e) {
                            console.log(e);
                        }
                    }
                );
            }
        }

        setResponsiveBehavior() {
            this.setHeaderPadding();
            $(window).resize(() => {
                this.setHeaderPadding();
            });
        }

        setHeaderPadding() {
            this.packFeaturedComponent.component.css('padding-bottom',
                (this.packOffersLane.component.outerHeight() / 2) + 'px');
        }

        initConfiguration(dataPackage, general) {
            const channels = dataPackage.hlchannels;
            const ottBanner = this.component.find("#ott-featured-products");

            this.packFeaturedComponent.setHighlightedChannels(channels.slice(0, 3));
            this.wizardHeader.setHeaderType('prpackage');
            this.wizardHeader.fillData(dataPackage);

            this.wizardHeader.setAcquisitionDrop(dataPackage);

            this.packOffersLane.fillData(dataPackage);
            this.clearLayoutWhenNoOffers(dataPackage);
            this.setResponsiveBehavior();

            if (this.pageType === 'monochannel') {
                if (channelOnlyPack(dataPackage)) {
                    this.component.find('.monochannel-content\x20.pdp-boxed-container:first-child').addClass('hide');
                }

                const packOnlyChan = dataPackage.packs.filter((tab) => tab.totalChannels === 1);

                packOnlyChan.forEach((v) => {
                    this.onlyChannel.setChannel({
                        backImage: v.image,
                        logo: v.channels[0].logo,
                        name: v.channels[0].name,
                        number: v.channels[0].number,
                        price: v.infoPacks[0].formattedPrice,
                        description: v.infoPacks[0].punchline,
                        url_redirect: v.infoPacks[0].subscribe,
                        ctaText: v.infoPacks[0].ctaText,
                        currency:general.currency
                    });
                });

                this.dynamicTabs.setData(dataPackage, false);
                ottBanner.find('.dtv-ott-featured-product-site').addClass('ott-monochannel-mode');
            } else {
                this.dynamicTabs.setData(dataPackage, true);
            }
        }

        clearLayoutWhenNoOffers(bundle) {
            const pos = !!bundle.postref.infoPacks[0];
            const pre = !!bundle.preref.infoPacks[0];
            const posText = pos ? bundle.postref.infoPacks[0].offerlong : "";
            const preText = pre ? bundle.preref.infoPacks[0].offerlong : "";

            if (posText + preText == "") {
                $('#premium-pack-channels-detail-grid').addClass(defaults.classes.noMarginTop);
            }
        }
    };
})();

const componentspremiumpackagedynamic = $('.premium-package-detail-container-dynamic');
componentspremiumpackagedynamic.each((index, element) => {
    const page = $(element);
    const previewmode = page.data('previewmode');
    const path = page.data('path');
    const mode = page.data('mode');
    const pageType = page.data('pagetype');
    const country = page.data('country');
    const language = page.data('language');
    const locale = country + '/' + language;
    new PremiumPackageDetailComponentDynamic(path, {}, pageType, locale);
});
const PremiumPackageDetailComponent = (function () {
    const defaults = {
        "values": {
            "monochannel": "monochannel",
            "package": "package"
        },
        "classes": {
            "noMarginTop": "no_margin_top"
        }
    };

    const getPathFromParam = (param) => {
        const search = new URLSearchParams(location.search);
        const locale = search.get('locale');

        this.packagesUrl = DIRECTV_PUBLIC_SITES_CONSTANTS.ENDPOINTPATH + 'bundles.html/';

        return param === '' && locale != null ? this.packagesUrl + search.get('locale') : param;
    };

    const channelOnlyPack = (data) => {
        return data.totalChannels === 1;
    };

    return class {
        constructor(path, translateData, pageType, locale) {
            this.path = getPathFromParam(path);
            this.pageType = pageType;
            this.locale = locale;
            this.translateData = translateData;
            this.component = $('.premium-package-detail-container');
            this.getComponents();
            this.getData();
        }

        getComponents() {
            this.packFeaturedComponent = GeneralComponentContainer.getComponent(this.component.find("#premium-package-featured").children().attr('id'));
            this.packOffersLane = GeneralComponentContainer.getComponent(this.component.find("#pack-offers-lane").children().attr('id'));
            this.dynamicTabs = GeneralComponentContainer.getComponent(this.component.find(".tab_wrapper").attr('id'));
            this.wizardHeader = GeneralComponentContainer.getComponent(this.component.find(".wizard-header-content").parent().attr('id'));
            this.onlyChannel = GeneralComponentContainer.getComponent(this.component.find("#premium-pack-channel-only").children('.premiumpackchannelonly-container').attr('id'));
            this.ottFeaturedProducts = GeneralComponentContainer.getComponent(this.component.find("#ott-featured-products").children().attr('id'));
            this.getHeaderComponent();

            this.wizardHeader.eventEmitter.subscribe((info) => {
                if (this.$headerComponent && info.event === 'component-updated') {
                    this.$headerComponent.generalResize();
                }
            });
        }

        getHeaderComponent() {
            if (!this.editMode) {
                this.$headerComponent = this.component.find("header");

                if (this.$headerComponent) {
                    this.$headerComponent = HeaderComponentContainer.getComponent(this.$headerComponent.attr('id'));
                }
            }
        }

        getData() {
            if (this.path) {
                GlobalData.getMultipleData([{
                    path: this.path,
                    doAfter: (data) => data[0]
                },
                GlobalData.defaults.requestData.SETTINGS
                ]).subscribe(
                    (result) => {
                        try {
                            this.initConfiguration(
                                result[0],
                                result[1].general
                            );
                        } catch (e) {
                            console.log(e);
                        }
                    }
                );
            }
        }

        setResponsiveBehavior() {
            this.setHeaderPadding();
            $(window).resize(() => {
                this.setHeaderPadding();
            });
        }

        setHeaderPadding() {
            this.packFeaturedComponent.component.css('padding-bottom',
                (this.packOffersLane.component.outerHeight() / 2) + 'px');
        }

        initConfiguration(dataPackage, general) {
            const channels = dataPackage.hlchannels;
            const ottBanner = this.component.find("#ott-featured-products");

            this.packFeaturedComponent.setHighlightedChannels(channels.slice(0, 3));
            this.wizardHeader.setHeaderType('prpackage');
            this.wizardHeader.fillData(dataPackage);

            this.wizardHeader.setAcquisitionDrop(dataPackage);

            this.packOffersLane.fillData(dataPackage);
            this.clearLayoutWhenNoOffers(dataPackage);
            this.setResponsiveBehavior();

            if (this.pageType === 'monochannel') {
                if (channelOnlyPack(dataPackage)) {
                    this.component.find('.monochannel-content\x20.pdp-boxed-container:first-child').addClass('hide');
                }

                const packOnlyChan = dataPackage.packs.filter((tab) => tab.totalChannels === 1);

                packOnlyChan.forEach((v) => {
                    this.onlyChannel.setChannel({
                        backImage: v.image,
                        logo: v.channels[0].logo,
                        name: v.channels[0].name,
                        number: v.channels[0].number,
                        price: v.infoPacks[0].formattedPrice,
                        description: v.infoPacks[0].punchline,
                        url_redirect: v.infoPacks[0].subscribe,
                        ctaText: v.infoPacks[0].ctaText,
                        currency:general.currency
                    });
                });

                this.dynamicTabs.setData(dataPackage, false);
                ottBanner.find('.dtv-ott-featured-product-site').addClass('ott-monochannel-mode');
            } else {
                this.dynamicTabs.setData(dataPackage, true);
            }
        }

        clearLayoutWhenNoOffers(bundle) {
            const pos = !!bundle.postref.infoPacks[0];
            const pre = !!bundle.preref.infoPacks[0];
            const posText = pos ? bundle.postref.infoPacks[0].offerlong : "";
            const preText = pre ? bundle.preref.infoPacks[0].offerlong : "";

            if (posText + preText == "") {
                $('#premium-pack-channels-detail').addClass(defaults.classes.noMarginTop);
            }
        }
    };
})();

const componentspremiumpackage = $('.premium-package-detail-container');
componentspremiumpackage.each((index, element) => {
    const page = $(element);
    const previewmode = page.data('previewmode');
    const path = page.data('path');
    const mode = page.data('mode');
    const pageType = page.data('pagetype');
    const country = page.data('country');
    const language = page.data('language');
    const locale = country + '/' + language;
    new PremiumPackageDetailComponent(path, {}, pageType, locale);
});
const PlansPageLandingComponent = (function () {
    const defaults = {
        "selectors": {
            "alert": ".alert-component"
        }
    };

    return class {
        constructor(editMode, country) {
            this.component = $('.plans-landing-page-container');
            this.editMode = editMode;
            this.country = country;
            this.helpers = new Helpers();
            this.getComponents();
        }

        getComponents() {
            this.productOrderComponent = GeneralComponentContainer
                .getComponent(this.component.find("#product-order-clasification").children().attr('id'));

            this.callmeNowComponent = GeneralComponentContainer
                .getComponent(this.component.find("#callmenow-container").children().attr('id'));

            this.callmeLaterComponent = GeneralComponentContainer
                .getComponent(this.component.find("#callme-later-component").children().attr('id'));

            this.callmeLaterModule = GeneralComponentContainer
                .getComponent(this.component.find(".module-callme-later-component").attr('id'));

            this.getAlert();

            this.getCallmeLaterComponent();
            this.getCallmeNowComponent();
            this.productOrderComponent.eventEmitter.pipe(
                rxjs.operators.filter((action) => action.event === 'end-load'),
                rxjs.operators.mergeMap((action) => action.data)
            ).subscribe((info) => {
                let modalTitle = "";

                if (info.event === 'make-call') {
                    if (this.callmeNowComponent) {
                        modalTitle = `${this.callmeNowComponent.modalTitle}\x20${info.data}`;
                        this.callmeNowComponent.$title.html(modalTitle);
                        this.callmeNowComponent.openModal();
                    } else if (this.helpers.isMobile()) {
                        window.open(`tel:${info.phone}`, '_system');
                    }
                }

                if (info.event === 'leave-data') {
                    modalTitle = `${this.callmeLaterComponent.modalTitle}\x20${info.data}`;
                    this.callmeLaterComponent.$callmeLaterTitle.html(modalTitle);
                    this.callmeLaterModule.callMeLaterForm.initProperties();
                    this.callmeLaterModule.setReasonId(info.reasonId);
                    this.callmeLaterComponent.openModal();
                }
            });
        }

        getCallmeLaterComponent() {
            if (!this.editMode) {
                if (this.callmeLaterComponent) {
                    this.callmeLaterComponent.eventEmitter.subscribe((info) => {

                        if (info.event === 'callme-later-submit') {
                            this.callmeLaterComponent.closeModal();
                            this.$alertComponent.setTitle(this.callmeLaterComponent.successTitle);
                            this.$alertComponent.setDescription(this.callmeLaterComponent.successDescription);
                            this.$alertComponent.setStatus('success');
                            this.$alertComponent.showAlert();
                        }

                        if (info.event === 'callme-later-submit-error') {
                            this.$alertComponent.setTitle(this.callmeLaterComponent.errorTitle);
                            this.$alertComponent.setDescription(this.callmeLaterComponent.errorDescription);
                            this.$alertComponent.setStatus('error');
                            this.$alertComponent.showAlert();
                        }
                    });
                    this.callmeLaterComponent.modalTitle = this.callmeLaterComponent.$callmeLaterTitle.html();
                }
            }
        }

        getCallmeNowComponent() {
            if (!this.editMode) {
                if (this.callmeNowComponent) {
                    this.callmeNowComponent.eventEmitter.subscribe((info) => {
                        if (info.event === 'callmenow-submit') {
                            this.callmeNowComponent.closeModal();
                            this.$alertComponent.setTitle(this.callmeNowComponent.successTitle);
                            this.$alertComponent.setDescription(this.callmeNowComponent.successDescription);
                            this.$alertComponent.setStatus('success');
                            this.$alertComponent.showAlert();
                        }

                        if (info.event === 'callmenow-submit-error') {
                            this.$alertComponent.setTitle(this.callmeNowComponent.errorTitle);
                            this.$alertComponent.setDescription(this.callmeNowComponent.errorDescription);
                            this.$alertComponent.setStatus('error');
                            this.$alertComponent.showAlert();
                        }
                    });

                    this.callmeNowComponent.closeModal();
                    this.callmeNowComponent.modalTitle = this.callmeNowComponent.$title.html();
                }
            }
        }

        getAlert() {
            if (!this.editMode) {
                this.$alertComponent = this.component.find(defaults.selectors.alert);

                if (this.$alertComponent) {
                    this.$alertComponent = GeneralComponentContainer.getComponent(this.$alertComponent.children().attr('id'));
                }
            }
        }
    };
})();

const componentsTemplatePlans = $('.plans-landing-page-container');
componentsTemplatePlans.each((index, element) => {
    const page = $(element);
    const previewmode = page.data('previewmode');
    const editmode = page.data('editmode');
    const country = page.data('country');
    new PlansPageLandingComponent(previewmode || editmode, country);
});
function footerCollapse(section){
    if(screen.width < 970){
        var chevron = section.children[0].children[1].children[0];
        var that = section.children[1];
        var openUL = document.getElementsByClassName('section-open');
        var allChevron = document.getElementsByClassName('chevron-down');

        that.removeAttribute('style');

        [].forEach.call(allChevron, function (el) {
            el.children[0].removeAttribute('style');
        });

        if (!that.classList.contains('section-open')) {
            [].forEach.call(openUL, function (el) {
                el.classList.remove('section-open');
                el.removeAttribute('style');
            });
        }
        
        if (!that.classList.contains('section-open')) {
            that.classList.add('section-open');
            that.style.display = 'block';
            chevron.style.transform = "rotate(225deg)";
            chevron.style.marginBottom = "-2px";
        }
        else {
            [].forEach.call(openUL, function (el) {
                el.classList.remove('section-open');
                el.removeAttribute('style');
            });
        }
    }
}
function lazyLoading(selector,initAttribute,finalAttribute) {
    const images = document.querySelectorAll(selector);
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting === true) {
                const image = entry.target;
                const realPath = image.getAttribute(initAttribute);
                if (realPath) {
                    image.setAttribute(finalAttribute, realPath);
                    image.removeAttribute(initAttribute);
                }
                observer.unobserve(image);
            }
        });
    });
    images.forEach(image => {
        observer.observe(image);
    });
}

window.addEventListener('load', (event) => {
    lazyLoading('img[data-src]','data-src','src');
    lazyLoading('source[data-srcset]','data-srcset','srcset');
    lazyLoading('*[data-lazybackimage]','data-lazybackimage','style');
});

